!function(){"use strict";define(["_routes","utility","angular","googleMaps"],function(e,t,i){e.register.directive("ahcUpsell",["$rootScope","navConstantsSvc","authService","corpLabsService","$state","apiProvider","$httpParamSerializer","$stateParams","$timeout","notify","$location","$uibModal","$interval",function(e,t,i,a,n,s,r,o,c,l,d,p,u){return{restrict:"AE",scope:{upSellObj:"=?",upsellCart:"=?",essFunc:"=?"},terminal:!0,priority:1e6,templateUrl:"labtest/templates/ahcUpsell.html?"+timeStamp,link:function(t,n,r){function o(e,i){_.isEmpty(e)||(t.upsellCart.updated||(t.upsellCart.updated=!0),"+"==i?t.upsellCart.items.push({packageId:e.packageId,patientId:e.patientId}):t.upsellCart.items=t.upsellCart.items.filter(function(t){return t.packageId!=e.packageId&&t.patientId!=e.patientId}),t.upsellCart.recentPatientId=e.patientId)}function d(e,i){if(!_.isEmpty(t.famPipeline[e])){var n=[];_.each(i,function(i){t.famPipeline[e].forEach(function(e){var t=JSON.parse(JSON.stringify(e));t.patientId=i.maid,t.relation=i.relation,t.source="upsell",n.push(t),o({packageId:e.packageId,patientId:i.maid},"+")})});var s=t.mergeList.isLabVisit?{providerId:_.first(t.upSellObj.providerIds)}:{};a.addItemsToCart(n,"+",!1,!0,{},s),t.famPipeline[e]=[]}}function p(){t.mergeList=a.labsCart(),t.packagePipeline={show:!1,providerId:0},t.beneficiaries=[],t.selectedBenef={maid:0,relation:"",groupedPackages:[],packages:[],currentCnt:3,maxCnt:3},t.famPipeline={show:!1,selectedItems:[],pendingItems:[],transit:!1,refreshCart:!1},t.familyPopupConfig={hideBenefs:!0,src:"ahcUpsell",defaultRelation:""},t.fetchUpsellPackages()}function u(){var e=_.isEmpty(t.mergeList)?[]:_.union(t.mergeList.tests,t.mergeList.packages);return{upsellFrom:t.upSellObj.src,upsellType:_.isEmpty(t.beneficiaries)?"":_.uniq(_.flatten(t.beneficiaries.map(function(e){return e.contracts}))).join(),cartItems:e.length,dependentCountSelected:_.uniq(_.pluck(e,"patientId")).filter(function(e){return e}).length}}function g(e,i,a){var n=t.mergeList?_.union(t.mergeList.tests,t.mergeList.packages):[];_.isEmpty(e)&&(e=n),_.isEmpty(t.selectedBenef.groupedPackages)||_.each(t.selectedBenef.groupedPackages,function(n){_.each(n,function(n){var s=e.find(function(e){return e.packageId==n.packageId&&e.patientId==t.selectedBenef.maid});s?(n.selected="+"==i,n.cartId=s.cartId,n.showCount=0):a&&(n.selected=!1,n.cartId=0,n.showCount=0,n.hideItem=!1)})}),_.isEmpty(t.selectedBenef.packages)||_.each(t.selectedBenef.packages,function(n){var s=e.find(function(e){return e.packageId==n.packageId&&e.patientId==t.selectedBenef.maid});s?(n.selected="+"==i,n.cartId=s.cartId,n.showCount=0):a&&(n.selected=!1,n.cartId=0,n.showCount=0,n.hideItem=!1)})}function f(){_.each(h,function(e,t){c.cancel(e),e&&(e.destroy(),h[t]=null,b[t]=null)})}t.isLoading=!0,t.upSellObj||(t.upSellObj={}),t.upsellCart&&t.upsellCart.items||(t.upsellCart={updated:!1,items:[]}),t.essFunc||(t.essFunc={}),t.isMobileView=e.isMobileView,window.updateSrc=!0;var m=i.isUserSignedin(),v=null;t.fetchUpsellPackages=function(){t.isLoading=!0,i.makeAjaxCalls(s.apiUrl+"/labs/v1/FetchUpsellPackages",{providerIds:t.upSellObj.providerIds,isLabVisit:t.mergeList.isLabVisit},"POST",m.token,i.getCity()).then(function(e){if(_.isEmpty(e.data.labsUpsellDetails)||_.isEmpty(e.data.labsUpsellDetails.benefDetails)||!e.data.labsUpsellDetails.benefDetails.some(function(e){return!_.isEmpty(e.benefRelationPackageIds)}))t.errorScreen=!0,a.sendEvents("No Upsell Packages Found",u());else{t.beneficiaries=[];var i=e.data.labsUpsellDetails;_.each(i.packages,function(e){e.isHomeSampleAvailable||(e.priceRange=Math.round(1.3*e.priceRange))}),_.each(i.benefDetails,function(e){_.isEmpty(e.beneficiaries)&&e.defaultBeneficiary&&!_.isEmpty(e.benefRelationPackageIds)&&!_.isEmpty(i.packages)?t.beneficiaries.push({"default":!0,relationName:e.relation,relation:e.relation,icon:a.getGenderIcon(1,e.gender,35),selected:!1,active:!0,contracts:_.uniq(i.packages.map(function(e){return e.contractId})),maid:-1,name:e.relation,packages:i.packages.filter(function(t){return e.benefRelationPackageIds.includes(t.packageId)})}):_.isEmpty(e.beneficiaries)||_.each(e.beneficiaries,function(e){var n={};_.extend(n,e),n.icon=a.getGenderIcon(e.maid,e.gender,e.age),n.packages=_.isEmpty(e.packagesListing)?[]:e.packagesListing,_.isEmpty(i.packages)||(n.packages=n.packages.concat(i.packages.filter(function(t){return e.paidPackage.includes(t.packageId)}))),n.relation=n.relationName,n.contracts=_.uniq(i.packages.map(function(e){return e.contractId})),n.active=!_.isEmpty(n.packages),n.sponsored=!_.isEmpty(e.sponsPackage),t.beneficiaries.push(n)})});var n={};if(t.selectedBenef.maid||(n=_.first(t.beneficiaries.filter(function(e){return e.active}))),_.isEmpty(n))if(_.isEmpty(v))l({message:"No packages found for added patient",position:"center",duration:5e3});else if(n=t.beneficiaries.find(function(e){return e.maid==v.maid}),_.isEmpty(n))l({message:"No packages found for added patient",position:"center",duration:5e3});else if(!_.isEmpty(t.famPipeline.pendingItems)){var s=t.famPipeline.pendingItems.map(function(e){return e.packageId});if(!_.isEmpty(s)){var r=n.packages.map(function(e){return e.packageId});_.every(s,function(e){return r.includes(e)})?d("pendingItems",[{maid:n.maid,relation:n.relationName}]):l({message:"The selected patient is not eligible for the package, please select different one",position:"center",duration:5e3})}}_.isEmpty(n)&&t.selectedBenef.maid&&(n=t.beneficiaries.find(function(e){return e.maid==t.selectedBenef.maid})),t.errorScreen=_.isEmpty(n),_.isEmpty(n)||(c(function(){h.beneficon.scrollItem(t.beneficiaries.findIndex(function(e){return e.maid==n.maid}))},700),t.onClickOfBenef(n))}t.isLoading=!1})["catch"](function(e){t.isLoading=!1,t.errorScreen=!0,a.sendEvents("Error In Loading Packages",u())})},t.onClickOfPackageCard=function(e){t.packagePipeline.show=!0,t.mergeList.isLabVisit&&(t.packagePipeline.providerId=_.first(t.upSellObj.providerIds)),t.packagePipeline.packageId=e},p(),t.onClickOfBenef=function(e){t.selectedBenef.maid=e.maid,t.selectedBenef.relation=e.relationName,t.selectedBenef.groupedPackages=[],t.selectedBenef.packages=[];var i=-1;_.each(e.packages,function(e,a){e.price||(e.price=e.estimatedPrice),e.display=!0,t.selectedBenef.packages.push(e),a%2==0&&(t.selectedBenef.groupedPackages.push([]),i++),t.selectedBenef.groupedPackages[i].push(e)}),t.selectedBenef.maxCnt=t.selectedBenef.packages.length,_.each(t.beneficiaries,function(t){t.selected=e.maid!=-1?t.maid==e.maid:e.relation==t.relation}),c(function(){t.essFunc.refreshGlider()}),g([],"+",!0)},t.viewMoreTests=function(){t.selectedBenef.currentCnt<t.selectedBenef.maxCnt?(_.each(t.selectedBenef.packages,function(e,i){i<t.selectedBenef.currentCnt||i>=t.selectedBenef.currentCnt+3||c(function(){t.selectedBenef.currentCnt+=1},i%3*30)}),c(function(){var e=document.getElementById("view-more-tests");e&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},100)):(c(function(){var e=document.getElementById("labTests-section");e&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},100),_.each(t.selectedBenef.packages,function(e,i){i<3||(t.selectedBenef.currentCnt-=1)}))},t.essFunc.upsellPageEvent=function(){a.sendEvents("Upsell Page",u())},t.addBenef=function(e){a.sendEvents("Add Family Member Clicked",u()),t.famPipeline.show=!0,t.familyPopupConfig.defaultRelation=""},t.addItem=function(e,i,n,s){if(e.relation=t.selectedBenef.relation,a.sendEvents("Add To Cart Button Clicked",{CartSource:"upsell"},new Array(e)),s&&s.stopPropagation(),t.selectedBenef.maid==-1)return t.familyPopupConfig.defaultRelation=t.selectedBenef.relation,void(t.famPipeline={selectedItems:[],pendingItems:new Array(e)||[],show:!0});e.selected=!0,e.patientId=t.selectedBenef.maid,e.source="upsell",o({packageId:e.packageId,patientId:e.patientId},"+");var r=t.mergeList.isLabVisit?{providerId:_.first(t.upSellObj.providerIds)}:{};a.addItemsToCart(new Array(e),"+",!1,!!m,{},r)},t.removeItem=function(e,i,n,s){a.sendEvents("Remove From Cart Button Clicked",{CartSource:"upsell"},new Array(e)),s&&s.stopPropagation(),e.selected=!1,e.patientId=t.selectedBenef.maid,e.relation=t.selectedBenef.relation,o({packageId:e.packageId,patientId:e.patientId},"-");var r=t.mergeList.isLabVisit?{providerId:_.first(t.upSellObj.providerIds)}:{};a.addItemsToCart(new Array(e),"-",!1,!!m,{},r)};var h={},b={},k={};t.initializeGlider=function(e,i,a){k[e]=c(function(){b[e]=document.querySelector("#"+e),b[e]&&(h[e]=new Glider(b[e],{slidesToShow:t.isMobileView?i[0]:i[1],slidesToScroll:a||1,draggable:!1,scrollLock:!0,skipTrack:!0,duration:1.5,arrows:!t.isMobileView&&{prev:".prev-"+e,next:".next-"+e}}))},10)},t.essFunc.refreshGlider=function(){_.each(h,function(e){e&&e.refresh&&e.refresh()})};var y=e.$on("cartItemsUpdated",function(e,i){t.mergeList=a.labsCart(),g(i.cartItems,i.op,i.refresh)}),I=t.$on("addedBenefeciary",function(e,i){v=null,_.isEmpty(i)||_.isEmpty(i.employeeDetail)||(v=_.first(i.employeeDetail.beneficiaries.filter(function(e){return e.maid==i.vasBenefId}))),t.famPipeline.show=!1,t.fetchUpsellPackages()});t.$on("$destroy",function(e){f(),_.each(k,function(e){c.cancel(e)}),I(),y(),window.updateSrc=!1})}}}]),e.register.directive("cartFooter",["$rootScope","navConstantsSvc","authService","corpLabsService","$state","apiProvider","$httpParamSerializer","$stateParams","$timeout","notify","$location","$uibModal","$interval",function(e,t,i,a,n,s,r,o,c,l,d,p,u){return{restrict:"AE",scope:{cartPipeline:"=?"},terminal:!0,priority:1e6,templateUrl:"labtest/templates/cartFooter.html?"+timeStamp,link:function(t,i,s){function r(){a.remLabsStickyHeader(),t.hideCartFooter=!0,a.dialog.centerVisitPopup=!0;var i=p.open({animation:!0,backdrop:"none",template:'<div class="modal-bottom-header modal-header p-t-10 p-l-20 p-r-20 primary-color"><div class="btn-border-close m-b-20"><span class="cursor-pointer pull-right" ng-style="{\'color\':isHover ? \'#000\' : \'#aaa\'}" ng-class="{\'md-dark-color\':isMobileView}" ng-init="isHover=false;" ng-mouseover="isHover=true;" ng-mouseout="isHover=false;" ng-click="closeModal()">close</span></div><div class="lgTxt bold">All Added Tests will be done at the Lab Centre of your choice</div></div><div class="modal-body primary-color modal-border-body clearfix" ng-class="{\'p-t-0\':!isMobileView}"><div class="col-xs-12 col-md-12 p-l-0 p-r-0"><div class="m-b-5 order-actions"><ul class="p-l-0 test-guidelines"><li class="light-bold smdTxt" ng-repeat="test in centerVisitTest">{{test}}</li></ul></div><span>Test requires special equipments for which you will have to visit the Lab Centre. You can select Lab Centre while Checking Out.</span><button class="br-15 btn btn-primary btn-block p-t-10 p-b-10 m-t-20" ng-click="continue()">Continue</button></div></div>',scope:t,controller:["$scope","$uibModalInstance",function(e,n){e.centerVisitTest=t.cartPipeline.cvPackages,e.closeModal=function(){n.dismiss("cancel")},i.result["catch"](function(){t.dialog.labsFixedHeader&&a.addLabsStickyHeader(),a.dialog.centerVisitPopup=!1,t.hideCartFooter=!1}),e["continue"]=function(){e.closeModal(),t.goToCart()}}],size:e.isMobileView?"bottom":"border modal-sm",windowClass:e.isMobileView&&"bottom-sheet"})}window.updateSrc=!0,t.isMobileView=e.isMobileView,t.cartPipeline||(t.cartPipeline={}),t.dialog=a.dialog,t.hideCartFooter=!1,t.goToCart=function(e){return e&&a.sendEvents("Go To Cart Button Clicked"),e&&t.cartPipeline.isLabVisit&&!a.providerParams.providerSelected?void r():void n.go("app.consumerCart")}}}}]),e.register.directive("corporateBenefits",["$rootScope","navConstantsSvc","authService","corpLabsService","$state","apiProvider","$httpParamSerializer","$stateParams","$timeout","notify","$location","$uibModal","$interval",function(e,t,i,a,n,s,r,o,c,l,d,p,u){return{restrict:"AE",scope:{obj:"=?",pipeline:"=?",blockDetails:"@"},terminal:!0,priority:1e6,templateUrl:"labtest/templates/corporateBenefits.html?"+timeStamp,link:function(t,r,o){function l(e){t.data=e,t.walletstring=e.walletServiceList.join(" | "),t.loaded=!0,t.corpBenefits=e}function g(){t.loaded=!1,i.makeAjaxCalls(s.apiUrl+"/Labs/v1/FetchCorporateBenefits",{fetchWalletServices:!0},"POST",t.user.token,i.getCity(),!0).then(function(e){e.data.isSuccess?(e.data.showDiscountedBanner&&(v+=1),e.data.showCorporateWalletBanner&&(v+=1),e.data.showCorporateBenefitsBanner&&(v+=1),a.corpBenfits=e.data,l(e.data)):t.hide=!0,t.$emit("corporateBenefits",e.data),t.loaded=!0})["catch"](function(e){t.hide=!0,t.loaded=!0})}function f(){t.user&&!t.user.isRetailUser&&(t.ahcBanner="/assets/banners/ahc_sponsored.webp",11187059==t.user.userDetails.pmEntityID&&(t.ahcBanner="/assets/banners/ahc_sponsored_mb_premio.webp"),_.isEmpty(a.corpBenfits)?g():l(a.corpBenfits))}function m(){if(h){var e=(h.slide+1)%(t.isMobileView?v:v-2);h.scrollItem(e)}else u.cancel(k)}t.user=i.isUserSignedin(),t.isMobileView=e.isMobileView,t.isRetailUser=t.user.isRetailUser||!t.user,t.loaded=!1,t.hide=!1,t.rtpcr=17879937,t.landingPage=n.includes("app.home");var v=0;t.landingPage||(v+=1),t.redirectToCorpote=function(){a.sendEvents("Corporate Benefits Banner Clicked"),d.url("/consumercorporatelabs")},t.fetchBeneficiaries=function(){i.makeAjaxCalls(s.apiUrl+"/Labs/v1/FetchBenefeciary.json","","GET",t.user.token).then(function(e){e.data.isSuccess&&!_.isEmpty(e.data.employeeDetail)&&(t.benefeciaries=e.data.employeeDetail.beneficiaries,_.each(t.benefeciaries,function(e){e.icon=a.getGenderIcon(e.maid,e.gender,e.age)}))})},f();var h=null,b=null,k=null;t.initializeGlider=function(){c(function(){b=document.querySelector("#corporate-benefits"),b&&b.addEventListener("glider-animated",function(e){k&&(u.cancel(k),k=null),k=u(m,3e3)}),b&&(h=new Glider(b,{slidesToShow:t.isMobileView?1:3,slidesToScroll:1,draggable:!1,scrollLock:!0,skipTrack:!0,duration:1.5,dots:"#dots-corporate-benefits"})),v>1&&(k=u(m,3e3))},10)},t.onCLickOfBanner=function(e){switch(e){case"radiology":a.sendEvents("Labs Banner Clicked",{serviceType:"radiology"}),n.go("app.radiologyTests");break;case"rtpcr":a.sendEvents("Labs Banner Clicked",{serviceType:"rtpcr"}),n.go("app.consumerTests",{"package":17879937});break;case"platinum":a.sendEvents("Labs Banner Clicked",{serviceType:"platinum"}),n.go("app.consumerPackages",{"package":21369101});break;case"taxExemption":a.sendEvents("Labs Banner Clicked",{serviceType:"taxExemption"}),n.go("app.consumerPackages")}},t.addBeneficiaries=function(){t.fetchBeneficiaries();p.open({animation:!0,size:e.isMobileView?"login-new modal-bottom":"login-new",scope:t,backdrop:"none",templateUrl:"beneficiaries.html",controller:["$scope","$uibModalInstance",function(e,t){e.closeModal=function(){t.dismiss("cancel")}}],size:t.isMobileView?"bottom":"border modal-sm",windowClass:e.isMobileView&&"bottom-sheet"})};e.$on("userLogout",function(e,i){t.$emit("corporateBenefits",{}),t.hide=!0,a.corpBenfits={},t.isRetailUser=!0}),e.$on("userLogin",function(e,n){t.hide=!1,t.loaded=!1,a.corpBenfits={},t.user=i.isUserSignedin(),t.isRetailUser=t.user.isRetailUser||!t.user,f()})}}}]),e.register.directive("familyPopUp",["$rootScope","authService","apiProvider","$uibModal","$timeout","patternService","$state","corpLabsService","navConstantsSvc",function(e,t,i,a,n,s,r,o,c){return{restrict:"EA",scope:{pipeline:"=",benefeciaries:"=?",fetchPackages:"=?",showAddMember:"@",mergeList:"=?",config:"=?"},templateUrl:"labtest/templates/familyPopUp.html?"+timeStamp,link:function(l){function d(){l.loading.benefs=!0,t.makeAjaxCalls(i.apiUrl+"/Labs/v1/FetchBenefeciary.json","","GET",l.user.token,"",!0).then(function(e){if(l.loading.benefs=!1,e.data.isSuccess){if(l.benefeciaries=e.data.employeeDetail.beneficiaries,_.each(l.benefeciaries,function(e){e.display=!1}),0==l.benefeciaries.length)return void(l.showAddMember=!0);m()}else l.showAddMember=!0})["catch"](function(e){l.loading.benefs=!1})}function p(){l.isMobileView?d():n(function(){var e=document.getElementById("familysideBar"),t=document.getElementById("backDrop"),i=document.getElementById("bottomCta");e&&(e.classList.toggle("open"),i&&i.classList.toggle("open"),t&&t.classList.toggle("open"),d())},300),o.remLabsStickyHeader(),o.dialog.familyPopup=!0}function u(){var e=document.getElementById("familysideBar"),t=document.getElementById("backDrop"),i=document.getElementById("bottomCta");o.dialog.familyPopup=!1,e&&e.classList.toggle("open"),t&&t.classList.toggle("open"),i&&i.classList.toggle("open"),n(function(){l.pipeline.show=!1,l.pipeline["package"]="",l.pipeline.searchPackages="",l.pipeline.packageEligiblitiy=[]},450)}function g(){l.dependentInfo={gender:"M",relation:"",submitted:!1,name:"",age:"",dob:""},l.dob="";var e=document.getElementById("custom-date");e&&(e.addEventListener("focus",function(){l.isDobFocused=!0,l.$apply()}),e.addEventListener("focusout",function(){l.isDobFocused=!1,l.$apply()}),e.addEventListener("keypress",setTimeout(function(){onkeyenter(event)},100)))}function f(e){_.isEmpty(e)&&(e=_.isEmpty(l.mergeList)?[]:_.union(l.mergeList.tests,l.mergeList.packages));var t="labTest";return e.find(function(e){return e.contractId==c.ahcContract})?t="AHC":e.find(function(e){return e.contractId==c.healthCheckContract})&&(t="healthCheck"),{packageName:_.pluck(e,"packageDisplayName").toString(),packageId:_.pluck(e,"packageId").toString(),visitType:e.find(function(e){return!e.isHomeSampleAvailable})?"centerVisit":"homeVisit",isSponsored:!!e.find(function(e){return e.isSponsored}),ahcTestCount:e.filter(function(e){return e.contractId==c.ahcContract}).length,labTestCount:e.filter(function(e){return e.contractId==c.labtestContract}).length,healthCheckCount:e.filter(function(e){return e.contractId==c.healthCheckContract}).length,serviceName:t}}function m(e,t){const i=[1,2,5];l.benefeciaries=_.sortBy(l.benefeciaries,"maid").reverse();var a;l.benefeciaries=_.each(l.benefeciaries,function(s,d){if(s.isDisabled=!1,s.isSelected=!1,s.icon=o.getGenderIcon(s.maid,s.gender,s.age),s.isEligible=!!l.user.isRetailUser||(!(l.pipeline["package"]&&l.pipeline["package"].contractId==c.ahcContract&&!_.isNaN(l.pipeline.packageEligiblitiy))||l.pipeline.packageEligiblitiy.findIndex(function(e){return s.maid==e})>-1),!_.isEmpty(l.pipeline.mergeList)&&l.pipeline["package"]&&l.pipeline.mergeList.selectedList[s.maid]){var p=l.pipeline.mergeList.selectedList[s.maid].findIndex(function(e){return e.packageId==l.pipeline["package"].packageId});s.isDisabled=p>-1,s.isSelected=p>-1}if(i.includes(s.relationId)){const p=l.benefList.findIndex(function(e){return e.relationId==s.relationId});p>-1&&(l.benefList[p].isDisabled=!0,l.benefList[p].isActive=!1)}if("app.consumerCart"===r.current.name&&l.pipeline&&l.pipeline.mergeList&&l.pipeline.mergeList.selectedList){var p=_.keys(l.pipeline.mergeList.selectedList).findIndex(function(e){return e==s.maid});p>-1&&(s.isSelected=!0,s.isDisabled=!0)}if(!_.isEmpty(e)&&e.vasBenefId&&s.maid==e.vasBenefId&&(s.isSelected=!0),t&&s.maid==t&&(a=s),l.pipeline["package"]&&!_.isEmpty(e)&&!_.isEmpty(e.packages)&&s.maid==e.vasBenefId){var p=e.packages.findIndex(function(e){return l.pipeline["package"].packageId==e.packageId});p==-1&&(l.packageNotEligible=!0,s.isEligible=!1,s.isDisabled=!0,s.isSelected=!1)}n(function(){s.display=!0},60*d)}),l.packageNotEligible&&n(function(){l.packageNotEligible=!1},5e3),a&&l.onBenefSelect(a)}if(l.user=t.isUserSignedin(),l.isMobileView=e.isMobileView,l.patternCheck=s,l.disableGender=!1,l.isCartPage=r.includes("app.consumerCart"),l.loading={benefs:!1},l.pipeline||(l.pipeline={}),l.config||(l.config={}),l.benefList=[{isSelected:!1,isDisabled:!1,isActive:!0,gender:"",relationName:"Self",relationId:1},{isSelected:!1,isDisabled:!1,isActive:!0,gender:"M",relationName:"Father",relationId:5},{isSelected:!1,isDisabled:!1,isActive:!0,gender:"F",relationName:"Mother",relationId:2},{isSelected:!1,isDisabled:!1,isActive:!0,gender:"M",relationName:"Brother",relationId:3},{isSelected:!1,isDisabled:!1,isActive:!0,gender:"F",relationName:"Sister",relationId:7},{isSelected:!1,isDisabled:!1,isActive:!0,gender:"F",relationName:"Daughter",relationId:4},{isSelected:!1,isDisabled:!1,isActive:!0,gender:"M",relationName:"Son",relationId:8},{isSelected:!1,isDisabled:!1,isActive:!0,gender:"M",relationName:"Father-in-law",relationId:11},{isSelected:!1,isDisabled:!1,isActive:!0,gender:"F",relationName:"Mother-in-law",relationId:12},{isSelected:!1,isDisabled:!1,isActive:!0,gender:"",relationName:"Spouse",relationId:17},{isSelected:!1,isDisabled:!1,isActive:!0,gender:"",relationName:"Others",relationId:23}],l.stepper=1,p(),l.pipeline&&!l.pipeline.mergeList&&(l.pipeline.mergeList=t.mergeCart),_.isEmpty(l.mergeList)||"app.consumerCart"!==r.current.name||(l.pipeline.mergeList=l.mergeList),l.dependentInfo={gender:"",relation:"",submitted:!1},l.calenderDetails={isOpen:!1,dobOptions:{maxDate:new Date,minDate:new Date(1917,1,1)}},l.form={},l.packageNotEligible=!1,l.selecetBenef=function(e){_.each(l.benefList,function(e){e.isSelected=!1}),e.isSelected=!0,l.dependentInfo.relation=e.relationName,e.gender?(l.dependentInfo.gender=e.gender,l.disableGender=!0):(l.dependentInfo.gender="M",l.disableGender=!1)},l.pipeline.searchPackages&&(l.pipeline.searchPackages=_.sortBy(l.pipeline.searchPackages,function(e){return e.packageDisplayName.length})),l.isDobFocused=!1,l.dob="",l.benefItemClcik=function(e){if(!e.isDisabled&&e.isEligible){e.isSelected=!e.isSelected,l.showErrorBorder=!1;var t=f();o.sendEvents("Add Family Member",_.extend({name:e.name,memberType:e.relationName,gender:e.gender,maid:e.maid},t))}},l.switchBoolen=function(e){l[e]=!l[e],"showAddMember"==e&&(l.showAddMember&&o.sendEvents("Add New Family Member",f()),g(),l.showErrorBorder=!1,_.each(l.benefList,function(e){e.isSelected=!1}))},l.validate=function(e,t){var i=new RegExp(l.patternCheck.getRegexExpression(t)),a=String.fromCharCode(e.charCode?e.charCode:e.which);if(!i.test(a)&&13!==e.charCode&&9!==e.charCode)return e.preventDefault(),!1},l.genderClick=function(e){l.disableGender||(l.dependentInfo.gender=e)},l.onBenefSelect=function(e,t){if(t&&t.stopPropagation(),e.isEligible&&!e.isDisabled){e.isSelected=!e.isSelected,l.showErrorBorder=!1,(l.pipeline["package"]||l.pipeline.searchPackages)&&(l.benefCount=_.filter(l.benefeciaries,function(e){return e.isSelected&&!e.isDisabled}).length,l.price=l.pipeline&&l.pipeline["package"]?l.pipeline["package"].price:l.pipeline.searchPackages?_.pluck(l.pipeline.searchPackages,"price").reduce(function(e,t){return e+t},0):0);var i=f();o.sendEvents("Add Family Member",_.extend({name:e.name,memberType:e.relationName,gender:e.gender,maid:e.maid},i))}},l.confirm=function(){var e=_.filter(l.benefeciaries,function(e){return e.isSelected&&!e.isDisabled});return e.length?(o.dialog.labsFixedHeader&&o.addLabsStickyHeader(),l.$emit("familyConfirmClicked",e,l.pipeline["package"]),o.sendEvents("Add Family Member Success",f()),void u()):void(l.showErrorBorder=!0)},l.dobChanged=function(){const e=/(0[1-9]|[12][0-9]|3[01])\-(0[1-9]|1[012])\-\d{4}/g;return l.dependentInfo.dob.match(e)?void(l.dateError=!1):void(l.dateError=!0)},l.addFamily=function(){if(l.dependentInfo.submitted=!0,l.form.patientForm.$valid&&l.dependentInfo.relation){const e=/(0[1-9]|[12][0-9]|3[01])\-(0[1-9]|1[012])\-\d{4}/g;if(!l.dependentInfo.dob.match(e))return void(l.dateError=!0);var a=l.dependentInfo.dob.split("-"),n=Number(a[0]),s=Number(a[1]),r=Number(a[2]),c=new Date(r,s,n),d={relationName:l.dependentInfo.relation,name:l.dependentInfo.name,dob:c.toJSON(),gender:l.dependentInfo.gender,fetchPackages:!!l.fetchPackages&&l.fetchPackages};t.makeAjaxCalls(i.apiUrl+"/Labs/v1/AddBenefeciary",d,"POST",l.user.token,!1).then(function(e){if(e.data.isSuccess){if(g(),l.switchBoolen("showAddMember"),l.benefeciaries=e.data.employeeDetail.beneficiaries,e.data.vasBenefId){var i=l.benefeciaries.find(function(t){return t.maid==e.data.vasBenefId});i&&(i.benefType="New")}_.isEmpty(t.mergeCart)||(t.mergeCart.benefDetails||(t.mergeCart.benefDetails={}),t.mergeCart.benefDetails[e.data.vasBenefId]=l.benefeciaries.find(function(t){return t.maid==e.data.vasBenefId})),l.config.hideBenefs?(u(),l.$emit("addedBenefeciary",e.data)):e.data.packages?(l.pipeline["package"]&&_.pluck(e.data.packages,"packageId").includes(l.pipeline["package"].packageId)&&l.pipeline.packageEligiblitiy.push(e.data.vasBenefId),m(e.data),l.$emit("addedBenefeciary",e.data)):m(null,e.data.vasBenefId);var a=f();o.sendEvents("Add New Family Member Success",_.extend({name:d.name,memberType:d.relationName,gender:d.gender},a))}})}},l.config.hideBenefs&&(l.showAddMember=!0,l.config.defaultRelation)){var v=null;_.each(l.benefList,function(e){e.relationName==l.config.defaultRelation?v=e:e.isActive=!1}),!!v&&l.selecetBenef(v)}var h=null;l.isMobileView&&(h=a.open({animation:!0,scope:l,backdrop:"none",templateUrl:"labtest/templates/mobileFamilyPopUp.html?"+timeStamp,controller:["$scope","$uibModalInstance",function(e,t){}],size:e.isMobileView?"bottom":"border",windowClass:e.isMobileView&&"bottom-sheet"}).closed.then(function(){l.pipeline.show=!1,l.pipeline["package"]="",l.pipeline.searchPackages="",l.pipeline.packageEligiblitiy=[]})),l.backDrropClicked=function(){u(),l.$emit("onBackDropClicked")},l.$on("$destroy",function(){l.pipeline.show=!1,l.pipeline["package"]="",l.pipeline.searchPackages="",l.pipeline.packageEligiblitiy=[]})}}}]),e.register.directive("labsCalendar",["$rootScope","navConstantsSvc","authService","$state","apiProvider","$httpParamSerializer","$stateParams","$timeout","notify","$location","corpLabsService",function(e,t,a,n,s,r,o,c,l,d,p){return{restrict:"AE",scope:{obj:"=?",pipeline:"=?",blockDetails:"=?"},terminal:!0,priority:1e6,templateUrl:"templates/labsCalendar.html?"+timeStamp,link:function(n){function r(){n.pipeline||(n.pipeline={}),n.blockDetails||(n.blockDetails={}),n.pipeline.initDate&&(h=new Date(n.pipeline.initDate)),n.pipeline.slotIntervalMin&&(slotIntervalMin=n.pipeline.slotIntervalMin),n.pipeline.totalDays&&(v=n.pipeline.totalDays),n.dateArray=[],d()}function o(e){var t=e%60,i="",a=Math.floor(e/60);return a>=12?(i="PM",12===a?a=a:a-=12):i="AM",[a,t,i]}function l(e,t){return e=e.toString(),e.length<t?l("0"+e,t):e}function d(){n.isMedibuddyLoading=!0,console.log(n.obj);var e={ProviderIds:_.flatten(n.obj.dcIds),NoOfDays:"30",ContractId:n.obj.contractId||10386,IsHomeVisitCase:!n.obj.isLabVisit,packageIds:_.isEmpty(y)?[]:y.map(function(e){return e.packageId}),pmEntityId:b.userDetails&&b.userDetails.pmEntityID?b.userDetails.pmEntityID:null};a.makeAjaxCalls(s.apiUrl+"Labs/ProvidersCalendar",e,"POST",b.token,k).then(function(e){if(e.data.isSuccess){var t=_.first(e.data.providerSlots);if(!_.isEmpty(t))return n.obj.providerSlots=t.daySlots,void g(t.daySlots)}n.calendarCheck=!1,n.isMedibuddyLoading=!1})["catch"](function(e){n.calendarCheck=!1,n.isMedibuddyLoading=!1})}function u(){if(b&&b.corpConfig&&b.corpConfig.bookTillDate){var e=new Date(b.corpConfig.bookTillDate);_.each(n.dateArray,function(t){e&&t.date>e&&(t.disabled=!0,t.overallSlotState={className:"noavail not-available",status:"Unavailiable"})})}if(n.blockDetails.blockTillDate){var t=new Date(n.blockDetails.blockTillDate);_.each(n.dateArray,function(e){e.date<t&&(e.disabled=!0)})}if(!_.isEmpty(n.blockDetails.blockDates)){var i=n.blockDetails.blockDates.map(function(e){return new Date(e)});_.each(n.dateArray,function(e){i.Contains(e.date)&&(e.disabled=!0)})}}function g(e){n.dateArray=f(e),u();var t=n.dateArray.findIndex(function(e){return!e.disabled});return t<0?(n.calendarCheck=!1,void(n.isMedibuddyLoading=!1)):(n.pickDate(n.dateArray[t],t),n.calendarCheck=!0,void(n.isMedibuddyLoading=!1))}function f(e){return e.map(function(e){var i={dateString:e.dateString,date:new Date(parseInt(e.date.replace("/Date(","").replace(")/",""))).setHours(0,0,0,0),formattedDate:e.dateString.split("-").slice(0,-1).join(" "),formattedDay:e.workingDaySlots.dayOfWeek,selected:!1,disabled:e.availableSlots<1};return i.disabled?i.overallSlotState={className:"not-available noavail not-available time-restricted",status:"Unavailiable"}:(e.availableSlots<=e.totalSlots*(t.minSlotThreshold/100)?i.overallSlotState={className:"almost-full active",status:"Filling fast",color:"#cc8800"}:i.overallSlotState={className:"slot-available active",status:"Available",color:"#81a200"},i.availableSlots=e.workingDaySlots),i})}function m(e){return i.forEach(e,function(t,i){if(t.slotStartTime||0===t.slotStartTime){var a=o(t.slotStartTime),n=l(a[0],"2")+":"+l(a[1],"2");e[i].startTime=n,e[i].startTimeMweb=a[1]?n:a[0],e[i].selected=!1,e[i].startTimeAmPm=a[2],e[i].time=n+" "+a[2],t.slotEndTime&&(a=o(t.slotEndTime),n=l(a[0],"2")+":"+l(a[1],"2"),e[i].endTime=n,e[i].endTimeMweb=a[1]?n:a[0],e[i].endTimeAmPm=a[2])}}),e}var v=30,h=new Date,b=a.isUserSignedin(),k=a.getCity(),y=_.isEmpty(a.mergeCart)?[]:_.union(a.mergeCart.packages,a.mergeCart.tests),I=-1;n.isMobileView=e.isMobileView,Date.prototype.addDays=function(e){return this.setDate(this.getDate()+parseInt(e)),this},Date.prototype.nextDay=function(e){var t=new Date(this.valueOf());return t.setDate(t.getDate()+e),t};r();var C={};n.initializeGlider=function(e){c(function(){C[e]=new Glider(document.querySelector("#"+e),{slidesToShow:n.isMobileView?"cal-glider"==e?3.5:"auto":6,slidesToScroll:"auto",draggable:!0,arrows:"cal-glider"==e&&{prev:".prev-"+e,next:".next-"+e}}),"cal-glider"==e&&C["cal-glider"].scrollItem(I)})},n.pickDate=function(e,t){if(!e.disabled){var i=e.availableSlots.slots.map(function(e){return _.pick(e,"slotStartTime","slotEndTime","servingProviders","slotCount","slotStartDateTime")}),a=_.isEmpty(n.slots)?null:n.slots.find(function(e){return e.selected}),s=m(i);if(_.isArray(s)){n.obj.prefDate=e.date,n.slots=s,a&&n.pickSlots(a),_.each(n.dateArray,function(e){e.selected=!1}),e.selected=!0,n.amSlots=n.slots.filter(function(e){return e.slotStartTime<720}),n.amSlotsMweb=[];for(var r=0;r<n.amSlots.length;r+=2)n.amSlotsMweb.push(n.amSlots.slice(r,r+2).map(function(e,t){return e}));n.pmSlots=n.slots.filter(function(e){return e.slotStartTime>=720}),n.pmSlotsMweb=[];for(var r=0;r<n.pmSlots.length;r+=2)n.pmSlotsMweb.push(n.pmSlots.slice(r,r+2).map(function(e,t){return e}))}}},n.pickSlots=function(e){_.each(n.slots,function(t,i){if(t.slotStartTime==e.slotStartTime){t.selected=!0;c(function(){if(n.isMobileView){var e="AM"==n.slots[i].startTimeAmPm?"amGlider":"pmGlider";document.querySelector("#"+e).scrollLeft=70*i}},200)}else t.selected=!1});var t=e.slotStartTime%60,i=0,a=0,s=Math.floor(e.slotStartTime/60),r=new Date(n.obj.prefDate);n.obj.prefDateTime=e.slotStartDateTime||new Date(r.getFullYear(),r.getMonth(),r.getDate(),s,t,i,a).toISOString(),n.obj.prefTime=e.slotStartTime,n.obj.servingProviders=e.servingProviders,n.obj.appointmentTimeTitle=e.startTime+" "+e.startTimeAmPm+" - "+e.endTime+" "+e.endTimeAmPm,p.sendEvents("Labs Slot Time Selected",{timeSlot:JSON.stringify(n.obj.prefDateTime),timeSlotMeta:JSON.stringify(e),timeSlotSelected:JSON.stringify(r)})},n.$on("$destroy",function(){_.each(C,function(e,t){c.cancel(e),e&&(e.destroy(),C[t]=null)})})}}}]),e.register.directive("labsCard",["$rootScope","navConstantsSvc","authService","corpLabsService","$state","apiProvider","$httpParamSerializer","$stateParams","$timeout","notify","$location","$uibModal","$interval",function(e,t,i,a,n,s,r,o,c,l,d,p,u){return{restrict:"AE",scope:{sectionList:"=?",cardPipeline:"=?",srcPage:"=?",labsData:"=?",showDetailsPopUp:"=?"},terminal:!0,priority:1e6,templateUrl:"labtest/templates/labsCard.html?"+timeStamp,link:function(s,r,l){function p(){s.isMobileView=e.isMobileView,s.cardPipeline||(s.cardPipeline={}),s.sectionList||(s.sectionList=[]),s.labsData||(s.labsData={}),s.packagePipeline={show:!1},["ProviderTests"].includes(s.srcPage)&&s.cardPipeline.providerId&&(s.packagePipeline.providerId=s.cardPipeline.providerId),s.radiologyPage="/radiologyTests"==d.path(),s.labsCart=a.labsCart(),s.testsViewCount={current:5,max:5},s.providerDetail=["ProviderTests"].includes(s.srcPage),s.cardData={healthChecks:[],labTests:[],ltViewAll:!["LabsLanding","ProviderTests"].includes(s.srcPage),
hcViewAll:!["ProviderTests"].includes(s.srcPage)},s.mergeList=a.labsCart(),s.cards={labTestsCard:s.sectionList.includes("labTests"),packagesCard:s.sectionList.includes("packages"),catgCard:s.sectionList.includes("categories")},s.categories={selCatg:o.catg||"",catgList:[],current:6,max:13},s.labTestFilter={filters:[],viewAll:!0},s.packageFilter={filters:[],viewAll:!0},u(),(s.categories.selCatg||["ProviderTests"].includes(s.srcPage))&&g()}function u(){_.each(Array(5).fill(0),function(e){s.cardData.healthChecks.push({display:!1})}),_.each(new Array(5).fill(0),function(e){s.cardData.labTests.push({display:!1})})}function g(){var e={};s.categories.selCatg&&(s.cards.catgCard=!1,e={category:s.categories.selCatg.toUpperCase(),loadSubCategories:!0}),f(_.extend(s.cardPipeline.reqBody,e),s.sectionList)}function f(e,i){s.testsViewCount={current:5,max:5};var n=_.extend({ignoreLoader:!0},e),r=["ProviderTests"].includes(s.srcPage)&&s.cardPipeline.providerId?s.cardPipeline.fetchProviderTests():a.fetchPackagesListing(n);r.then(function(e){s.labsData.packages=e.packages,s.labsData.providerDetail=e.providerDetail,_.each(s.labsData.packages,function(e){e.display=!0}),m({"default":n.subCategory,data:e.subCategories},{"default":n.category,data:e.categories}),s.cardData.healthChecks=e.packages.filter(function(e){return e.contractId==t.healthCheckContract}),s.cardData.labTests=e.packages.filter(function(e){return e.contractId==t.labtestContract}),s.testsViewCount.max=s.cardData.labTests.length,s.cards.packagesCard=!_.isEmpty(s.cardData.healthChecks),s.cards.labTestsCard=!_.isEmpty(s.cardData.labTests),v([],"+",!0);var i=!_.isEmpty(k)&&k.userDetails&&[1022628,1022626].includes(k.userDetails.pmEntityID)?0:1;_.isEmpty(s.packageFilter.filters)||s.onPackageFilterClick(s.packageFilter.filters[i]),_.isEmpty(s.labTestFilter.filters)||s.onlabTestFilterClick(_.first(s.labTestFilter.filters)),c(function(e){y&&y.refresh()},300)})["catch"](function(){})}function m(e,i){if(_.isEmpty(e)||_.isEmpty(e.data)?(s.labTestFilter.filters=[],s.packageFilter.filters=[]):(s.labTestFilter.filters=_.isEmpty(e.data[t.labtestContract])?[]:e.data[t.labtestContract].map(function(t){return{label:t,value:t,selected:e["default"]&&e["default"]==t}}),s.packageFilter.filters=_.isEmpty(e.data[t.healthCheckContract])?[]:e.data[t.healthCheckContract].map(function(t){return{label:t,value:t,selected:e["default"]&&e["default"]==t}}),s.labTestFilter.viewAll=s.isMobileView,s.packageFilter.viewAll=s.isMobileView,_.each(s.packageFilter.filters,function(e){e.display=!0}),_.each(s.labTestFilter.filters,function(e){e.display=!0})),!_.isEmpty(i)&&!_.isEmpty(i.data)){var a=s.cardPipeline.reqBody.loadOnlyRadiology?"/assets/icons/corpLabs/categories/radiology/":"/assets/icons/corpLabs/categories/labtest/";i.data.length>6?(s.categories.catgList=i.data.map(function(e,t){return{label:e,value:e,imgSrc:a+e.toLowerCase().replace(" ","-")+".svg",show:t<5,"function":"chooseCategory"}}),s.categories.catgList.splice(5,0,{label:"View More...",value:"view",imgSrc:"/assets/icons/corpLabs/categories/radiology/arrow-down.svg",show:!0,"function":"changeCategoryView"}),s.categories.catgList.splice(s.categories.catgList.length,0,{label:"View Less...",value:"view",imgSrc:"/assets/icons/corpLabs/categories/radiology/arrow-up.svg",show:!1,"function":"changeCategoryView"})):s.categories.catgList=i.data.map(function(e,t){return{label:e,value:e,imgSrc:a+e.toLowerCase().replace(" ","-")+".svg",show:!0,"function":"chooseCategory"}}),s.categories.max=s.categories.catgList.length}}function v(e,t,i){var n=s.mergeList?_.union(s.mergeList.tests,s.mergeList.packages):[],r=["ProviderTests"].includes(s.srcPage)&&(!a.providerParams.providerSelected||a.providerParams.providerId!=s.cardPipeline.providerId);_.isEmpty(e)&&(e=n),_.each(s.cardData.labTests,function(a){var o=e.find(function(e){return e.packageId==a.packageId});o?(a.selected=!r&&"+"==t,a.cartId=o.cartId,a.showCount=!r&&s.cardPipeline.showBenefPopup?n.filter(function(e){return e.packageId==a.packageId}).length:0):i&&(a.selected=!1,a.cartId=0,a.showCount=0)}),_.each(s.cardData.healthChecks,function(a){var o=e.find(function(e){return e.packageId==a.packageId});o?(a.selected=!r&&"+"==t,a.cartId=o.cartId,a.showCount=!r&&s.cardPipeline.showBenefPopup?n.filter(function(e){return e.packageId==a.packageId}).length:0):i&&(a.selected=!1,a.cartId=0,a.showCount=0)})}function h(){c.cancel(y),y&&(y.destroy(),y=null,I=null)}window.updateSrc=!0;var b,k=i.isUserSignedin();p(),s.onFilterViewMore=function(e){e?s.packageFilter.viewAll=!0:s.labTestFilter.viewAll=!0},s.viewMoreTests=function(){var e=_.first(s.labTestFilter.filters.filter(function(e){return e.selected}));s.testsViewCount.current<s.testsViewCount.max?(a.sendEvents("View More Button Clicked",{serviceType:"labtest",filterType:e&&e.label}),_.each(s.cardData.labTests,function(e,t){t<s.testsViewCount.current||t>=s.testsViewCount.current+5||c(function(){s.testsViewCount.current+=1},t%5*30)}),c(function(){var e=document.getElementById("view-more-tests");e&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},100)):(c(function(){var e=document.getElementById("labTests-section");e&&e.scrollIntoView({behavior:"smooth",block:"center",inline:"center"})},100),a.sendEvents("View Less Button Clicked",{serviceType:"labtest"}),_.each(s.cardData.labTests,function(e,t){t<5||(s.testsViewCount.current-=1)}))},s.onPackageFilterClick=function(e,i){i&&a.sendEvents("Labs Filters Clicked",{serviceType:"HealthCheckUps",filterType:e.label}),_.each(s.packageFilter.filters,function(t){t.selected=t.label==e.label}),s.cardData.healthChecks=s.labsData.packages.filter(function(i){return i.contractId==t.healthCheckContract&&i.subCategories.includes(e.value.toUpperCase())});var n=s.cardData.healthChecks.filter(function(e){return!e.isAvailable});_.isEmpty(n)||a.sendEvents("Labs Non Serviceable",{serviceType:"HealthCheckUps",filterType:e.label},n),c(function(e){y&&y.refresh()})},s.onlabTestFilterClick=function(e,i){i&&a.sendEvents("Labs Filters Clicked",{serviceType:"LabTests",filterType:e.label}),_.each(s.labTestFilter.filters,function(t){t.selected=t.label==e.label}),s.cardData.labTests=s.labsData.packages.filter(function(i){return i.contractId==t.labtestContract&&i.subCategories.includes(e.value.toUpperCase())});var n=s.cardData.labTests.filter(function(e){return!e.isAvailable});_.isEmpty(n)||a.sendEvents("Labs Non Serviceable",{serviceType:"LabTests",filterType:e.label},n),s.testsViewCount.current=5,s.testsViewCount.max=s.cardData.labTests.length},s.onClickOfCategories=function(e){s.radiologyPage?a.sendEvents("Radiology Service Icons Clicked",{serviceType:e.label}):a.sendEvents("LabTests Service Icons Clicked",{serviceType:e.label}),s[e["function"]](e)},s.viewAllPackages=function(e){e?(a.sendEvents("View All Clicked",{serviceType:"healthcheck"}),n.go("app.consumerPackages",{filter:s.categories.selCatg})):(a.sendEvents("View All Clicked",{serviceType:"labtest"}),n.go("app.labTestsListing",{catg:s.categories.selCatg}))},s.filterCategories=function(e){return e.show},s.chooseCategory=function(e){n.go(n.current,{catg:e.value},{reload:!0})},s.changeCategoryView=function(){_.each(s.categories.catgList,function(e,t){t<s.categories.max&&t>=s.categories.current-1&&c(function(){e.show=!e.show},t%5*50)})},s.openPackageDetails=function(i){if(s.showDetailsPopUp)return a.sendEvents("PackageTestdetailspopup",{packageId:i.packageId,packageName:i.packageDisplayName,providerId:s.cardPipeline&&s.cardPipeline.providerId?s.cardPipeline.providerId:null,providerName:s.cardPipeline&&s.cardPipeline.providerName?s.cardPipeline.providerName:null}),s.packagePipeline.show=!0,void(s.packagePipeline.packageId=i.packageId);if(i.contractId==t.healthCheckContract)if(e.isMobileView)n.go("app.consumerPackages",{"package":i.packageId},{reload:!0});else{var r=window.location.origin;window.open(r+"/consumerPackages/"+i.packageId)}else if(e.isMobileView)n.go("app.consumerTests",{"package":i.packageId},{reload:!0});else{var r=window.location.origin;window.open(r+"/consumerTests/"+i.packageId+"/")}};var y=null,I=null;s.initializeGlider=function(){c(function(){var e="hc-glider";I=document.querySelector("#"+e),I&&(y=new Glider(I,{slidesToShow:s.isMobileView?1.05:3,slidesToScroll:3,draggable:!1,scrollLock:!0,skipTrack:!0,duration:1.5,arrows:!s.isMobileView&&{prev:".prev-"+e,next:".next-"+e}}))},10)};var C=e.$on("cartItemsUpdated",function(e,t){s.mergeList=a.labsCart(),v(t.cartItems,t.op,t.refresh)}),S=e.$on("userLocation",function(e,t){g()});s.$on("$destroy",function(e){h(),C(),S(),c.cancel(b)})}}}]),e.register.directive("labsSearch",["$rootScope","navConstantsSvc","authService","corpLabsService","$state","apiProvider","$httpParamSerializer","$stateParams","$timeout","notify","$location","$uibModal","$interval","$sce",function(e,t,i,a,n,s,r,o,c,l,d,p,u,g){return{restrict:"AE",scope:{searchPipeline:"=?"},terminal:!0,priority:1e6,templateUrl:"labtest/templates/labsSearch.html?"+timeStamp,link:function(n,r,o){function c(){var e={isPopular:!0,contractIds:[t.healthCheckContract,t.labtestContract],ignoreLoader:!0},i=a.fetchPackagesListing(e);i.then(function(e){n.popularResults=e,n.mergeList.patients.length<=1&&u(n.mergeList.searchCart,"+",!0)})}function d(e,t,i){"-"==t?_.each(e,function(e){n.mergeList.searchCart=n.mergeList.searchCart.filter(function(t){return t.packageId!=e.packageId}),n.mergeList.totalSearchCost-=e.price}):"+"==t&&_.each(e,function(e){n.mergeList.searchCart.push(e),n.mergeList.totalSearchCost+=e.price}),u(e,t,i,[{key:"searchCartSel",val:"+"==t}]),f()}function u(e,t,i){var a=n.mergeList.searchCart;_.isEmpty(e)&&(e=a),_.each(n.searchVars.searchResults,function(a){var n=e.find(function(e){return e.packageId==a.packageId});a.searchCartSel=n?!!i||"+"==t:!i&&a.searchCartSel}),_.isEmpty(n.popularResults)||(_.each(n.popularResults.popularCovidTests,function(a){var n=e.find(function(e){return e.packageId==a.packageId});a.searchCartSel=n?!!i||"+"==t:!i&&a.searchCartSel}),_.each(n.popularResults.popularLabTests,function(a){var n=e.find(function(e){return e.packageId==a.packageId});a.searchCartSel=n?!!i||"+"==t:!i&&a.searchCartSel}),_.each(n.popularResults.popularHealthChecks,function(a){var n=e.find(function(e){return e.packageId==a.packageId});a.searchCartSel=n?!!i||"+"==t:!i&&a.searchCartSel}),n.showInSearch.covid=!_.isEmpty(n.popularResults.popularCovidTests)&&!!n.popularResults.popularCovidTests.find(function(e){return!e.searchCartSel}),n.showInSearch.tests=!_.isEmpty(n.popularResults.popularLabTests)&&!!n.popularResults.popularLabTests.find(function(e){return!e.searchCartSel}),n.showInSearch.packages=!_.isEmpty(n.popularResults.popularHealthChecks)&&!!n.popularResults.popularHealthChecks.find(function(e){return!e.searchCartSel})),_.each(n.descriptionMap,function(a){var n=e.find(function(e){return e.packageId==a.packageId});a.searchCartSel=n?!!i||"+"==t:!i&&a.searchCartSel})}function f(){n.mergeList.patients.length>1||n.mergeList.patients.length<=1&&_.isEmpty(n.mergeList.selectedList[n.mergeList.defaultPatId])?n.searchVars.cartText="Add To Cart":_.isEqual(n.mergeList.selectedList[n.mergeList.defaultPatId],n.mergeList.searchCart)?n.searchVars.cartText="Go To Cart":n.searchVars.cartText="Update Cart"}function m(e){var t=a.getPackageDetail(e);t.then(function(t){n.discountString=g.trustAsHtml("Upto <b>20% off</b>"),n.descriptionMap=t.descriptionMap,u(n.mergeList.searchCart,"+",!0),e&&n.showPackageDesc(e)})}function v(e,t){e&&(n.isLoading=!0,i.makeAjaxCalls(s.apiUrl+"/Labs/Search/"+i.getCity()+"/"+i.getPincode()+"/"+e+"/10/"+(t?"true":"false"),"","GET",h.token,i.getCity(),!0).then(function(e){n.isLoading=!1,n.searchVars.searchResults=e.data.isSuccess?e.data.searchedItems:[],_.each(n.searchVars.searchResults,function(e){e.searchCartSel=!!n.mergeList.searchCart.find(function(t){return t.packageId==e.packageId})})},function(e){n.isLoading=!1,n.searchVars.searchResults=[],l({message:"There is some trouble loading in search results, please try again later",position:"center",duration:5e3})}))}window.updateSrc=!0;var h=i.isUserSignedin();n.isMobileView=e.isMobileView,n.searchPipeline||(n.searchPipeline={},n.searchPipeline.dropdown=!1,n.searchVars.searchText=""),n.mergeList=a.labsCart(),n.searchVars={searchText:"",suggestedKeyword:"",cartText:"Go To Cart",searchResults:[]},n.showInSearch={},n.searchVars.placeholder=n.isMobileView?"Lab Tests, Scans, Packages":"Search for Lab Tests, Scans & Health Checkup Packages",n.descriptionMap={},n.dialog=a.dialog,n.clearText=function(e){n.searchVars.searchText="",n.searchVars.suggestedKeyword="",n.searchVars.searchResults=[],e&&e.stopPropagation()},c(),n.addItem=function(e,t,i){i&&i.stopPropagation(),e.patientId=n.mergeList.defaultPatId||0,a.sendEvents("Add To Cart Button Clicked",{CartSource:"Search"}),d(new Array(e),"+")},n.removeItem=function(e,t,i){i&&i.stopPropagation(),a.sendEvents("Remove From Cart Button Clicked",{CartSource:"Search"}),d(new Array(e),"-")},n.showPackageDesc=function(t,i){if(n.dialog.searchPopover=!1,n.descriptionMap[t])var a=p.open({animation:!0,backdrop:"none",template:'<div style="background-color:#fafcff" ng-class="{\'modal-bottom-header modal-header\':isMobileView,\'modal-body clearfix\':!isMobileView}"><div class="clearfix text-right"><span class="cursor-pointer" ng-style="{\'color\':isHover ? \'#000\' : \'#aaa\'}" ng-class="{\'md-dark-color\':isMobileView}"ng-init="isHover=false;" ng-mouseover="isHover=true;" ng-mouseout="isHover=false;" ng-click="cancelDialog($event)">close</span></div><ng-include src="\'package_desc.html\'"></ng-include></div></div>',scope:n,controller:["$scope","$uibModalInstance",function(e,i){e.packageDetail=n.descriptionMap[t],e.packageDetail.saleActive=!!e.packageDetail.discountInfo.discountPrice,e.cancelDialog=function(e){e&&e.stopPropagation(),i.dismiss("cancel")},a.result["catch"](function(){n.dialog.searchPopover=!0}),e.bodyFunctions=!1,e.diseasesCovered=!1,e.lifestyle=!1,e.toggleExpand=function(e,t){_.each(t.arrayFirstHalf,function(t){t.profileName!==e.profileName&&(t.expanded=!1)}),_.isEmpty(t.arraySecondHalf)||_.each(t.arraySecondHalf,function(t){t.profileName!==e.profileName&&(t.expanded=!1)}),e.expanded=!e.expanded}}],size:e.isMobileView?"bottom":"lg modal-border",windowClass:e.isMobileView&&"bottom-sheet"});else m(t)},n.debounceSearch=_.debounce(function(e){v(e)},800,!1),n.searchItems=function(e){n.searchVars.searchText=e,e&&e.length>1?n.debounceSearch(e):n.searchVars.searchResults=[]};var b=e.$on("cartItemsUpdated",function(e,t){n.mergeList=a.labsCart(),n.mergeList.patients.length<=1&&u(n.mergeList.searchCart,"+",!0)});n.$on("$destroy",function(e){b()})}}}]),e.register.directive("locationPopUp",["$rootScope","authService","apiProvider","$uibModal","$timeout","patternService","$state","corpLabsService","navConstantsSvc","$http","notify",function(e,t,a,n,s,r,o,c,l,d,p){return{restrict:"EA",scope:{disablePopup:"=?",step:"=?",showSavedOnly:"=?",customLocation:"=?"},templateUrl:"labtest/templates/locationPopUp.html?"+timeStamp,link:function(u){function g(){u.opened=!0,u.chosenAddressTag="",c.sendEvents("Location PopUp",{triggerdBy:t.getUserLocation()?"User":"System"}),c.dialog.locationPopup=!0,c.remLabsStickyHeader(),T=18,u.isMobileView?A=n.open({animation:!0,scope:u,backdrop:"none",templateUrl:"labtest/templates/mobileLocationPopUp.html?"+timeStamp,controller:["$scope","$uibModalInstance",function(e,t){$=t,e.cancelDialog=function(){t.dismiss("cancel"),I()}}],size:e.isMobileView?"bottom":"border",windowClass:e.isMobileView&&"bottom-sheet"}).closed.then(function(){I()}):s(function(){var e=document.getElementById("locsideBar"),t=document.getElementById("backDrop");e&&(e.classList.toggle("open"),t&&t.classList.toggle("open"))},300),u.confirmedLocation&&"SAVED_ADDRESS"==u.confirmedLocation.type&&u.confirmedLocation.addressId&&(u.chosenAddressTag=u.confirmedLocation.addressId),v(),u.showSavedOnly||m()}function f(i,a,n){var r=i?i:t.getCity(),o=a?a:t.getPincode(),l=n?n:t.getUserLocation();s(function(){u.$emit("selectedCity",{city:r,pincode:o,location:l}),u.$emit("pincodeChange",o),e.$emit("userLocation",l)},300),c.sendEvents("Location Submit",{locationchosenfrom:u.source})}function m(e){navigator.geolocation?(u.isLocationEnabled=!0,navigator.geolocation.getCurrentPosition(function(t){u.loading.gps=!1,u.usercurrentlat=t.coords.latitude,u.usercurrentlong=t.coords.longitude,e&&(b(t.coords.latitude,t.coords.longitude),u.map&&u.marker&&(u.marker.setPosition({lat:t.coords.latitude,lng:t.coords.longitude}),u.map.panTo({lat:t.coords.latitude,lng:t.coords.longitude}),u.map.setCenter({lat:t.coords.latitude,lng:t.coords.longitude}),u.map.setZoom(18)))},y,{maximumAge:1/0})):(u.loading.gps=!1,u.isLocationEnabled=!1)}function v(){if(u.savedAddresses=[],t.isUserSignedin())if(t.userAddresses&&t.userAddresses.length){var e=t.userAddresses.filter(function(e){return e.latitude&&e.longitude});e.forEach(function(e){u.savedAddresses.push({secondary_location:e.addressLine1+", "+e.addressLine2,primary_location:e.addressType,addressId:e.addressTag,icon:c.locationIcon(e.addressType),latitude:e.latitude,longitude:e.longitude,pincode:e.pincode,city:e.city,placeId:e.houseNo,type:"SAVED_ADDRESS"})})}else t.makeAjaxCalls(a.apiUrl+"/UserProfile",{fetchOnlyUserDetails:!0},"POST",u.user.token,null,!0).then(function(e){e.data.profile&&e.data.profile.userAddresses&&(t.userAddresses=e.data.profile.userAddresses.filter(function(e){return e.latitude&&e.longitude}),t.userAddresses.forEach(function(e){u.savedAddresses.push({secondary_location:e.addressLine1+", "+e.addressLine2,primary_location:e.addressType,addressId:e.addressTag,icon:c.locationIcon(e.addressType),latitude:e.latitude,longitude:e.longitude,pincode:e.pincode,city:e.city,placeId:e.houseNo,type:"SAVED_ADDRESS"})}))})["catch"](function(e){})}function h(e){var i=a.apiUrl+"/Labs/v1/FetchCityByPincode/"+e;u.loading.servicable=!0,u.error.servicable=!1,u.servicability=!1,t.makeAjaxCalls(i,"","GET",u.user.token,t.getCity(),!0).then(function(t){u.loading.servicable=!1,E&&t.data.isRetailPackagesAvailable||!E&&t.data.isSuccess?t.data.city&&(u.servicability=!0,u.newcity=t.data.city,u.newpincode=e,c.sendEvents("Pincode Verification",{pincode:e,locationchosenfrom:u.source}),u.selectedLocation&&!u.selectedLocation.city&&(u.selectedLocation.city=t.data.city),"SAVED_ADDRESS"==u.source&&u.confirmLocation()):(u.servicability=!1,c.sendEvents("Pincode Not Servicable",{locationchosenfrom:u.source}),c.sendEvents("Location Unserviceable",{nonservicablePincode:e,nonservicableLatitute:u.selectedLocation.latitude,nonservicableCity:t.data&&t.data.city?t.data.city:"",nonservicableLongitude:u.selectedLocation.longitude,locationchosenfrom:u.source}),u.errorMessage="Sorry! We are not serviceable in "+e+" location. Please try another pincode")})["catch"](function(t){c.sendEvents("Location Unserviceable",{nonservicablePincode:e,nonservicableLatitute:u.selectedLocation.latitude,nonservicableCity:"No City",nonservicableLongitude:u.selectedLocation.longitude,locationchosenfrom:u.source}),u.loading.servicable=!0,u.error.servicable=!0,u.servicability=!1,503==t.status?(c.sendEvents("Pincode Not Servicable",{locationchosenfrom:u.source}),u.errorMessage="Sorry! We are not serviceable in "+e+" location. Please try another pincode"):u.errorMessage="There is an error fetching the details. Please try again or after sometime."})}function b(e,t,i){var a=new google.maps.Geocoder,n={lat:parseFloat(e),lng:parseFloat(t)},s={};i?s.placeId=i:(e||t)&&(s.location=n),a.geocode(s,function(i,a){if(a===google.maps.GeocoderStatus.OK)for(var n=null,s=0;s<i.length;s++){const r=i[s];if(r.address_components&&r.address_components.forEach(function(e){if(e.types.includes("postal_code"))return void(n=r)}),n){var o="";const l=["sublocality_level_2","sublocality_level_1","sublocality","administrative_area_level_2","administrative_area_level_1"];for(var d=0;d<l.length;d++)if(_.find(n.address_components,function(e){return e.types.includes(l[d])})){o=_.find(n.address_components,function(e){return e.types.includes(l[d])}).long_name;break}return u.selectedLocation={pincode:_.find(n.address_components,function(e){return e.types.includes("postal_code")}).long_name,latitude:e,longitude:t,primary_location:o,secondary_location:n.formatted_address,placeId:n.place_id,type:"SEARCH"},void u.placesClick(u.selectedLocation,"SEARCH")}}else c.sendEvents("GeoCoder Error",{status:a,errorMessage:"Geocoder Failure"})},function(e){c.sendEvents("GeoCoder Catch Block")})}function k(e,t,i,a,n){if(a||(a=T),document.getElementById(e)){var s={lat:t,lng:i};u.map&&u.marker&&(u.marker.setPosition({lat:t,lng:i}),u.map.setZoom(18)),u.map=new google.maps.Map(document.getElementById(e),{center:s,zoom:a,clickableIcons:!1,gestureHandling:n,disableDefaultUI:!0,restriction:{latLngBounds:{north:37.1,south:8.05,west:68.12,east:97.4},strictBounds:!1}});var r={url:"/assets/icons/location/pin.svg",scaledSize:new google.maps.Size(25,37.74)};u.marker=new google.maps.Marker({icon:r,position:s,map:u.map,animation:google.maps.Animation.DROP,name:"Location"}),2==u.step&&(google.maps.event.addListener(u.map,"center_changed",function(){var e=this.getCenter(),t=e.lat(),i=e.lng();u.marker.setPosition({lat:t,lng:i})}),google.maps.event.addListener(u.map,"dragend",function(){var e=this.getCenter(),t=e.lat(),i=e.lng();c.sendEvents("Drag Map",{locationchosenfrom:u.source}),u.debounceMarker(t,i)}))}}function y(e){switch(u.loactionErrormsg="",u.isLocationEnabled=!1,u.loading.gps=!1,u.errorType=e.code,e.code){case e.PERMISSION_DENIED:u.loactionErrormsg="User denied the request for Geolocation.";break;case e.POSITION_UNAVAILABLE:u.loactionErrormsg="Location information is unavailable.";break;case e.TIMEOUT:u.loactionErrormsg="The request to get user location timed out.";break;default:u.loactionErrormsg="An unknown error occurred."}c.sendEvents("Location Permission Denied",{loactionErrormsg:u.loactionErrormsg})}function I(){u.opened=!1,c.dialog.locationPopup=!1;var e=document.getElementById("locsideBar"),i=document.getElementById("backDrop");e&&e.classList.toggle("open"),i&&i.classList.toggle("open"),$&&$.dismiss("cancel"),s(function(){u.step=1,u.searchText.value="",u.map=null,u.marker=null,u.currentLocationMarker=null,u.searchedresult=[],u.showSavedOnly=!1,u.changeSavedAddress=!1,c.dialog.locationPopup=!1,u.limit={addresses:3,reacentsearches:3},c.dialog.labsFixedHeader&&c.addLabsStickyHeader(),t.getPincode()&&t.getCity()&&t.getUserLocation()||P()},450)}function C(e,i){u.addoreditaddressInfo={submitted:!1},c.sendEvents("Add new Address"),u.step=3,u.isAdd=!!e,u.opened||g();var a;a=i?i:t.getUserLocation(),u.othersTag=!1,u.newAddressInfo={city:a.city,pincode:a.pincode,addressType:a.tag?a.tag:"Home",addressLine2:a.secondary_location?a.secondary_location:"",addressLine1:e?"":a.primary_location,latitude:a.latitude?a.latitude:"",longitude:a.longitude?a.longitude:"",houseNo:a.placeId?a.placeId:"",isPrimary:!0,isActive:!0},s(function(){u.newAddressInfo.latitude&&u.newAddressInfo.longitude&&k("google-map-readonly",u.newAddressInfo.latitude,u.newAddressInfo.longitude,18,"none")},350)}function S(){u.step=1,u.limit={addresses:100},u.showSavedOnly=!0,u.opened||g()}function w(e,i){if(u.userProfile=t.profileInfo,u.userProfile&&_.isEmpty(u.userProfile.userAddresses)&&(u.userProfile.userAddresses=[]),e){var n=u.userProfile.userAddresses.find(function(t){return t.addressTag==e});_.extend(n,u.newAddressInfo)}else{var s=_.extend({},u.newAddressInfo);delete s.addressTag,u.userProfile.userAddresses.push(_.extend({},s))}var r=_.map(t.userAddresses,function(e){return e.addressTag}),l=a.apiUrl+"/UpdateProfile.json";t.makeAjaxCalls(l,u.userProfile,"POST",u.user.token,null,i).then(function(i){if(i.data.isSuccess&&i.data.profile){u.userProfile=i.data.profile,t.profileInfo=i.data.profile,t.userAddresses=i.data.profile.userAddresses.filter(function(e){return e.latitude&&e.longitude});var a=_.map(t.userAddresses,function(e){return e.addressTag}),n=_.first(_.difference(a,r)),s=_.find(i.data.profile.userAddresses,function(e){return e.addressTag==n});c.sendEvents("Submit Address"),v(),e||"app.consumerLabsCheckout"!==o.current.name||(s?u.placesClick({secondary_location:s.addressLine1+", "+s.addressLine2,primary_location:s.addressType,addressId:s.addressTag,icon:c.locationIcon(s.addressType),latitude:s.latitude,longitude:s.longitude,pincode:s.pincode,city:s.city,placeId:s.houseNo,type:"SAVED_ADDRESS"},"SAVED_ADDRESS"):S())}else p({message:"Sorry! Please try again after sometime.",position:"center",duration:5e3})})}function L(){u.noPincode=!1,u.confirmedLocation=l.defaultLabsLocation,t.setUserLocation(u.confirmedLocation),t.setPincode("560029"),t.setCity("Bengaluru"),f("Bengaluru","560029",u.confirmedLocation)}function P(){B=n.open({animation:!0,scope:u,backdrop:"static",templateUrl:"labtest/templates/defaultLocation.html?"+timeStamp,controller:["$scope","$uibModalInstance",function(e,t){e.confirm=function(){L(),t.dismiss("cancel")},e.changeLocation=function(){t.dismiss("cancel"),u.noPincode=!0,g()}}],size:e.isMobileView?"bottom":"border modal-sm",windowClass:e.isMobileView&&"bottom-sheet"}).closed.then(function(){})}function D(t,i){c.sendEvents("Change location permission pop-up"),I(),M=n.open({animation:!0,scope:u,backdrop:"static",templateUrl:"labtest/templates/changeLocation.html?"+timeStamp,controller:["$scope","$uibModalInstance",function(e,a){e.current_location=t,e.new_location=i,e.cancelDialog=function(){a.dismiss("cancel"),c.sendEvents("Change location permission response",{Popup_response:"Cancel"})},e.confirm=function(){u.confirmLocation(!0),c.sendEvents("Change location permission response",{Popup_response:"Changelocation"}),o.go("app.consumerCart")}}],size:e.isMobileView?"bottom":"border modal-sm",windowClass:e.isMobileView&&"bottom-sheet"}).closed.then(function(){})}u.user=t.isUserSignedin(),u.isMobileView=e.isMobileView,u.patternCheck=r,u.isIOS=/iphone|ipod|ipad/.test(window.navigator.userAgent.toLowerCase()),u.isLocationEnabled=!1,u.searchedresult=[],u.step=1,u.searchText={value:""},u.source="";var E=!!_.isEmpty(u.user)||u.user.isRetailUser;u.loading={placessearch:!1,addresses:!1,maps:!1,gps:!1,servicable:!1},u.recentSearches=_.isEmpty(t.getRecentSearches())?[]:t.getRecentSearches(),u.error={placessearch:!1,addresses:!1,maps:!1,servicable:!1},u.limit={addresses:3,reacentsearches:3},u.addressInfo={addressLine1:"",addressLine2:"",pincode:t.getPincode(),city:t.getCity(),isSelected:!1,isActive:!0,addressType:"Home"},u.form={};var T=18,A="",B=null,M=null,$=null;u.noPincode=!1,t.getPincode()&&t.getCity()&&t.getUserLocation()?(u.confirmedLocation=t.getUserLocation(),f()):(u.noPincode=!0,g()),u.confirmLocation=function(e){if(u.servicability&&u.newcity&&u.newpincode){if("app.consumerLabsCheckout"===o.current.name&&!e){if("SAVED_ADDRESS"!=u.selectedLocation.type&&u.savedAddresses.length>0)return void C(!0,u.selectedLocation);var i=t.getUserLocation();if(i.pincode!=u.selectedLocation.pincode)return void D(i,u.selectedLocation)}t.setPincode(u.newpincode),t.setCity(u.newcity),t.setUserLocation(u.selectedLocation),f(u.newcity,u.newpincode,u.selectedLocation),I(),u.confirmedLocation=u.selectedLocation,u.noPincode=!1}},u.validate=function(e,t){var i=new RegExp(u.patternCheck.getRegexExpression(t)),a=String.fromCharCode(e.charCode?e.charCode:e.which);if(!i.test(a)&&13!==e.charCode&&9!==e.charCode)return e.preventDefault(),!1},u.clearSearch=function(e,t){u.searchText.value="",t="",u.searchedresult=[],e&&e.stopPropagation()},u.detectLocation=function(){u.loading.gps||(u.loading.gps=!0,"$apply"!=u.$root.$$phase&&"$digest"!=u.$root.$$phase&&u.$apply(),m(!0))},u.zoom=function(e){if(!(T<=6)){switch(e){case"INCR":T+=1;break;case"DEC":T-=1}u.map&&u.map.setZoom(T)}},u.placesClick=function(e,i){if(e.type||(e.type=i),u.selectedLocation=e,u.source=i,1==u.step&&"SAVED_ADDRESS"!=i)u.step=2,T=18,u.selected_PL=e.primary_location,u.selected_SL=e.secondary_location,"SEARCH"==i&&(u.recentSearches.push(e),u.recentSearches=_.uniq(u.recentSearches,function(e){return e.placeId}),t.setRecentSearches(u.recentSearches)),s(function(){k("google-map",e.latitude,e.longitude,T,"auto")},350);else if(2==u.step)u.selected_PL=e.primary_location,u.selected_SL=e.secondary_location;else if("SAVED_ADDRESS"==i&&u.chosenAddressTag==e.addressId)return;h(e.pincode)},u.debounceMarker=_.debounce(function(e,t){b(e,t)},300,!1),u.debounceSearch=_.debounce(function(e){u.searchedresult=[],u.loading.placessearch=!0,u.error.placessearch=!1,d({method:"GET",url:"https://location-service.medibuddy.in/places-search?searchText="+e,headers:{platform:"web"},ignoreLoadingBar:!0}).then(function(e){u.loading.placessearch=!1,u.error.placessearch=!1,e.data.success&&e.data.results&&!_.isEmpty(e.data.results)&&(u.searchedresult=[],e.data.results.forEach(function(e){u.searchedresult.push({pincode:e.pincode,primary_location:e.primaryText,secondary_location:e.secondaryText,placeId:e.placeId,latitude:e.latitude,longitude:e.longitude})}))})["catch"](function(t){u.loading.placessearch=!1,u.error.placessearch=!0,c.sendEvents("Failure in Places Search",{searchText:e})})},1e3,!1),u.searchItems=function(e){u.searchText.value=e,u.searchedresult=[],e&&e.length>3?u.debounceSearch(e):u.searchedresult=[]},u.openLocationPopUp=function(){u.disablePopup||(c.sendEvents("Change Location"),g())},u.goBack=function(){u.step=1,u.selected_PL="",u.selected_SL="",u.map=null,u.marker=null,u.limit={addresses:3,reacentsearches:3},u.currentLocationMarker=null},u.resetScreen=function(e){u.step=e||1,u.limit={addresses:3,reacentsearches:3},u.showSavedOnly=!1,u.changeSavedAddress=!1,m()},u.switchBoolen=function(e){u[e]=!u[e]},u.changeAddressTag=function(e){u.newAddressInfo&&"Others"!=e?(u.newAddressInfo.addressType=e,u.othersTag=!1):"Others"==e&&(u.othersTag=!0,u.newAddressInfo.addressType="")},u.addorupdateAddress=function(){if(u.addoreditaddressInfo.submitted=!0,u.addoreditaddressInfo.newaddressForm&&!u.addoreditaddressInfo.newaddressForm.$valid){var e=i.element(document.querySelector("input.ng-invalid"));return void(e&&!_.isEmpty(e)&&e[0].focus())}u.isAdd&&w(!1,!1)},u.backDrropClicked=function(){I(),u.$emit("onBackDropClicked")};e.$on("DefaultLocationSet",function(){u.noPincode=!1,u.confirmedLocation=t.getUserLocation(),f()});u.$on("$destroy",function(){I()}),u.$on("showSavedAdresses",function(){S()}),u.$on("changeSavedAddress",function(){u.changeSavedAddress=!0,S()}),u.$on("changeLocation",function(){u.step=1,g()}),u.$on("addNewAddress",function(e,t){C(t)})}}}]),e.register.directive("packageDetails",["$rootScope","navConstantsSvc","authService","corpLabsService","$state","apiProvider","$stateParams","$timeout","notify","$uibModal",function(e,t,i,a,n,s,r,o,c,l){return{restrict:"EA",scope:{pipeline:"=?",showDetailsOnly:"=?"},terminal:!0,priority:1e6,link:function(n,s,r){function o(){p=l.open({animation:!0,backdrop:"none",templateUrl:"labtest/templates/packageDetailsPopUp.html?"+timeStamp,scope:n,controller:["$scope","$uibModalInstance",function(e,i){function s(){n.packageDetail.saleActive=!!n.packageDetail.discountInfo.discountPrice}function r(){var e=_.union(n.mergeList.tests,n.mergeList.packages),i=_.groupBy(e,"packageId");if(n.packageDetail.packageCountInCart=i[n.pipeline.packageId]?i[n.pipeline.packageId].length:0,n.packageDetail.selected=!1,n.pipeline.contractId==t.ahcContract)if(n.pipeline.patientId){var a=_.find(e,function(e){return e.packageId==n.pipeline.packageId&&e.patientId==n.pipeline.patientId});a&&(n.packageDetail.selected=!0,n.packageDetail.cartId=a.cartId)}else n.packageDetail.selected=!1,n.packageDetail.cartId=0;else if(1==n.packageDetail.packageCountInCart){var a=_.find(e,function(e){return e.packageId==n.pipeline.packageId});n.packageDetail.selected=!0,n.packageDetail.cartId=a.cartId}}e.isLoading=!0,e.bodyFunctions=!1,e.diseasesCovered=!1,e.lifestyle=!1;var o=a.getPackageDetail(n.pipeline.packageId,n.pipeline.providerId,n.pipeline.patientId);o.then(function(t){e.isLoading=!1,n.packageDetail=t.descriptionMap[n.pipeline.packageId],
e.providerDetail=t.providerDetail||null,s(),r()})["catch"](function(t){e.isLoading=!1,c({message:"Sorry! Unabled to load Package Details, Please try after some time",position:"center",duration:5e3}),e.cancelDialog()}),e.cancelDialog=function(e){e&&e.stopPropagation(),i.dismiss("cancel")},e.toggleExpand=function(e,t){_.each(t.arrayFirstHalf,function(t){t.profileName!==e.profileName&&(t.expanded=!1)}),_.isEmpty(t.arraySecondHalf)||_.each(t.arraySecondHalf,function(t){t.profileName!==e.profileName&&(t.expanded=!1)}),e.expanded=!e.expanded},e.addItem=function(e){(_.isNull(e.patientId)||0==e.patientId)&&n.pipeline.patientId&&(e.patientId=n.pipeline.patientId),n.showBenefPopUp||n.pipeline.showFamilyPopUp||(a.sendEvents("Add To Cart Button Clicked",{CartSource:d},new Array(e)),a.addItemsToCart(new Array(e),"+",!1,!!n.user))},e.removeItem=function(e){a.sendEvents("Remove From Cart Button Clicked",{CartSource:d},new Array(e)),a.addItemsToCart(new Array(e),"-",!1,!!n.user)}}],size:e.isMobileView?"bottom":"lg modal-border",windowClass:e.isMobileView&&"bottom-sheet"}).closed.then(function(){n.pipeline.show=!1,n.pipeline={}})}var d="Package Details Pop Up";if(n.user=i.isUserSignedin(),n.isMobileView=e.isMobileView,n.isRetailUser=n.user.isRetailUser||!n.user,!_.isEmpty(n.pipeline)&&n.pipeline.show){n.packageDetail=null,n.familyPipeline={show:!1},_.isEmpty(n.user)?a.getCartLS():a.getCartDetails();var p=null,u=e.$on("cartItemsUpdated",function(e,i){n.mergeList=a.labsCart(),n.showBenefPopUp=(!n.pipeline.patientId||n.pipeline.contractId!=t.ahcContract)&&n.mergeList.patients.length>1,n.pipeline.showFamilyPopUp&&(n.showBenefPopUp=!0);var s=_.find(_.union(n.mergeList.tests,n.mergeList.packages),function(e){return e.packageId==n.pipeline.packageId&&e.patientId==n.pipeline.patientId});s&&n.packageDetail?(n.packageDetail.selected=!!s,n.packageDetail.cartId=s.cartId):n.packageDetail&&(n.packageDetail.selected=!1,n.packageDetail.cartId=0);var r=_.union(n.mergeList.tests,n.mergeList.packages).filter(function(e){return e.isPresentInCart&&e.contractId==t.ahcContract}),c="none";_.isEmpty(r)||(c=r.find(function(e){return!e.isHomeSampleAvailable})?"lab":"home"),n.pipeline.contractId==t.ahcContract&&"none"!=c&&("lab"==c&&n.pipeline.isHomeSampleAvailable&&(n.showDetailsOnly=!0),"home"!=c||n.pipeline.isHomeSampleAvailable||(n.showDetailsOnly=!0)),p||o()});n.$on("$destroy",function(e){u(),n.pipeline={}})}}}}]),e.register.directive("providerDetail",["$rootScope","authService","apiProvider","$uibModal","$timeout","patternService","$state","corpLabsService","navConstantsSvc","$stateParams",function(e,t,i,a,n,s,r,o,c,l){return{restrict:"EA",scope:{providerPipeline:"=?",showTitle:"=?"},templateUrl:"labtest/templates/providerDetail.html?"+timeStamp,link:function(a){function s(e){e||a.providerPipeline.providerDetails||(e=a.providerPipeline.providerDetails);var t={loginstatus:!0,providerFlow:!a.isCheckout};return e&&(t.providerId=e.providerId,t.providerName=e.providerName,t.Recommended=e.isRecommended,t.photosAvailable=e.hasOwnProperty("providerProperties")&&e.providerProperties.hasOwnProperty("provierImages")&&e.providerProperties.length>0,t.distanceFromUser=e.distance,t.provideLocationAvailable=e.hasOwnProperty("distance"),t.Trusted=e.providerProperties.isTrusted,t["NABL Certified"]="NABL Certified"==e.label,t["NABH Certified"]="NABH Certified"==e.label),t}function d(){a.totRatings=0,a.providerPipeline.providerDetails.providerProperties.ratings&&(a.totRatings=_.reduce(a.providerPipeline.providerDetails.providerProperties.ratings,function(e,t){return e+t.count},0),_.each(a.providerPipeline.providerDetails.providerProperties.ratings,function(e){a.ratings[e.rating-1].count=e.count,a.ratings[e.rating-1].percentage=e.count/a.totRatings*100}),a.avgrating=_.reduce(a.ratings,function(e,t){return e+t.rating*t.count},0)/a.totRatings,a.avgrating=Math.round(100*a.avgrating)/100,a.avgrating<=3&&(a.avgrating=0,a.totRatings=0)),a.providerPagePhoto=[],a.providerPipeline.providerDetails&&a.providerPipeline.providerDetails.providerProperties.provierImages&&a.providerPipeline.providerDetails.providerProperties.provierImages.length&&(a.providerPagePhoto=_.pluck(_.sortBy(a.providerPipeline.providerDetails.providerProperties.provierImages,"order").filter(function(e){return e.isActive}),"imageUrl")),n(function(){a.providerPipeline.providerDetails.locationInfo&&a.providerPipeline.providerDetails.locationInfo.providerLocationLatitude&&a.providerPipeline.providerDetails.locationInfo.providerLocationLongitude&&p("provider-location",a.providerPipeline.providerDetails.locationInfo.providerLocationLatitude,a.providerPipeline.providerDetails.locationInfo.providerLocationLongitude)},400)}function p(e,t,i){if(document.getElementById(e)){a.pos[e]={lat:parseFloat(t),lng:parseFloat(i)},a.map[e]=new google.maps.Map(document.getElementById(e),{center:a.pos[e],zoom:16,clickableIcons:!1,disableDefaultUI:!0,gestureHandling:"none",restriction:{latLngBounds:{north:37.1,south:8.05,west:68.12,east:97.4},strictBounds:!1}});var n={url:"/assets/icons/location/pin.svg",scaledSize:new google.maps.Size(25,37.74)};a.marker=new google.maps.Marker({icon:n,position:a.pos[e],map:a.map[e],animation:"providermaps"==e?google.maps.Animation.BOUNCE:google.maps.Animation.DROP,name:"Location"})}}a.isMobileView=e.isMobileView;var u=16;a.showRatings=c.showRatings,a.providerPipeline||(a.providerPipeline={}),console.log(a.providerPipeline),a.providerId=l.providerId||a.providerPipeline.providerId,a.isCheckout=r.includes("app.consumerLabsCheckout"),a.ratings=[{rating:1,count:0,percentage:0},{rating:2,count:0,percentage:0},{rating:3,count:0,percentage:0},{rating:4,count:0,percentage:0},{rating:5,count:0,percentage:0}],a.loading=!1,a.sections=[{title:"Amenities",selected:!1,isActive:!0,value:"amenitites"},{title:"Map & Directions",selected:!1,isActive:!0,value:"location"},{title:"Rating & Reviews",selected:!1,isActive:!1,value:"ratings"}],_.isEmpty(a.providerPipeline.providerDetails)?(a.loading=!0,t.makeAjaxCalls(i.apiUrl+"/Labs/v1/FetchProviderDetails",{providerIds:[a.providerId]},"POST").then(function(e){a.loading=!1,e.data.isSuccess&&!_.isEmpty(e.data.providers)&&(a.providerPipeline.providerDetails=_.find(e.data.providers,function(e){return e.providerId==a.providerId}),d())})["catch"](function(e){a.loading=!1})):d(),a.gliderClick=function(){o.sendEvents("Image slider clicked in PDP",s(a.providerPipeline.providerDetails))},a.viewMap=function(){o.sendEvents("View Provider on Map",s()),a.opened=!0,a.backDrropClicked()},a.backDrropClicked=function(e){n(function(){var t=document.getElementsByClassName("locationsidebar"),i=document.getElementById("backDrop");t&&(t[0].classList.toggle("open"),i&&i.classList.toggle("open"),e?a.opened=!1:p("providermaps",a.providerPipeline.providerDetails.locationInfo.providerLocationLatitude,a.providerPipeline.providerDetails.locationInfo.providerLocationLongitude))},100)},a.onSectionClick=function(e){_.each(a.sections,function(t){t.selected=t.title==e.title});var t=document.getElementById(e.value);t&&t.scrollIntoView({behavior:"smooth",block:"start",inline:"center"})};var g={},f={},m={};a.initializeGlider=function(e){m[e]=n(function(){g[e]=document.querySelector("#"+e),g[e]&&(f[e]=new Glider(g[e],{slidesToShow:a.isMobileView?1.1:1,slidesToScroll:1,draggable:!1,skipTrack:!0,scrollLock:!0,arrows:!a.isMobileView&&{prev:".prev-"+e,next:".next-"+e},dots:a.isMobileView&&"#dots-"+e}))},300)},a.imageClick=function(e){o.sendEvents("Image slider clicked in PDP",s()),f.providerImages&&f.providerImages.scrollItem(e)},a.map={},a.pos={},a.zoom=function(e,t){if(!(u<=6)){switch(t){case"INCR":u+=1;break;case"DEC":u-=1}a.map[e]&&a.map[e].setZoom(u)}},a.$on("$destroy",function(){a.providerPipeline={}})}}}])})}();