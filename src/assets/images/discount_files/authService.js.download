!function(){"use strict";define(["angular"],function(e){var t=e.module("marketplace.AuthService",[]);t.factory("authService",["$http","$rootScope","$location","$window","$uibModal","$state","navConstantsSvc","cityList","apiProvider","$cookies","localStorageService","$anchorScroll",function(t,a,o,i,n,r,s,l,d,c,u,p){var m,g="",h=[],f=[],b=[],v=!1,y={},S=["gmail.com","yahoo.com","yahoo.co.in","rediffmail.com"],E={};return window.templates&&(y=e.copy(window.templates),delete window.templates),{linkInsurerSection:{},corporatePackages:{},mediCart:{},mergeCart:{},benef:[],ahcCart:{},filterObj:{},activeService:null,userAddresses:[],timeline:{details:null,selected:""},scrollToSection:function(e,t){e&&setTimeout(function(){p.yOffset=t?t:a.isMobileView?100:50,p(e)})},medsCartInfo:{quantity:0},returnApiUrl:function(){return d.apiUrl},returnContents:function(e){return y[e]},getTimeFormate:function(e){var t=function(e,a){var o=e.toString();return o.length<a?t("0"+o,a):o},a="";if(e){var o=e%60,i="",n=Math.floor(e/60);n>=12?(i="PM",12===n?n=n:n-=12):i="AM";var r=t(n,"2")+":"+t(o,"2");a=r+" "+i}return a},getUniqCollection:function(e){var t=_.uniq(e,function(e){return e.dcId});return t},getUniqPackageIdCollection:function(e){var t=_.uniq(e,function(e){return e.packageId});return t},getUniqDoctorCollection:function(e){var t=_.uniq(e,function(e){return e.doctorUniqueId});return t},getUniqCollectionName:function(e){var t=_.uniq(e,function(e){return e.name});return t},getUniqCollectionProvider:function(e){var t=_.first(e),a=[];return t&&!_.isEmpty(t.dcName)?a=_.uniq(e,function(e){return e.dcName}):t&&!_.isEmpty(t.hospName)?a=_.uniq(e,function(e){return e.hospName}):a},getUniqId:function(e){var t=_.uniq(e,function(e){return e.id});return t},getUniqCollectionAmenities:function(e){var t=_.uniq(e,function(e){return e.name});return t},getUniqCollectionLocation:function(e){var t=[];return t=_.uniq(e,function(e){return e.hospBranch?e.hospBranch:e.dcLocation?e.dcLocation:void 0})},fileDownload:function(e){var t=new Promise(function(t,a){var o=this.getUserObj(),i="https://www.medibuddy.in/WAPI/GetFileSignedURLDownload/"+e;this.makeAjaxCalls(i,{},"GET",o.token,"",!0).then(function(o){if(o.data&&"OK"==o.data.httpStatusCode){var i=document.createElement("a");i.setAttribute("id",e),i.setAttribute("href",o.data.signedURL),document.body.appendChild(i),i.click(),document.body.removeChild(i),t({signedURL:o.data.signedURL,isSuccess:o.data.httpStatusCode})}else notify({message:"Cannot download the report at the moment",position:"center",duration:5e3}),a(o)})}.bind(this));return t},multipleFilesDownload:function(e){var t=setInterval(function(){this.fileDownload(e.pop()),e.length||clearInterval(t)}.bind(this),500)},get:function(e,t,a){return e.slice(t,t+a)},getNewFieldForDcServices:function(e,t){return _.forEach(e,function(e,a){_.forEach(t,function(t,a){t.dcServices&&t.dcServices.length>0&&_.forEach(t.dcServices,function(o,i){o===e.name&&t.dummyDcServices.push({id:a+1,name:e.name,selected:!1})})})}),t},getTimeWithAMPM:function(e){var t="",a=function(e,t){return e=e.toString(),e.length<t?a("0"+e,t):e};if(e){var o=e%60,i="",n=Math.floor(e/60);n>=12?(i="PM",12===n?n=n:n-=12):i="AM";var r=a(n,"2")+":"+a(o,"2");t=r+" "+i}return t},finder:function(e,t,a){for(var o=t[0][a],i=1;i<t.length;i++)o=e(o,t[i][a]);return o},createDateTime:function(e,t){var a=new Date(e).getDate(),o=new Date(e).getMonth()+1,i=new Date(e).getFullYear(),n=new Date(t).getHours(),r=new Date(t).getMinutes(),s=i+","+o+","+a+" "+n+":"+r,l=new Date(s);return l},createAppointmentObject:function(e,t){var a={patientName:e.patientName,email:e.email,phone:e.phone,userConsent:e.userConsent,emergencyPhone:"",dateOfBirth:e.dateOfBirth,gender:e.gender,packageId:t.packageId,packageName:t.packageName,dcId:t.dcId,dcName:t.dcName,dcLocation:t.dcLocation,prefDateTime:e.prefDateTime.toJSON(),isSponsored:!1,doctorId:t.doctorUniqueId,visitType:e.visitType?e.visitType:"",addressLine1:e.addressLine1?e.addressLine1:"",addressLine2:e.addressLine2?e.addressLine2:"",couponCode:e.couponCode?e.couponCode:"",citySelected:t.dcCity,totalPrice:t.price,discount:e.discount,finalPrice:e.finalPrice?e.finalPrice:t.price,relation:e.relation,pincode:e.pincode?e.pincode:"",hospitalRegistrationNo:e.hospitalRegistrationNo?e.hospitalRegistrationNo:""};return h=a,a},toggeFilter:function(e){var t={isMedicine:!1,isPharmacy:!1,isHealthcheckup:!1,isConsultation:!1,isInvestigation:!1,isMoreCity:!1,isOlService:!1,isHomeHealthCare:!1,isGso:!1,isGnome:!1,isDental:!1,isCovid:!1,categoryItemTypeId:"",cities:[]};return e===s.healthCheckFilterName?(t.isHealthcheckup=!0,t.isMoreCity=!1,t.categoryItemTypeId=s.healthCheckId,t.cities=l[s.healthCheckId]):e===s.medicineFilterName||e===s.pharmacyFilterName?(t.isMedicine=e===s.medicineFilterName,t.isPharmacy=e===s.pharmacyFilterName,t.categoryItemTypeId=s.medicineId,t.cities=l[s.medicineId]):e===s.consultationFilterName?(t.isConsultation=!0,t.categoryItemTypeId=s.consultationId,t.cities=l[s.consultationId]):e===s.investigationFilterName?(t.isInvestigation=!0,t.categoryItemTypeId=s.investigationId,t.cities=l[s.investigationId]):"covid"===e?(t.isCovid=!0,t.categoryItemTypeId=s.investigationId,t.cities=l[s.investigationId]):"morecity"===e?(t.isMoreCity=!0,t.isHealthcheckup=!0,t.cities=l[s.healthCheckId]):e===s.olServiceFilterName?(t.isMoreCity=!1,t.isOlService=!0,t.categoryItemTypeId=s.olServiceId,t.cities=l[s.olServiceId]):e===s.gsoFilterName?(t.isMoreCity=!1,t.isGso=!0,t.categoryItemTypeId=s.gsoId,t.cities=l[s.gsoId]):e===s.genomFilterName?(t.isMoreCity=!1,t.isGenome=!0,t.categoryItemTypeId=s.genomeId,t.cities=l[s.genomeId]):e===s.homeHealthCareFilterName?(t.isMoreCity=!1,t.isHomeHealthCare=!0,t.categoryItemTypeId=s.homehealthcareId,t.cities=l[s.homehealthcareId]):e===s.dentalFilterName&&(t.isDental=!0,t.isMoreCity=!1,t.categoryItemTypeId=s.dentalId,t.cities=l[s.dentalId]),t},checkSeriveType:{c920aa2144b9e51184af002219349965:"c920aa2144b9e51184af002219349965","Health checks":"c920aa2144b9e51184af002219349965","467117a029f0e511aa80002219349965":"467117a029f0e511aa80002219349965",Medicine:"467117a029f0e511aa80002219349965",ad131e35ffb9e51184af002219349965:"ad131e35ffb9e51184af002219349965",Consultation:"ad131e35ffb9e51184af002219349965","4f81d4702c8242009081cfde6301dd38":"4f81d4702c8242009081cfde6301dd38",olService:"4f81d4702c8242009081cfde6301dd38","259fb4d2abcb480fb4e8778a33b9c9d2":"259fb4d2abcb480fb4e8778a33b9c9d2",gso:"259fb4d2abcb480fb4e8778a33b9c9d2",ba678c34a85141299c0b43ac3b1ee8ca:"ba678c34a85141299c0b43ac3b1ee8ca","Home Health Care":"ba678c34a85141299c0b43ac3b1ee8ca","1b1fbfb833ea4e8d96c0a0325da21d69":"1b1fbfb833ea4e8d96c0a0325da21d69",Genome:"1b1fbfb833ea4e8d96c0a0325da21d69","66d51e1e3d674dddbae81df593392f12":"66d51e1e3d674dddbae81df593392f12",Dental:"66d51e1e3d674dddbae81df593392f12"},setPincode:function(e){u.set("pincode",e)},setAddress:function(e){u.set("address",e)},getAddress:function(){return u.get("address")},getPincode:function(){return u.get("pincode")},setUserLocation:function(e){u.set("userLocation",e)},getUserLocation:function(){return u.get("userLocation")},setRecentSearches:function(e){u.set("recentSearches",e)},getRecentSearches:function(){return u.get("recentSearches")},getUserRoles:function(){return u.get("_mp_user").rolesFeatures.roles},getUserFeatures:function(){return u.get("_mp_user").rolesFeatures.features},getAccessToken:function(){return u.get("_mp_user").accessTokenObj.access_token},getUserId:function(){return u.get("_mp_user").userDetails.userId},setUserObj:function(e){var t=-621355968e5,a=new Date(parseInt(e.userDetails.dateOfBirth.replace("/Date(","").replace(")/","")));u.get(e.userDetails.userId)&&t===a.getTime()&&(e.userDetails.dateOfBirth=e.userDetails.dateOfBirth.replace(a.getTime(),u.get(e.userDetails.userId))),u.set("_mp_user",e)},getUserObj:function(){return u.get("_mp_user")?u.get("_mp_user"):null},destroyUserObj:function(){this.refreshOrders=!0,this.orderHistory=[];var e=["app.navya","app.walletInfo","app.appointmentDetails","app.insurancePage","app.payment","app.medicine","app.orders","app.orderDetails","app.hospitalizationDetail","app.hospitalizationBooking","app.orderData","app.claims","app.storeSelection","app.getsecondopinion"];u.remove("_mp_user"),u.remove("auth_uuid"),u.remove("UniqSessionId"),_.contains(e,r.current.name)&&r.go("app.home",{},{reload:"app.home"}),window._MB_Analytics.__resetOnLogout(),a.$emit("userLogout",""),this.setDefaultLocation()},isActive:function(){var e=this.getUserObj();return!!e},setCity:function(e){e&&(e=e.charAt(0).toUpperCase()+e.slice(1)),window._Site_Props.__setLocation(e),u.set("city",e)},getCity:function(){return u.get("city")?u.get("city"):window.location.href.indexOf("/corporate")===-1||window.location.href.indexOf("/vaccination")===-1?"Bengaluru":null},setOrderDetails:function(e){m=e},getOrderDetails:function(){return m},setDefaultLocation:function(){window.sessionStorage.removeItem("corp_redirection_cta");var e=this.getUserLocation();e&&"SAVED_ADDRESS"==e.type&&(this.setUserLocation(s.defaultLabsLocation),this.setPincode("560029"),this.setCity("Bengaluru"),this.userAddresses=[],a.$emit("DefaultLocationSet"))},L2Csetuserdetails:function(e){E.IsGoldUser=e.isGold||!1,E.L2CCheckbox=e.isRetailUser||!1,E.L2CPrice=e.price||0,E.L2CText=e.text||null,E.isL2Cchecked=e.isRetailUser&&e.checkboxFlag},L2Cgetuserdetails:function(){return E},L2Cchangecheckbox:function(e){E.isL2Cchecked=e},uploadFile:function(e,a,o,i,n){var r=this.isUserSignedin();if(o&&a){var s=new Promise(function(s,l){this.makeAjaxCalls(d.apiUrl+"GetFileSignedURLUpload",{fileName:e.name,fileType:o,appId:9203,contractType:a,s3AccountType:"MB"},"POST",r?r.token:"abc",null,i,n).then(function(i){i.data&&i.data.success&&i.data.signedURL?t.put(i.data.signedURL,e,{headers:{"Content-Type":e.type}}).then(function(n){if(200==i.status){var c={fileName:e.name,fileType:o,appId:9203,fileIdentifier:i.data.fileIdentifier,signedURL:i.data.signedURL,contractType:a},u={AccessToken:r?r.token:"abc"};t.put(d.apiUrl+"SaveFileDetails",c,{headers:u}).then(function(e){e.data&&e.data.success?(e.data={isSuccess:e.data.success,fileUploadedList:[e.data.fileIdentifier.replaceAll("-","")],fileDetails:[{fileName:e.data.fileNamem,filePublicUrl:e.data.fileIdentifier}]},s(e)):l({isSuccess:!1,errorMessage:"Failed to upload to s3"})})["catch"](function(e){l({isSuccess:!1,errorMessage:"Failed to upload to s3"})})}else l({isSuccess:!1,errorMessage:"Failed to upload to s3"})})["catch"](function(e){l({isSuccess:!1,errorMessage:"Failed to upload to s3"})}):l({isSuccess:!1,errorMessage:"Failed to get signed url"})})["catch"](function(e){l({isSuccess:!1,errorMessage:"Failed to get signed url"})})}.bind(this));return s}},makeAjaxCalls:function(e,a,o,i,n,r,s){var l="DESKTOP_WEB";if(window.innerWidth<480){var c=window.navigator.userAgent.toLowerCase();l=c.indexOf("android")==-1?"IOS_WEB":"ANDROID_WEB"}a&&"GENOME"===a.keyword&&(n=" ");var u=t({method:o,url:e,data:a,headers:_.extend({mbservertoken:e==d.infinitiNode+"CorporateData/UserCreation"?i:void 0,AccessToken:i,City:n?n.trim():this.getCity(),Pincode:this.getPincode()>0?this.getPincode():0,Platform:window.getSrcType(),Booking_Platform:l,browser_fingerprint_id:window.sessionStorage.getItem("branch_fingerprint")||""},s),ignoreLoadingBar:r});return u},getWalletBalance:function(){var e=d.apiUrl+"/CheckWalletBalanceWithBenef\t",t=this.getUserObj();if(t&&t.token)return this.makeAjaxCalls(e,{},"GET",t.token,"",!0)},getSubsEligibility:function(){var e=d.infinitiNodeStg+"wallet/preWalletConfiguration",t=this.getUserObj();if(t&&t.token)return this.makeAjaxCalls(e,{userId:t.userDetails.userId,entityId:t.userDetails.pmEntityID},"POST",t.token)},isUserSignedin:function(){return this.user=this.getUserObj(),!!(this.user&&this.user.token&&this.user.userDetails&&this.user.userDetails.firstName)&&this.user},cityPopup:function(e){if(_.isArray(this.allCities)){var t=n.open({templateUrl:"templates/allCities.html?"+timeStamp,controller:["$scope","$rootScope","authService","$sce",function(e,a,o,i){e.modelOptions={debounce:{"default":200,blur:250},getterSetter:!0},e.allCities=o.allCities,e.topCities=o.topCities,e.allCities=_.difference(o.allCities,o.topCities),e.selectedCity=o.getCity();var n=l[s.medicineId]||[],r=_.union(o.allCities,o.topCities);e.selectedCity&&_.indexOf(e.topCities,e.selectedCity)<0&&_.some(e.allCities,function(t,a){if(t===e.selectedCity)return e.allCities.splice(a,1),e.allCities.unshift(t),!0}),e.cityError=i.trustAsHtml(o.cityError),e.ok=function(){t.close()},e.close=function(){t.close(),o.getCity()||state.go("app.home",{},{reload:"app.home"})},e.setUserCity=function(t){t&&(e.selectedCity=t,a.$broadcast("allCities",t),e.ok())},e.onCitySearch=function(){e.city&&e.city.length>1?(e.noMatch=!r.filter(function(t){return t.toLowerCase().indexOf(e.city.toLowerCase())>-1}).length,e.noService=n.filter(function(t){return t.toLowerCase()===e.city.toLowerCase()}).length&&e.noMatch):(e.noService=!1,e.noMatch=!1),e.noService&&window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"City Not Serviceable",payload:window._Site_Props.__getEventParameters({service:!0,custom:{city:e.city}})})}}],size:e});this.modalInstance=t}},updateMedsLocalCart:function(){var e=u.get("medsCart"),t=this.isUserSignedin();return t.isRetailUser||(e=e.filter(function(e){return!e.fromOtcStore})),u.set("medsCart",e),e},removeMedsLocalCart:function(){return u.set("medsCart",[]),[]},openPopup:function(e,a){n.open({animation:!0,templateUrl:a,controller:["$scope","$uibModalInstance","$rootScope","$timeout","$state","authService",function(e,a,o,i,n,r){e.logInUser={userName:"",password:""};var s=6e3;e.isReLogin=!0,e.validatepassword=function(t){e.isReLogin=!t.password},e.isPasswordWrong=!1,e.isHomePage=n.includes("app.home"),e.usersigninedinFailed=function(){e.isPasswordWrong=!0,i(function(){e.isPasswordWrong=!1},s)},e.ok=function(){a.dismiss("cancel")},e.getUserObj=function(){return u.get("_mp_user")?u.get("_mp_user"):null};var l=u.get("city");e.signinIn=function(a){e.user=e.getUserObj();var o={username:e.user.userDetails.email,password:a.password,isSSOLogin:!1,authServerAccessToken:"",isSocialLogin:!1,appName:"",appUniqueIdentifier:"",appAccessToken:"",email:e.user.userDetails.email,firstName:"",lastName:"",checkUser:!1},i=d.apiUrl+"MarketPlaceLogon";t.post(i,o,{headers:{"Content-Type":"application/json",City:l,Platform:"web"}}).then(function(t){console.log("response",t),t.data.isSuccess?(r.setUserObj(_.extend(t.data.user,{isRetailLabsFlowEnabled:t.data.isRetailLabsFlowEnabled})),e.ok(),n.reload()):(e.loginErrorMsg=t.data.errorMessage,e.usersigninedinFailed())})}}],size:e})},logoutUser:function(){this.destroyUserObj()},openRegistrationPopup:function(e,t,a){if(t="templates/openRegistrationPopup.html?"+timeStamp,a||(a={}),!v){v=!0;n.open({animation:!0,templateUrl:t,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","$sce",function(e,t,o,i,n,r,s,l,c,p,m,g){t.regFormCheck=!0,t.regScreen=!1,t.counter=30,t.showResendLink=!1;var h="";t.otpEnterScreen=!0,t.email=a.email,t.entityId=a.entityId;var f={defaultFields:{email:!0,empCode:!0,mobile:!0,gender:!0,dob:!0,name:!0,grade:!1,leader:!1},entityId:{11186623:["mobile","gender","dob","name","grade"],11184763:["email","empCode","mobile","gender","dob","name","leader"],11184764:["email","empCode","mobile","gender","dob","name","leader"],11184765:["email","empCode","mobile","gender","dob","name","leader"]}},b={},y=[],S=f.entityId;if(t.entityId&&(y=S&&S[t.entityId]?S[t.entityId]:[]),0==y.length)b=f.defaultFields;else for(var E=0;E<y.length;E++)b[y[E]]=!0;if(t.entitySpecificFields=b,a.empCode&&b.empCode&&setTimeout(function(){$("#empCode").val(t.empCode)},100),b.dob||(t.dob="01-01-0001"),a.empCode&&!b.empCode){var P=a.empCode.split("@");P.length>0?t.empCode=P[0]:t.empCode=a.empCode}if(setTimeout(function(){$("#email").val(t.email)},100),l.location.href.includes("medibuddy"))try{var C={screen:"Self Registration",appVersion:"",domain:"medibuddyInWeb",event:"LF_SELFREG_FORM_OPEN",email:t.email,advertiserId:l.sessionStorage.getItem("branch_fingerprint"),auth_uuid:u.get("auth_uuid")||void 0},I=Object.assign({},C,{meta:JSON.stringify(C)});n.post(d.eventlogsUrl,I)}catch(L){console.log(L)}t.validateOtp=function(i){if(i){$("#verifyerr").text("");var r="https://www.medibuddy.in/WAPI/UserVerification",c={tokenForLoginModel:t.tokenlogin,Token:t.token,Phrase:$("#otp").val(),platform:"medibuddyInweb"};n.post(r,c,{headers:{"Content-Type":"application/json"}}).then(function(i){if(i=i.data,i.isSuccess){if(l.location.href.includes("medibuddy"))try{var r={screen:"Self Registration",appVersion:"",id:t.phone,domain:"medibuddyInWeb",event:"LF_SELFREG_PHONE_VERIFIED",email:t.email,advertiserId:l.sessionStorage.getItem("branch_fingerprint"),auth_uuid:u.get("auth_uuid")||void 0},c=Object.assign({},r,{meta:JSON.stringify(r)});n.post(d.eventlogsUrl,c)}catch(p){console.log(p)}s.loggedUserName=i.loginDetails.user.firstName,s.setUserObj(_.extend(i.loginDetails.user,{isRetailLabsFlowEnabled:i.isRetailLabsFlowEnabled})),t.ok(),e.dismiss("cancel"),o.$emit("userLogin",a),a.controller&&("authService"==a.controller&&a.func?s[a.func].apply(null,a.args):o.$broadcast(a.controller,a)),o.$broadcast("search","")}else{if(l.location.href.includes("medibuddy"))try{var r={screen:"Self Registration",appVersion:"",id:t.phone,domain:"medibuddyInWeb",event:"LF_SELFREG_PHONE_NOT_VERIFIED",email:t.email,advertiserId:l.sessionStorage.getItem("branch_fingerprint"),auth_uuid:u.get("auth_uuid")||void 0},c=Object.assign({},r,{meta:JSON.stringify(r)});n.post(d.eventlogsUrl,c)}catch(p){console.log(p)}$("#verifyerr").text(i.message)}})}},t.validateNumber=function(e,t){var a=new RegExp(r.getRegexExpression(t)),o=String.fromCharCode(e.charCode?e.charCode:e.which);if(!a.test(o)&&13!==e.charCode&&9!==e.charCode)return e.preventDefault(),!1},t.ok=function(){v=!1,e.dismiss("cancel"),t.user&&t.user.token&&t.user.userDetails||(s.insuranceSelected=!1,"app.covidVaccination"==c.current.name&&c.go("app.home",{reload:!1}))},t.openOtpFlow=function(){t.regFormCheck=!1,t.regScreen=!0,t.otpEnterScreen=!1,t.counter=30,t.showResendLink=!1,$(".timer").html(""),$("#verifyerr").text(""),$("#loginerr").text(""),setTimeout(function(){$("#otp").val("")},100),h=setInterval(function(){$(".timer").text(t.counter+"s"),t.counter--,1===t.counter&&(t.showResendLink=!0,t.stopTimerCorp())},1e3)},t.stopTimerCorp=function(){clearInterval(h),t.counter=60,t.showResendLink=!0},t.updatePhone=function(){t.phone=$("#phone").val();var e=/^[1-9]{1}[0-9]{9}$/;$("#phone").removeClass("input-error"),$("#phonerr").text(""),$("#signuperr").text(""),$("#loginerr").text("");var a=$("#phone").val();e.test(a)?($("#phonerr").text(""),$(".loginBtn").prop("disabled",!1)):($("#phonerr").text("Please enter valid 10 digit number"),$(".loginBtn").prop("disabled",!0))},t.updateName=function(){t.name=$("#name").val()},t.updateGrade=function(){t.grade=$("#grade").val()},t.updateDateOfBirth=function(){t.dob=$("#dob").val()},t.updateEmployeeCode=function(){t.empCode=$("#empCode").val()},t.updateGender=function(){t.gender=$("#gender").val()},t.updateLeaderFamily=function(){t.grade=$("#leader").val()},t.registerUser=function(e,a){if(e){if(l.location.href.includes("medibuddy"))try{var o={screen:"Self Registration",appVersion:"",domain:"medibuddyInWeb",event:"LF_SELFREG_FORM_SUBMITTED",email:t.email,advertiserId:l.sessionStorage.getItem("branch_fingerprint"),auth_uuid:u.get("auth_uuid")||void 0},i=Object.assign({},o,{meta:JSON.stringify(o)});n.post(d.eventlogsUrl,i)}catch(r){console.log(r)}t.counter=30,t.stopTimerCorp(),$("#loginerr").text(""),a||$(".otpPhone").append(t.phone);var s="https://www.medibuddy.in/WAPI//RegisterWellnessCorpUser",c={employeeId:t.empCode,dateOfBirth:t.dob,name:t.name,email:t.email,phone:t.phone,gender:t.gender,corporateName:"NonTPASSO",entityId:t.entityId,grade:t.grade?t.grade:void 0};a&&t.openOtpFlow(),n.post(s,c,{headers:{"Content-Type":"application/json"}}).then(function(e){if(e=e.data,e.isSuccess)if(a||t.openOtpFlow(),e.otpResponse&&e.tokenForLoginModel){if(t.tokenlogin=e.tokenForLoginModel,t.token=e.otpResponse.otpKey,l.location.href.includes("medibuddy"))try{var o={screen:"Self Registration",appVersion:"",phone:t.phone,domain:"medibuddyInWeb",event:"LF_SELFREG_USER_CREATED",email:t.email,advertiserId:l.sessionStorage.getItem("branch_fingerprint"),auth_uuid:u.get("auth_uuid")||void 0},i=Object.assign({},o,{meta:JSON.stringify(o)});n.post(d.eventlogsUrl,i)}catch(r){console.log(r)}}else e.message&&$("#loginerr").text(e.message);else{if($("#loginerr").text(e.errorMessage),l.location.href.includes("medibuddy"))try{var o={screen:"Self Registration",appVersion:"",info:e.errorMessage,phone:t.phone,domain:"medibuddyInWeb",event:"LF_SELFREG_USER_CREATION_FAILED",email:t.email,advertiserId:l.sessionStorage.getItem("branch_fingerprint"),auth_uuid:u.get("auth_uuid")||void 0},i=Object.assign({},o,{meta:JSON.stringify(o)});n.post(d.eventlogsUrl,i)}catch(r){console.log(r)}console.log(e)}})}}}],size:"reg-corp"})}document.querySelector("header").classList.remove("sticky-header")},openLoginPopup:function(e,t,o,r,s){if(t=r?r+timeStamp:"templates/openLoginPopUpnew.html?"+timeStamp,o||(o={}),!v){v=!0;n.open({animation:!0,templateUrl:t,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","apiProvider",function(e,t,a,n,r,l,d,c,p,m,g,h){t.isMobileView=a.isMobileView,$(".loginBtn").prop("disabled",!0),t.loginScreen=!1,t.linkAccountScreen=!0,t.showResendLink=!1,t.loginMedibuddyCheck=!0,t.displayTxt=s,t.forgotPasswordScreen=!0,t.otpEnterScreen=!0,t.signUpScreen=!0,t.otpDataId="",t.counter=30,t.phone="",t.name="",t.email="";var f="";t.isValidate=!0,t.mailId="";var b=u.get("city");t.emailPattern=l,t.loginObj={userName:"",password:""},t.gender={M:"Male",F:"Female"},c._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Login/Signup",payload:c._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{itemSource:i.location.href}})}),t.isNewLogin=!0,t.selectedBtn=function(e,a){"LOGIN"===e?(t.screen="login",t.loginMedibuddyCheck=!0,t.loginScreen=!1,t.signUpScreen=!0,t.tabBtns=!1,t.linkAccountScreen=!0,t.forgotPasswordScreen=!0,t.otpEnterScreen=!0,$(".signup").removeClass("active"),$(".login").addClass("active")):"LinkingScreen"===e&&t.linkAccount()},t.showErrorScreen=function(){$("#name").addClass("input-error"),$("#namerr").text("Please enter name"),$("#emailerr").text("Please enter email"),$("#email").addClass("input-error"),$("#phone").val(t.phone)},t.linkAccount=function(){return t.ok(),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_CORPORATE_LOGIN_INITATE",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"Login Page","Entry Point":"I have Corporate Account"}})}),d.openLoginPopupCorp("lg","templates/corporateLoginPopup.html?"+timeStamp,o)},t.stopTimer=function(){clearInterval(f),t.counter=60,t.showResendLink=!0},t.otpVerify=function(e){t.otpDataId=e,t.forgotPasswordScreen=!0,t.linkAccountScreen=!0,t.otpEnterScreen=!1,t.tabBtns=!1,t.loginScreen=!0,t.signUpScreen=!0,t.showResendLink=!1,t.counter=60,$(".timer").html(""),$("#verifyerr").text(""),setTimeout(function(){$("#otp").val("")},100),f=setInterval(function(){$(".timer").text(t.counter+"s"),t.counter--,1===t.counter&&(t.showResendLink=!0,t.stopTimer())},1e3)},t.updateOtp=function(){$("#verifyerr").text("")},t.loginuserbyOtpVerify=function(i,n){if(i){$(".verifyBtn").prop("disabled",!0);var s=u.get("_mp_user"),l=s&&s.userDetails&&s.userDetails.userId||null,p=n?d.isUserSignedin():{},m={source:"medibuddy",platform:"medibuddyInWeb",otp:$("#otp").val(),otpDataId:t.otpDataId,phonenumber:t.phone,advertiserId:c.sessionStorage.getItem("branch_fingerprint"),imei:"MediBuddy_3b82314e-c6ae-4839-b50b-a9e4e64c6f65",version:"3.1.62",name:t.name,email:t.email,isMandatoryMobile:n,corpToken:u.get("corpToken")||void 0,mbUserId:l};console.log(m);var g=h.siteUrl+"unified-login/user/verifyotp";r.post(g,m,{headers:{"Content-Type":"application/json"}}).then(function(i){var r=i.data;$(".verifyBtn").prop("disabled",!1),r.isSuccess?(n&&c._MB_Analytics.__push({isCleverTap:!0,dbLog:"mbConsumerLabs",name:"Verification Sucess",payload:c._Site_Props.__getEventParameters({custom:{pmEntityId:p&&p.userDetails?p.userDetails.pmEntityID:"",userId:p&&p.userDetails?p.userDetails.pmEntityID:""}})}),u.set("patientId",r.patientId),u.set("daservertoken",r.daservertoken),u.set("auth_uuid",r.auth_uuid),u.set("retailMbId",r.user.userDetails.userId),d.loggedUserName=r.user.userDetails.firstName,console.log(d.loggedUserName,r.user),n?null:d.setUserObj(_.extend(r.user,{patientId:r.patientId,isRetailLabsFlowEnabled:r.isRetailLabsFlowEnabled})),t.ok(),e.dismiss("cancel"),a.$emit("userLogin",o),o.controller&&("authService"==o.controller&&o.func?d[o.func].apply(null,o.args):a.$broadcast(o.controller,o)),a.$broadcast("search","")):(n&&c._MB_Analytics.__push({isCleverTap:!0,dbLog:"mbConsumerLabs",name:"Verification Failed",payload:c._Site_Props.__getEventParameters({custom:{pmEntityId:p&&p.userDetails?p.userDetails.pmEntityID:"",userId:p&&p.userDetails?p.userDetails.pmEntityID:""}})}),u.set("toShowMandPopUp",!0),$("#verifyerr").text(r.errorText))})["catch"](function(e){n&&c._MB_Analytics.__push({isCleverTap:!0,dbLog:"mbConsumerLabs",name:"Verification Failed",payload:c._Site_Props.__getEventParameters({custom:{userName:d.loggedUserName,pmEntityId:p&&p.userDetails?p.userDetails.pmEntityID:"",userId:p&&p.userDetails?p.userDetails.pmEntityID:""}})}),u.set("toShowMandPopUp",!0),$(".verifyBtn").prop("disabled",!1),console.log(e)})}else $("#phone").focus(),$("#phone").addClass("input-error")},t.loginUserWithOtp=function(e,a,o){if(e){if(o){var i=d.isUserSignedin();c._MB_Analytics.__push({isCleverTap:!0,dbLog:"mbConsumerLabs",name:"OTP Requested",payload:c._Site_Props.__getEventParameters({custom:{pmEntityId:i&&i.userDetails?i.userDetails.pmEntityID:"",userId:i&&i.userDetails?i.userDetails.pmEntityID:""}})})}$(".otpPhone").text("+91-"),$("#phone").val()?$(".otpPhone").append($("#phone").val()):$(".otpPhone").append(t.phone),$("#phone").removeClass("input-error"),$(".verifyBtn").prop("disabled",!1),t.counter=30,t.stopTimer();var n=u.get("_mp_user"),s=n&&n.userDetails&&n.userDetails.userId||null,l={source:"medibuddy",platform:"medibuddyInWeb",phonenumber:$("#phone").val()?$("#phone").val():t.phone,screen:"login-page",isMandatoryMobile:o,advertiserId:c.sessionStorage.getItem("branch_fingerprint"),mbUserId:s},p=h.siteUrl+"unified-login/user/register";$("#phone").val()&&(t.phone=$("#phone").val()),r.post(p,l,{headers:{"Content-Type":"application/json"}}).then(function(e){var a=e.data;a.success?(u.set("toShowMandPopUp",!1),t.otpDataId=a.data.otpDataId,t.otpVerify(t.otpDataId)):($("#loginerr").text(a.errorText),$("#verifyerr").text(a.errorText))})["catch"](function(e){console.log(e)})}else $("#phone").addClass("input-error")},t.backToLogin=function(){t.stopTimer(),t.linkAccountScreen=!1,t.forgotPasswordScreen=!0,t.otpEnterScreen=!0,t.tabBtns=!0,t.loginScreen=!0,t.signUpScreen=!0},t.editMobile=function(){t.otpEnterScreen=!0,t.forgotPasswordScreen=!0,t.linkAccountScreen=!0,t.tabBtns=!1,t.screen="login","login"===t.screen?($("#phone").text($(".otpPhone").val()),t.loginScreen=!1,t.signUpScreen=!0):"signup"===t.screen&&(t.loginScreen=!0,t.signUpScreen=!1)},t.loginMedibuddy=function(i){if(i){var n={username:t.loginObj.userMBName,password:t.loginObj.passwordMB};t.loginMedibuddyCheck=!0,t.stopTimer(),c._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsLoginSubmit"});var s=h.apiUrl+"MarketPlaceLogon";r.post(s,n,{headers:{"Content-Type":"application/json",City:b,Platform:"web"}}).then(function(i){t.loginMedibuddyCheck=!1,i.data.isSuccess?(d.loggedUserName=t.loginObj.userMBName,d.setUserObj(_.extend(i.data.user,{isRetailLabsFlowEnabled:i.data.isRetailLabsFlowEnabled})),t.ok(),e.dismiss("cancel"),a.$emit("userLogin",o),o.controller&&("authService"==o.controller&&o.func?d[o.func].apply(null,o.args):a.$broadcast(o.controller,o)),a.$broadcast("search","")):"User OTP Not Verified"===i.data.errorMessage?(t.guid=i.data.tokenForLoginModel,t.signinUp(),t.verifyOtpRegUser=!0,t.sendOtp({})):(console.log("in else",i.data.errorMessage),t.loginErrorMsg=i.data.errorMessage,$("#corplogerr").text(i.data.errorMessage),t.usersigninedinFailed())})}},t.updateuserMBName=function(){$("#corplogerr").text("")},t.updateMBPwd=function(){$("#corplogerr").text("")},t.ok=function(){v=!1,e.dismiss("cancel"),t.counter=30,d.isUserSignedin()||"app.covidVaccination"==p.current.name&&p.go("app.home",{reload:!1})},t.forgotPassword=function(){t.counter=30,t.infinitiLoginCheck=!1,t.userNamePlaceholder="Enter your Mobile or Email",t.loginObj.userName="",t.isPasswordCheck=!0,t.forgotPassErrorMsg="",t.forgotPasswordScreen=!1,t.linkAccountScreen=!0,t.otpEnterScreen=!0,t.loginScreen=!0,t.signUpScreen=!0},t.validateNumber=function(e,t){var a=new RegExp(l.getRegexExpression(t)),o=String.fromCharCode(e.charCode?e.charCode:e.which);if(!a.test(o)&&13!==e.charCode&&9!==e.charCode)return e.preventDefault(),!1},t.updateMob=function(){var e=/^[1-9]{1}[0-9]{9}$/;$("#phone").removeClass("input-error"),$("#moberr").text(""),$("#signuperr").text(""),$("#loginerr").text("");var t=$("#phone").val();e.test(t)?($("#moberr").text(""),$(".signUpBtn").prop("disabled",!1),$(".loginBtn").prop("disabled",!1)):($("#moberr").text("Please enter valid 10 digit number"),$(".signUpBtn").prop("disabled",!0),$(".loginBtn").prop("disabled",!0))},t.openDetailsPage=function(){t.ok();var e=u.get("_mp_user").userDetails.userId;if(c.location.href.includes("medibuddy")){var a={screen:"Home_Page",appVersion:"",domain:"medibuddyInWeb",event:"LF_MANDATORY_MOBILE_POPUP_CLICKHERE",advertiserId:c.sessionStorage.getItem("branch_fingerprint"),auth_uuid:u.get("auth_uuid")||void 0,mbUserId:e},o=Object.assign({},a,{meta:JSON.stringify(a)});r.post(h.eventlogsUrl,o)}return d.openLoginPopup("lg","templates/mandatoryPhoneNoImp.html?"+timeStamp,void 0,"templates/mandatoryPhoneNoImp.html?")},t.skipMandatoryMobile=function(){var e=u.get("_mp_user"),a=e&&e.userDetails&&e.userDetails.userId||null;if(c.location.href.includes("medibuddy")){var o={screen:"Home_Page",appVersion:"",domain:"medibuddyInWeb",event:"LF_MANDATORY_MOBILE_POPUP_SKIPCLICK",advertiserId:c.sessionStorage.getItem("branch_fingerprint"),auth_uuid:u.get("auth_uuid")||void 0,mbUserId:a},i=Object.assign({},o,{meta:JSON.stringify(o)});r.post(h.eventlogsUrl,i)}var n=d.isUserSignedin();c._MB_Analytics.__push({excludeCleverTap:!0,dbLog:"mbConsumerLabs",name:"Mandatory Popup Skipped",payload:c._Site_Props.__getEventParameters({custom:{pmEntityId:n.userDetails?n.userDetails.pmEntityID:"",userId:n.userDetails?n.userDetails.userId:""}})}),u.set("toShowMandPopUp",!1),t.ok()},t.redirectToMandatoryMobile=function(){var e=u.get("_mp_user"),a=e&&e.userDetails&&e.userDetails.userId||null;if(c.location.href.includes("medibuddy")){var o={screen:"Home_Page",appVersion:"",domain:"medibuddyInWeb",event:"LF_MANDATORY_MOBILE_POPUP_CONTINUEVERIFICATION",advertiserId:c.sessionStorage.getItem("branch_fingerprint"),auth_uuid:u.get("auth_uuid")||void 0,mbUserId:a},i=Object.assign({},o,{meta:JSON.stringify(o)});r.post(h.eventlogsUrl,i)}return t.ok(),d.openLoginPopup("lg","templates/openMandatoryMobilePopup.html?"+timeStamp,void 0,"templates/openMandatoryMobilePopup.html?")},t.updateName=function(){var e=/^[A-Za-z0-9 ]+$/;$("#name").removeClass("input-error"),$("#namerr").text(""),$("#signuperr").text("");var t=$("#name").val();""===t||e.test(t)?($("#namerr").text(""),$(".signUpBtn").prop("disabled",!1)):($("#namerr").text("Please enter valid name"),$(".signUpBtn").prop("disabled",!0))},t.updateEmail=function(){var e=/^(([^<>()\[\]\\.,;:\s@']+(\.[^<>()\[\]\\.,;:\s@']+)*)|('.+'))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
$("#email").removeClass("input-error"),$("#emailerr").text(""),$("#signuperr").text("");var t=$("#email").val();if(""===t||e.test(t)){var a=t.split("@");S.includes(a[1])?($("#emailerr").text("Please enter valid email"),$(".signUpBtn").prop("disabled",!0)):(console.log(" valid"),$("#emailerr").text(""),$(".signUpBtn").prop("disabled",!1))}else console.log("not valid"),$("#emailerr").text("Please enter valid email"),$(".signUpBtn").prop("disabled",!0)},t.signUpUser=function(e){if(console.log(e),e){t.counter=30,$(".otpPhone").text("+91-"),$(".otpPhone").append($("#phone").val()),t.name=$("#name").val(),t.email=$("#email").val(),t.phone=$("#phone").val();var a={source:"medibuddy",platform:"medibuddyInWeb",phonenumber:$("#phone").val(),screen:"signUpScreen",name:t.name,email:t.email,advertiserId:c.sessionStorage.getItem("branch_fingerprint")},o=h.siteUrl+"unified-login/user/register";r.post(o,a,{headers:{"Content-Type":"application/json"}}).then(function(e){var a=e.data;a.success?(t.otpDataId=a.data.otpDataId,t.otpVerify(t.otpDataId)):$("#signuperr").text(a.errorText)})["catch"](function(e){console.log("error",e)})}},d.showRegisterTab&&(t.selectedBtn("REGISTER"),d.showRegisterTab=!1),d.showLinkingScreen&&t.selectedBtn("LinkingScreen")}],size:a.isMobileView?"login-new modal-bottom":"login-new",windowClass:a.isMobileView&&"bottom-sheet"})}document.querySelector("header").classList.remove("sticky-header")},openLoginPopupCorp:function(e,t,a){if(a||(a={}),!v){v=!0;n.open({animation:!0,templateUrl:t,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","$sce",function(e,t,o,n,r,s,l,c,p,m,g,h){$(".loginBtn").prop("disabled",!0);try{c._MB_Analytics.__push({branchLog:{name:"corporateLoginEntryPointClicked",custom_data:{medibuddyUserId:"",source:c.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:c.sessionStorage.getItem("branch_fingerprint")||"",entryPoint:c.location.href}}})}catch(f){console.log(f)}t.loginScreen=!1,t.linkAccountScreen=!0,t.showResendLink=!1,t.loginMedibuddyCheck=!0,t.tpoerrorMessage=!1,t.otpEnterScreen=!0,t.showRetailLogin=!0,t.otpVerificationTime=1,t.otpDataId="",t.counter=30,t.entityId="",t.phone="",t.name="",t.email="",t.hideotpshare=!1;var b="";t.isValidate=!0,t.mailId="";var y=u.get("city");t.emailPattern=s,t.loginObj={userName:"",password:""},t.gender={M:"Male",F:"Female"},c._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Login/Signup",payload:c._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{itemSource:i.location.href}})}),t.isNewLogin=!0,t.otpModel=[];for(var E=0;E<6;E++)t.otpModel.push({value:"",name:"otp-field-"+E});t.validate=function(e,t){var a=new RegExp(s.getRegexExpression(t)),o=String.fromCharCode(e.charCode?e.charCode:e.which);if(!a.test(o)&&13!==e.charCode&&9!==e.charCode||1==e.target.value.length)return e.preventDefault(),!1},t.validateKeyDown=function(e){var a;if("Backspace"==e.key&&(a=t.otpModel.slice().reverse().find(function(e){return e.value}))){var o=document.querySelector(".input-otp #"+a.name);o&&o.focus&&o.focus()}},t.focusNextInput=function(){var e;if(e=t.otpModel.find(function(e){return!e.value})){var a=document.querySelector(".input-otp #"+e.name);a&&a.focus&&(a.focus(),$("#otp-field-0").removeClass("input-error"),$("#otp-field-1").removeClass("input-error"),$("#otp-field-2").removeClass("input-error"),$("#otp-field-3").removeClass("input-error"),$("#otp-field-4").removeClass("input-error"),$("#otp-field-5").removeClass("input-error"),$("#otp-field-0").addClass("border-blue"),$("#otp-field-1").addClass("border-blue"),$("#otp-field-2").addClass("border-blue"),$("#otp-field-3").addClass("border-blue"),$("#otp-field-4").addClass("border-blue"),$("#otp-field-5").addClass("border-blue"))}},t.linkAccountCorp=function(){try{c._MB_Analytics.__push({branchLog:{name:"corporateLoginViaUsernamePassword",custom_data:{medibuddyUserId:"",source:c.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:c.sessionStorage.getItem("branch_fingerprint")||"",entryPoint:c.location.href}}})}catch(e){console.log(e)}t.linkAccountScreen=!1,t.otpEnterScreen=!0,t.loginScreen=!0},t.stopTimerCorp=function(){clearInterval(b),t.counter=30,t.showResendLink=!0},t.validate=function(e,t){var a=new RegExp(s.getRegexExpression(t)),o=String.fromCharCode(e.charCode?e.charCode:e.which);if(!a.test(o)&&13!==e.charCode&&9!==e.charCode||1==e.target.value.length)return e.preventDefault(),!1},t.otpVerifyCorp=function(e){t.otpDataId=e,t.linkAccountScreen=!0,t.otpEnterScreen=!1,t.showResendLink=!1,t.loginScreen=!0,t.counter=60,$(".timer").html(""),$("#verifyerr").text(""),setTimeout(function(){$("#otp").val("")},100),b=setInterval(function(){$(".timer").text(t.counter+"s"),t.counter--,1===t.counter&&(t.showResendLink=!0,t.stopTimerCorp())},1e3)},t.okCorp=function(){try{c._MB_Analytics.__push({branchLog:{name:"corporateLoginBackButtonClicked",custom_data:{medibuddyUserId:"",source:c.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:c.sessionStorage.getItem("branch_fingerprint")||"",entryPoint:c.location.href}}})}catch(a){console.log(a)}e.dismiss("cancel"),t.counter=30,t.stopTimerCorp(),t.user&&t.user.token&&t.user.userDetails||(l.insuranceSelected=!1,"app.covidVaccination"==p.current.name&&p.go("app.home",{reload:!1}))},t.emailToSSORedirection=function(e,a){r.post("https://infi-node.medibuddy.in/mobile/redirecturl",{username:a}).then(function(o){if(o.data.ssoRedirect&&o.data.singleSignOnUrl)c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_REDIRECT_TO_TPA_SSO",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:a,corporateDomain:a.split("@")[1]}})}),console.log("emailToSSORedirection **** ==>",o.data),c.location.href=o.data.singleSignOnUrl;else{if("EMAIL_OTP_SCREEN_PWD_REDIRECTION"==e)return void t.showOldCorpLoginWindow();t.showHRPortalErr()}})["catch"](function(e){t.showOldCorpLoginWindow()})},t.loginuserbyOtpVerifyCorp=function(i){if(i){$(".verifyBtn").prop("disabled",!0);var n=(1e5*$("#otp-field-0").val()+1e4*$("#otp-field-1").val()+1e3*$("#otp-field-2").val()+100*$("#otp-field-3").val()+10*$("#otp-field-4").val()+1*$("#otp-field-5").val()).toString(),s={corporateEmailAddress:t.email,otp:n,isEmailOTPLogin:!0},d="https://www.medibuddy.in/WAPI/MarketPlaceLogon";r.post(d,s,{headers:{"Content-Type":"application/json",Platform:"web"}}).then(function(i){var r=i.data;if($(".verifyBtn").prop("disabled",!1),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_VERIFY_INITIATE",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginEventScreen:"OTP Screen"}})}),r.isSuccess)c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_VERIFY_SUCCESS",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginEventScreen:"EMAIL_OTP_SCREEN"}})}),c._MB_Analytics.__push({name:"corpLoginOtpVerified",branchLog:{name:"corporateLoginOtpVerificationSuccessful",custom_data:{medibuddyUserId:"",source:c.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:c.sessionStorage.getItem("branch_fingerprint")||"",email:$("#email").val()?$("#email").val():t.email,otpEntered:n,entryPoint:c.location.href}}}),l.loggedUserName=r.user.userDetails.firstName,l.setUserObj(_.extend(r.user,{isRetailLabsFlowEnabled:r.isRetailLabsFlowEnabled})),t.okCorp(),e.dismiss("cancel"),o.$emit("userLogin",a),a.controller&&("authService"==a.controller&&a.func?l[a.func].apply(null,a.args):o.$broadcast(a.controller,a)),o.$broadcast("search",""),l.getuserLongToken(r.user.token).then(function(e){e.data.isSuccess&&e.data.encryptedToken&&l.getEncryptedTokenForLinking({corpToken:e.data.encryptedToken,corpMbId:r.user.userDetails.userId})})["catch"](function(e){console.log("Error Occured",e.message)});else{t.isRegistration&&"Oops, Looks like your corporate data is not present with us. Please check your username once again. Please connect with your HR or contact Medibuddy customer support to get your correct username"===r.errorMessage&&t.showRegistrationWindow(),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_VERIFY_FAILED",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginEventScreen:"EMAIL_OTP_SCREEN"}})}),t.otpVerificationTime+=1,t.otpVerificationTime>=4&&!u.get(obj.userDetails)?($("#verifyerr").text("Sorry, We are not able to connect your corporate account. Please use your phone number to login and use other services."),t.showRetailLogin=!1):$("#verifyerr").text(r.errorMessage),$("#otp-field-0").removeClass("border-blue"),$("otp-field-1").removeClass("border-blue"),$("#otp-field-2").removeClass("border-blue"),$("#otp-field-3").removeClass("border-blue"),$("#otp-field-4").removeClass("border-blue"),$("#otp-field-5").removeClass("border-blue"),$("#otp-field-0").addClass("input-error"),$("#otp-field-1").addClass("input-error"),$("#otp-field-2").addClass("input-error"),$("#otp-field-3").addClass("input-error"),$("#otp-field-4").addClass("input-error"),$("#otp-field-5").addClass("input-error");try{c._MB_Analytics.__push({branchLog:{name:"corporateLoginOtpErrorReceived",custom_data:{medibuddyUserId:"",source:c.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:c.sessionStorage.getItem("branch_fingerprint")||"",email:$("#email").val()?$("#email").val():t.email,otpEntered:n,entryPoint:c.location.href,errorMessage:r.errorMessage}}})}catch(s){console.log(s)}}})["catch"](function(e){$(".verifyBtn").prop("disabled",!1),e.data?$("#verifyerr").text("Something went wrong. Please try again after sometime"):$("#verifyerr").text("Please check the entered Email ID")})}else $("#verifyerr").text("Please enter valid OTP")},t.initiateOtpFlow=function(e){e&&c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_RETRY",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0}})});var a=$("#email").val()?$("#email").val():t.email;try{if("https://www.medibuddy.in"===c.location.href){var o={screen:"Login",appVersion:"",domain:"medibuddyInweb",event:"corporateLoginOtpRequested",email:t.email,auth_uuid:u.get("auth_uuid")||void 0},i=Object.assign({},o,{meta:JSON.stringify(o)});r.post(d.eventlogsUrl,i)}c._MB_Analytics.__push({branchLog:{name:"corporateLoginOtpRequested",custom_data:{medibuddyUserId:"",source:c.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:c.sessionStorage.getItem("branch_fingerprint")||"",email:a,entryPoint:c.location.href}}})}catch(n){console.log(f)}var s={corporateEmailAddress:a},l="https://www.medibuddy.in/WAPI/SendEmailOTPForLogin";$("#email").val()&&(t.email=$("#email").val()),r.post(l,s,{headers:{"Content-Type":"application/json"}}).then(function(e){c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_SENT",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.otpVerifyCorp(t.otpDataId)})["catch"](function(e){c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_NOT_SENT",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",corporateDomain:t.email.split("@")[1]}})}),console.log(e)})},t.openLoginScreenOld=function(e,o){if(t.okCorp(),e)try{if("https://www.medibuddy.in"===c.location.href){var i={screen:"Login",appVersion:"",domain:"medibuddyInweb",event:"corpLoginUsernamePwdVerifyReq",email:t.email,auth_uuid:u.get("auth_uuid")||void 0},n=Object.assign({},i,{meta:JSON.stringify(i)});r.post(d.eventlogsUrl,n)}}catch(s){console.log(s)}else c._MB_Analytics.__push({excludeCleverTap:"true",dbLog:!0,name:"LF_USERNAME_LOGIN_INITATE",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,screen:"USERNAME_PWD_SCREEN"}})});return o||(o="EMAIL_OTP_SCREEN"),u.set("toShowMandPopUp",!0),l.openLoginPopupOld("lg","templates/openLoginPopUp.html?"+timeStamp,a,o)},t.openRetailLogin=function(){return t.okCorp(),l.openLoginPopup("lg","templates/openLoginPopUpnew.html?"+timeStamp)},t.showRetailLoginMsg=function(){$("#corperr").text("Sorry, We are not able to connect your corporate account. Please use your phone number to login and use other services."),t.hideotpshare=!0,t.showRetailLogin=!1},t.showOldCorpLoginWindow=function(){c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_TO_USERPWD_REDIRECTION",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.hideotpshare=!0,t.openLoginScreenOld(!0)},t.showRegistrationWindow=function(){return c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SHOW_SELF_REGISTRATION_FORM",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"Login Page",email:t.email}})}),t.okCorp(),l.openRegistrationPopup("lg","templates/openRegistrationPopup.html?"+timeStamp,{email:t.email,entityId:t.entityId})},t.loginUserWithOtpCorp=function(e,a){var o=$("#email").val()?$("#email").val():t.email;if(e){try{if("https://www.medibuddy.in/"===c.location.href){var n={screen:"Login",appVersion:"",domain:"medibuddyInWeb",event:"emailidentered",auth_uuid:u.get("auth_uuid")||void 0},s=Object.assign({},n,{meta:JSON.stringify(n)});r.post(d.eventlogsUrl,s)}}catch(l){console.log(l)}$("#email").val()?$(".otpEmail").text($("#email").val()):$(".otpEmail").append(t.email),$("#email").removeClass("input-error"),t.counter=30,t.stopTimerCorp();var p={corporateEmailAddress:o},m="https://www.medibuddy.in/WAPI/CheckEmailOTPLoginLaunch";$("#email").val()&&(t.email=$("#email").val()),r.post(m,p,{headers:{"Content-Type":"application/json"}}).then(function(e){var a=e.data;if(console.log(a),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_REQUEST",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),a.isSuccess){var o=a.checkTpAorNonTpaUserResponse&&a.checkTpAorNonTpaUserResponse.reasonType?a.checkTpAorNonTpaUserResponse.reasonType:0,n=a.checkTpAorNonTpaUserResponse&&a.checkTpAorNonTpaUserResponse.userType?a.checkTpAorNonTpaUserResponse.userType:"NonTPAUser";if("Allow EmailOTP"===a.clientAction)u.set("toShowMandPopUp",!0),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,screen:"Email_Login",loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),"TPAUser"==n?c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_TPA",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}):c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_NON_TPA",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.initiateOtpFlow();else if("Highlight UserNameAndPassword Flow"===a.clientAction){if(5==o?c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}):8==o?(c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,screen:"Email_Login",loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_TPA",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_MULTIPLE_LOGINS",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",userEmail:t.email,corporateDomain:t.email.split("@")[1]}})}),t.emailToSSORedirection("EMAIL_OTP_SCREEN",t.email)):1==o&&c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_ABSENT_IN_MB",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),"TPAUser"==n?(c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_TPA",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.emailToSSORedirection("EMAIL_OTP_SCREEN",t.email)):"NonTPAUser"==n&&c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_NON_TPA",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),[10].includes(o))return c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,screen:"Email_Login",loginScreenEvent:"EMAIL_OTP_SCREEN",emailid:t.email,corporateDomain:t.email.split("@")[1]}})}),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_NON_TPA",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_MULTIPLE_LOGINS",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",userEmail:t.email,corporateDomain:t.email.split("@")[1]}})}),void t.showOldCorpLoginWindow();var s="https://infi-node.medibuddy.in/mobile/redirecturl";r.post(s,{username:t.email},{headers:{"Content-Type":"application/json"}}).then(function(e){if(e.data.ssoRedirect){console.log("res.data ****",e.data),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_REDIRECT_TO_TPA_SSO",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})});var a=e.data.singleSignOnUrl;i.location.href=a}else t.showOldCorpLoginWindow()})["catch"](function(e){t.showOldCorpLoginWindow()})}else if("Redirect To SSO"===a.clientAction){var s=a.ssoUrl;if(s){try{if("https://www.medibuddy.in/"===c.location.href){var l={screen:"Login",appVersion:"",domain:"medibuddyInweb",event:"SSOredirection",email:t.email,auth_uuid:u.get("auth_uuid")||void 0},p=Object.assign({},l,{meta:JSON.stringify(l)});r.post(d.eventlogsUrl,p)}}catch(m){console.log(m)}c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_REDIRECT_TO_NONTPA_SSO",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.okCorp(),t.hideotpshare=!0,c.open(s,"_blank").focus()}else t.showHRPortalErr()}else"Show Error Message"===a.clientAction?(c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ERR_MSG",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),t.showHRPortalErr()):"Show Registration Page"===a.clientAction?(c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,screen:"Email_Login",loginScreenEvent:"EMAIL_OTP_SCREEN",emailid:t.email,corporateDomain:t.email.split("@")[1]}})}),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_ABSENT_IN_MB",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_NON_TPA",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SELFREG_FORM_OPEN_REQ",payload:c._Site_Props.__getEventParameters({custom:{screen:"Corp_login",appVersion:"",domain:"medibuddyInWeb",event:"LF_SELFREG_FORM_OPEN_REQ",advertiserId:c.sessionStorage.getItem("branch_fingerprint"),email:t.email,auth_uuid:u.get("auth_uuid")||void 0}})}),t.initiateOtpFlow(),t.entityId=a.checkTpAorNonTpaUserResponse.pM_EntityId,t.isRegistration=!0):(9==o&&c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),"TPAUser"==n?(c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_ABSENT_IN_MB",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_TPA",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),9==o?t.emailToSSORedirection("NO_USRNAME_REDIRECTION",t.email):t.emailToSSORedirection("EMAIL_OTP_SCREEN_PWD_REDIRECTION",t.email)):t.showOldCorpLoginWindow())}else"NonTPA_UserNotFound"==a.errorMessage&&(c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_EMAIL_OTP_ENABLED",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})}),c._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_ABSENT_IN_MB",payload:c._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN",emailId:t.email,corporateDomain:t.email.split("@")[1]}})})),t.showHRPortalErr()})["catch"](function(e){console.log(e)})}else{$("#email").addClass("input-error"),$("#loginerr").text("Please enter correct Email ID"),$("#corpemaillabel").css("color","red"),t.hideotpshare=!0;try{c._MB_Analytics.__push({branchLog:{name:"corporateLoginInvalidEmailEntered",custom_data:{medibuddyUserId:"",source:c.sessionStorage.getItem("utm_source")||"",maid:"",platform:"MBWeb",browser_fingerprint_id:c.sessionStorage.getItem("branch_fingerprint")||"",email:$("#email").val()?$("#email").val():t.email,entryPoint:c.location.href}}})}catch(g){console.log(g)}}},t.showHRPortalErr=function(){$("#email").addClass("input-error"),$("#loginerr").text("We did not find any users with the given email. Please contact your HR to create your account"),$("#corpemaillabel").css("color","red");try{if("https://www.medibuddy.in/"===c.location.href){var e={screen:"Login",appVersion:"",domain:"medibuddyInweb",event:"errLoginHRPortal",email:t.email,auth_uuid:u.get("auth_uuid")||void 0},a=Object.assign({},e,{meta:JSON.stringify(e)});r.post(d.eventlogsUrl,a)}}catch(o){console.log(o)}t.hideotpshare=!0},t.editEmailCorp=function(){t.otpEnterScreen=!0,t.linkAccountScreen=!0,t.loginScreen=!1},t.loginMedibuddyCorp=function(i){if(i){var n={username:t.loginObj.userMBName,password:t.loginObj.passwordMB};t.loginMedibuddyCheck=!0,t.stopTimerCorp(),c._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsLoginSubmit"});var s=d.apiUrl+"MarketPlaceLogon";r.post(s,n,{headers:{"Content-Type":"application/json",City:y,Platform:"web"}}).then(function(i){t.loginMedibuddyCheck=!1,i.data.isSuccess?(l.loggedUserName=t.loginObj.userMBName,l.setUserObj(_.extend(i.data.user,{isRetailLabsFlowEnabled:i.data.isRetailLabsFlowEnabled})),t.okCorp(),e.dismiss("cancel"),o.$emit("userLogin",a),a.controller&&("authService"==a.controller&&a.func?l[a.func].apply(null,a.args):o.$broadcast(a.controller,a)),o.$broadcast("search","")):"User OTP Not Verified"===i.data.errorMessage?(t.guid=i.data.tokenForLoginModel,t.signinUp(),t.verifyOtpRegUser=!0,t.sendOtp({})):(console.log(i.data.errorMessage),t.loginErrorMsg=i.data.errorMessage,$("#corperr").text("Sorry, We are not able to connect your corporate account. Please use your phone number to login and use other services."),t.hideotpshare=!0,t.showRetailLogin=!1,$("#corplogerr").text(i.data.errorMessage),t.usersigninedinFailed())})}},t.updateuserMBNameCorp=function(){$("#corplogerr").text("")},t.updateMBPwdCorp=function(){$("#corplogerr").text("")},t.okCorp=function(){v=!1,e.dismiss("cancel"),t.counter=30,t.user=l.getUserObj(),t.user&&t.user.token&&t.user.userDetails||(l.insuranceSelected=!1,"app.covidVaccination"==p.current.name&&p.go("app.home",{reload:!1}))},t.updateEmailCorp=function(){t.tpoerrorMessage=!1;var e=/^(([^<>()\[\]\\.,;:\s@']+(\.[^<>()\[\]\\.,;:\s@']+)*)|('.+'))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;$("#email").removeClass("input-error"),$("#corplogerr").text(""),$("#corperr").text(""),$("#loginerr").text("");var a=$("#email").val();if(""===a||e.test(a)){var o=a.split("@");S.includes(o[1])?($("#loginerr").text("Please enter valid Corporate Email"),$(".loginBtn").prop("disabled",!0)):($("#loginerr").text(""),$(".loginBtn").prop("disabled",!1))}else $("#loginerr").text("Please enter a valid email ID"),$(".loginBtn").prop("disabled",!0)}}],size:"login-corp"})}document.querySelector("header").classList.remove("sticky-header")},openInsurancePopUp:function(e,t,a){n.open({animation:!0,templateUrl:t,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","$sce",function(e,t,o,i,n,r,s,l,c,p,m,g){t.linkInfo={policyNumber:"",userName:"",entityId:0},t.errMsg="",t.sortDatas=a.policyList,t.backToInsuranceForm=function(){t.InsuranceLinkError=!1},t.InsuranceLinkError=!1,t.closeModal=function(){e.dismiss("cancel")},t.linkInsurerAccount=function(){if(!t.linkInfo.entityId)return void(t.errMsg="Please Choose Your Policy");if(1==l.location.href.includes("medibuddy"))try{var e={appVersion:"",domain:"medibuddyInWeb",event:"LYI_Submit",policy_provider_pmEntityId:t.linkInfo.entityId,pol_number:t.linkInfo&&t.linkInfo.policyNumber},a=Object.assign({},e,{meta:JSON.stringify(e)});n.post(d.eventlogsUrl,a)}catch(o){console.log(o)}var i={entityId:t.linkInfo.entityId,retailPolicyNumber:t.linkInfo.policyNumber},r=s.getUserObj();s.makeAjaxCalls(d.infinitiNode+"CorporateData/UserCreation",i,"POST",r.encryptedToken).then(function(e){if(e.data.isSuccess&&e.data.authServerToken){u.set("policyNumber",JSON.stringify(t.linkInfo.policyNumber)),t.closeModal();var a=l.location.href+"sl?AuthToken="+e.data.authServerToken;l.location.href=a}t.InsuranceLinkError=!0,t.insuranceErroMsg=e.data.message})["catch"](function(e){t.InsuranceLinkError=!0,t.insuranceErroMsg=e.data.message,console.log(e)})},t.myChangeInfo=function(e,a){t.linkInfo[e]=a,t.errMsg=""}}],size:"login-corp"})},openSubsPopup:function(){n.open({animation:!0,templateUrl:"templates/subs.html?"+timeStamp,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","$sce",function(e,t,a,i,n,r,s,l,d,c,u,p){t.closeModal=function(){e.dismiss("cancel")},t.allowed_subscriptions=[{packageName:"Tier1",displayName:"Basic Package",packagePrice:1e3,description:"This package sucks, don't even think about buying it"},{packageName:"Tier2",displayName:"Intermediate Package",packagePrice:2e3,description:"This package is alright i guess, might give it a try"},{packageName:"Tier3",displayName:"Advanced Package",packagePrice:3e3,description:"This package is pretty good, 8/10 would buy again"},{packageName:"Tier4",displayName:"Epic Package",packagePrice:4e3,description:"This package is crazy good, youl'l regret not buying this"},{packageName:"Tier5",displayName:"Extreme Package",packagePrice:5e3,description:"This package is better than taco bell, do I need to say more?"},{packageName:"Tier6",displayName:"Legendary Package",packagePrice:6e3,description:"This should be illegal bruh"},{packageName:"Tier7",displayName:"No Longer a Package",packagePrice:7e3,description:"This package is has ascended the physical realm and become the very embodiment of value for money"}],t.subsWaves=["url(/assets/icons/subs/wave-2.svg)","url(/assets/icons/subs/wave-5.svg)","url(/assets/icons/subs/wave-6.svg)","url(/assets/icons/subs/wave-4.svg)","url(/assets/icons/subs/wave-3.svg)","url(/assets/icons/subs/wave-1.svg)","url(/assets/icons/subs/wave-7.svg)"],t.selected=!1,t.selectedSubscription=void 0,t.addSubscription=function(e){t.selectedSubscription=e,t.selected=!0},t.removeSubscription=function(e){t.selectedSubscription=void 0,t.selected=!1},t.checkoutSubsCart=function(){console.log("puhsed cart item to db/redist"),t.closeModal(),o.url("/subsCheckout")}}],size:a.isMobileView?"bottom":"border modal-sm",windowClass:a.isMobileView?"bottom-sheet":"subsModal"})},checkoutSubsCart:function(){o.url("/subsCheckout")},openLoginPopupOld:function(e,t,a,o){if(a||(a={}),!v){v=!0;n.open({animation:!0,templateUrl:t,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","$sce",function(e,t,n,r,s,l,c,p,m,h,b,y){
t.isEmpty=!1,t.userNamePlaceholder="Enter your Mobile or Email",t.tooltipText=y.trustAsHtml("<div><b>MediBuddy</b> is the exclusive one-stop app for <b>Medi Assist</b> members to manage all their healthcare needs. Your <b>MediBuddy</b> helps make the most of your health and wellness benefits, anytime, anywhere and on-the-go: <br><br> Access a curated catalog of outpatient services on <b>Infiniti</b><br><br> Don't have your <b> MediBuddy</b> login yet? Activate your account now.</div>"),t.userOtpVarified=!1,t.infinitiLoginCheck=!0,t.showpassword=!1;var S=6e3;t.showRetailLogin=!0,t.loginClicked=1,t.isValidate=!0,t.entityId=0,t.mailId="";var E=u.get("city");t.emailPattern=l,t.loginObj={userName:"",password:""},t.gender={M:"Male",F:"Female"},p._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:!0,name:"Login/Signup",payload:p._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{itemSource:i.location.href}})}),t.usernameChanged=function(){t.showpassword=!1,t.isTPAMessage=!1;var e=/^\S*$/;void 0==t.loginObj.userMBName||0==e.test(t.loginObj.userMBName)?t.regexTestFailed=!0:t.regexTestFailed=!1},t.ssoRedirectFnt=function(){s.post("https://infi-node.medibuddy.in/mobile/redirecturl",{username:t.loginObj.userMBName}).then(function(e){e.data.ssoRedirect&&e.data.singleSignOnUrl?(p.location.href=e.data.singleSignOnUrl,p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USRNAME_REDIRECT_TO_TPA_SSO",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"EMAIL_OTP_SCREEN"}})})):(t.loginErrorMsg="portal.medibuddy.in",t.TPAUserMessage())})["catch"](function(e){t.loginErrorMsg="portal.medibuddy.in",t.TPAUserMessage()})},t.okCorp=function(){v=!1,e.dismiss("cancel"),t.counter=30,t.user=c.getUserObj(),t.user&&t.user.token&&t.user.userDetails||(c.insuranceSelected=!1,"app.covidVaccination"==m.current.name&&m.go("app.home",{reload:!1}))},t.showRegistrationWindow=function(){return t.okCorp(),c.openRegistrationPopup("lg","templates/openRegistrationPopup.html?"+timeStamp,{email:t.loginObj.userMBName,empCode:t.loginObj.userMBName,entityId:t.entityId})},t.checkNonTPA=function(){t.showpassword||t.regexTestFailed||s.post("https://infi-node.medibuddy.in/mobile/checkTPAorNonTPAUser",{userName:t.loginObj.userMBName}).then(function(e){return 204==e.status?void t.checkNonTPA():(void 0!=o&&""!=o?(p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USERNAME_SUBMIT",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:o,emailId:t.loginObj.userMBName}})}),o=""):p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USERNAME_SUBMIT",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),void("Show Registration Page"==e.data.clientAction?(t.entityId=e.data.checkTpAorNonTpaUserResponse.pM_EntityId,t.showRegistrationWindow()):"TPAUser"==e.data.userType?(3==e.data.reasonType?p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}):1==e.data.reasonType&&p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_ABSENT_IN_MB",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_TPA",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),t.ssoRedirectFnt(t.loginObj.userMBName)):(p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_IS_NON_TPA",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),5!=e.data.reasonType&&4!=e.data.reasonType||p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_PRESENT_IN_MB",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),t.showpassword=!0)))})["catch"](function(e){t.TPAUserMessage()})},t.usersigninedinFailed=function(){t.isPasswordWrong=!0,r(function(){t.isPasswordWrong=!1},S)},t.TPAUserMessage=function(){t.isTPAMessage=!0},t.isNewLogin=!0,t.openTab=function(){var e=p.location.pathname+p.location.search;t.url="https://me.medibuddy.in?redirecturl="+e+"sl?AuthToken=",p.location=t.url},t.selectedTab=function(e){t.logInUser.userName="",t.logInUser.password="",t.logInUser.confirmPassword="",t.logInUser.dateOfBirth="",t.logInUser.mobile="",t.logInUser.firstName="",t.logInUser.lastName="",t.logInUser.userRegisterName="",t.logInUser.registerPassword="",t.logInUser.employeeId="",t.logInUser.gender="",t.logInUser.isChecked=!1,"LOGIN"===e?(t.mailAlertForm=!1,t.otpCheckForFBOrGoogle=!1,t.isNewForm=!1,t.isNewLogin=!0):"REGISTER"===e&&r(function(){t.isSingUpCreated=!0,t.isPasswordWrong=!1,t.isNewForm=!0,t.isNewLogin=!1},0)},t.changeClass=function(){t.invalidClass&&(t.invalidClass=void 0)},t.backToInfinitiLogin=function(){t.forgetFormMedibuddy=!1,t.isPasswordCheck=!1,t.otpCheckLogin=!1,t.forgetPasssOtpCheck=!1,t.localScope=t,t.medibuddyLoginCheck=!1,t.infinitiLoginCheck=!0,t.userNames=[]},t.loginMedibuddy=function(){if(t.showpassword){var o={username:t.loginObj.userMBName,password:t.loginObj.passwordMB};t.loginMedibuddyCheck=!0,p._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsLoginSubmit"});var i=d.apiUrl+"MarketPlaceLogon";s.post(i,o,{headers:{"Content-Type":"application/json",City:E,Platform:"web"}}).then(function(o){p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USRNAME_PWD_SUBMIT",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",emailId:t.loginObj.userMBName}})}),t.loginMedibuddyCheck=!1,o.data.isSuccess?(t.showRetailLogin=!0,c.loggedUserName=t.loginObj.userMBName,c.setUserObj(_.extend(o.data.user,{isRetailLabsFlowEnabled:o.data.isRetailLabsFlowEnabled})),p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USERNAME_LOGIN_SUCCESS",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",userType:"NON-TPA",emailId:t.loginObj.userMBName}})}),t.ok(),e.dismiss("cancel"),n.$emit("userLogin",a),a.controller&&("authService"==a.controller&&a.func?c[a.func].apply(null,a.args):n.$broadcast(a.controller,a)),n.$broadcast("search",""),c.getuserLongToken(o.user.token).then(function(e){e.data.isSuccess&&e.data.encryptedToken&&c.getEncryptedTokenForLinking({corpToken:e.data.encryptedToken,corpMbId:o.user.userDetails.userId})})["catch"](function(e){console.log("Error Occured",e.message)})):"User OTP Not Verified"===o.data.errorMessage?(p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USER_OTP_NOT_VERIFIED",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0}})}),t.guid=o.data.tokenForLoginModel,t.signinUp(),t.verifyOtpRegUser=!0,t.sendOtp({})):(t.loginClicked+=1,t.loginClicked>=5&&!u.get(obj.userDetails)?(t.loginErrorMsg="Sorry, We are not able to connect your corporate account. Please use your phone number to login and use other services.",t.showRetailLogin=!1):t.loginErrorMsg=o.data.errorMessage,t.usersigninedinFailed())})["catch"](function(e){console.log(e),p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_USERNAME_LOGIN_FAILED",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,loginScreenEvent:"USERNAME_PWD_SCREEN",reason:e&&e.data&&e.data.errorMessage?e.data.errorMessage:"",loginNameDetails:o.username}})})})}},t.resetPassword=function(e){var a=!1,o=!1,i={};if(_.isEmpty(t.userNames)||(a=!0,i.username=t.loginObj.selectedUserName),t.loginObj.userName.match(/[a-z]/i)?t.loginObj.userName.match(t.emailPattern.getRegexExpression("emailchk"))?a=!0:(t.userNamePlaceholder="Enter valid email Id",t.loginObj.userName="",t.invalidClass=!0):t.loginObj.userName.match(/^\d{10}/)?(a=!0,o=!0):(t.userNamePlaceholder="Enter valid mobile number",t.loginObj.userName="",t.invalidClass=!0),a){o?i.mobile=t.loginObj.userName:i.emailId=t.loginObj.userName,t.userNames=[],t.selectedUsername="";try{if("https://www.medibuddy.in/"===p.location.href){var n={screen:"Login",appVersion:"",domain:"medibuddyInweb",event:"forgotpwdrequest",email:t.loginObj.userName,auth_uuid:u.get("auth_uuid")||void 0},r=Object.assign({},n,{meta:JSON.stringify(n)});s.post(d.eventlogsUrl,r)}}catch(l){console.log(l)}s.post(d.apiUrl+"ForgetPassword",i,{headers:{"Content-Type":"application/json",City:E}}).then(function(e){e.data.isSuccess?(t.forgetPasssOtpCheck=!0,t.isPasswordCheck=!1,t.fogetAuthToken=e.data.keyForLoginModel,e.data.mobileOTPSentResponse?(t.fogetPassSednTo=e.data.mobileOTPSentResponse.sentTo,t.forgetOtpKey=e.data.mobileOTPSentResponse.keyForToken):(t.fogetPassSednTo=e.data.emailOTPSentResponse.sentTo,t.forgetOtpKey=e.data.emailOTPSentResponse.keyForToken)):"Multiple users with your emailId"!==e.data.errorMessage||_.isEmpty(e.data.userNames)?t.forgotPassErrorMsg=e.data.errorMessage:(t.userNames=e.data.userNames,t.loginObj.selectedUserName=e.data.userNames[0],t.infinitiLoginCheck=!1,t.isPasswordCheck=!0)})}},t.forgetOtpPassSend=function(o){var i={OTP:o.OTP,keyForToken:t.forgetOtpKey,NewPassword:o.password,KeyForLoginViewModel:t.fogetAuthToken};t.loginErrorMsg="",s.post(d.apiUrl+"MarketPlaceChangePasswordThroughMobile",i,{headers:{"Content-Type":"application/json",City:E}}).then(function(o){if(o.data.isSuccess){t.forgetPasssOtpCheck=!1,c.setUserObj(o.data.loginDetails.user);try{if("https://www.medibuddy.in/"===p.location.href){var i={screen:"Login",appVersion:"",user:o.data.loginDetails.user,domain:"medibuddyInweb",event:"forgotpwdsent",email:t.loginObj.userName,auth_uuid:u.get("auth_uuid")||void 0},r=Object.assign({},i,{meta:JSON.stringify(i)});s.post(d.eventlogsUrl,r)}}catch(l){console.log(l)}t.ok(),e.dismiss("cancel"),n.$emit("userLogin",a),a.controller&&n.$broadcast(a.controller,a),n.$broadcast("search","")}else o.data.errorMessage&&("Wrong OTP"===o.data.errorMessage?b({message:"Please Enter Valid OTP.",position:"center",duration:5e3}):t.loginErrorMsg=o.data.errorMessage)})},t.ok=function(){e.dismiss("cancel")},t.validateMailId=function(e){var a=/^(([^<>()\[\]\\.,;:\s@']+(\.[^<>()\[\]\\.,;:\s@']+)*)|('.+'))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;e?(t.isValidate=a.test(e),t.isValidMail=t.isValidate===!0,t.isMail=!1):(t.isMail=!0,t.isValidate=!0)},t.getMailIdPopup=function(e,t){h.open({templateUrl:t,keyboard:!0,backdrop:"static",controller:["$uibModalInstance","$scope","$rootScope","$timeout","$state","authService",function(e,t,a,o,i,n){t.isValidate=!0,t.isfb=!0,t.ok=function(){e.dismiss("cancel")},t.validateMailId=function(e){var a=/^(([^<>()\[\]\\.,;:\s@']+(\.[^<>()\[\]\\.,;:\s@']+)*)|('.+'))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;e?(t.isValidate=a.test(e),t.isValidMail=t.isValidate===!0,t.isMail=!1):(t.isMail=!0,t.isValidate=!0)},t.getUserObjectForGoogle=function(e,t,a){var o={isSocialLogin:!0,appName:"gmail",appUniqueIdentifier:e.id,appAccessToken:t,email:e.emails,mobile:e.mobile,firstName:e.name.givenName,lastName:e.name.familyName,checkUser:"new"!==a};return o},t.createGoogleUser=function(e,o){var i=d.apiUrl+"MarketPlaceLogon",l=t.getUserObjectForGoogle(e,o,"new");s.post(i,l,{headers:{"Content-Type":"application/json",City:E,Platform:"web"}}).then(function(e){if(e.data.isSuccess)n.setUserObj(e.data.user),p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SSO_SUCCESSFUL_LOGIN",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0}})});else if("User OTP Not Verified"===e.data.errorMessage){p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SSO_LOGIN_USR_OTP_NOT_VERIFIED",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0}})}),t.guid=e.data.tokenForLoginModel;var o={socialLoginDetail:l,isSocialLoginOTP:!0,appId:9194},i=d.apiUrl+"VerifyUser";s.post(i,o,{headers:{"Content-Type":"application/json"}}).then(function(e){t.mobile=e.data.mobileNo,e.data.isSMSSent===!0?(r(function(){t.mailAlertForm=!1,t.otpCheckForFBOrGoogle=!0,t.activePill=1},0),t.otpResponse={otpKey:""},t.otpResponse.otpKey=e.data.otpKey,p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SSO_LOGIN_USR_SMS_OTP_SENT",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,mobileNo:t.mobile}})})):e.data.isEmailSent===!0&&(r(function(){t.mailAlertForm=!1,t.otpCheckForFBOrGoogle=!0,t.activePill=1},0),t.otpResponse={otpKey:""},t.otpResponse.otpKey=e.data.emailKey,p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SSO_LOGIN_USR_EMAIL_OTP_SENT",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0,emailKey:t.otpResponse.otpKey}})}))})}else a.$broadcast("invalidUser",!1),p._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SSO_LOGIN_FAIL",payload:p._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0}})})})},t.getMailId=function(){t.googleUser=f,t.access_token=g,t.googleUser.emails=t.mailId,t.googleUser.mobile=t.mobile,t.createGoogleUser(t.googleUser,t.access_token)},a.$on("closePopup",function(e){t.ok(!1)}),t.isValidMailId=!1,a.$on("invalidUser",function(e,a){t.isValidMail=!1,t.isValidMailId=!0,o(function(){t.isValidMailId=!1},6e3)})}],size:e})},n.$on("closePopup",function(e){t.ok(!1),e.preventDefault()}),t.isSingUpCreated=!0,t.patternCheck=l,t.isValidate=!0,t.isUser=!1,t.isLogin=!0,t.preStoredValue="",t.isValidMail=!1,t.isFirstName=!1,t.isMobile=!1,t.isLastName=!1,t.isError=!1,t.logInUser={userName:"",password:"",confirmPassword:"",dateOfBirth:"",mobile:"",firstName:"",lastName:""},t.openPopup={opened:!1,openDobPopup:!1},t.ok=function(){v=!1,e.dismiss("cancel"),t.user=c.getUserObj(),t.user&&t.user.token&&t.user.userDetails||(c.insuranceSelected=!1,a.stayInState||m.go("app.home",{reload:!1}))},t.openRetailLogin=function(){return t.ok(),c.openLoginPopup("lg","templates/openLoginPopUpnew.html?"+timeStamp)},t.createUser=function(e){var a={userName:e.userRegisterName,password:e.registerPassword,email:e.userRegisterName,mobile:e.mobile,firstName:e.firstName,lastName:e.lastName,dateOfBirth:e.dateOfBirth},o="";1==e.isChecked?(o=d.apiUrl+"RegisterWellnessCorpUser",a.name=e.firstName,a.phone=e.mobile,a.employeeId=e.employeeId,a.corporateName=e.userRegisterName.split("@").pop(),a.gender=e.gender):o=d.apiUrl+"RegisterUser",s.post(o,a,{headers:{"Content-Type":"application/json"}}).then(function(o){if(o.data.isSuccess){t.otpResponse=o.data.otpResponse,t.guid=o.data.tokenForLoginModel,t.phoneOrEmail=o.data.otpResponse.mobileNo,t.otpCheck=!0,t.registerCheck=!1,t.isSingUpCreated=!1;var i={name:e.firstName,email:e.userRegisterName,phonenumber:e.mobile};p._MB_Analytics.__push({isCleverTap:!0,fbq:!0,fbqReference:"CompleteRegistration",name:"Registered",payload:p._Site_Props.__getEventParameters({custom:i}),branchLog:{name:"Registered",custom_data:i}})}else"You already exist with us."===o.data.errorMessage?(t.logInUser.OTP="",b({message:"User already exists with  email-Id: "+a.email,position:"center",duration:5e3}),t.isNewLogin=!0,t.infinitiLoginCheck=!0,t.otpCheck=!1,t.otpCheckForFBOrGoogle=!1,t.activePill=0,t.backToInfinitiLogin(),t.loginObj.userName=e.userRegisterName,t.resetPassword()):o.data.errorMessage?(t.isError=!0,t.registerErrorMessage=o.data.errorMessage,r(function(){t.isError=!1},9e3),t.isLogin=!0):1==e.isChecked&&b({message:"Looks like your company have not partnered with us. Write to infiniti@mahs.in and mention your phone number.",position:"center",duration:5e3})})},t.signinUp=function(e){e&&t.createUser(e)},t.isCorporateUser=function(e){t.logInUser.isChecked=!1,e&&(t.logInUser.isChecked=!0)},t.forgotPassword=function(){try{p._MB_Analytics.__push({dbLog:!0,name:"Forgotpasswordclick",payload:p._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{itemSource:i.location.href},source:p.sessionStorage.getItem("utm_source")||"",platform:"MBWeb"})})}catch(e){console.log(e)}t.infinitiLoginCheck=!1,t.userNamePlaceholder="Enter your Mobile or Email",t.loginObj.userName="",t.isPasswordCheck=!0,t.forgotPassErrorMsg=""},t.userVerification=function(){t.localScope=t;var o={tokenForLoginModel:t.guid,Token:t.otpResponse.otpKey,Phrase:t.logInUser.OTP},i=d.apiUrl+"UserVerification";s.post(i,o,{headers:{"Content-Type":"application/json"}}).then(function(o){if(o.data.isSuccess){t.otpCheck=!1,t.otpCheckLogin=!1,t.verifyOtpRegUser=!1,t.userOtpVarified=!0,e.dismiss("cancel");var i=o.data.loginDetails.user;c.setUserObj(i);var r={email:i.userDetails.email,phonenumber:i.userDetails.phone,patientid:i.userDetails.userId};i.userDetails&&p._MB_Analytics.__push({isCleverTap:!0,name:"OTP Verified",payload:p._Site_Props.__getEventParameters({custom:r}),branchLog:{name:"OTP Verified",custom_data:r}}),n.$emit("userLogin",a),a.controller&&n.$broadcast(a.controller,a),n.$broadcast("search",""),m.reload()}else o.data.isSuccess||b({message:"OTP verification Failed, Please enter correct OTP.",position:"center",duration:5e3})})},t.sendOtp=function(e){var a={};a=t.verifyOtpRegUser?{tokenForLoginModel:t.guid,appId:9194}:{isMobileVerification:!0,LoginName:e.userRegisterName?e.userRegisterName:e.userName,MobileNo:e.mobile,appId:9194};var o=d.apiUrl+"VerifyUser";s.post(o,a,{headers:{"Content-Type":"application/json"}}).then(function(e){t.otpResponse={},(e.data.isSMSSent||e.data.isEmailSent)&&(e.data.isSMSSent?t.phoneOrEmail="phone "+e.data.mobileNo:t.phoneOrEmail="email id "+e.data.emailId,t.otpResponse.otpKey=e.data.otpKey,t.isSingUpCreated=!1,t.verifyOtpRegUser?t.otpCheckLogin=!0:t.otpCheck=!0)})},t.signedIn=!1,t.feebackFunction=function(e){var a={userFeedBack:e.userFeedBack,subject:e.subject,userName:e.userName,phonenumber:e.phonenumber,email:e.email};s.post(d.apiUrl+"UserFeedBack",a,{headers:{"Content-Type":"application/json",City:E}}).then(function(e){t.ok(!1),b({message:"Thank you! Your feedback is submitted successfully.",position:"center",duration:5e3})})},c.showRegisterTab&&(t.activePill=1,t.selectedTab("REGISTER"),c.showRegisterTab=!1)}],size:"login"})}document.querySelector("header").classList.remove("sticky-header")},openClaimDetails:function(e){var t=n.open({templateUrl:"userorders/claimDetails.html?"+timeStamp,controller:["$scope","authService","apiProvider",function(a,o,i){a.cancelRequest=o.cancelRequest,a.claimDetail=e.data.claimDetail,a.documentsLength=0,a.docCallsMade=!1,a.auditTrailCallsMade=!1,a.fetchAuditTrail=function(){if(!a.auditTrailCallsMade){var e=i.apiUrl+"/infiniti/auditrail/claim.json",t={claimIds:a.claimDetail.clmIds,dbType:a.claimDetail.basicDetails.sourcerDbType};o.makeAjaxCalls(e,t,"POST").then(function(e){e.data.isSuccess&&(a.auditTrailList=e.data.auditTrail),a.auditTrailCallsMade=!0})}},a.fetchDocuments=function(){if(!a.docCallsMade){var e=i.apiUrl+"/infiniti/attachment/claim.json",t={claimIds:a.claimDetail.clmIds,dbType:a.claimDetail.basicDetails.sourcerDbType};o.makeAjaxCalls(e,t,"POST").then(function(e){e.data.isSuccess&&(_.isEmpty(e.data.attachments)||(a.claimAttachments=e.data.attachments.claimAttachments,a.dmsAttachments=e.data.attachments.dmsAttachments,a.emailAttachments=e.data.attachments.emailPAAttachments,a.faxAttachments=e.data.attachments.faxAttachments,a.documentsLength=a.claimAttachments.length+a.dmsAttachments.length+a.emailAttachments.length+a.faxAttachments.length)),a.docCallsMade=!0})}},a.cancel=function(){o.cancelRequest="",t.close()}}],size:"claim-details"})},getuserLongToken:function(e){return this.makeAjaxCalls(d.apiUrl+"GetUserLongToken",{shortToken:e},"POST")},getEncryptedTokenForLinking:function(e){if(!(u.get("retailToken").length<=1||u.get("retailMbId")<=1)){var a="corpToken:"+e.corpToken+",corpmbid:"+e.corpMbId+",retailToken:"+u.get("retailToken")+",retailmbid:"+u.get("retailMbId"),o=null,i=window.CryptoJS.enc.Base64.parse("YVhWemRHTGxNVFppZVhSVGMydGxlUT09");o=window.CryptoJS.AES.encrypt(a,i,{mode:window.CryptoJS.mode.ECB,padding:window.CryptoJS.pad.Pkcs7}),t.post("https://loginprod.medibuddy.in/user/userLinking/v1",{data:o.toString()}).then(function(e){console.log("User Linking Success")})["catch"](function(e){console.log("User Linking Failed")})}},getsessionTokenUsing:function(e,i){var n=d.apiUrl+"MarketPlaceLogon",r={isSSOLogin:!0,authServerAccessToken:e},s=o.search();s&&s.utm_appname&&(r.appName=s.utm_appname,u.set("utm_appname",s.utm_appname),window.localStorage.setItem("parent_app",s.utm_appname),o.search("utm_appname",null)),this.isSSOLogin=!0;this.makeAjaxCalls(n,r,"POST").then(function(e){if(e.data.isSuccess)if("Server Login Error."===e.data.errorMessage){o.search("AuthToken",null),o.path("/");try{if(window.location.href.includes("medibuddy")){var n={screen:"SSO_Login",appVersion:"",domain:"medibuddyInWeb",event:"LF_SSO_LOGIN_FAILED",advertiserId:window.sessionStorage.getItem("branch_fingerprint"),auth_uuid:u.get("auth_uuid")||void 0},r=Object.assign({},n,{meta:JSON.stringify(n)});t.post(d.eventlogsUrl,r)}}catch(s){console.log(s)}}else if(e.data.isSuccess&&e.data.user){u.set("toShowMandPopUp",!0),e.data.user.isSSOLogin=!0,u.set("_mp_user",_.extend(e.data.user,{isRetailLabsFlowEnabled:e.data.isRetailLabsFlowEnabled,isNewAHCFlowEnabled:e.data.isNewAHCFlowEnabled,isMergeFlowEnabled:e.data.isMergeFlowEnabled})),window._MB_Analytics.__push({excludeCleverTap:"true",loginEventFlow:!0,dbLog:!0,name:"LF_SSO_SUCCESSFUL_LOGIN",payload:window._Site_Props.__getEventParameters({custom:{auth_uuid:u.get("auth_uuid")||void 0}})});var l=o.search();if(delete l.AuthToken,delete l.refurl,o.search("AuthToken",null),o.search("refurl",null),i){i=i.indexOf("Health-checks")>-1||i.indexOf("Health-Care")>-1?i.replace(/-/g," "):i,i.indexOf("medibuddy.in")>-1&&(i=i.split("medibuddy.in")[1]),l.bookingSrc&&(a.bookingSrc=l.bookingSrc),i="/"===i[0]?i:"/"+i,o.url(i);for(var c in l)l.hasOwnProperty(c)&&o.search(c,l[c]);o.replace()}else o.path("/")}})},setOfferPackageIdList:function(e){b=[],b=e},isOtcEnabled:function(){var e=this.isUserSignedin();return!(e&&e.userDetails&&e.userDetails.pmEntityID)||s.otcEntityIds.indexOf(e.userDetails.pmEntityID)>-1},getOfferPackageIdList:function(){return b=["22dd74b0067e48a7b1deff5043d0708e","a565adabaf854d4ea9dabe06c4596068","c4f071665c044e8889c9bc0bf11086dc","81eaa1bcad1a4d66b0127c5073d824c1","c15181b08a4046b9a795557ec454cf0a","e21aff63b6d14c93a1204ac410dd7192","50289e129f754c069f3cea4a4cc2be91","13675d40546d4d3d89d8341669a27dfc","71e5596615164b45baf569c3ecac0536","8af37dfa49714f718cd4cd095ff87bcf","b0722de202914d97aea7a9c0b9ac8cd8","5fed6b043bb149478a73d3ec6563a17f","efd5e376d79d4647a346c8c64a9e785f","3476b074edf54778847c4bf580af1353","adf22f3414c34eb092bdfbcb7fc75d1b","deb91166f27f46c5a71db203f91abfdc","fb8f63ddc2fd475cb4899831de5dda57","f97f503247164327bb50662b59d53318","5e84f0412a2f41acb54a012b20b1b537","6d6b80b9148b401e9555d2d455f7c15f","989dbee469fd443ba3c2fce234093e6f","492a12074e43452b9441f1dd0d0bea51","4e7c454462624b4ca5e5cf3b1fb8f86a","18ac0089a56d4384a11bf9b2271dcec5","74b1ad2150484176a30573fe11a0187b","c164dba6ca71416e953ae6a702619618","9d08bf94ef8a488f8a2bbf14b56dedf0","12aa5d916eae41fbaf5cb4c6555a2387","0c91e94c56f34e13952e093f7d1e61e5","463f7e9bc8bf419d9c7dbbcceb55ce69","139234e951fa47f19008b9d6d4318e07","5ecc71bdca76464bb8ac94822a836248","fdd0879ea76f4abb9d3f0e641375871e","9ca53cf556d240849605877f5cc0b297","dc7335be10f141a1b0965e147fac7f7a","c88ee7339383413c9498e29a292c2fed","733177960dd945edbf870b3be7ae8e4c","ebbc4e6275854b85a7053580c45f5a55","c31294d1ad14497abd853f97a85a14dc","dfadb17c33f540c0a6505f391f305fd2","814497728c99421b8e75a21022562b6c","fb77a2480c1e45e3ae49886761523f3f","f06b0cbf7dff4adb81beacdff3588d7b","3fe684b5221944168122a2a303f823a5","9564169a0e6e4001a772f9f6fcbe7634","0d94b9a163df4b4db0bb763e593d1f1e","418deae4a3b74cc6a980abe71dc3febd","aef0e1cae4124191aa962fda6d18fa81","7737a5c1e3e44d56af02b479f51fadf2","8c041eae77504b29ab69630b4b1bb46b","291761f617ee44c0bb76b9ca4878777a","86305085fb074f8fabb1d0f67b482693","cb1a1e6430b14ca79097e5ccbf4ba71c","a3589ae105bc4ba3a82e7662891750eb","88d1d1ad939840e3abd25c9fa251ac04","1d94d999f93f491ead0df84288df2cfc","1ddd573d9c3745b5b3167d1eac0768d8","a82df636ca084a79a893fabec9e35eda","95b3670b60564d9a861d1530ab9fb802","acbcd393f4ec4bee95a4d37af75ca455","a533ceddd8dd41bb973e118549f97575","743b71918f164a089a00b7673912e2c9","87e294828b3c47b7ae8ba2419df09fb2","861b7de21c4c4929b165b9af62079d53","55c983b9118d490a9a8e302ec1ede3b1","b3122df8793b486a99756dd617150c95","8f25d44ae32f46c8999a9b5defcb24cc","ae826a25fe754e53a94c7510c0532ace"],[]},activateChat:function(e){if(e)window._MB_Analytics.__push({branchLog:{name:"Topic Visited",custom_data:{topic:"MB Gold"}}});else{var t=this.isUserSignedin(),o={};t&&t.userDetails&&(o.patientid=t.userDetails.userId),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",name:"MedsConsultNow",branchLog:{name:"Talk to Doc",custom_data:o}})}var i=d.doctorUrl;t&&t.encryptedToken&&(i=d.doctorUrl+"&accessToken="+t.encryptedToken);var n=e?d.goldUrl:i;a.isWebView||e?window.location.href=n:window.open(n,"_blank")}}}]),t.factory("patternService",function(){var e={phonechk:/^\(?(\d{3})\)?[- ]?(\d{3})[- ]?(\d{4})$/,pincodechk:/^\d*$/,emailchk:/^(([^<>()[\]\\.,;:\s@\']+(\.[^<>()[\]\\.,;:\s@\']+)*)|(\'.+\'))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,integerchk:/^\d*$/,datechk:/^[\d-]*$/,citychk:/([(A-Za-z\s\')])/,alphanumericchk:/^[a-zA-Z0-9]*$/,passwordchk:/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?\d)(?=.*?[!#$'()*-,.\/<=>?@\[\]^`{|}~])[a-zA-Z\d!#$'()*-,.\/<=>?@\[\]^`{|}~]+$/,fullnamechk:/^[a-zA-Z\s\'\-,]*$/,namechk:/^[a-zA-Z\s\.\'\-]*$/,mobilechk:/^[6789]\d{9}$/,medicineNameReplacePattern:/[^a-zA-Z'\s.]/gi,medicineAddrReplacePattern:/[^a-zA-Z0-9\-,.:()\/]/gi,pancardchk:/^[A-Z]{5}[0-9]{4}[A-Z]{1}$/gi,aadharchk:/^\d{12}$/};return{getRegexExpression:function(t){return e[t]}}}),t.factory("popupService",["$document","$compile","$rootScope","$controller","$timeout","$sce","authService","$state","$window","apiProvider",function(t,a,o,i,n,r,s,l,d,c){var u={id:null,template:null,templateUrl:null,title:"Default Title",backdrop:!0,success:{label:"OK",fn:null},cancel:{label:"Close",fn:null},controller:null,backdropClass:"modal-backdrop",backdropCancel:!0,footerTemplate:null,modalClass:"silbar",appointmentDetails:"",packageDetailForBookingAppointment:"",css:{top:"100px",left:"30%",margin:"0 auto"}},p=t.find("body");return function(t,m,g){function h(e,t){var a={orderId:e,browser_fingerprint_id:t};s.makeAjaxCalls("https://www.medibuddy.in/websiteapp/CreateOrderIdBrowserIdMapping",a,"POST").then(function(e){})["catch"](function(e){console.log("error while createOrderIdBrowserFingerprintIdMapping"+e)})}e.isObject(t)?(g=m,m=t):m.templateUrl=t,m=e.extend({},u,m);var f,b=(m.id?' id="'+m.id+'" ':"",'<button class="btn" ng-click="$modalCancel()">{{$modalCancelLabel}}</button><button class="btn btn-primary" ng-click="$modalSuccess()">{{$modalSuccessLabel}}</button>'),v=('<div class="modal-footer">'+(m.footerTemplate||b)+"</div>",function(){return m.template?e.isString(m.template)?'<div class="">'+m.template+"</div>":'<div class="">'+m.template.html()+"</div>":'<div class="" ng-include="\''+m.templateUrl+"'\"></div>"}()),y=e.element('<div class="slideBox"><div class="slideContent">'+v+"</div></div>");for(f in m.css)y.css(f,m.css[f]);var S="<div ";m.backdropCancel&&(S+='ng-click="$modalCancel()"'),S+=">";var E=e.element(S);E.addClass(m.backdropClass),E.addClass("fade in");var P=function(e){27===e.keyCode&&T.$modalCancel()},C=function(){p.unbind("keydown",P),y.remove(),m.backdrop&&E.remove()};p.bind("keydown",P);var I,L,T=m.scope||o.$new();T.packageDetail=g.packageDetail,T.HHCandSOcheck=!0,T.packageDetail&&(T.packageDescription=r.trustAsHtml(T.packageDetail.description),T.packageInstructions=r.trustAsHtml(T.packageDetail.instruction),T.packageDetail.packageTests?(T.consultation=_.findWhere(T.packageDetail.packageTests.testGroups,{name:"Consultation"}),T.consultation?(T.totalCount=T.packageDetail.packageTests.count-T.consultation.count,T.consultation.count=T.consultation.count?T.consultation.count:0):(T.consultation={count:0},T.totalCount=T.packageDetail.packageTests.count),e.forEach(T.packageDetail.packageTests.testGroups,function(e,t){e.tests.name=e.name})):(T.totalCount=0,T.consultation={count:0})),T.packageDetailLocation=g.packageDetailLocation,g.packageDetailLocation&&(T.agerange={maxAge:g.packageDetailLocation.maxAge,minAge:g.packageDetailLocation.minAge},_.isEmpty(g.packageDetailLocation.availableSlots)||_.isEmpty(g.packageDetailLocation.availableSlots[0].slots)||(T.slotEndTime=s.getTimeWithAMPM(g.packageDetailLocation.availableSlots[0].slots[0].slotEndTime),T.slotStartTime=s.getTimeWithAMPM(g.packageDetailLocation.availableSlots[0].slots[0].slotStartTime))),T.paymentOptions=g.paymentOptions?g.paymentOptions:[],T.walletFailure=g.walletFailure?g.walletFailure:"",T.bookedAppointmentDetails=s.bookedAppointmentDetails,T.packageDetailForBookingAppointment=s.packageDetailForBookingAppointment,T.bookedAppointmentDetails&&(u.appointmentDetails=T.bookedAppointmentDetails,T.bookedAppointmentDetail=u.appointmentDetails),T.packageDetailForBookingAppointment&&(u.packageDetailForBookingAppointment=T.packageDetailForBookingAppointment,T.packageDetailForBookingAppointment1=u.packageDetailForBookingAppointment),T.isPackageDetailForBookingAppointment="app.consultation"===l.current.name,T.paymentOptions=g.paymentOptions?g.paymentOptions:[],T.bookedAppointmentDetails=s.bookedAppointmentDetails,T.bookedAppointmentDetails&&(T.bookedAppointmentDetails.gender=g.gender),T.packageDetailForBookingAppointment=s.packageDetailForBookingAppointment,T.logInUser={userName:"",password:""},T.pg={gatewayAmount:"",totalAmount:"",walletAmount:""},T.wallet={gatewayAmount:"",totalAmount:"",walletAmount:""},T.isPayBypg=!1,T.isDefault=!1,T.isPayment=!0,T.isEmpty=!1;T.isValidate=!0,T.isMailId=!1,T.isfb=!0,T.paymentDetails={isSummary:!0,isPayOnline:!1},T.paymentOption={value:""},T.finalPayment=0,T.bookedAppointmentDetails&&T.bookedAppointmentDetails.finalPrice&&(T.finalPayment=T.bookedAppointmentDetails.finalPrice),T.mediMarketPayment={amountAfterCouponDiscount:T.finalPayment,isCod:!1},T.isPayble=!0,T.user=s.isUserSignedin(),T.paymentObject=[],T.goNext=function(e){T.paymentDetails.isPayOnline="pay"===e,T.paymentDetails.isSummary="details"===e},T.tabChange=function(e){T.paymentDetails.isPayOnline="pay"===e,T.paymentDetails.isSummary="pay"!==e},T.fillDetails=function(e){o.$emit("fillDetails",e)},T.ok=function(e,t){T.$modalCancel(),e===!0&&(T.bookFromDetails(t),"fail"===e&&window.$location.reload())},T.isPaymentCalled=!1,T.flag=!1,T.paymentDoubleClick=function(){return T.flag=!0,!1},T.isPaymentProcessing=!1,T.isChecmsg=!1,"app.consultation"===l.current.name?(T.isConsultationPayment=!0,T.isPackagePayment=!1,T.isChecmsg="app.consultation"===l.current.name):(T.isConsultationPayment=!1,T.isPackagePayment=!0),T.validateCoupon=function(){if(""!==T.bookedAppointmentDetails.couponCode){var e={PackageId:g.packageDetail.id,ProviderID:"177828aaaaaaaaaaaaaaaaaaaaaaaaaa",DoctorUniqueId:"",
CouponCode:T.bookedAppointmentDetails.couponCode,Gender:T.bookedAppointmentDetails.gender,ApplicableDate:T.bookedAppointmentDetails.prefDateTime||new Date},t=c.apiUrl+"/CheckCouponCodeApplicability.json";s.makeAjaxCalls(t,e,"POST",T.user.token).then(function(t){t.data.isSuccess?t.data.response.isApplicable?(T.isCouponCodeNotEmpty=!0,T.isInvalidCoupon=!1,T.showCouponMessage=!0,T.validatedCouponCode=e.CouponCode,T.mediMarketPayment.couponDiscount=t.data.response.discount,T.finalPayment=T.bookedAppointmentDetails.finalPrice-T.mediMarketPayment.couponDiscount):(T.isCouponCodeNotEmpty=!1,T.bookedAppointmentDetails.couponCode="",T.showCouponMessage=!1,T.isInvalidCoupon=!0,T.errorValueForCoupon=t.data.response.message,T.finalPayment=T.bookedAppointmentDetails.finalPrice):t.data.isSuccess||(T.isCouponCodeNotEmpty=!1,T.showCouponMessage=!1,T.isCouponCodeNotEmpty=!1,T.isInvalidCoupon=!0,T.bookedAppointmentDetails.couponCode="",T.showCouponMessage=!1,T.errorValueForCoupon="Invalid Coupon Code",T.bookedAppointmentDetails.couponCode="",T.finalPayment=T.bookedAppointmentDetails.finalPrice)})}else T.isCouponCodeNotEmpty=!1,T.mediMarketPayment.couponDiscount=0,T.isInvalidCoupon=!1,T.showCouponMessage=!1,T.finalPayment=T.bookedAppointmentDetails.finalPrice},T.authorizeRazorPay=function(e){var t=c.paymentUrl+T.razorPayOptions.amount;t+="&paymentid="+e.razorpay_payment_id,d.location.href=t},T.dismissalRazorPay=function(){T.isPaymentProcessing=!1,T.isPaymentCalled=!1,n(function(){T.flag=!1},0,!0)},T.processPaymentOption=function(t){if(t&&T.user&&T.user.token){T.isPaymentProcessing=!0,T.isConsultationPayment=!1,T.isPackagePayment=!1;var a=c.apiUrl+"/PaymentMethod",i={paymentMethods:[]};e.forEach(t,function(e,t){i.paymentMethods.push(e.paymentMethod)}),T.isCouponCodeNotEmpty&&(i.couponCode=T.validatedCouponCode),s.makeAjaxCalls(a,i,"POST",T.user.token).then(function(e){if(s.refreshOrders=!0,e.data.isSuccess&&0!==e.data.orderId)if(h(e.data.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),_.isEmpty(e.data.razorPayOptions))e.data.paymentGatewayURL?(o.$emit("cfpLoadingBar:loading"),d.location.href=e.data.paymentGatewayURL):(s.orderId=e.data.orderId,l.go("app.orderDetails",{reload:"app.orderDetails"}));else{T.razorPayOptions=e.data.razorPayOptions,T.razorPayOptions.name="MediBuddy",T.razorPayOptions.handler=T.authorizeRazorPay,T.razorPayOptions.prefill={name:T.bookedAppointmentDetails.patientName,email:T.bookedAppointmentDetails.email,contact:T.bookedAppointmentDetails.phone},T.razorPayOptions.modal={ondismiss:T.dismissalRazorPay},T.razorPayOptions.image="/assets/images/logo_medibuddy_infiniti-sm.png",T.razorPayOptions.description="Your order ID: "+e.data.orderId,T.razorPayOptions.theme.color="#2198ff";var t=new Razorpay(T.razorPayOptions);t.open()}else e.data.isSuccess||(d.location.href="/technicalGlitch")})}},T.ProcessPaymentOption=function(e){if(T.flag=!0,T.isPaymentCalled===!1&&T.flag){T.isPayment=!1,T.isPaymentCalled=!0;for(var t=0;t<T.paymentOptions.length;t++)"pg"===T.paymentOptions[t].paymentMethod.toLowerCase()&&T.paymentObject.push(T.paymentOptions[t]);T.processPaymentOption(T.paymentObject)}},o.$on("closePopup",function(e){T.ok(!1)}),T.$title=m.title,T.$modalClose=C,T.$modalCancel=function(){var e=m.cancel.fn||C;e.call(this),T.$modalClose()},T.$modalSuccess=function(){var e=m.success.fn||C;e.call(this),T.$modalClose()},T.$modalSuccessLabel=m.success.label,T.$modalCancelLabel=m.cancel.label,m.controller&&(L=e.extend({$scope:T},g),I=i(m.controller,L),y.contents().data("$ngControllerController",I)),a(y)(T),a(E)(T),p.append(y),m.backdrop&&p.append(E),n(function(){y.addClass("in")},200)}}]),t.run(["$templateCache",function(e){e.put("error-messages.html","<div ng-message='text'>Please enter only alphabetic characters.</div><div ng-message='required1'>Please enter a value in this field.</div><div ng-message='minlength'>Enter at least the minimum number of characters.</div><div ng-message='date'>Enter the date in MM/DD/YYYY format.</div><div ng-message='invalid-date'>Please enter a valid date.</div>")}]),t.factory("seoService",["$rootScope","$http","apiProvider",function(e,t,a){return{getSeoContent:function(o){var i={categoryItemTypeId:o.categoryItemTypeId,seriveCategory:o.condition,keyword:o.keyword,location:o.location,city:o.city,pincode:o.pincode};t.post(a.apiUrl+"getMediBuddySEO",i,{headers:{"Content-Type":"application/json"}}).then(function(t){t.data.isSuccess&&(e.seo.title=t.data.data.TITLE,e.seo.keywords=t.data.data.KEYWORDS,e.seo.metaDescription=t.data.data.DESCRIPTION,e.seo.canonicalName=a.siteUrl+t.data.data.CANONICALNAME,e.seo.content=t.data.data.CONTENT)})}}}]),t.factory("$exceptionHandler",["$injector","$window",function(e,t){return function(a,o){var i,n=(e.get("$http"),e.get("$location")),r=(e.get("$state"),e.get("$log"));r.error.apply(r,arguments),a.message+=' (caused by "'+o+'")',i={exception:a.message||"",stack:a.stack||"",cause:o||"",location:n.path(),client_timestamp:new Date,logging_level:40,user_agent:t.navigator.userAgent}}}])})}();