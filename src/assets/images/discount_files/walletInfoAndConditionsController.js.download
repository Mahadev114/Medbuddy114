!function(){"use strict";define(["_routes"],function(e){e.register.controller("walletInfoAndConditionsController",["$scope","authService","$rootScope","$window","$sce","navConstantsSvc","apiProvider",function(e,l,t,a,n,i,o){function s(){e.userAuth.encryptedToken&&e.authToken||l.makeAjaxCalls(o.apiUrl+"GetUserLongToken",{shortToken:e.userAuth.token},"POST").then(function(t){console.log("response=",t),t.data.isSuccess&&(e.userAuth.encryptedToken=t.data.encryptedToken,l.setUserObj(e.userAuth),e.authToken=e.userAuth.encryptedToken)})}a.scrollTo(0,0);var c=this;e.conditionCallFired=!1;var r=l.isUserSignedin();e.userAuth=l.isUserSignedin(),e.isReimbursementButton=r.isReimbursementButton,e.isAccentureUser=r&&r.userDetails&&i.allAccentureEntityIds.indexOf(r.userDetails.pmEntityID)>-1,e.accenturePolicy=n.trustAsHtml("<div class='conditions'> <div class='policy-conditions'> <h3><b> Account Balance T&C:</b></h3> <ul> <li> Account balance can be utilized for employee health checkup only, not for dependents. </li><li> In case you opt for reimbursement of INR 2000 instead of cashless, account balance will become INR 0. </li></ul> </div> </div>"),e.init=function(){e.wallets=l.walletDetails?l.walletDetails.length:0;var t=_.findWhere(l.walletDetails,{walletName:"MAWallet"});e.MAWalletFound=!_.isEmpty(t),e.MABalance=t&&t.balance?t.balance:l.MABalance,l.MBBalance>0&&!_.findWhere(l.walletConfigs,{walletName:"MBWallet"})&&l.walletConfigs.push({walletName:"MBWallet"}),e.corpBalance=l.CorpBalance,e.MBBalance=l.MBBalance,e.MaWalletName=l.maAliasName,e.corpWalletName=l.corpAliasName},s(),e.walletSelection=function(t){e.selectedWallet=_.findWhere(l.walletDetails,{walletName:t}),!e.selectedWallet||!e.selectedWallet.balanceDetail||e.selectedWallet&&e.selectedWallet.balanceDetail&&e.selectedWallet.balanceDetail.policies&&1===e.selectedWallet.balanceDetail.policies.length&&e.selectedWallet.balanceDetail.polDetails&&1===e.selectedWallet.balanceDetail.polDetails.length?c.showBenefDetails=!1:c.showBenefDetails=!0},e.loadPolicyConditions=function(){(l.isTermsAndConditionsApplicable||e.isAccentureUser)&&(_.forEach(l.walletConfigs,function(e,t){var a=_.findWhere(l.walletDetails,{walletName:e.walletName});_.isEmpty(a)||("mbwallet"===e.walletName.toLowerCase()&&(a.policyConditions=n.trustAsHtml(i.MbWalletDefaultTermsOfUse)),e.walletTermsOfUse&&(a.policyConditions=n.trustAsHtml(e.walletTermsOfUse)))}),e.MAWalletFound?e.walletSelection("MAWallet"):e.walletSelection(_.first(l.walletDetails).walletName))},e.user=l.getUserObj(),e.user?(e.init(),e.loadPolicyConditions()):l.openLoginPopupCorp("lg","templates/corporateLoginPopup.html?"+timeStamp),e.cancelDialog=function(){this.$dismiss()};var u=t.$on("showWalletInfo",function(){e.init(),e.loadPolicyConditions(),e.noWallet=!1}),d=t.$on("cfpLoadingBar:completed",function(){e.noWallet=!e.wallets});t.$on("$destroy",function(){u(),d()})}])})}();