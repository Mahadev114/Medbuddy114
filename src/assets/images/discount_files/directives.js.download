!function(){"use strict";define(["_routes","utility"],function(e,a){e.register.directive("downloadAppLink",["$rootScope","$window",function(e,a){return{restrict:"E",scope:{isMobileView:"=",mobileImgHeight:"=",webImgHeight:"=",section:"="},template:'<a class="m-r-5" ng-click="appRedirect()" rel="noopener" aria-label="Android">            <img src="/assets/images/android.png" height="{{isMobileView ? mobileImgHeight : webImgHeight}}" class="android" alt="Download Android App"/>          </a>          <a class="m-l-5" ng-click="appRedirect(true)" rel="noopener" aria-label="IOS">            <img src="/assets/images/ios.png" height="{{isMobileView ? mobileImgHeight : webImgHeight}}" class="ios" alt="Download IOS App"/>          </a>',link:function(t,i,o){t.section=t.section||"FirstFold",t.appRedirect=function(i){var o="https://tfgsu.app.link/MBSite?~channel="+a.location.href+"&~feature=MBSite&~campaign="+t.section+"&~tags=MBSite";e.isWebView?a.open(o,"_blank"):a.open(i?"https://itunes.apple.com/us/app/medibuddy/id946666981?ls=1&mt=8":"https://play.google.com/store/apps/details?id=in.medibuddy&hl=en","_blank")}}}}]),e.register.directive("marketApiMasking",["$rootScope",function(e){return{restrict:"AE",scope:{loadingMsg:"=?"},template:'<div class="form-loading" ng-if="loading"><span>Processing, please wait!<img src="/assets/gif/loader.gif" alt=""/><hr ng-if="loadingMsg"><div class="loading-msg" ng-if="loadingMsg"><p>{{loadingMsg[showIndex]}}</p></div></span></div>',link:function(a,t,i){a.showIndex=0;var o=e.$on("cfpLoadingBar:loading",function(){a.loadingMsg&&a.loadingMsg.length>1&&(a.showIndex=Math.floor(Math.random()*a.loadingMsg.length)),a.loading=!0}),n=e.$on("cfpLoadingBar:completed",function(){a.loading=!1});e.$on("$destroy",function(){n(),o()})}}}]),e.register.directive("notifyMsg",["$rootScope","$uibModal","$interval","localStorageService",function(e,a,t,i){return{restrict:"AE",scope:{msg:"=?",timer:"=?",always:"=?",normalText:"=?"},template:'<div ng-if="!isMobileView && msg && (!notificationViewed || always)" class="alert-lg alert-warning m-t-10 m-b-0 text-center" uib-alert close="closeAlert()"><button class="close m-r-5 no-pointers"><span ng-if="dismissTimer && !timer" aria-hidden="true">{{dismissTimer}}</span></button><strong>{{msg}}</strong></div>',link:function(o,n,s){function r(){i.setStorageType("sessionStorage"),i.set("notificationViewed",JSON.stringify(!0)),i.setStorageType("localStorage")}!o.normalText&&n&&n[0]&&n[0].classList.add("mdTxt"),o.dismissTimer=20;var l,c;o.isMobileView=e.isMobileView,o.closeAlert=function(){o.msg="",t.cancel(l),o.isMobileView&&c?(c.dismiss("cancel"),c=null):r()},i.setStorageType("sessionStorage"),o.notificationViewed=i.get("notificationViewed"),i.setStorageType("localStorage"),o.notificationViewed&&!o.always||(o.timer||(l=t(function(){1===o.dismissTimer?o.closeAlert():o.dismissTimer--},1e3)),e.isMobileView&&(c=a.open({animation:!0,scope:o,backdrop:"none",template:'<div class="modal-bottom-header modal-header p-l-10 p-r-10"><div class="br-10 alert-lg alert-warning m-0 justify-text" uib-alert close="cancelDialog()"><button class="close m-r-5 no-pointers"><span ng-if="dismissTimer && !timer" aria-hidden="true">{{dismissTimer}}</span></button><strong>{{msg}}</strong></div></div>',controller:["$scope","$uibModalInstance",function(e,a){e.cancelDialog=function(){a.dismiss("cancel"),c=null,r()}}],size:"bottom",windowClass:"bottom-sheet"}),c.closed.then(function(){r(),t.cancel(l)}))),o.$on("$destroy",function(){l&&t.cancel(l)})}}}]),e.register.directive("checkConnection",["$rootScope","$window","$timeout",function(e,a,t){return{restrict:"AE",template:'<div class="note-header" ng-if="connectionText">{{connectionText}}</div>',link:function(e,i,o){e.connectionText="",e.isOnline=function(){t(function(){a.navigator.onLine?e.connectionText="":e.connectionText="No network connection. Please try after some time."},0)},e.isOnline(),a.addEventListener("online",e.isOnline),a.addEventListener("offline",e.isOnline)}}}]),e.register.directive("ratingStar",["$rootScope","navConstantsSvc",function(e,a){return{restrict:"AE",scope:{stars:"=?",action:"=?",size:"=?",spacing:"=?"},template:'<div class="rating star {{ratingClass}}" ng-class="{\'no-pointers\':!action,\'cursor-pointer\':action,\'lg m-t-15\':large,\'xl m-t-15\':xtraLarge}"><span ng-class="{\'m-l-10\':spacing}" ng-repeat="each in scale" ng-mouseenter="onHover(each)" ng-mouseleave="onLeave()" ng-click="onClick(each)"></span></div>',link:function(e,t,i){e.activeStars=a.ratingStarClasses[e.stars]?a.ratingStarClasses[e.stars]:a.ratingStarClasses[1],e.action&&(e.activeStars="outline"),"lg"==e.size?e.large=!0:"xl"==e.size&&(e.xtraLarge=!0),e.ratingClass=e.activeStars,e.scale=[1,2,3,4,5],e.onHover=function(t){e.ratingClass=a.ratingStarClasses[t]},e.onLeave=function(){e.ratingClass=e.activeStars},e.onClick=function(t){e.activeStars=a.ratingStarClasses[t],e.$emit("starsSelected",t)}}}}]),e.register.directive("shareIt",["$rootScope","navConstantsSvc","$stateParams","authService","notify",function(e,a,t,i,o){return{restrict:"AE",scope:{shareObj:"=obj",openDefault:"=opendefault"},template:'<div ng-class="openDefault? \'share-open-default\' : \'\'">                            <span class="icon share-icon-button"><img src="assets/icons/share.svg" alt=""/></span>                            <span class="group">                                <span class="icon" uib-tooltip="Share with facebook" ng-if="!fbNotEnabled"> <img src="assets/icons/facebook.svg" ng-click="facebookShare()" alt=""/> </span>                                <span class="icon" uib-tooltip="Share with twitter"> <img src="assets/icons/twitter.svg" ng-click="twitterShare()" alt=""/> </span>                                <span class="icon" uib-tooltip="Share with whatsapp"> <img src="assets/icons/whatsapp.svg" ng-click="whatsappShare()" alt=""/> </span>                                <span class="icon" uib-tooltip="Share with email"> <img src="assets/icons/email.svg" ng-click="mailShare()"> </span>                                <span class="icon" uib-tooltip="Copy to clipboard"> <img src="assets/icons/copy.svg" ng-click="copyToClipboard()" alt=""/> </span>                            </span>                        </div>',link:function(e,a,n){e.fbNotEnabled=i.FbNotEnabled,e.getPackageShareData=function(a){switch(a){case"email":return{shareMailSubject:"Today's The Day You Do Something For Your Health",shareText:"Promote prevention and Safeguard your health.\n\nCheck out "+e.shareObj.packageName+" on MediBuddy\n",shareLink:e.shareLink};case"facebook":return{shareMailSubject:"Here's The One Thing You Need",shareText:"Check "+e.shareObj.packageName+" on MediBuddy",shareLink:e.shareLink,caption:e.shareObj.dcName};case"twitter":return{shareText:"Here's The One Thing You Need \nCheck "+e.shareObj.packageName+" on MediBuddy",shareLink:e.shareLink};case"whatsapp":return{shareText:"This is definitely worth 5 minutes of your time. Thank me later.\n\nCheck "+e.shareObj.packageName+" on MediBuddy \n",shareLink:e.shareLink};case"clipboard":return{copyText:e.shareLink};default:return{shareLink:e.shareObj.shareLink,shareMailSubject:e.shareObj.shareMailSubject,copyText:e.shareObj.copyText,shareText:e.shareObj.shareText}}},e.getShareLink=function(){e.categoryId=i.checkSeriveType[t.categoryItemTypeId],e.shareLink=window.location.origin+"/product/"+(e.categoryId?e.categoryId:"")+"/"+(t.searchk?t.searchk:"")+"/"+(t.searchc?t.searchc:"")+"/"+e.shareObj.packageId+"/"+(t.dcId?"?dcId="+t.dcId:"")},e.facebookShare=function(){try{var a;e.shareObj.packageId?(a=e.getPackageShareData("facebook"),window._Site_Props.__setPackageDetails({packageName:e.shareObj.packageName,providerName:e.shareObj.dcName,providerLocation:e.shareObj.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Facebook Share",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Share","Facebook",e.shareObj.packageName+" by "+e.shareObj.dcName)})})):(a=e.getPackageShareData(),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Facebook Share",payload:window._Site_Props.__getEventParameters({service:!0,custom:{shareType:e.shareObj.shareType},google:window._Site_Props.__googleTransform("Share","Facebook",e.shareObj.shareType)})})),FB.ui({method:"share_open_graph",app_id:"198628023814821",action_type:"og.shares",display:"popup",action_properties:JSON.stringify({object:{"og:url":a.shareLink,"og:title":a.shareMailSubject,"og:description":a.shareText}})})}catch(t){o({message:"Facebook access is denied",position:"center",duration:2e3})}},e.twitterShare=function(){var a;e.shareObj.packageId?(a=e.getPackageShareData("twitter"),window._Site_Props.__setPackageDetails({packageName:e.shareObj.packageName,providerName:e.shareObj.dcName,providerLocation:e.shareObj.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Twitter Share",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Share","Twitter",e.shareObj.packageName+" by "+e.shareObj.dcName)})})):(a=e.getPackageShareData(),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Twitter Share",payload:window._Site_Props.__getEventParameters({service:!0,custom:{shareType:e.shareObj.shareType},google:window._Site_Props.__googleTransform("Share","Twitter",e.shareObj.shareType)})}));var t={url:a.shareLink,text:a.shareText,hashtags:"MediBuddy"},i="http://twitter.com/share?";for(var o in t)i+="&"+o+"="+encodeURIComponent(t[o]);window.open(i)},e.whatsappShare=function(){var a;e.shareObj.packageId?(a=e.getPackageShareData("whatsapp"),window._Site_Props.__setPackageDetails({packageName:e.shareObj.packageName,providerName:e.shareObj.dcName,providerLocation:e.shareObj.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Whatsapp Share",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Share","Whatsapp",e.shareObj.packageName+" by "+e.shareObj.dcName)})})):(a=e.getPackageShareData(),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Whatsapp Share",payload:window._Site_Props.__getEventParameters({service:!0,custom:{shareType:e.shareObj.shareType},google:window._Site_Props.__googleTransform("Share","Whatsapp",e.shareObj.shareType)})}));var t=a.shareText+a.shareLink,i="https://api.whatsapp.com/send?text="+encodeURIComponent(t);window.open(i)},e.mailShare=function(){var a;e.shareObj.packageId?(a=e.getPackageShareData("email"),window._Site_Props.__setPackageDetails({packageName:e.shareObj.packageName,providerName:e.shareObj.dcName,providerLocation:e.shareObj.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Email Share",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Share","Email",e.shareObj.packageName+" by "+e.shareObj.dcName)})})):(a=e.getPackageShareData(),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Email Share",payload:window._Site_Props.__getEventParameters({service:!0,custom:{shareType:e.shareObj.shareType},google:window._Site_Props.__googleTransform("Share","Email",e.shareObj.shareType)})}));var t="mailto:?Subject=",i=encodeURI(a.shareMailSubject),o=encodeURI(a.shareText+a.shareLink);t+=i+"&Body="+o,window.open(t)},e.copyToClipboard=function(){var a;e.shareObj.packageId?(a=e.getPackageShareData("clipboard"),window._Site_Props.__setPackageDetails({packageName:e.shareObj.packageName,providerName:e.shareObj.dcName,providerLocation:e.shareObj.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Copy to Clipboard",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Share","Clipboard",e.shareObj.packageName+" by "+e.shareObj.dcName)})})):(a=e.getPackageShareData(),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Copy to Clipboard",payload:window._Site_Props.__getEventParameters({service:!0,custom:{shareType:e.shareObj.shareType},google:window._Site_Props.__googleTransform("Share","Clipboard",e.shareObj.shareType)})}));var t=document.createElement("textarea");t.value=a.copyText,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),o({message:"Copied to clipboard",position:"center",duration:2e3})},!_.isEmpty(e.shareObj)&&e.shareObj.packageId&&e.getShareLink()}}}]),e.register.directive("focusElement",["$rootScope",function(e){return{restrict:"AE",link:function(e,a,t){a[0].focus()}}}]),e.register.directive("dynamicContentLoad",["$rootScope","$window","$timeout","$document",function(e,a,t,i){return{link:function(e,t,o){var n=t[0];angular.element(i)[0].body;e.debounchFunction=function(){a.pageYOffset+a.innerHeight>n.offsetHeight+100&&e.$apply(o.dynamicContentLoad)},i.bind("scroll",e.debounchFunction)}}}]),e.register.directive("labelText",["$rootScope","$window","$timeout","$document",function(e,a,t,i){return{restrict:"A",link:function(e,a,t){a.bind("focus",function(){a.parent().addClass("active completed"),a.addClass("active completed")}),a.bind("blur",function(){""===a.val()&&(a.parent().removeClass("completed"),a.parent().removeClass("active"))})}}}]),e.register.directive("sponserPackage",["$rootScope","$compile","$timeout","$stateParams","authService","apiProvider","$sce","navConstantsSvc","$state",function(e,a,t,i,o,n,s,r,l){return{restrict:"AE",scope:{ctrlData:"=bind",ageRangeValue:"=?",genderFilter:"=genderFilter",hsc:"=?",pipeline:"=?",isMobileView:"=?"},template:'<div ng-show="allAhcPackageList.length>0">                    <div class="result-box col-sm-12 col-xs-12 corp-hc-banner" ng-if="!isBookingAllowed">                    <span class="label label-info">Corporate Specific</span>                    <div class="col-sm-2" ng-if="!isMobileView">                        <img id="imghealthCheck" src="/assets/images/wellness_bg.png" alt="" height="100"/>                    </div>                    <div class="col-sm-8 col-xs-8" ng-class="{\'p-l-0 p-r-0\':isMobileView}">                        <div class="bold m-b-10 heading-color lgTxt" ng-if="!isMobileView">Congratulations !!</div>                        <div ng-class="{\'mdTxt\':!isMobileView}">You are eligible to avail Health Check benefits provided by your corporate.</div>                    </div>                    <div class="col-sm-2 col-xs-4 text-center">                        <button class="btn btn-default light-bold br-5" ng-click="redirectToCorpBenefits()" ng-class="{\'p-l-20 p-r-20 m-t-30\':!isMobileView,\'m-t-10\':isMobileView}">Continue</button>                    </div>                  </div>                  <div  ng-repeat="data in allAhcPackageList track by $index" ng-if="isBookingAllowed">                  <div class="result-box corp p-0" ng-class="{\'offer\':isMobileView,\'m-0\':showHideSponserPackage}" style="margin-bottom: {{showHideSponserPackage?0:30}}px!important">                    <div class="clearfix ahc-package-container" ng-if="!isMobileView">                        <span ng-if="data.priceStartFrom > 1">Corporate Specific</span>                        <span ng-if="data.priceStartFrom == 0">Corporate Sponsored</span>                        &emsp;&nbsp;<label>{{data.sponserPackageDetails.length}} Providers are serving this package</label>                    </div>                    <div class="row box" ng-if="isMobileView">                    <div class="col-xs-12 provider">                        <div class="disc">                        <b ng-click="fetchDetails(data.provider)" class="product-name">{{data.provider.packageName}}</b>                        <div class="col-xs-6 p-l-0 m-b-10">                        <p><b style="margin-left:0;">Tests: {{:: data.provider.packageTestCount}}</b><b style="margin-left:0;" ng-if="data.provider.packageConsultationCount &gt; 0">, Consultations: {{:: data.provider.packageConsultationCount}} </b></p>                        <p>by<b><span ng-if="!nextDayFilter && data.sponserTempPackageDetails.length">{{data.sponserTempPackageDetails.length}}</span><span ng-if="nextDayFilter">{{autoBookSlots.length}}</span> Providers</b></p>                        <p><i class="mm mm-map-marker"></i>{{cityName}}</p>                        </div>                        <div class="col-xs-6 p-r-0 text-right">                        <a class="btn btn-default btn-sm outline-primary" ng-click="fetchDetails(data.provider)">{{data.provider.detailsClicked?"Hide":"Show"}}&nbsp;Details</a>                        </div>                        <span class="label label-info label-offer" ng-if="data.priceStartFrom > 1">Corporate Specific</span>                        <span class="label label-info label-offer" ng-if="data.priceStartFrom == 0">Corporate Sponsored</span>                        <a ng-if="!data.showHideSponserPackage" ng-click="showHideSponserPackageFunc(data)" class="btn btn-primary btn-booking">Show Providers</a>                        <a ng-if="data.showHideSponserPackage" ng-click="hideSponserPackageFunc(data)" class="btn btn-primary btn-booking">Hide Providers</a>                        </div>                    </div>                    </div>                    <div class="row box" ng-if="!isMobileView">                      <div class="col-xs-6 provider">                        <div class="disc"><b ng-click="fetchDetails(data.provider)" class="product-name">{{data.provider.packageName}}</b>                          <p>by<b><span ng-if="!nextDayFilter && data.sponserTempPackageDetails.length">{{data.sponserTempPackageDetails.length}}</span><span ng-if="nextDayFilter">{{autoBookSlots.length}}</span> Providers</b><span class="product-location"><i class="mm mm-map-marker"></i>{{cityName}}</span></p>                        </div>                      </div>                      <div class="col-xs-3 p-l-0 p-r-0 extra text-center">                        <div class="btn-group btn-product-details" ng-click="fetchDetails(data.provider)">                          <div style="float:left">{{data.provider.packageTestCount}}<span>Tests</span></div>                          <div style="float:right"><b ng-if="data.provider.packageConsultationCount &gt; 0">{{:: data.provider.packageConsultationCount}}</b><span ng-if="data.provider.packageConsultationCount === 0">No</span><span> Consult(s)</span></div>                          <div class="details">Details<i class="mm mm-chevron-down"></i></div>                        </div>                      </div>                      <div class="col-xs-3 book">        \t\t\t\t<div class="price pull-right">        \t\t\t\t\t<span ng-if="data.priceStartFrom > 0"> <span ng-if="data.totalDifferedPrice > 1" style="color: #666;font-size: 12px;">Start From </span> <i class="mm mm-rupee"></i> {{data.priceStartFrom}}</span>        \t\t\t\t</div>                        <a ng-show="!data.showHideSponserPackage" ng-click="showHideSponserPackageFunc(data)" class="btn btn-primary btn-booking">Show Providers</a>                        <a ng-show="data.showHideSponserPackage" ng-click="hideSponserPackageFunc(data)" class="btn btn-primary btn-booking">Hide Providers</a>                      </div>                    </div>                    <div ng-show="data.provider.detailsClicked || (detailsClicked &amp;&amp; data.provider.packageId === clickPackageId)" class="detailswraper" ng-class="{\'no-animate\':isMobileView}"><a ng-click="closeDetails()" class="closeBtn"><i class="mm mm-close"></i></a>                      <div ng-if="data.homeSampleCollection" style="width: 250px; margin-top: 6px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-right hscAwail"><i style="width:30px; height:30px;" class="img-icon icon-hsc pull-left"></i>Home Sample Collection Available</div>                      <uib-tabset>                        <uib-tab index="0" heading="Description">                          <div class="row">                            <div class="col-sm-5 tests">                              <ul>                                <li tooltip-placement="top" uib-tooltip="{{consultationInnerTest}}"><b>Consultation(s)<span ng-if="dc.packageConsultationCount &gt; 0">{{dc.packageConsultationCount}}</span><span ng-if="dc.packageConsultationCount === 0">_</span></b></li>                              </ul>                              <ul>                                <li><b>Tests<span>{{nonConsultationTestCount}}</span></b></li>                                <li ng-repeat="test in nonConsultationTest" tooltip-placement="top" tooltip-class="tt-test" uib-tooltip="{{test.innerTests}}" class="smTxt">{{test.name}}<span>{{test.count}}</span></li>                              </ul>                            </div>                            <div class="col-sm-7">                              <div style="padding:10px 0" class="clearfix">                                <div ng-if="data.minAge || data.maxAge" style="margin-right: 5px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left">                                  Age Range:                                  &nbsp;<span ng-if="data.minAge &lt; 60">{{data.minAge}} - {{data.maxAge}}</span><span ng-if="data.minAge &gt; 59">{{data.minAge}} +</span>                                </div>                                <div style="line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left"><span ng-if="data.genderType === \'F\'"> Female Specific Package </span> </div>                              </div>                              <div ng-bind-html="packageDescription" class="smTxt"></div>                            </div>                          </div>                        </uib-tab>                        <uib-tab index="1" ng-if="packageInstructions" heading="Instructions">                          <div ng-bind-html="packageInstructions" line-height:14px;="line-height:14px;" class="smTxt"></div>                        </uib-tab>                      </uib-tabset>                    </div>                  </div>                  <div class="clearfix m-b-30" ng-if="data.showHideSponserPackage && showHideSponserPackageList.length">                    <provider-selection selected-package="selectedPackage" dc-list="showHideSponserPackageList" pipeline="pipeline" checkout="false" provider-slots="providerSlots" all-ahc-package-list="allAhcPackageList" old-corporate-flow="true"></provider-selection>                    </div>                  </div>                  </div>',link:function(a,t,c){a.closeDetails=function(){a.clickPackageId=""},a.detailsClicked=!1,a.ageRangeValue={maxAge:100,minAge:0,isTrue:!1},a.genderFilter={type:"both",isTrue:!1},a.$on("closeSlot",function(e){a.clickPackageId=""}),a.fetchDetails=function(e){if(a.bookClicked=!1,a.isMobileView?(e.detailsClicked=!e.detailsClicked,e.bookClicked=!1):a.detailsClicked=!a.detailsClicked,a.clickPackageId=e.packageId,a.detailsClicked||e.detailsClicked){var t="/showDcDetails"+e.packageId+"/"+e.packageName;window._Site_Props.__setPackageDetails({packageName:e.packageName,providerName:e.dcName,providerLocation:e.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"show Dc Detail",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("AHC","showDcDetail",e.packageName+" by "+e.dcName)})});(new Date).getTime();t=n.apiUrl+"/PackageDetails/"+e.packageId,a.consultationTest=[],a.consultationTestCount=0,a.nonConsultationTest=[],a.nonConsultationTestCount=0,o.makeAjaxCalls(t,"","GET").then(function(e){e.data.packageDetail&&(a.packageDetail=e.data.packageDetail,a.packageDetail.packageTests&&_.each(a.packageDetail.packageTests.testGroups,function(e,t){var i="";"Consultation"===e.name?(_.each(e.tests,function(e,a){i+=e.name+", "}),a.consultationInnerTest=i.slice(0,i.length-2),a.consultationTest.push(e),a.consultationTestCount+=e.count):(_.each(e.tests,function(e,a){i+=e.name+", "}),e.innerTests=i.slice(0,i.length-2),a.nonConsultationTest.push(e),a.nonConsultationTestCount+=e.count)}),a.packageDescription=s.trustAsHtml(a.packageDetail.description),a.packageInstructions=s.trustAsHtml(a.packageDetail.instruction))})}},a.hideSponserPackageFunc=function(e){window._Site_Props.__setPackageDetails({packageName:a.selectedPackage.packageName}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"AHC Hide Providers",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{companyName:a.user.corpDetails.employeeDetail.companyName}})}),a.selectedPackage=[],e.showHideSponserPackage=!1,a.showHideSponserPackageListPackageId=""},a.showHideSponserPackageFunc=function(e){a.selectedPackage=e.provider,e.showHideSponserPackage=!0,e.showHideSponserPackage?(a.showHideSponserPackageList=e.sponserTempPackageDetails,a.showHideSponserPackageListPackageId=e.provider.packageId,window._Site_Props.__setPackageDetails({packageName:a.selectedPackage.packageName}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"AHC Show Providers",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{companyName:a.user.corpDetails.employeeDetail.companyName}})})):(a.showHideSponserPackageListPackageId="",a.showHideSponserPackageList=[])},a.returnTime=function(e){var a=o.getTimeFormate(e);return a},a.$on("changeCity",function(e,t){a.getAhcPackage()});var d=e.$on("userDetails",function(e,t){a.getAhcPackage()}),p=(e.$on("userLogout",function(e,t){a.allAhcPackageList=[],a.providerSlots=[]}),e.$on("filterAHCItems",function(e,t){a.allAhcPackageList=angular.copy(a.tempallAhcPackageList),t.Provider.length>0&&t.Location.length>0?(a.allAhcPackageList=a.filterByProvider(a.allAhcPackageList,t.Provider),a.allAhcPackageList=a.filterByLocation(a.allAhcPackageList,t.Location,!0)):t.Provider.length>0?a.allAhcPackageList=a.filterByProvider(a.allAhcPackageList,t.Provider):t.Location.length>0&&(a.allAhcPackageList=a.filterByLocation(a.allAhcPackageList,t.Location,!1)),_.each(a.allAhcPackageList,function(e,t){e.provider.packageId==a.showHideSponserPackageListPackageId&&(a.showHideSponserPackageList=e.sponserTempPackageDetails,a.sponsored.fetchSlotInfo(!0))})}));a.filterByProvider=function(e,a){return _.each(e,function(t,i){t.sponserTempPackageDetails=[],_.each(t.sponserPackageDetails,function(e,i){_.each(a,function(a,i){e.dcName.toLowerCase().indexOf(a.dcName.toLowerCase())>=0&&t.sponserTempPackageDetails.push(e)})}),0===t.sponserTempPackageDetails.length&&(e=_.difference(e,t))}),e},a.filterByLocation=function(e,a,t){return t?_.each(e,function(t,i){_.each(t.sponserTempPackageDetails,function(e,i){var o=!1;_.each(a,function(a,t){e.dcLocation.toLowerCase()===a.dcLocation.toLowerCase()&&(o=!0)}),o||(t.sponserTempPackageDetails=_.difference(t.sponserTempPackageDetails,e))}),0===t.sponserTempPackageDetails.length&&(e=_.difference(e,t))}):_.each(e,function(t,i){t.sponserTempPackageDetails=[],_.each(t.sponserPackageDetails,function(e,i){_.each(a,function(a,i){e.dcLocation.toLowerCase()===a.dcLocation.toLowerCase()&&t.sponserTempPackageDetails.push(e)})}),0===t.sponserTempPackageDetails.length&&(e=_.difference(e,t))}),e},a.getAhcPackage=function(){if(a.user=o.isUserSignedin(),a.user&&i.searchc&&("preventive"===i.searchc.toLowerCase()||"master"===i.searchc.toLowerCase()||"executive"===i.searchc.toLowerCase())){a.allAhcPackageList=[],a.providerSlots=[];var e=n.apiUrl+"AHC/GetPackage.json";a.cityName=o.getCity();var t=-1;o.makeAjaxCalls(e,{},"POST",a.user.token,a.cityName).then(function(e){if(a.allAhcPackageList=[],e.data.ahcPackages&&e.data.ahcPackages.length>0&&(_.each(e.data.ahcPackages,function(i,o){i.packageName.toLowerCase().indexOf("ahc")>-1&&(t=o),i.packageFilters&&i.packageFilters.length>0&&_.forEach(i.packageFilters,function(e,a){var t=e;if("gender"===t.substring(0,6).toLowerCase()){var o=t.split(":")[1];i.genderType=o}else if("maxage"===t.substring(0,6).toLowerCase()){var n=t.split(":")[1];i.maxAge=parseInt(n)}else if("minage"===t.substring(0,6).toLowerCase()){var s=t.split(":")[1];i.minAge=parseInt(s),i.minAge>59&&(i.maxAge=60)}else"homesamplecollection"===t.substring(0,20).toLowerCase()?i.homeSampleCollection=t.split(":")[1]?t.split(":")[1].toLowerCase():t.split(":")[1]:"priority"===t.substring(0,8).toLowerCase()?i.corpPriority=!0:"isgoldpartner"===t.substring(0,13).toLowerCase()?i.goldPartner=!0:(i.genderType||(i.genderType="both"),i.minAge=i.minAge>0?i.minAge:0,i.maxAge=i.maxAge>0?i.maxAge:59)}),a.tempAchPackage={},a.tempAchPackage.priceObj={},_.isEmpty(e.data.availableSlots)||(i.availableSlots=e.data.availableSlots),a.tempAchPackage.provider=i,a.tempAchPackage.genderType=i.genderType,a.tempAchPackage.minAge=i.minAge,a.tempAchPackage.maxAge=i.maxAge,a.providerSlots=e.data.providerSlots||[],a.tempAchPackage.sponserPackageDetails=i.providers,"updateFilters"in(a.pipeline||{})&&a.pipeline.updateFilters(a.tempAchPackage.sponserPackageDetails);var n=e.data.availableSlots;a.tempAchPackage.sponserTempPackageDetails=a.tempAchPackage.sponserPackageDetails,_.each(a.tempAchPackage.sponserPackageDetails,function(e,t){var o=n||i.availableSlots;_.isEmpty(o)||_.isEmpty(o[0].slots)||(a.tempAchPackage.priceObj[e.price]=0,e.slotStartTime=a.returnTime(o[0].slots[0].slotStartTime),e.slotEndTime=a.returnTime(o[0].slots[0].slotEndTime)),e.goldPartner=i.goldPartner||"",e.corpPriority=i.corpPriority||"",e.homeSampleCollection=i.homeSampleCollection||"",e.genderType=i.genderType,e.minAge=i.minAge,e.maxAge=i.maxAge,e.packageId=i.packageId,e.availableSlots=o,e.packageName=i.packageName,e.isAHC=!0,e.isSponser=0===e.price,e.contractId=r.ahcContract});var s=Object.keys(a.tempAchPackage.priceObj);s.length>1?(a.tempAchPackage.priceStartFrom=_.first(s.sort()),a.tempAchPackage.totalDifferedPrice=s.length):1===s.length?(a.tempAchPackage.priceStartFrom=_.first(s.sort()),a.tempAchPackage.totalDifferedPrice=s.length):(a.tempAchPackage.priceStartFrom=_.first(s.sort()),a.tempAchPackage.totalDifferedPrice=s.length),delete a.tempAchPackage.priceObj,a.allAhcPackageList.push(a.tempAchPackage),a.tempallAhcPackageList=a.allAhcPackageList}),t>0)){var i=a.allAhcPackageList.splice(t,1);a.allAhcPackageList.splice(0,0,_.first(i))}}),a.user&&a.user.corpConfig&&(a.isBookingAllowed=a.user.corpConfig.isBookingAllowed)}},e.$on("$destroy",function(){p(),d()}),a.getAhcPackage(),a.$watchGroup(["sponserPackageDetails"],function(e){a.tempCtrlData=[],e&&e&&(a.tempCtrlData=a.ctrlData,a.sponserPackageDetails&&a.sponserPackageDetails.length>0&&(a.tempCtrlData=_.union(a.tempCtrlData,a.sponserPackageDetails),_.isEmpty(_.difference(a.tempCtrlData,e))||(a.ctrlData=a.tempCtrlData)))}),a.redirectToCorpBenefits=function(){window._MB_Analytics.__push({isCleverTap:!0,name:"Redirect to UCP"}),l.go("app.corporate")}}}}]),e.register.directive("offeredPackage",["$rootScope","$compile","$timeout","$stateParams","authService","apiProvider","$sce","navConstantsSvc","$state","$window","$location",function(e,a,t,i,o,n,s,r,l,c,d){return{restrict:"AE",scope:{ctrlData:"=bind",corpids:"=?",blockData:"=blockdata",priceRangeValue:"=priceRangeValue",ageRangeValue:"=?",genderFilter:"=genderFilter",hsc:"=?",orderSelected:"=orderBy",isMobileView:"=?"},template:'<div ng-if="tempCtrlData.length &gt; 0" ng-repeat="dc in tempCtrlData|pricebetween:priceRangeValue.minPrice :priceRangeValue.maxPrice :priceRangeValue.isTrue |ageRange: ageRangeValue.minAge :ageRangeValue.maxAge : ageRangeValue.isTrue |gender: genderFilter |hscFilter: hsc.isSelected |orderBy:orderSelected track by dc.trackId" class="result-box"  ng-class="!dc.corpPriority ? \'offer\' : \'\'">            <div class="share hideSm" ng-if="!dc.corpPriority"> </div>            <div class="row box" ng-if="isMobileView">                <div class="col-xs-12 provider">                    <div class="logo">                        <div class="noLogo bg1">{{:: dc.dcName.charAt(0)}}</div>                    </div>                    <div class="disc">                        <a class="product-name" ng-click="bookSlotAfterValidation(dc)">{{:: dc.packageName}}</a>                        <div ng-class="{\'col-xs-9 p-l-0 p-r-0\':isMobileView}">                            <p><b style="margin-left:0;">Tests: {{:: dc.packageTestCount}}</b><b style="margin-left:0;" ng-if="dc.packageConsultationCount &gt; 0">, Consultations: {{:: dc.packageConsultationCount}} </b></p>                            <p>by<span ng-if="dc.providerRelativeUrl">&nbsp;<a href="{{dc.providerRelativeUrl}}">{{:: dc.dcName}}</a></span><b ng-if="!dc.providerRelativeUrl">{{:: dc.dcName}}</b></p>                            <p class="loaction">                                <span class="product-location" ng-hide="dc.homeSampleCollection"><i class="mm mm-map-marker"></i>{{:: dc.dcLocation}}</span>                                <span class="hsc" ng-show="dc.homeSampleCollection" title="A trained technician will visit your home to collect the samples"><i class="mm mm-sample"></i>&nbsp;Home Sample Collection</span>                            </p>                            <p><i class="mm mm-clock"></i>{{:: dc.slotStartTime}} - {{:: dc.slotEndTime}}</p>                            <span class="label label-info" ng-if="dc.corpPriority"> Exclusive </span>                            <span class="label label-info label-offer" ng-if="!dc.corpPriority"> Special Offer </span>                        </div>                        <div class="col-xs-3 p-l-0 p-r-0 text-right" ng-if="isMobileView">                            <div class="m-b-5 price" ng-if="dc.price >0"><b>&#x20B9;&nbsp;{{dc.price}}</b></div>                            <div class="m-b-5 price" ng-if="dc.priceRange > dc.price"><i class="mm mm-rupee"></i><strike>{{:: dc.priceRange}}</strike></div>                            <span class="discount" ng-if="dc.priceRange > dc.price">{{dc.discountPercent}}% OFF</span>                        </div>                        <div class="book" style="padding-left:0!important">                            <div ng-if="!isMobileView">                                <div class="clearfix">                                    <span class="discount"><span ng-if="(dc.priceRange &gt; dc.price)">{{dc.discountPercent}}% Off</span></span>                                    <span class="price pull-right"><b>&#x20B9;&nbsp;{{:: dc.price}}</b></span>                                </div>                                <div class="strike pull-right" ng-if="(dc.priceRange &gt; dc.price)"><i class="mm-rupee"></i> <strike>{{:: dc.priceRange}}</strike></div>                            </div>                            <a ng-click="bookSlotAfterValidation(dc)" class="btn btn-primary btn-booking" style="float: right">View Package<i class="mm mm-female" ng-if="dc.genderType == \'F\'"></i> <i class="mm mm-male" ng-if="dc.genderType == \'M\'"></i></a>                        </div>                    </div>                </div>            </div>            <div class="row box" ng-if="!isMobileView">                <div class="col-xs-6 provider">                  <div class="logo">                    <div class="noLogo bg1">{{:: dc.dcName.charAt(0)}}</div>                  </div>                  <div class="disc"><a class="product-name" ng-click="bookSlotAfterValidation(dc)">{{:: dc.packageName}}</a>                    <div ng-class="{\'col-xs-9 p-l-0 p-r-0\':isMobileView}">                        <p class="m-b-5">                            by<span ng-if="dc.providerRelativeUrl">&nbsp;<a href="{{dc.providerRelativeUrl}}" target="_blank">{{:: dc.dcName}}</a></span><b ng-if="!dc.providerRelativeUrl">{{:: dc.dcName}}</b>                            <span ng-if="dc.salePrice" class="m-l-10 discount"><span>{{dc.saleName}}</span></span>                        </p>                        <p class="loaction">                            <span class="product-location" ng-hide="dc.homeSampleCollection"><i class="mm mm-map-marker"></i>{{:: dc.dcLocation}}</span>                            <span class="hsc" ng-show="dc.homeSampleCollection" title="A trained technician will visit your home to collect the samples"><i class="mm mm-sample"></i>&nbsp;Home Sample Collection</span>                        </p>                        <span class="label label-info" ng-if="dc.corpPriority"> Exclusive </span>                        <span class="label label-info label-offer" ng-if="!dc.corpPriority"> Special Offer </span>                    </div>                    <div class="col-xs-3 p-l-0 p-r-0 text-right" ng-if="isMobileView">                        <div class="m-b-5 price" ng-if="dc.price >0"><b>&#x20B9;&nbsp;{{dc.price}}</b></div>                        <div class="m-b-5 price" ng-if="dc.priceRange > dc.price"><i class="mm mm-rupee"></i><strike>{{:: dc.priceRange}}</strike></div>                        <span class="discount" ng-if="dc.priceRange > dc.price">{{dc.discountPercent}}% OFF</span>                    </div>                  </div>                </div>                <div class="col-xs-3 p-l-0 p-r-0 extra text-center package-new-design">                  <div class="btn-group btn-product-details">                    <div style="float:left">{{:: dc.packageTestCount}}<span>Tests</span></div>                    <div style="float:right"><b ng-if="dc.packageConsultationCount &gt; 0">{{:: dc.packageConsultationCount}}</b><span ng-if="dc.packageConsultationCount === 0">No</span><span> Consult(s)</span></div>                  </div>                </div>                <div class="col-xs-3 book">                    <div ng-if="!isMobileView">                        <div class="clearfix">                            <span class="discount"><span ng-if="(dc.priceRange &gt; dc.price || dc.salePrice)">{{dc.salePrice ? "43" : dc.discountPercent}}% Off</span></span>                            <div class="price pull-right"><b>&#x20B9;&nbsp;{{:: dc.salePrice? dc.salePrice: dc.price}}</b></div>                        </div>                        <div ng-if="(dc.priceRange &gt; dc.price || dc.salePrice)" class="pull-right strike"><i class="mm-rupee"></i>                            <strike>{{:: dc.priceRange}}</strike>                        </div>                    </div>                    <a ng-click="bookSlotAfterValidation(dc)" class="btn btn-primary btn-booking"> View Package<i class="mm mm-female" ng-if="dc.genderType == \'F\'"></i> <i class="mm mm-male" ng-if="dc.genderType == \'M\'"></i></a>                </div>              </div>              <div ng-show="dc.detailsClicked || (detailsClicked &amp;&amp; dc.dcId === clickDCId &amp;&amp; dc.packageId === clickPackageId)" class="detailswraper"  ng-class="{\'no-animate\':isMobileView}"><a class="closeBtn"><i class="mm mm-close"></i></a>                <div ng-if="dc.homeSampleCollection" style="width: 250px; margin-top: 6px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-right"><i style="width:30px; height:30px;" class="img-icon icon-hsc pull-left"></i>Home Sample Collection Available</div>                <uib-tabset>                  <uib-tab index="0" heading="Description">                    <div class="row">                      <div class="col-sm-5 tests">                        <ul>                          <li tooltip-placement="top" uib-tooltip="{{dc.consultationInnerTest}}"><b>Consultation(s)<span ng-if="dc.packageConsultationCount &gt; 0">{{dc.packageConsultationCount}}</span><span ng-if="dc.packageConsultationCount === 0">_</span></b></li>                        </ul>                        <ul>                          <li><b>Tests<span>{{dc.nonConsultationTestCount}}</span></b></li>                          <li ng-repeat="test in dc.nonConsultationTest" tooltip-placement="top" tooltip-class="tt-test" uib-tooltip-template= "\'myTooltip.html\'" class="smTxt">{{test.name}}<span>{{test.count}}</span></li>                          <script type="text/ng-template" id="myTooltip.html">                            <ol class="test-list">                              <li ng-repeat="testinner in test.innerTests"> {{testinner}} </li>                            </ol>                          </script>                        </ul>                      </div>                      <div class="col-sm-7">                        <div class="clearfix">                          <div style="margin-right: 5px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left">                            Age Range:                            &nbsp;<span ng-if="dc.minAge &lt; 60">{{dc.minAge}} - {{dc.maxAge}}</span><span ng-if="dc.minAge &gt; 59">{{dc.minAge}} +</span>                          </div>                          <div style="line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left"><span ng-if="dc.genderType == \'F\'">Female Specific Package</span><span ng-if="dc.genderType == \'M\'">Male Specific Package</span></div>                        </div>                        <div ng-bind-html="dc.packageDescription" class="smTxt"></div>                      </div>                    </div>                  </uib-tab>                  <uib-tab index="1" heading="Instructions">                    <div ng-bind-html="dc.packageInstructions" line-height:14px;="line-height:14px;" class="smTxt"></div>                  </uib-tab>                </uib-tabset>              </div>              <div ng-if="dc.bookClicked || (bookClicked &amp;&amp; dc.dcId === clickDCId &amp;&amp; dc.packageId === clickPackageId)" class="detailswraper bookwraper"  ng-class="{\'no-animate\':isMobileView}"><a ng-click="bookSlotAfterValidation(dc)" class="closeBtn"><i class="mm mm-close"></i></a>                <div style="padding:10px 0" class="appointment-details">                  <medi-book-slot obj="dc" block-details="blockData" errormessage="errorMessage" pipeline="pipeline"></medi-book-slot>                </div>              </div>            </div>',
link:function(e,a,t){e.pipeline={},e.bookSlotAfterValidation=function(e){var a={packageName:e.packageName,vendorName:e.dcName,vendorLocation:e.dcLocation,visitType:"home sample collection"===e.homeSampleCollection?"home sample":"lab visit",itemSource:"VendorPackageListingPage",refUrl:c.location.href};window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"ChooseVendor",dbLog:"hc",hj:!0,payload:window._Site_Props.__getEventParameters({service:!0,"package":!1,custom:a})});var t=o.isUserSignedin(),s={packageId:e.packageId,searchc:i.searchc,city:i.city,categoryItemTypeId:i.categoryItemTypeId,coupon:i.coupon||"",dcId:e.dcId};if(t&&t.token){var d={sessionData:{},forceUpdate:!0};d.sessionData[r.healthCheckId]="",o.makeAjaxCalls(n.apiUrl+"/SessionStorage.json",d,"POST",t.token).then(function(e){l.go("app.packageDetail",s,{reload:"app.packageDetail"})})}else l.go("app.packageDetail",s,{reload:"app.packageDetail"})},e.getDetailViewUrl=function(e){return location.origin+"/product/"+i.categoryItemTypeId+"//"+i.searchc+"/"+e.packageId+(i.coupon?"/?coupon="+i.coupon:"/")},e.fetchDetails=function(a){if(e.bookClicked=!1,e.isMobileView?(a.detailsClicked=!a.detailsClicked,a.bookClicked=!1):e.detailsClicked=!e.detailsClicked,e.clickDCId=a.dcId,e.clickPackageId=a.packageId,e.detailsClicked||a.detailsClicked){var t="/showDcDetails"+a.packageId+"/"+a.packageName;window._Site_Props.__setPackageDetails({packageName:a.packageName,providerName:a.dcName,providerLocation:a.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"show Dc Detail",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Health Checks","showDcDetail",a.packageName+" by "+a.dcName)})});(new Date).getTime();a.description||(t=n.apiUrl+"/PackageDetails/"+a.packageId,a.consultationTest=[],a.consultationTestCount=0,a.nonConsultationTest=[],a.nonConsultationTestCount=0,o.makeAjaxCalls(t,"","GET").then(function(t){t.data.packageDetail&&(e.packageDetail=t.data.packageDetail,_.each(e.packageDetail.packageTests.testGroups,function(e,t){var i;"Consultation"===e.name?(i="",_.each(e.tests,function(e,a){i+=e.name+", "}),a.consultationInnerTest=i.slice(0,i.length-2),a.consultationTest.push(e),a.consultationTestCount+=e.count):(i=[],_.each(e.tests,function(e,a){i.push(e.name)}),e.innerTests=i,a.nonConsultationTest.push(e),a.nonConsultationTestCount+=e.count)}),a.packageDescription=s.trustAsHtml(e.packageDetail.description),a.packageInstructions=s.trustAsHtml(e.packageDetail.instruction))}))}},e.user=o.isUserSignedin(),e.sortCollection=function(a){return e.user&&e.user.userDetails&&r.positionWiseHCPackagesEntityId.includes(e.user.userDetails.pmEntityID)?a:(a=_.sortBy(a,"plh"===e.orderSelected||"phl"===e.orderSelected?"price":"discountPercent"),"phl"!==e.orderSelected&&"dhl"!==e.orderSelected||(a=a.reverse()),a)},e.differenceCtrlData=[],e.$watch("ctrlData",function(a){a&&(e.offeredPackageId=o.getOfferPackageIdList(),a&&(a&&a.length!==e.differenceCtrlData.length&&(e.tempCtrlData=[],e.corpPriorData=[],e.tempOfferData=[],_.each(e.corpids,function(a,t){var i=_.findWhere(e.ctrlData,{packageId:a});_.isEmpty(i)||(e.corpPriorData.push(i),e.differenceCtrlData=_.difference(e.ctrlData,e.corpPriorData),e.ctrlData=e.differenceCtrlData)}),_.each(e.offeredPackageId,function(a,t){var i=_.findWhere(e.ctrlData,{packageId:a});_.isEmpty(i)||(e.tempOfferData.push(i),e.differenceCtrlData=_.difference(e.ctrlData,e.tempOfferData),e.ctrlData=e.differenceCtrlData)})),e.corpPriorData=e.sortCollection(e.corpPriorData),e.tempOfferData=e.sortCollection(e.tempOfferData),e.user&&e.user.userDetails&&r.mediAssistIds.indexOf(e.user.userDetails.pmEntityID)>-1?e.tempCtrlData=e.corpPriorData.concat(e.tempOfferData):e.tempCtrlData=e.tempOfferData.concat(e.corpPriorData)))})}}}]),e.register.directive("offeredPackageGeneral",["$rootScope","$compile","$timeout","$stateParams","authService","apiProvider","$sce","navConstantsSvc",function(e,a,t,i,o,n,s,r){return{restrict:"AE",scope:{url:"=?",requestData:"=?",ageRangeValue:"=?",genderFilter:"=?",isMobileView:"=?"},template:'<div ng-if="tempCtrlData.length &gt; 0" ng-repeat="dc in tempCtrlData |ageRange: ageRangeValue.minAge :ageRangeValue.maxAge : ageRangeValue.isTrue |gender: genderFilter track by dc.packageId" class="result-box healthchecks">              <div class="row box">                <div class="col-xs-6 provider">                  <div class="logo">                    <div class="noLogo bg1">{{:: dc.dcName.charAt(0)}}</div>                  </div>                  <div class="disc"><a ng-click="fetchDetails(dc)" class="product-name">{{:: dc.packageName}}</a>                    <div ng-class="{\'col-xs-9 p-l-0 p-r-0\':isMobileView}">                        <p>by<b>&nbsp;{{:: dc.dcName}}</b></p>                        <p class="loaction">                            <span class="product-location" ng-hide="dc.homeSampleCollection"><i class="mm mm-map-marker"></i>{{:: dc.dcLocation}}</span>                            <span class="hsc" ng-show="dc.homeSampleCollection" title="A trained technician will visit your home to collect the samples"><i class="mm mm-sample"></i>&nbsp;Home Sample Collection</span>                        </p>                    </div>                    <div class="col-xs-3 p-l-0 p-r-0 text-right" ng-if="isMobileView">                        <div class="m-b-5 price" ng-if="dc.price >0"><b>&#x20B9;&nbsp;{{dc.price}}</b></div>                        <div class="m-b-5 price" ng-if="dc.priceRange > dc.price"><i class="mm mm-rupee"></i><strike>{{:: dc.priceRange}}</strike></div>                        <div class="discount" ng-if="dc.priceRange > dc.price">{{dc.discountPercent}}% OFF</div>                    </div>                  </div>                </div>                <div class="col-xs-3 p-l-0 p-r-0 extra text-center">                  <p class="availTiming"><i class="mm mm-clock"></i>{{:: dc.slotStartTime}} - {{:: dc.slotEndTime}}</p>                  <div ng-if="!isMobileView" ng-click="fetchDetails(dc)" class="btn-group btn-product-details">                    <div style="float:left">{{:: dc.packageTestCount}}<span>Tests</span></div>                    <div style="float:right"><b ng-if="dc.packageConsultationCount &gt; 0">{{:: dc.packageConsultationCount}}</b><span ng-if="dc.packageConsultationCount === 0">No</span><span> Consult(s)</span></div>                    <div class="details">Details<i class="mm mm-chevron-down"></i></div>                  </div>                  <p ng-if="isMobileView" style="text-align:left;"><b style="margin-left:0;">Tests: {{:: dc.packageTestCount}}</b><b ng-if="dc.packageConsultationCount &gt; 0">, Consultation: {{:: dc.packageConsultationCount}}</b></p>                </div>                <div class="col-xs-3 book" ng-class="{\'extra\':isMobileView}">                    <div ng-if="!isMobileView">                        <div class="clearfix">                            <span class="discount"><span ng-if="(dc.priceRange &gt; dc.price)">{{dc.discountPercent}}% Off</span></span>                            <div class="price pull-right"><b>&#x20B9;&nbsp;{{:: dc.price}}</b></div>                        </div>                        <div ng-if="(dc.priceRange &gt; dc.price)" class="pull-right strike"><i class="mm-rupee"></i>                            <strike>{{:: dc.priceRange}}</strike>                        </div>                    </div>                  <a ng-click="bookSlotAfterValidation(dc)" class="btn btn-primary btn-booking"> Book Now<i class="mm mm-female" ng-if="dc.genderType == \'F\'"></i> <i class="mm mm-male" ng-if="dc.genderType == \'M\'"></i></a>                </div>              </div>              <div ng-show="dc.detailsClicked || (detailsClicked &amp;&amp; dc.dcId === clickDCId &amp;&amp; dc.packageId === clickPackageId)" class="detailswraper"  ng-class="{\'no-animate\':isMobileView}"><a ng-click="fetchDetails(dc)" class="closeBtn"><i class="mm mm-close"></i></a>                <div ng-if="dc.homeSampleCollection" style="width: 250px; margin-top: 6px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-right"><i style="width:30px; height:30px;" class="img-icon icon-hsc pull-left"></i>Home Sample Collection Available</div>                <uib-tabset>                  <uib-tab index="0" heading="Description">                    <div class="row">                      <div class="col-sm-5 tests">                        <ul>                          <li tooltip-placement="top" uib-tooltip="{{dc.consultationInnerTest}}"><b>Consultation(s)<span ng-if="dc.packageConsultationCount &gt; 0">{{dc.packageConsultationCount}}</span><span ng-if="dc.packageConsultationCount === 0">_</span></b></li>                        </ul>                        <ul>                          <li><b>Tests<span>{{dc.nonConsultationTestCount}}</span></b></li>                          <li ng-repeat="test in dc.nonConsultationTest" tooltip-placement="top" tooltip-class="tt-test" uib-tooltip-template= "\'myTooltip.html\'" class="smTxt">{{test.name}}<span>{{test.count}}</span></li>                          <script type="text/ng-template" id="myTooltip.html">                            <ol class="test-list">                              <li ng-repeat="testinner in test.innerTests"> {{testinner}} </li>                            </ol>                          </script>                        </ul>                      </div>                      <div class="col-sm-7">                        <div class="clearfix">                          <div style="margin-right: 5px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left">                            Age Range:                            &nbsp;<span ng-if="dc.minAge &lt; 60">{{dc.minAge}} - {{dc.maxAge}}</span><span ng-if="dc.minAge &gt; 59">{{dc.minAge}} +</span>                          </div>                          <div style="line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left"><span ng-if="dc.genderType == \'F\'">Female Specific Package</span><span ng-if="dc.genderType == \'M\'">Male Specific Package</span></div>                        </div>                        <div ng-bind-html="dc.packageDescription" class="smTxt"></div>                      </div>                    </div>                  </uib-tab>                  <uib-tab index="1" heading="Instructions" ng-if="packageInstructions">                    <div ng-bind-html="dc.packageInstructions" line-height:14px;="line-height:14px;" class="smTxt"></div>                  </uib-tab>                </uib-tabset>              </div>              <div ng-if="dc.bookClicked || (bookClicked &amp;&amp; dc.dcId === clickDCId &amp;&amp; dc.packageId === clickPackageId)" class="detailswraper bookwraper"  ng-class="{\'no-animate\':isMobileView}"><a ng-click="bookSlotAfterValidation(dc)" class="closeBtn"><i class="mm mm-close"></i></a>                <div style="padding:10px 0" class="appointment-details">                  <medi-book-slot obj="dc" errormessage="errorMessage"></medi-book-slot>                </div>              </div>            </div>',link:function(a,t,l){a.ageRangeValue={maxAge:100,minAge:0,isTrue:!1},a.genderFilter={type:"both",isTrue:!1},a.bookSlotAfterValidation=function(e){a.detailsClicked=!1,a.isMobileView?(e.bookClicked=!e.bookClicked,e.detailsClicked=!1):a.bookClicked=!a.bookClicked,a.clickDCId=e.dcId,a.clickPackageId=e.packageId,a.bookClicked||e.bookClicked?(window._Site_Props.__setPackageDetails({packageName:e.packageName,providerName:e.dcName,providerLocation:e.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:"hc",name:"Request Slot",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform(i.categoryItemTypeId,"RequestSlot",e.packageName+" by "+e.dcName)})})):window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Slot Selection Cancelled",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform(i.categoryItemTypeId,"SlotSelectionCancelled",e.packageName+" by "+e.dcName)})})},a.fetchDetails=function(e){if(a.bookClicked=!1,a.isMobileView?(e.detailsClicked=!e.detailsClicked,e.bookClicked=!1):a.detailsClicked=!a.detailsClicked,a.clickDCId=e.dcId,a.clickPackageId=e.packageId,a.detailsClicked||e.detailsClicked){var t="/showDcDetails"+e.packageId+"/"+e.packageName;window._Site_Props.__setPackageDetails({packageName:e.packageName,providerName:e.dcName,providerLocation:e.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"show Dc Detail",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Dental","showDcDetail",e.packageName+" in Dental")})});(new Date).getTime();e.packageDescription||(t=n.apiUrl+"/PackageDetails/"+e.packageId,e.consultationTest=[],e.consultationTestCount=0,e.nonConsultationTest=[],e.nonConsultationTestCount=0,o.makeAjaxCalls(t,"","GET").then(function(t){t.data.packageDetail&&(a.packageDetail=t.data.packageDetail,_.each(a.packageDetail.packageTests.testGroups,function(a,t){var i;"Consultation"===a.name?(i="",_.each(a.tests,function(e,a){i+=e.name+", "}),e.consultationInnerTest=i.slice(0,i.length-2),e.consultationTest.push(a),e.consultationTestCount+=a.count):(i=[],_.each(a.tests,function(e,a){i.push(e.name)}),a.innerTests=i,e.nonConsultationTest.push(a),e.nonConsultationTestCount+=a.count)}),e.packageDescription=s.trustAsHtml(a.packageDetail.description),e.packageInstructions=s.trustAsHtml(a.packageDetail.instruction))}))}},a.weekFilter=r.weekGroup,_.forEach(a.weekFilter,function(e,a){e.isDisabled=!0}),o.makeAjaxCalls(a.url,a.requestData,"POST").then(function(e){e.data&&e.data.categoryItemTypeResponse&&e.data.categoryItemTypeResponse.length>0&&(a.tempCtrlData=e.data.categoryItemTypeResponse[0].categoryItems,_.forEach(a.tempCtrlData,function(e,t){a.tempCtrlData[t].uniqueId=1+t,a.tempCtrlData[t].day0=!1,a.tempCtrlData[t].day1=!1,a.tempCtrlData[t].day2=!1,a.tempCtrlData[t].day3=!1,a.tempCtrlData[t].day4=!1,a.tempCtrlData[t].day5=!1,a.tempCtrlData[t].day6=!1,e.packageFilters&&e.packageFilters.length>0&&_.forEach(e.packageFilters,function(e,i){var o=e;if("gender"===o.substring(0,6).toLowerCase()){var n=o.split(":")[1];a.tempCtrlData[t].genderType=n}else if("maxage"===o.substring(0,6).toLowerCase()){var s=o.split(":")[1];a.tempCtrlData[t].maxAge=parseInt(s)}else if("minage"===o.substring(0,6).toLowerCase()){var l=o.split(":")[1];a.tempCtrlData[t].minAge=parseInt(l),a.tempCtrlData[t].minAge>59&&(a.tempCtrlData[t].maxAge=100)}else"homesamplecollection"===o.substring(0,20).toLowerCase()?a.tempCtrlData[t].homeSampleCollection=o.split(":")[1]?o.split(":")[1].toLowerCase():o.split(":")[1]:"keywords"===o.substring(0,8).toLowerCase()&&o.split(":")[1].toLowerCase().indexOf(r.dentalPackageName.toLowerCase())>-1?a.tempCtrlData[t].isDentalPackage=!0:"priority"===o.substring(0,8).toLowerCase()?a.tempCtrlData[t].corpPriority=!0:(a.tempCtrlData[t].genderType||(a.tempCtrlData[t].genderType="both"),a.tempCtrlData[t].minAge=a.tempCtrlData[t].minAge>0?a.tempCtrlData[t].minAge:0,a.tempCtrlData[t].maxAge=a.tempCtrlData[t].maxAge>0?a.tempCtrlData[t].maxAge:59)}),_.forEach(e.availableSlots,function(i,o){var n=i;0===n.day&&e.day0===!1?(a.tempCtrlData[t].day0=!0,a.tempCtrlData[t].daysSet0=n.day,a.weekFilter[6].isDisabled=!1):1===n.day&&e.day1===!1?(a.tempCtrlData[t].day1=!0,a.tempCtrlData[t].daysSet1=n.day,a.weekFilter[n.day-1].isDisabled=!1):2===n.day&&e.day2===!1?(a.tempCtrlData[t].day2=!0,a.tempCtrlData[t].daysSet2=n.day,a.weekFilter[n.day-1].isDisabled=!1):3===n.day&&e.day3===!1?(a.tempCtrlData[t].day3=!0,a.tempCtrlData[t].daysSet3=n.day,a.weekFilter[n.day-1].isDisabled=!1):4===n.day&&e.day4===!1?(a.tempCtrlData[t].day4=!0,a.tempCtrlData[t].daysSet4=n.day,a.weekFilter[n.day-1].isDisabled=!1):5===n.day&&e.day5===!1?(a.tempCtrlData[t].day5=!0,a.tempCtrlData[t].daysSet5=n.day,a.weekFilter[n.day-1].isDisabled=!1):6===n.day&&e.day6===!1&&(a.tempCtrlData[t].day6=!0,a.tempCtrlData[t].daysSet6=n.day,a.weekFilter[n.day-1].isDisabled=!1)}),_.isEmpty(e.availableSlots)||_.isEmpty(e.availableSlots[0].slots)||(e.slotStartTime=o.getTimeFormate(e.availableSlots[0].slots[0].slotStartTime),e.slotEndTime=o.getTimeFormate(e.availableSlots[0].slots[0].slotEndTime)),e.priceRange&&!isNaN(e.priceRange)&&(e.priceRange=parseInt(e.priceRange.split(".")[0])),e.price<e.priceRange?e.discountPercent=100-Math.round(e.price/e.priceRange*100):e.discountPercent=0,e.trackId=e.dcId+e.packageId}),a.originalCtrlData=a.tempCtrlData)});e.$on("filterAHCItems",function(e,t){a.tempCtrlData=angular.copy(a.originalCtrlData),t.Provider.length>0&&a.filterByProvider(t.Provider),t.Location.length>0&&a.filterByLocation(t.Location)});a.filterByProvider=function(e){_.each(a.tempCtrlData,function(t,i){_.each(e,function(e,i){t.dcName.toLowerCase().indexOf(e.dcName.toLowerCase())<0&&(a.tempCtrlData=_.without(a.tempCtrlData,t))})})},a.filterByLocation=function(e){_.each(a.tempCtrlData,function(t,i){_.each(e,function(e,i){t.dcLocation.toLowerCase()!==e.dcLocation.toLowerCase()&&(a.tempCtrlData=_.without(a.tempCtrlData,t))})})}}}}]),e.register.directive("megaMenu",["$rootScope","$compile","$stateParams","authService","apiProvider",function(e,a,t,i,o){return{restrict:"AE",scope:{configdata:"=?",searchdata:"="},templateUrl:"/templates/megaMenuTemplate.html?"+timeStamp,link:function(e,a,t){e.searchdata?(e.search=e.searchdata,e.validity=!0):(e.search=[],e.searchdata=[],e.validity=!1),e.editSearchData=function(a,t,i){if("checkbox"===i){if(t>=e.search.length)e.search[t]=angular.copy(a);else if(a.isSelected)e.search[t].name=e.search[t].name+","+a.name;else{var o=e.search[t].name.indexOf(a.name);0===o?e.search[t].name=e.search[t].name.substring(o+1+a.name.length,e.search[t].name.length):e.search[t].name=e.search[t].name.substring(0,o-1)+e.search[t].name.substring(o+a.name.length,e.search[t].name.length)}e.search[t].name?e.checkValidityAndAssign(a):(e.validity=!1,e.searchdata=[],e.search.splice(t,1))}else if(!a.isSelected){if(a.isSelected=!0,t<e.search.length){for(var n=e.search.length-t,s=t;s<e.search.length;s++)e.search[s].isSelected=!e.search[s].isSelected;e.search.splice(t,n),e.search[t]=a}else e.search[t]=a;e.checkValidityAndAssign(a)}},e.checkValidityAndAssign=function(a){a.types&&0!==a.types.length?(e.searchdata=[],e.validity=!1):(e.validity=!0,e.searchdata=e.search)}}}}]),e.register.directive("affixDirective",["$timeout","$rootScope",function(e,a){return{restrict:"A",link:function(e,t,i){i.affixDirective&&!a.isMobileView&&requirejs(["sticky"],function(){$(i.affixDirective).stick_in_parent({parent:"#containeWrap",offset_top:20}),i.pinbottom&&$(i.affixDirective).on("sticky_kit:bottom",function(e){$(this).parent().css("position","static")}).on("sticky_kit:unbottom",function(e){$(this).parent().css("position","relative")})})}}}]),e.register.directive("scrollUp",["$rootScope","$window","$timeout","$document",function(e,a,t,i){return{restrict:"AE",scope:{},template:'<div ng-show="scrollTopBtnShow">          <a class="scrollTopBtn" ng-click="scrollToTop()" >              <i class="mm mm-chevron-up"></i>           </a> </div>',link:function(e,o,n){e.scrollTopBtnShow=!1;o[0],angular.element(i)[0].body;e.scrollToTop=function(){e.scrollTopBtnShow=!1,a.scrollTo(0,0)};var s=!1;e.debounchFunction=function(){s||(s=!0,t(function(){s=!1,a.pageYOffset>300?e.scrollTopBtnShow=!0:e.scrollTopBtnShow=!1},100,!0))},i.bind("scroll",e.debounchFunction)}}}]),e.register.directive("dentalOfferedPackage",["$rootScope","$compile","$timeout","$stateParams","authService","apiProvider","$sce",function(e,a,t,i,o,n,s){return{restrict:"AE",scope:{ctrlData:"=bind"},template:'<div ng-if="tempCtrlData.length &gt; 0" ng-repeat="dc in tempCtrlData track by dc.packageId" class="result-box healthchecks">              <div class="row box">                <div class="col-xs-6 provider">                  <div class="logo">                    <div class="noLogo bg1">{{:: dc.dcName.charAt(0)}}</div>                  </div>                  <div class="disc"><a ng-click="fetchDetails(dc)" class="product-name">{{:: dc.packageName}}</a>                    <p>by&nbsp;<b>{{:: dc.dcName}}</b></p>                    <p ng-hide="dc.homeSampleCollection" class="product-location"><i class="mm mm-map-marker"></i>{{:: dc.dcLocation}}</p>                    <p class="loaction">                        <span class="product-location" ng-hide="dc.homeSampleCollection"><i class="mm mm-map-marker"></i>{{:: dc.dcLocation}}</span>                        <span class="hsc" ng-show="dc.homeSampleCollection" title="A trained technician will visit your home to collect the samples"><i class="mm mm-sample"></i>&nbsp;Home Sample Collection</span>                    </p>                  </div>                </div>                <div class="col-xs-3 p-l-0 p-r-0 extra text-center">                    <div ng-class="{\'col-xs-9 p-l-0 p-r-0\':isMobileView}">                        <p class="availTiming"><i class="mm mm-clock"></i>{{:: dc.slotStartTime}} - {{:: dc.slotEndTime}}</p>                        <div ng-click="fetchDetails(dc)" class="btn-group btn-product-details">                            <div style="float:left">{{:: dc.packageTestCount}}<span>Tests</span></div>                            <div style="float:right"><b ng-if="dc.packageConsultationCount &gt; 0">{{:: dc.packageConsultationCount}}</b><span ng-if="dc.packageConsultationCount === 0">No</span><span> Consult(s)</span></div>                            <div class="details">Details<i class="mm mm-chevron-down"></i></div>                    </div>                    <div class="col-xs-3 p-l-0 p-r-0 text-right" ng-if="isMobileView">                        <div class="m-b-5 price" ng-if="dc.price >0"><b>&#x20B9;&nbsp;{{dc.price}}</b></div>                        <div class="m-b-5 price" ng-if="dc.priceRange > dc.price"><i class="mm mm-rupee"></i><strike>{{:: dc.priceRange}}</strike></div>                        <div class="discount" ng-if="dc.priceRange > dc.price">{{dc.discountPercent}}% OFF</div>                    </div>                </div>                </div>                <div class="col-xs-3 book">                    <div ng-if="!isMobileView">                        <div class="clearfix">                            <span class="discount"><span ng-if="(dc.priceRange &gt; dc.price)">{{dc.discountPercent}}% Off</span></span>                            <div class="price pull-right"><b>&#x20B9;&nbsp;{{:: dc.price}}</b></div>                        </div>                        <div ng-if="(dc.priceRange &gt; dc.price)" class="pull-right strike"><i class="mm-rupee"></i>                            <strike>{{:: dc.priceRange}}</strike>                            </div>                    </div>                  <a ng-click="bookSlotAfterValidation(dc)" class="btn btn-primary btn-booking"> Book Now<i class="mm mm-female" ng-if="dc.genderType == \'F\'"></i> <i class="mm mm-male" ng-if="dc.genderType == \'M\'"></i></a>                </div>              </div>              <div ng-show="(detailsClicked &amp;&amp; dc.dcId === clickDCId &amp;&amp; dc.packageId === clickPackageId)" class="detailswraper"><a ng-click="fetchDetails(dc)" class="closeBtn"><i class="mm mm-close"></i></a>                <div ng-if="dc.homeSampleCollection" style="width: 250px; margin-top: 6px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-right"><i style="width:30px; height:30px;" class="img-icon icon-hsc pull-left"></i>Home Sample Collection Available</div>                <uib-tabset>                  <uib-tab index="0" heading="Description">                    <div class="row">                      <div class="col-sm-5 tests">                        <ul>                          <li tooltip-placement="top" uib-tooltip="{{consultationInnerTest}}"><b>Consultation(s)<span ng-if="dc.packageConsultationCount &gt; 0">{{dc.packageConsultationCount}}</span><span ng-if="dc.packageConsultationCount === 0">_</span></b></li>                        </ul>                        <ul>                          <li><b>Tests<span>{{nonConsultationTestCount}}</span></b></li>                          <li ng-repeat="test in nonConsultationTest" tooltip-placement="top" tooltip-class="tt-test" uib-tooltip-template= "\'myTooltip.html\'" class="smTxt">{{test.name}}<span>{{test.count}}</span></li>                          <script type="text/ng-template" id="myTooltip.html">                            <ol class="test-list">                              <li ng-repeat="testinner in test.innerTests"> {{testinner}} </li>                            </ol>                          </script>                        </ul>                      </div>                      <div class="col-sm-7">                        <div class="clearfix">                          <div style="margin-right: 5px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left">                            Age Range:                            &nbsp;<span ng-if="dc.minAge &lt; 60">{{dc.minAge}} - {{dc.maxAge}}</span><span ng-if="dc.minAge &gt; 59">{{dc.minAge}} +</span>                          </div>                          <div style="line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left"><span ng-if="dc.genderType == \'F\'">Female Specific Package</span><span ng-if="dc.genderType == \'M\'">Male Specific Package</span></div>                        </div>                        <div ng-bind-html="packageDescription" class="smTxt"></div>                      </div>                    </div>                  </uib-tab>                  <uib-tab index="1" heading="Instructions" ng-if="packageInstructions">                    <div ng-bind-html="packageInstructions" line-height:14px;="line-height:14px;" class="smTxt"></div>                  </uib-tab>                </uib-tabset>              </div>              <div ng-if="(bookClicked &amp;&amp; dc.dcId === clickDCId &amp;&amp; dc.packageId === clickPackageId)" class="detailswraper bookwraper"><a ng-click="bookSlotAfterValidation(dc)" class="closeBtn"><i class="mm mm-close"></i></a>                <div style="padding:10px 0" class="appointment-details">                  <medi-book-slot obj="dc" errormessage="errorMessage"></medi-book-slot>                </div>              </div>            </div>',link:function(e,a,t){e.bookSlotAfterValidation=function(a){e.detailsClicked=!1,e.bookClicked=!e.bookClicked,e.clickDCId=a.dcId,e.clickPackageId=a.packageId,e.bookClicked?(window._Site_Props.__setPackageDetails({packageName:a.packageName,providerName:a.dcName,providerLocation:a.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Request Slot",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Dental","RequestSlot",a.packageName+" by "+a.dcName)})})):window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Slot Selection Cancelled",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Dental","SlotSelectionCancelled",a.packageName+" by "+a.dcName)})})},e.fetchDetails=function(a){if(e.bookClicked=!1,e.detailsClicked=!e.detailsClicked,e.clickDCId=a.dcId,e.clickPackageId=a.packageId,e.detailsClicked){var t="/showDcDetails"+a.packageId+"/"+a.packageName;window._Site_Props.__setPackageDetails({packageName:a.packageName,providerName:a.dcName,providerLocation:a.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"show Dc Detail",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Dental","showDcDetail",a.packageName+" by "+a.dcName)})});(new Date).getTime();t=n.apiUrl+"/PackageDetails/"+a.packageId,e.consultationTest=[],e.consultationTestCount=0,e.nonConsultationTest=[],e.nonConsultationTestCount=0,o.makeAjaxCalls(t,"","GET").then(function(a){a.data.packageDetail&&(e.packageDetail=a.data.packageDetail,_.each(e.packageDetail.packageTests.testGroups,function(a,t){var i;"Consultation"===a.name?(i="",_.each(a.tests,function(e,a){i+=e.name+", "}),e.consultationInnerTest=i.slice(0,i.length-2),e.consultationTest.push(a),e.consultationTestCount+=a.count):(i=[],_.each(a.tests,function(e,a){i.push(e.name)}),a.innerTests=i,e.nonConsultationTest.push(a),e.nonConsultationTestCount+=a.count)}),e.packageDescription=s.trustAsHtml(e.packageDetail.description),e.packageInstructions=s.trustAsHtml(e.packageDetail.instruction))})}},e.offeredPackageId=["5c61e9d09fac48c59283e5232456a00b","fe6864995a5b43afb4e30b15881fdd72","c64c428211f4416e977b8b240077c346","fcd503088dbc4ceeb3058bcbaed27f26","11af8f74b273438d978b31a1dbeabf38","a43ba83f3f6249f092a99caa97a6913a","427f742a0c8c449c8a2cd7157556513c","fcbd55b850ae44dbb3cc2aa198790556","88bcd06622ba4c3d97f899d06d1851fd","56672801f7a54a2b946e4214e577755e","4cbf8ba66a894429a17c33529086d0bd","35478d9f2fd54caeaf665862701f3fa2","966a6a02ff6a444db618698785530442","1ad7ba65d44a49e8b57c7d013f0eae08","398f25a26601420aaeb538927bda62fd","7df5aa2925d646f9933204b926717b76","e0f776c2aee04739a61b669568b8af5e","0605161adb314bb0bb67724d1ac64fcd","41fe385218b74c7b931c0f90ab2b42e3","4087675642344c82adc7dce053a7843d","68516193850c46c882b831aec6327975","4adfdf94520b44ff8ccb398ad7df2715","b8356371feac4d518fd5842683b4b81d","3fbd6450b0f8495e9204da3ce9978788","78e86a92f4874085a506a30b5111a18a","efb46a4b12224ae5a7a00ff8ad61f7c8","edb95cd759c74b659410f5a50d4da181","962ee811547743af84a39b4fdc12ea0e","c69c608bb27f47849bb580b204d10a72","0aacf18415004c1eae5bfa5493d73f54","e7cd88c45e5a465881b2bc7b7afc51c3","dd2c7863dc93454ca58e297909c96e2c","8cef315e269c4b328f01353c60601832","b3d06b7d73324144bc080db2a19289c0","49995e3ff5d141f286bcdf43f0665336","a9a6c9b2d2d54f75abe06e8e1c944505"],e.differenceCtrlData=[],e.$watch("ctrlData",function(a){a&&a&&a&&a.length!==e.differenceCtrlData.length&&(e.tempCtrlData=[],_.each(e.ctrlData,function(a,t){e.offeredPackageId.indexOf(a.packageId)>=0&&(e.tempCtrlData.push(a),e.differenceCtrlData=_.difference(e.ctrlData,e.tempCtrlData),e.ctrlData=e.differenceCtrlData)}))})}}}]),e.register.directive("sponserPackageDental",["$rootScope","$compile","$timeout","$stateParams","authService","apiProvider","$sce","navConstantsSvc",function(e,a,t,i,o,n,s,r){return{restrict:"AE",scope:{ctrlData:"=bind"},template:'<div ng-show="allAhcPackageList.length>0">                  <div  ng-repeat="data in allAhcPackageList |ageRange: ageRangeValue.minAge :ageRangeValue.maxAge : ageRangeValue.isTrue |gender: genderFilter track by $index">                  <div class="result-box corp">                    <div class="row box">                      <div class="col-xs-6 provider">                        <div class="disc"><a ng-click="fetchDetails(data.provider)" class="product-name">{{data.provider.packageName}}</a>                          <p>by<b>{{data.sponserTempPackageDetails.length}} Providers</b><span class="product-location"><i class="mm mm-map-marker"></i>{{cityName}}</span></p>                        </div>                      </div>                      <div class="col-xs-3 p-l-0 p-r-0 extra text-center">                        <div class="btn-group btn-product-details" ng-click="fetchDetails(data.provider)">                          <div style="float:left">{{data.provider.packageTestCount}}<span>Tests</span></div>                          <div style="float:right"><span>{{data.provider.packageConsultationCount}}</span><span> Consult(s)</span></div>                          <div class="details">Details<i class="mm mm-chevron-down"></i></div>                        </div>                      </div>                      <div class="col-xs-3 book">        \t\t\t\t<div class="price pull-right">        \t\t\t\t\t<span ng-if="data.priceStartFrom > 0"> <span ng-if="data.totalDifferedPrice > 1" style="color: #666;font-size: 12px;">Start From </span> <i class="mm mm-rupee"></i> {{data.priceStartFrom}}</span>        \t\t\t\t</div>                        <div class="clearfix">                          <div class="label-corpSponcered" ng-if="data.priceStartFrom > 1">Corporate Specific</div>        \t\t\t\t  <div class="label-corpSpecific" ng-if="data.priceStartFrom == 0">Corporate Sponsored</div>                        </div>                        <a ng-show="data.provider.packageId !== showHideSponserPackageListPackageId" ng-click="showHideSponserPackageFunc(data)" class="btn btn-primary btn-booking">Show Providers</a>                        <a ng-show="showHideSponserPackage && data.provider.packageId === showHideSponserPackageListPackageId" ng-click="hideSponserPackageFunc(data)"  class="btn btn-primary btn-booking">Hide Providers</a>                      </div>                    </div>                    <div ng-show="(detailsClicked &amp;&amp; data.provider.packageId === clickPackageId)" class="detailswraper"><a ng-click="closeDetails()" class="closeBtn"><i class="mm mm-close"></i></a>                      <div ng-if="data.homeSampleCollection" style="width: 250px; margin-top: 6px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-right hscAwail"><i style="width:30px; height:30px;" class="img-icon icon-hsc pull-left"></i>Home Sample Collection Available</div>                      <uib-tabset>                        <uib-tab index="0" heading="Description">                          <div class="row">                            <div class="col-sm-5 tests">                              <ul>                                <li tooltip-placement="top" uib-tooltip="{{consultationInnerTest}}"><b>Consultation(s)<span ng-if="dc.packageConsultationCount &gt; 0">{{dc.packageConsultationCount}}</span><span ng-if="dc.packageConsultationCount === 0">_</span></b></li>                              </ul>                              <ul>                                <li><b>Tests<span>{{nonConsultationTestCount}}</span></b></li>                                <li ng-repeat="test in nonConsultationTest" tooltip-placement="top" tooltip-class="tt-test" uib-tooltip-template= "\'myTooltip.html\'" class="smTxt">{{test.name}}<span>{{test.count}}</span></li>                                <script type="text/ng-template" id="myTooltip.html">                                  <ol class="test-list">                                    <li ng-repeat="testinner in test.innerTests"> {{testinner}} </li>                                  </ol>                                </script>                              </ul>                            </div>                            <div class="col-sm-7">                              <div style="padding:10px 0" class="clearfix">                                <div ng-if="data.minAge || data.maxAge" style="margin-right: 5px; line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left">                                  Age Range:                                  &nbsp;<span ng-if="data.minAge &lt; 60">{{data.minAge}} - {{data.maxAge}}</span><span ng-if="data.minAge &gt; 59">{{data.minAge}} +</span>                                </div>                                <div style="line-height: 33px; font-size: 12px; background: #ffea7f; padding: 0 10px;  border-radius: 2px;" class="pull-left"><span ng-if="data.genderType === \'F\'"> Female Specific Package </span> </div>                              </div>                              <div ng-bind-html="packageDescription" class="smTxt"></div>                            </div>                          </div>                        </uib-tab>                        <uib-tab index="1" ng-if="packageInstructions" heading="Instructions">                          <div ng-bind-html="packageInstructions" line-height:14px;="line-height:14px;" class="smTxt"></div>                        </uib-tab>                      </uib-tabset>                    </div>                  </div>                  <div ng-repeat="dc in showHideSponserPackageList track by $index" ng-if="showHideSponserPackage && data.provider.packageId === showHideSponserPackageListPackageId" class="result-box corp-list">                    <div class="row box">                      <div class="col-xs-6 provider">                        <div class="logo">                          <div class="noLogo bg1">T</div>                        </div>                        <div class="disc"><a ng-click="fetchDetails(dc)" class="product-name">{{:: dc.dcName}}.</a>                          <p class="product-location"><i class="mm mm-map-marker"></i>{{:: dc.dcLocation}}</p>                          <p class="availTiming"><i class="mm mm-clock"></i>{{dc.slotStartTime}} - {{dc.slotEndTime}}</p>                        </div>                      </div>                      <div class="col-xs-3 p-l-0 p-r-0 extra text-center"></div>                      <div class="col-xs-3 book">                        <div ng-if="dc.price > 0" class="clearfix price">                          Rs. {{dc.price}}                        </div>                        <div ng-if="dc.price === 0 && !isMobileView" class="clearfix">                          <div class="label-corpSponcered" > Sponsored </div>                        </div>                        <a class="btn btn-primary btn-booking" ng-click="bookSlotAfterValidation(dc)" >Book Now</a>                      </div>                  </div>                  <div ng-if="(bookClicked &amp;&amp; dc.dcId === clickDCId &amp;&amp; dc.packageId === clickPackageId)" class="detailswraper bookwraper">                    <a ng-click="closeDetails(dc)" class="closeBtn"><i class="mm mm-close"></i></a>                    <div style="padding:10px 0" class="appointment-details">                      <medi-book-slot obj="dc" errormessage="scope.errorMessage"></medi-book-slot>                    </div>                    </div>                  </div>                  </div>                  </div>',
link:function(a,t,i){a.detailsClicked=!1,a.ageRangeValue={maxAge:100,minAge:0,isTrue:!1},a.genderFilter={type:"both",isTrue:!1},a.closeDetails=function(){a.clickPackageId=""},a.fetchDetails=function(e){if(a.bookClicked=!1,a.detailsClicked=!0,a.clickPackageId=e.packageId,a.detailsClicked){var t="/showDcDetails"+e.packageId+"/"+e.packageName;window._Site_Props.__setPackageDetails({packageName:e.packageName,providerName:e.dcName,providerLocation:e.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"show Dc Detail",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Dental","showDcDetail",e.packageName+" by "+e.dcName)})});(new Date).getTime();t=n.apiUrl+"/PackageDetails/"+e.packageId,a.consultationTest=[],a.consultationTestCount=0,a.nonConsultationTest=[],a.nonConsultationTestCount=0,o.makeAjaxCalls(t,"","GET").then(function(e){e.data.packageDetail&&(a.packageDetail=e.data.packageDetail,a.packageDetail.packageTests&&_.each(a.packageDetail.packageTests.testGroups,function(e,t){var i="";"Consultation"===e.name?(i="",_.each(e.tests,function(e,a){i+=e.name+", "}),a.consultationInnerTest=i.slice(0,i.length-2),a.consultationTest.push(e),a.consultationTestCount+=e.count):(i=[],_.each(e.tests,function(e,a){i.push(e.name)}),e.innerTests=i,a.nonConsultationTest.push(e),a.nonConsultationTestCount+=e.count)}),a.packageDescription=s.trustAsHtml(a.packageDetail.description),a.packageInstructions=s.trustAsHtml(a.packageDetail.instruction))})}},a.hideSponserPackageFunc=function(){a.showHideSponserPackage=!1,a.showHideSponserPackageListPackageId=""},a.showHideSponserPackageFunc=function(e){a.showHideSponserPackage=!0,a.showHideSponserPackage?(a.showHideSponserPackageList=e.sponserTempPackageDetails,a.showHideSponserPackageListPackageId=e.provider.packageId):a.showHideSponserPackageListPackageId=""},a.returnTime=function(e){var a=o.getTimeFormate(e);return a},a.$on("changeCity",function(e,t){a.getAhcPackage()});var r=e.$on("userDetails",function(e,t){a.getAhcPackage()}),l=(e.$on("userLogout",function(e,t){a.allAhcPackageList=[]}),e.$on("filterAHCAgeItems",function(e,t){a.ageRangeValue=t}),e.$on("filterAHCGenderItems",function(e,t){a.genderFilter=t}),e.$on("filterAHCItems",function(e,t){a.allAhcPackageList=angular.copy(a.tempallAhcPackageList),t.Provider.length>0&&t.Location.length>0?(a.allAhcPackageList=a.filterByProvider(a.allAhcPackageList,t.Provider),a.allAhcPackageList=a.filterByLocation(a.allAhcPackageList,t.Location,!0)):t.Provider.length>0?a.allAhcPackageList=a.filterByProvider(a.allAhcPackageList,t.Provider):t.Location.length>0&&(a.allAhcPackageList=a.filterByLocation(a.allAhcPackageList,t.Location,!1))}));a.filterByProvider=function(e,a){return _.each(e,function(t,i){t.sponserTempPackageDetails=[],_.each(t.sponserPackageDetails,function(e,i){_.each(a,function(a,i){e.dcName.toLowerCase().indexOf(a.dcName.toLowerCase())>=0&&t.sponserTempPackageDetails.push(e)})}),0===t.sponserTempPackageDetails.length&&(e=_.difference(e,t))}),e},a.filterByLocation=function(e,a,t){return t?_.each(e,function(t,i){_.each(t.sponserTempPackageDetails,function(e,i){var o=!1;_.each(a,function(a,t){e.dcLocation.toLowerCase()===a.dcLocation.toLowerCase()&&(o=!0)}),o||(t.sponserTempPackageDetails=_.difference(t.sponserTempPackageDetails,e))}),0===t.sponserTempPackageDetails.length&&(e=_.difference(e,t))}):_.each(e,function(t,i){t.sponserTempPackageDetails=[],_.each(t.sponserPackageDetails,function(e,i){_.each(a,function(a,i){e.dcLocation.toLowerCase()===a.dcLocation.toLowerCase()&&t.sponserTempPackageDetails.push(e)})}),0===t.sponserTempPackageDetails.length&&(e=_.difference(e,t))}),e},a.getAhcPackage=function(){a.allAhcPackageList=[];var e=n.apiUrl+"/categoryitemtypesearch.json";a.user=o.isUserSignedin(),a.cityName=o.getCity(),o.makeAjaxCalls(e,{categoryItemTypeId:"77b6448303f94721b52e16dd55878326",keyword:"DENTALPACKAGE"},"POST",a.user.token,a.cityName).then(function(e){a.allAhcPackageList=[],e.data.categoryItemTypeResponse&&e.data.categoryItemTypeResponse.length>0&&_.each(e.data.categoryItemTypeResponse,function(e,t){e.packageFilters&&e.packageFilters.length>0&&_.forEach(e.packageFilters,function(a,t){var i=a;if("gender"===i.substring(0,6).toLowerCase()){var o=i.split(":")[1];e.genderType=o}else if("maxage"===i.substring(0,6).toLowerCase()){var n=i.split(":")[1];e.maxAge=parseInt(n)}else if("minage"===i.substring(0,6).toLowerCase()){var s=i.split(":")[1];e.minAge=parseInt(s),e.minAge>59&&(e.maxAge=60)}else"homesamplecollection"===i.substring(0,20).toLowerCase()?e.homeSampleCollection=i.split(":")[1]?i.split(":")[1].toLowerCase():i.split(":")[1]:(e.genderType||(e.genderType="both"),e.minAge=e.minAge>0?e.minAge:0,e.maxAge=e.maxAge>0?e.maxAge:59)}),a.tempAchPackage={},a.tempAchPackage.priceObj={},a.tempAchPackage.provider=e,a.tempAchPackage.genderType=e.genderType,a.tempAchPackage.minAge=e.minAge,a.tempAchPackage.maxAge=e.maxAge,a.tempAchPackage.sponserPackageDetails=e.providers,a.tempAchPackage.sponserTempPackageDetails=a.tempAchPackage.sponserPackageDetails,_.each(a.tempAchPackage.sponserPackageDetails,function(t,i){_.isEmpty(e.availableSlots)||_.isEmpty(e.availableSlots[0].slots)||(a.tempAchPackage.priceObj[t.price]=0,t.slotStartTime=a.returnTime(e.availableSlots[0].slots[0].slotStartTime),t.slotEndTime=a.returnTime(e.availableSlots[0].slots[0].slotEndTime)),t.genderType=e.genderType,t.minAge=e.minAge,t.maxAge=e.maxAge,t.packageId=e.packageId,t.availableSlots=e.availableSlots,t.packageName=e.packageName,t.isSponser=!0});var i=Object.keys(a.tempAchPackage.priceObj);i.length>1?(a.tempAchPackage.priceStartFrom=_.first(i.sort()),a.tempAchPackage.totalDifferedPrice=i.length):1===i.length?(a.tempAchPackage.priceStartFrom=_.first(i.sort()),a.tempAchPackage.totalDifferedPrice=i.length):(a.tempAchPackage.priceStartFrom=_.first(i.sort()),a.tempAchPackage.totalDifferedPrice=i.length),delete a.tempAchPackage.priceObj,a.allAhcPackageList.push(a.tempAchPackage),a.tempallAhcPackageList=a.allAhcPackageList})})},a.bookSlotAfterValidation=function(e){a.detailsClicked=!1,a.bookClicked=!0,a.clickDCId=e.dcId,a.clickPackageId=e.packageId,a.bookClicked?(window._Site_Props.__setPackageDetails({packageName:e.packageName,providerName:e.dcName,providerLocation:e.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Request Slot",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Dental","RequestSlot",e.packageName+" by "+e.dcName)})})):window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Slot Selection Cancelled",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Dental","SlotSelectionCancelled",e.packageName+" by "+e.dcName)})})},e.$on("$destroy",function(){l(),r()}),a.getAhcPackage(),a.$watchGroup(["sponserPackageDetails"],function(e){a.tempCtrlData=[],e&&e&&(a.tempCtrlData=a.ctrlData,a.sponserPackageDetails&&a.sponserPackageDetails.length>0&&(a.tempCtrlData=_.union(a.tempCtrlData,a.sponserPackageDetails),_.isEmpty(_.difference(a.tempCtrlData,e))||(a.ctrlData=a.tempCtrlData)))})}}}]),e.register.directive("blogContent",["authService",function(e){return{restrict:"E",replace:!0,scope:{pageName:"=?",tabName:"=?"},template:'<div class="discover" ng-class="{\'m-0\':pageName===\'offers\'}" ng-hide="!links.length"><h3 ng-class="{\'text-center m-b-10\':pageName===\'offers\'}">Discover More</h3><div class="row"><div class="col-xs-6 col-md-4 bx" ng-repeat="link in links track by $index"><a href="{{link.blogLink}}" target="_blank"><img src="{{link.image}}" alt=""/>{{link.blogTitle}}</a></div></div></div>',link:function(e,a,t){requirejs(["blogContents"],function(a){e.links=_.property("links")(_.findWhere(a,{pageName:e.pageName})),e.tabName&&(e.links=_.property("links")(_.findWhere(e.links,{tabName:e.tabName})))})}}}]),e.register.directive("ahcBanner",["authService","navConstantsSvc","notify",function(e,a,t){return{restrict:"E",replace:!0,scope:{isMobileView:"=?",openDefault:"=opendefault"},template:'                        <div>                            <div ng-if="isCognizantUser">                                <div class="row p-t-10 p-b-10 m-b-10 m-t-10 br-20 mandatory-border" style="background: linear-gradient(0deg, #FFDFE0 0%, #FFF5F5 100%);" >                                    <div class="p-l-30 col-md-8" ng-if="!isMobileView" style="background-img: url()">                                        <span class="lgTxt bold"> Refer your friend and get 100 Buddy coins each! </span>                                        <p class="smdTxt1"> Share the code with your friend and get the 100 Buddy coins on their first annual health checkup <a ng-click=ahcBannerOnClick("ahcReferralBanner_KnowMore") ui-sref="app.ahcReferral"><b>Know more &gt;</b></a></p>                                    </div >                                    <div class="col-md-2 m-t-5" ng-if="!isMobileView" style="width:300px;">                                        <span class="col-md-2 m-t-5" ng-if="!isMobileView" style="width:200px;">                                            <span>                                                <span style="box-shadow: 0 0 15px rgb(24 24 24 / 16%);">                                                    <span ng-click="copyToClipboard()" class="br-10 white-bg smdTxt bold p-t-10 p-b-10">                                                        <span class="p-l-5" >{{referralCode1}}</span>                                                        <span class="vl" style="height:100%; border-left: #E0E0E0;  width: 1px; position: absolute;  margin-left: -1px;"></span>                                                        <span > <img src="assets/icons/ahc/copy-blue.svg" height="40px" width=auto; "/> </span>                                                    </span>                                                </span>                                            </span>                                        </span>                                        <span class="col-md-2 m-t-10" ng-if="!isMobileView" style="margin-left:-20px">                                            <span class="share share-ahc hideSm cursor-pointer" style="">                                                <span class="openDefault? \'share-open-default\' : \'\'">                                                    <div class="icon-ahc share-icon-button" style="margin-bottom=40px; padding:0 0 0 0;"><img src="assets/icons/ahc/share.svg" height="35px" alt=""  /></div>                                                        <span class="group" style="width:100px;">                                                            <span class="p-l-4 p-r-4" ng-if="!fbNotEnabled"><img src="assets/icons/facebook.svg" ng-click="facebookShare()" alt="" height="30px" /> </span>                                                            <span class="p-l-4 p-r-4" > <img src="assets/icons/telegram.svg" ng-click="telegramShare()" alt="" height="30px" /> </span>                                                            <span class="p-l-4 p-r-4" > <img src="assets/icons/whatsapp.svg" ng-click="whatsappShare()" alt="" height="30px" /> </span>                                                        </span>                                                </span>                                            </span>                                        </span>                                    </div>                                    <div class="p-l-10 p-r-10" ng-if="isMobileView">                                        <span class="smTxt bold"> Refer your friend and get 100 Buddy coins each! </span>                                        <p class="xsmTxt"> Share the code with your friend and get the 100 Buddy coins on their first annual health checkup <a ng-click=ahcBannerOnClick("ahcReferralBanner_KnowMore") ui-sref="app.ahcReferral"><b>Know more &gt;</b></a></p>                                    </div>                                    <div class="col-md-2" ng-if="isMobileView">                                        <span>                                            <span class="">                                                <span ng-click="copyToClipboard()" class="br-10 white-bg smdTxt3 bold p-t-5 p-b-5">                                                    <span class="p-l-5" >{{referralCode1}}</span>                                                    <span class="vl" style="height:100%; border-left: #E0E0E0;  width: 1px; position: absolute;  margin-left: -1px;"></span>                                                    <span > <img src="assets/icons/ahc/copy-blue.svg" height="30px" width=auto; "/> </span>                                                </span>                                            </span>                                        </span>                                        <span class="p-l-10 xsmTxt" >or share via</span>                                        <span class="p-l-10" ng-if="!fbNotEnabled"><img src="assets/icons/facebook.svg" ng-click="facebookShare()" alt="" height="30px" /> </span>                                        <span class="p-l-10" > <img src="assets/icons/telegram.svg" ng-click="telegramShare()" alt="" height="30px" /> </span>                                        <span class="p-l-10" > <img src="assets/icons/whatsapp.svg" ng-click="whatsappShare()" alt="" height="30px" /> </span>                                    </div>                                </div>                        </div>                    </div>                ',link:function(i,o,n){if(i.user=e.getUserObj(),i.isCognizantUser=!_.isEmpty(i.user)&&i.user.userDetails&&i.user.userDetails.pmEntityID&&a.cognizantEntityIds.includes(i.user.userDetails.pmEntityID),i.user&&i.user.encryptedToken&&i.isCognizantUser){var s={authority:"authgateway.docsapp.in",accept:"application/json, text/plain, */*","content-type":"application/json",mbservertoken:i.user.encryptedToken};e.makeAjaxCalls("https://authgateway.docsapp.in/reward/referral/generateCoupon",{key:"referralAHC"},"POST",i.user.token,"",!0,s).then(function(e){e.data.success&&(i.referralCode1=e.data.code,i.referralText1=e.data.text,i.referralInvite1=e.data.text+" Referral Code: -  "+e.data.code,i.referralUrl1="https://www.medibuddy.in/refer/AHC")})}i.ahcBannerOnClick=function(e){window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:e,name:e})},i.whatsappShare=function(){i.ahcBannerOnClick("achReferralBanner_WhatsAppShare_"+i.referralCode1);var e=i.referralInvite1+i.referralUrl1,a="https://api.whatsapp.com/send?text="+encodeURIComponent(e);window.open(a)},i.facebookShare=function(){i.ahcBannerOnClick("achReferralBanner_FBShare_"+i.referralCode1);var e="http://www.facebook.com/sharer.php?u="+encodeURIComponent(i.referralUrl1)+"&t="+encodeURIComponent(i.referralInvite1);window.open(e)},i.telegramShare=function(){i.ahcBannerOnClick("achReferralBanner_TelegramShare_"+i.referralCode1);var e="https://t.me/share/url?url="+encodeURIComponent(i.referralUrl1)+"&text="+encodeURIComponent(i.referralInvite1);window.open(e)},i.copyToClipboard=function(){i.ahcBannerOnClick("achReferralBanner_CopyToClipBoard_"+i.referralCode1);var e=document.createElement("textarea"),a=i.referralInvite1+"\n"+i.referralUrl1;e.value=a,e.setAttribute("readonly",""),e.style.position="absolute",e.style.left="-9999px",document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),t({message:"Copied to clipboard",position:"center",duration:2e3})},i.mailShare=function(){var e="mailto:?Subject=",a=encodeURI("Get amazing rewards | Avail Annual Health Checkup now on MediBuddy"),t=encodeURIComponent(i.referralUrl1)+"\n"+encodeURIComponent(i.referralInvite1);e+=a+"&Body="+t,window.open(e)}}}}]),e.register.directive("limitTo",[function(){return{restrict:"A",link:function(e,a,t){var i=parseInt(t.limitTo),o=/Backspace|Enter/;angular.element(a).on("keydown",function(e){o.test(event.key)||this.value.length==i&&e.preventDefault()})}}}]),e.register.directive("hcDescription",["$rootScope","apiProvider","authService","corpWellnessService","$sce","navConstantsSvc",function(e,a,t,i,o,n){return{restrict:"E",scope:{packageDetail:"=",ahc:"="},templateUrl:"/templates/hcDescription.html?"+timeStamp,link:function(a,t,s){function r(e){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"show Dc Detail",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("AHC","showDcDetail",e.packageName+" by "+e.dcName)})}),a.packageDetail.descLoaded||i.getPackageDetail(e.packageId,a.ahc).then(function(e){e.packageDetail&&(a.packageDetail.consultationTest=[],a.packageDetail.nonConsultationTest=[],a.packageDetail=_.extend(a.packageDetail,_.omit(e.packageDetail,"name","id")),a.packageDetail.descLoaded=!0,a.packageDetail.packageTests&&_.each(a.packageDetail.packageTests.testGroups,function(e,t){var i="";"Consultation"===e.name?(_.each(e.tests,function(e,a){i+=e.name+", "}),a.packageDetail.consultationInnerTest=i.slice(0,i.length-2),a.packageDetail.consultationTest.push(e)):(_.each(e.tests,function(e,a){i+=e.name+", "}),e.innerTests=i.slice(0,i.length-2).split(","),a.packageDetail.nonConsultationTest.push(e),a.packageDetail.nonConsultationTestCount+=e.count)}),a.packageDescription=o.trustAsHtml(a.packageDetail.description),a.packageInstructions=o.trustAsHtml(a.packageDetail.instruction))})}a.isMobileView=e.isMobileView,window._Site_Props.__setPackageDetails({packageName:a.packageDetail.packageName,providerName:a.packageDetail.dcName,providerLocation:a.packageDetail.dcLocation}),a.ahc&&(a.ahcInstructions=n.ahcInstructions),r(a.packageDetail),a.hideForm=function(){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Hide Dc Detail",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("AHC","showDcDetail",a.packageDetail.packageName+" by "+a.packageDetail.dcName)})}),a.packageDetail.showDetails=!1};var l=a.$on("clearForm",function(){a.hideForm()});a.$on("$destroy",function(){l()})}}}]),e.register.directive("labsFileUpload",["$rootScope","Upload","$timeout","authService","apiProvider","$window","$http","patternService","notify","corpLabsService","navConstantsSvc",function(e,a,t,i,o,n,s,r,l,c,d){return{restrict:"AE",scope:{isCorpLabs:"=?",isCart:"=?"},templateUrl:"/templates/labsFileUploadTemplate.html?"+timeStamp,link:function(e,n,s){e.step=1,e.phoneNumber="",e.totalFiles=[],e.updatedFiles={},e.patternCheck=r;var p="";e.closePopUp=function(){e.$parent&&e.$parent.$parent&&e.$parent.$parent.$dismiss&&e.$parent.$parent.$dismiss("cancel")},e.validate=function(a,t){var i=new RegExp(e.patternCheck.getRegexExpression(t)),o=String.fromCharCode(a.charCode?a.charCode:a.which);if(!i.test(o)&&13!==a.charCode&&9!==a.charCode)return a.preventDefault(),!1},e.updatePhone=function(a){e.phoneNumber=a},e.uploadRxIfSignedInUser=function(){try{if(e.isCorpLabs?c.sendEvents("Upload Click",{fileType:p}):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Click",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})}),e.isCart)return e.step=4,void e.$emit("prescriptionUpload",e.files[e.files.length-1]);var a=i.isUserSignedin();if(!a)return void(e.step=2);var t=o.apiUrl+"/Labs/UploadRx.json",n={PrescriptionId:e.files[0].result.fileUploadedList[0]};i.makeAjaxCalls(t,n,"POST",a.token).then(function(a){a.data.isSuccess?(e.step=4,e.isCorpLabs?c.sendEvents("Upload Success",{fileType:p}):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Success",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})})):(e.step=5,e.isCorpLabs?c.sendEvents("Upload Failed"):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Failed",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})}))})}catch(s){e.step=5,l({message:"There is some challenge uploading the prescription, please try again later",position:"center",duration:5e3}),e.isCorpLabs?c.sendEvents("Upload Failed"):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Failed",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})})}},e.uploadRxWithPhoneNumber=function(){try{e.isCorpLabs?c.sendEvents("Enter User Details Submit"):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Enter User Details Submit",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})});var a=o.apiUrl+"/Labs/UploadRx.json",t={PrescriptionId:e.files[0].result.fileUploadedList[0],PhoneNumber:e.phoneNumber};i.makeAjaxCalls(a,t,"POST").then(function(a){a.data.isSuccess?(e.step=3,e.isCorpLabs?c.sendEvents("Enter Success"):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Success",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})})):(e.step=5,l({message:"There is some challenge uploading the prescription, please try again later",position:"center",duration:5e3}),e.isCorpLabs?c.sendEvents("Upload Failed"):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Failed",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})}))})}catch(n){e.step=5,e.isCorpLabs?c.sendEvents("Upload Failed"):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Failed",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})})}},e.uploadFiles=function(o,n){if(o){String.prototype.includes||(String.prototype.includes=function(){return String.prototype.indexOf.apply(this,arguments)!==-1});for(var s=0;s<o.length;s++)if(o[s].name.indexOf("exe")>-1||o[s].name.indexOf("bat")>-1||o[s].size/1048576>15)n.push(o[s]),o.splice(s,1),s--;else{var r=_.where(e.totalFiles,{name:o[s].name});_.isEmpty(r)&&e.totalFiles.push(o[s])}}e.files=o,n.length>0&&(e.errFiles=n),0===n.length&&e.totalFiles.length>0&&(e.errFiles=[]),angular.forEach(o,function(o){if(_.contains(e.totalFiles,o)){var n=o.name.split(".").pop();p="pdf"===n?"pdf":"image";var s=n.length,r=o.name.substring(0,o.name.length-s-1)+(new Date).getTime()+"."+o.name.split(".").pop();o=a.rename(o,r),o.isLoading=!0,i.uploadFile(o,d.labtestContract,"Prescription").then(function(a){t(function(){a.data.isSuccess?(o.result=a.data,e.updatedFiles[a.data.fileDetails[0].fileName]=a.data.fileDetails,e.isCorpLabs?c.sendEvents("File Type For Upload",{fileType:p}):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"File Type For Upload",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page",fileType:"pdf"===n?"pdf":"image"}})})):(e.step=5,e.isCorpLabs?c.sendEvents("Upload Failed",{fileType:p}):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Failed",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})})),o.isLoading=!1})},function(a){o.isLoading=!1,e.step=5,e.isCorpLabs?c.sendEvents("Upload Failed",{fileType:p}):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",isGoogle:!1,name:"Upload Failed",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"Labs Landing Page"}})})})}})}}}}]),e.register.directive("mediBookSlot",["$rootScope","navConstantsSvc","authService","$state","apiProvider","$httpParamSerializer","$stateParams","$timeout","notify","$location","$uibModal",function(e,a,t,i,o,n,s,r,l,c,d){return{restrict:"AE",scope:{obj:"=obj",blockDetails:"=blockDetails",errormessage:"=errormessage",callCtrl:"=callCtrl",sponsored:"=?",pipeline:"=?",prefDate:"=?",isRecommendation:"=?",driver:"=?",slotsToShow:"=?",autoBookSlots:"=?",fromTimeline:"=?",dateFilter:"=?",emitSlotHandler:"=?",initDate:"=?",hideDatePicker:"=?",hideHeader:"=?",hideFooter:"=?",dayLimit:"=?",divideByHour:"=?",isLabs:"=?",isNewTemplate:"=?",isNewAhc:"=?",bookTillDate:"=?",fromCorporate:"=?",oldCorporateFlow:"=?",isMediClinic:"=?",mediclinicConfig:"=?",isOfflineConsults:"=?"},terminal:!0,priority:1e6,templateUrl:"templates/myPopoverTemplate.html?"+timeStamp,link:function(p,m,g){function u(e){var a=e.date,t=p.daysCollection,i=e.mode;return 0===t.length?i="":1===t.length?"day"===i&&a.getDay()===t[0].day:2===t.length?"day"===i&&(a.getDay()===t[0].day||a.getDay()===t[1].day):3===t.length?"day"===i&&(a.getDay()===t[0].day||a.getDay()===t[1].day||a.getDay()===t[2].day):4===t.length?"day"===i&&(a.getDay()===t[0].day||a.getDay()===t[1].day||a.getDay()===t[2].day||a.getDay()===t[3].day):5===t.length?"day"===i&&(a.getDay()===t[0].day||a.getDay()===t[1].day||a.getDay()===t[2].day||a.getDay()===t[3].day||a.getDay()===t[4].day):6===t.length?"day"===i&&(a.getDay()===t[0].day||a.getDay()===t[1].day||a.getDay()===t[2].day||a.getDay()===t[3].day||a.getDay()===t[4].day||a.getDay()===t[5].day):void 0}function h(e){var a=e.date,t=e.mode;if("day"===t)for(var i=new Date(a).setHours(0,0,0,0),o=0;o<p.events.length;o++){var n=new Date(p.events[o].date).setHours(0,0,0,0);if(i===n)return p.events[o].status}return""}function f(e,a){var t=_.isDate(e)?e:new Date(e),i=_.isDate(a)?a:new Date(a);return Math.floor((Date.UTC(i.getFullYear(),i.getMonth(),i.getDate())-Date.UTC(t.getFullYear(),t.getMonth(),t.getDate()))/864e5)}function y(a){p.hideDatePicker||(ae=r(function(){var t=a||p.gliderId;R[t]=new Glider(document.querySelector("#"+t),{slidesToShow:"auto",slidesToScroll:"auto",draggable:!0,itemWidth:e.isMobileView?75:100,exactWidth:e.isMobileView?75:100,arrows:{prev:"."+p.gliderPrevClass,next:"."+p.gliderNextClass}})}))}function v(e){var a=e%60,t="",i=Math.floor(e/60);return i>=12?(t="PM",12===i?i=i:i-=12):t="AM",[i,a,t]}function k(){return F&&(W&&U.getHours()<H.autoBookMB||(!_.isEmpty(p.obj.providerSlots)||!_.isEmpty(A))&&U.getHours()<H.autoBookHC)}function b(){return x&&!_.isEmpty(p.obj.providerSlots)&&U.getHours()<H.autoBookCovid}function D(){return p.dateFilter&&U.getHours()<H.autoBookAHC}function C(e){ie=angular.isDefined(e)?e:p.dateArray.findIndex(function(e){return e.isDay===!0}),ie>-1?(oe=p.dateArray[ie],ne=1===f(U,oe.date),se=2===f(U,oe.date),oe.isDisabled||(ne&&!(D()||k()||b())||se&&$)&&!p.isLabs&&!p.isMediClinic&&!p.isOfflineConsults?(p.dateArray[ie].isDay=!1,p.dateArray[ie].isSlotNotAvail=!0,ie+=1,C()):("app.homehealthcare"===i.current.name||"app.genome"===i.current.name||p.sponsored?p.pickTimeWithoutSlot(oe,p.sponsored):p.pickTime(oe,ie),te=r(function(){document.querySelector("#"+p.gliderId)&&ie>1&&(document.querySelector("#"+p.gliderId).scrollLeft=70*ie)},200))):_.isEmpty(oe)||p.pickTimeWithoutSlot(oe,p.sponsored)}function P(e){if(_.isArray(e)&&!_.isEmpty(e)){p.obj.providerSlots=e;var a=_.first(p.obj.providerSlots).daySlots?"daySlots":"slots";p.pipeline.groupedSlots=_.groupBy(_.flatten(_.pluck(p.obj.providerSlots,a)),function(e){var a=new Date(parseInt(e.date.replace("/Date(","").replace(")/",""))).setHours(0,0,0,0);if(e.workingDaySlots){var t=p.dateArray.find(function(e){return _.isEqual(new Date(a),e.date)});!t||t.isOverbooked||t.isSlotNotAvail||t.isHoliday||t.isDisabled||(t.isDay=!0,t.availableSlots=e.workingDaySlots)}return a}),p.pipeline.updateDateSlots(),C()}else p.obj.providerSlots=null;p.isMedibuddyLoading=!1,y()}function w(e){if(P(e),C(),p.prefDate){var a=angular.copy(p.prefDate.date),t=p.dateArray.findIndex(function(e){return e.date.setHours(0,0,0,0)==a.setHours(0,0,0,0)});t>-1&&(p.pickTime(p.dateArray[t],t),te=r(function(){document.querySelector("#"+p.gliderId).scrollLeft=70*t},200))}}var S=p.obj;p.preferdStartTime="",p.startWith=0,p.previousWith=0;var T=p.divideByHour?60:30;p.isMediClinic&&(T=p.divideByHour?30:15),p.daysCount=15;var A=p.sponsored||p.prefDate||{};p.currentDay=p.prefDate&&p.prefDate.date?p.prefDate.date:"",p.pipeline||(p.pipeline={}),p.pipeline.homeSampleError=!1;var I="selectedSlot";if(p.emitSlotHandler&&_.isString(p.emitSlotHandler)&&(I=p.emitSlotHandler),p.userObj=t.isUserSignedin(),p.dropDownConsentFLow=!1,p.dropdownBranches=[],p.isDropDownOpen=!1,p.selectedDropDownBranch=null,p.confirmConsent=!1,p.dropdownDefaultValue="",p.isMediClinic&&p.mediclinicConfig){p.dropDownConsentFLow=p.userObj&&p.mediclinicConfig.mediClinicDropdown[p.userObj.userDetails.pmEntityID];var O=p.mediclinicConfig.mediClinicDropdown[p.userObj.userDetails.pmEntityID];O&&(p.dropdownBranches=O.dropdDown.value,p.dropdownDefaultValue=O.dropdDown.defaultValue)}var L,M=document.getElementsByClassName("timeslider-days")[0];if(document.getElementsByClassName("timeslider-days").length>1)for(L=0;L<document.getElementsByClassName("timeslider-days").length;L++)if(document.getElementsByClassName("timeslider-days")[L].clientWidth>0){M=document.getElementsByClassName("timeslider-days")[L];break}if(M?(p.sliderWidth=M.clientWidth,p.widthOfOneDay=80,p.noOfDaysDisplayed=parseInt(p.sliderWidth/p.widthOfOneDay)-1):(p.noOfDaysDisplayed=7,p.sliderWidth=560,p.widthOfOneDay=80),!_.isEmpty(S))if(S.requests){var B=_.first(S.requests);window._Site_Props.__setPackageDetails({packageName:B.packageName,providerName:B.providerName,providerLocation:B.providerLocation})}else window._Site_Props.__setPackageDetails({packageName:S.packageName,providerName:S.dcName,providerLocation:S.dcLocation});p.isPreviousValue={cursor:"not-allowed"},p.isNextValue={},p.appointmentData={patientName:"",email:"",gender:"",phone:"",dateOfBirth:"",genderValue:a.genderTitle,prefDate:"",prefDateTime:"",relation:""};var F=_.contains(["app.comparePage","app.packagesnew","app.packageDetail","app.oneClick","app.checkout","app.mediCheckoutCart"],i.current.name)||a.contractDetails[p.obj.orderType]==a.healthCheckFilterName||p.obj.contractId==a.ahcContract,x=p.obj.contractId===a.labtestContract&&p.obj.isCovid,N=F||p.isLabs||p.obj.contractId===a.labtestContract;p.blockDates=_.map(a.blockDates,function(e){var a=e.date.substring(e.date.length-4,e.date.length);return e.date=e.date.replace(a,(new Date).getFullYear()+""),e}),p.blockDetails&&_.each(p.blockDetails,function(e,a){var i="";if("provider_overbooking"===e.blockType.toLowerCase())e.idNo&&e.idNo.indexOf(p.obj.dcId)>-1&&(i=new Date(parseInt(e.blockDate.replace("/Date(","").replace(")/",""))),p.blockDates.push({date:i.toLocaleDateString("en-US").replace(/[^ -~]/g,""),reason:"overbooking"}));else if("holiday"===e.blockType.toLowerCase())(!e.idNo||0===e.idNo.length||e.idNo.indexOf(p.obj.dcId)>-1)&&(i=new Date(parseInt(e.blockDate.replace("/Date(","").replace(")/",""))),p.blockDates.push({date:i.toLocaleDateString("en-US").replace(/[^ -~]/g,""),reason:"holiday"}));else if("package_id"===e.blockType.toLowerCase())e.idNo&&e.idNo.indexOf(p.obj.packageId)>-1&&(i=new Date(parseInt(e.blockDate.replace("/Date(","").replace(")/",""))),p.blockDates.push({date:i.toLocaleDateString("en-US").replace(/[^ -~]/g,""),reason:"overbooking"}));else if("policy_enddate"===e.blockType.toLowerCase()){var o=t.isUserSignedin();if(e.idNo&&e.idNo.indexOf(o.userDetails.pmEntityID.toString())>-1){i=new Date(parseInt(e.blockDate.replace("/Date(","").replace(")/","")));var n=_.range(20);_.each(n,function(e){p.blockDates.push({date:i.toLocaleDateString("en-US").replace(/[^ -~]/g,""),reason:"policy expired"}),i.setDate(i.getDate()+1)})}}else"mediclinic"===e.blockType.toLowerCase()&&(i=new Date(e.blockDate),p.blockDates.push({date:i.toLocaleDateString("en-US").replace(/[^ -~]/g,""),reason:"overbooking"}))}),p.close=function(){p.dateArray[p.pickTimeIndex].isOpen=!1,p.FinalTime=p.preferdStartTime},p.isOfflineConsults=t.isOfflineConsults,Date.prototype.addDays=function(e){return this.setDate(this.getDate()+parseInt(e)),this},Date.prototype.addDays1=function(e){var a=new Date(this.valueOf());return a.setDate(a.getDate()+e),a},p.takeServerDate=function(){var e;return e=t.serverDate?new Date(t.serverDate):new Date};var E=p.takeServerDate();
E=E.addDays(p.daysCount),p.dateOptions={dateDisabled:u,formatYear:"yy",maxDate:E,minDate:p.takeServerDate(),startingDay:1},p.showPopover=!1,p.pad=function(e,a){return e=e.toString(),e.length<a?p.pad("0"+e,a):e},p.selectDropDownBranch=function(e){p.selectedDropDownBranch=e,p.isDropDownOpen=!1},p.doConsent=function(){p.modalInstance&&p.modalInstance.close(),p.confirmConsent=!0},p.openConsentForm=function(){p.modalInstance=d.open({templateUrl:"templates/consentFormForTcs.html?"+timeStamp,size:"sm",resolve:{proceedFurther:function(){return p.doConsent}},controller:["$scope","$uibModalInstance","proceedFurther",function(e,a,t){e.proceedFurther=t,e.closeModal=function(){a.dismiss("cancel")}}]})},p.calculateTimeSlots=function(e){var a=[],t=0,i=0;t=e.slotStartTime,i=e.slotEndTime;for(var o=t;o<i;o++){var n;o===t?n=t:(n=t+T,t=n),i>=n&&a.push({slotStartTime:n})}return a},p.today=function(){p.dt=p.takeServerDate()},p.today(),p.inlineOptions={customClass:h,minDate:p.takeServerDate(),showWeeks:!0};var j;p.localScope=p,p.instantbooking=!1,p.selectedTime=function(a,i){angular.forEach(p.slots,function(t,i){t.slotStartTime===a.slotStartTime&&t.startTime===a.startTime&&t.isSelected===a.isSelected?(p.slots[i].isSelected=!0,j=r(function(){if(e.isMobileView){var a="AM"==p.slots[i].startTimeAmPm?"amGlider":"pmGlider";document.querySelector("#"+a).scrollLeft=70*i}},200)):p.slots[i].isSelected=!1}),p.hideDatePicker||(p.currentDay=p.dayPrefered),angular.forEach(p.dateArray,function(e,a){p.dateArray[a].isSelected=!1});var o=_.find(p.dateArray,function(e){return e.date.setHours(0,0,0,0)==p.currentDay.setHours(0,0,0,0)});o.isSelected=!0,p.dateArray.push(o),p.dateArray=t.getUniqId(p.dateArray);var n,s,l,c,d;if(p.instantbooking?(p.preferdStartTime=p.instantTime,p.preferdEndTime=a.endTime+a.endTimeAmPm,p.isSelectedPreferdTime=!0,n=parseInt(p.nowT.split(":",2)[1]),s=0,l=0,c=parseInt(p.nowT.split(":",2)),d=new Date(p.currentDay.getFullYear(),p.currentDay.getMonth(),p.currentDay.getDate(),c,n,s,l),p.prefDateTime=d,p.isError=!1):(p.preferdStartTime=a.startTime+" "+a.startTimeAmPm,p.preferdEndTime=a.endTime+a.endTimeAmPm,p.isSelectedPreferdTime=!0,n=a.slotStartTime%60,s=0,l=0,c=Math.floor(a.slotStartTime/60),d=new Date(p.currentDay.getFullYear(),p.currentDay.getMonth(),p.currentDay.getDate(),c,n,s,l),p.prefDateTime=d,p.isError=!1),p.hideFooter){var m={date:p.currentDay,time:p.preferdStartTime,endTime:p.preferdEndTime,provider:p.obj,prefDateTime:p.prefDateTime,slotStartTime:a.slotStartTime};a.servingProviders&&(m.servingProviders=a.servingProviders),p.$emit(I,m)}},p.gliderId="glider"+(""+Math.random()).substring(2,5),p.gliderPrevClass="glider-prev-"+(""+Math.random()).substring(2,5),p.gliderNextClass="glider-next-"+(""+Math.random()).substring(2,5);var R={};p.isMobileView=e.isMobileView,p.pickTimeWithoutSlot=function(e,a){p.tempData&&(p.tempData.isSelected=!1),p.sponsored&&(p.sponsored.prefDate={date:e.date,position:document.getElementById(p.gliderId)?document.getElementById(p.gliderId).scrollLeft:0},p.sponsored.fetchSlotInfo(a)),p.tempData=e,e.isSelected=!0,p.isSelectedPreferdTime=!0,p.prefDateTime=e.date,p.preferdStartTime=e.date,p.FinalTime=e.date},p.pickTime=function(e,a){if(p.preferdStartTime="",p.pickTimeIndex=a,e.isDay===!0){if(p.dayPrefered=e.date,p.tempData&&(p.tempData.isSelected=!1),p.tempData=e,e.showPopover=!e.showPopover,e.isSelected=!0,p.selectedDayTime=[],p.prefDate&&p.prefDate.date){var t=new Date(p.prefDate.date).getTime();p.pipeline.groupedSlots[t]&&p.fromCorporate?angular.forEach(p.pipeline.groupedSlots[t],function(e,a){e.providerId==parseInt(p.obj.dcId)&&angular.forEach(e.workingDaySlots,function(e,a){p.selectedDayTime.push(e)})}):p.pipeline.oldCorporateProviderGroupedSlots&&p.pipeline.oldCorporateProviderGroupedSlots[t]&&angular.forEach(p.pipeline.oldCorporateProviderGroupedSlots[t],function(e,a){e.providerId==parseInt(p.obj.dcId)&&angular.forEach(e.workingDaySlots,function(e,a){p.selectedDayTime.push(e)})})}if(e.availableSlots?(angular.forEach(e.availableSlots,function(e,a){p.selectedDayTime.push(e)}),p.selectedDayTime.push(e.availableSlots)):V&&!p.fromCorporate&&angular.forEach(V,function(a,t){a.day===e.day&&angular.forEach(a,function(e,a){p.selectedDayTime.push(e)})}),!_.isEmpty(p.selectedDayTime))if(N){var i=p.selectedDayTime[1].map(function(e){return _.pick(e,"slotStartTime","slotEndTime","servingProviders","slotCount")});p.isLabs?(p.slots=[],p.slots=p.devideTimeSlots(i)):(p.slots={},p.slots[0]=p.devideTimeSlots(i))}else p.slots={},_.each(p.selectedDayTime[1],function(e,a){var t=p.calculateTimeSlots(p.selectedDayTime[1][a]);p.slots[a]=p.devideTimeSlots(t)});p.isTime=!0}else p.isTime=!1;if(_.isArray(p.slots)){p.amSlots=p.slots.filter(function(e){return e.slotStartTime<720}),p.amSlotsMweb=[];for(var o=0;o<p.amSlots.length;o+=2)p.amSlotsMweb.push(p.amSlots.slice(o,o+2).map(function(e,a){return e}));p.pmSlots=p.slots.filter(function(e){return e.slotStartTime>=720}),p.pmSlotsMweb=[];for(var o=0;o<p.pmSlots.length;o+=2)p.pmSlotsMweb.push(p.pmSlots.slice(o,o+2).map(function(e,a){return e}))}if(p.emitSlotHandler&&(p.isLabs||p.currentDay)&&(p.$emit("slotDateChange",{date:p.currentDay,prefDate:e.date}),p.prefDate&&p.prefDate.time)){var n=_.union(p.amSlots,p.pmSlots).find(function(e){return e.time==p.prefDate.time});n&&p.selectedTime(n)}console.log(p.dateArray)},p.dynamicPopover={templateUrl:"myPopoverTemplate.html?"+timeStamp},p.devideTimeSlots=function(e){return angular.forEach(e,function(a,t){if(a.slotStartTime||0===a.slotStartTime){var i=v(a.slotStartTime),o=p.pad(i[0],"2")+":"+p.pad(i[1],"2");e[t].startTime=o,e[t].startTimeMweb=i[1]?o:i[0],e[t].isSelected=!1,e[t].startTimeAmPm=i[2],e[t].time=o+" "+i[2],a.slotEndTime&&(i=v(a.slotEndTime),o=p.pad(i[0],"2")+":"+p.pad(i[1],"2"),e[t].endTime=o,e[t].endTimeMweb=i[1]?o:i[0],e[t].endTimeAmPm=i[2])}}),e},p.getDates=function(e,a){var t=[],i=e,o=new Date;for(p.tomorrowDateIndex=-1,e.getFullYear()!==o.getFullYear()||e.getMonth()!==o.getMonth()||e.getDate()!==o.getDate()+1||p.isLabs||p.isMediClinic||p.isOfflineConsults||(p.tomorrowDateIndex=0);i<=a;)t.push(i),i=i.addDays1(1);return t},p.appointmentDetails={packageData:{},userData:{}},p.appointmentDetails.packageData=S;var V=p.appointmentDetails.packageData.availableSlots;V?"homeVisitDate"==p.emitSlotHandler&&S.homeVisitAvailableSlots?V=S.homeVisitAvailableSlots:(1==p.pipeline.homeSampleSelection||p.pipeline.isHomeVisit)&&S.radiologyAvailableSlots&&(V=S.radiologyAvailableSlots):V=p.obj.availableSlots,p.availableSlots=[],_.forEach(V,function(e,a){p.availableSlots[e.day]=e});var W,U=p.takeServerDate(),$=!1,H=a.nextDayThreshold,G=1,q="30";_.isString(p.appointmentDetails.packageData.dcName)&&(W=p.appointmentDetails.packageData.dcName.toLowerCase().indexOf("thyrocare")>-1);var z=new Date,Y=14;!(U.getHours()>=H.autoBookMB)||F||x||p.dateFilter||p.isLabs||p.isMediClinic||p.isOfflineConsults?p.isOfflineConsults&&(G=z.getHours()<Y?1:2):($=!0,G=2);var J=29;"app.olservice"===i.current.name?J=7:(p.isLabs||_.isDate(p.initDate))&&(G=0),p.dayLimit&&(J=p.dayLimit);var K,Q=_.isDate(p.initDate)?Math.floor(p.initDate):t.serverDate||new Date;for(K=p.getDates(new Date(Q).addDays(G),new Date(Q).addDays(J+G)),p.isMediClinic&&(K=p.getDates(new Date(Q),new Date(Q).addDays(30))),p.dateArray=[],L=0;L<K.length;L++)p.dateArray.push({id:L+1,showPopover:!1,isOpen:!1,isSelected:!1,date:new Date(K[L].setHours(0,0,0,0)),isDay:!1,day:new Date(K[L]).getDay()});for(var X=0;X<p.dateArray.length;X++){"app.olservice"===i.current.name&&X>2&&(p.dateArray[X].isDay=!1);var Z=p.dateArray[X],ee=_.findWhere(p.blockDates,{date:Z.date.toLocaleDateString("en-US").replace(/[^ -~]/g,"")});ee?(p.dateArray[X].isDay=!1,p.dateArray[X].isDisabled=!0,"overbooking"===ee.reason?p.dateArray[X].isOverbooked=!0:"holiday"===ee.reason&&(p.dateArray[X].isHoliday=!0)):_.isDate(p.bookTillDate)&&p.dateArray[X].date>p.bookTillDate?(p.dateArray[X].isDay=!1,p.dateArray[X].isDisabled=!0):_.isEmpty(p.availableSlots[Z.day])||_.isEmpty(p.availableSlots[Z.day].slots)||(p.dateArray[X].isDay=!0),p.sponsored&&!p.sponsored.isAutoSlotProviderAvailable&&0==X&&(p.dateArray[X].isDay=!1)}var ae,te,ie=-1,oe={},ne=!1,se=!1,re=t.isUserSignedin();if(_.isEmpty(p.obj.providerSlots)&&!A.prefDate&&!p.hideDatePicker&&N||p.oldCorporateFlow){p.isMedibuddyLoading=!0;var le,ce;if(N){le=p.obj.pmEntityID?o.apiUrl+"/AHC/ProvidersWithCalendar":"https://www.medibuddy.in/WAPI/Labs/ProvidersCalendar";var de=p.obj.dcIds?p.obj.dcIds.map(function(e){return e?parseInt(e):0}):[parseInt(p.obj.dcId)];ce={ProviderIds:_.uniq(de),NoOfDays:q,pmEntityId:re.userDetails.pmEntityID,ContractId:p.obj.contractId,IsHomeVisitCase:!(!p.pipeline.isHomeVisit&&_.isEmpty(p.obj.dcIds)&&!p.obj.homeSampleCollection),packageIds:_.isArray(p.obj.packageId)?p.obj.packageId:p.obj.packageId?[p.obj.packageId]:[],pincode:parseInt(p.obj.pincode),pmEntityId:p.obj.pmEntityID},_.isEmpty(ce.packageIds)||isNaN(_.first(ce.packageIds))&&(ce.packageIds=[]),p.oldCorporateFlow&&(ce.ContractId=a.ahcContract,ce.pmEntityId=re.userDetails.pmEntityID,ce.ProviderIds=_.map(p.obj.providers,function(e){return parseInt(e.dcId)}))}else le=o.apiUrl+"/ProviderSlots",ce={ProviderIds:[p.obj.dcId],NoOfDays:q,ContractId:p.obj.contractId};t.makeAjaxCalls(le,ce,"POST",p.userObj.token).then(function(e){if(console.log("ProvidersWithCalendar --> Done",e),e.data.serverDate&&(t.serverDate=parseInt(e.data.serverDate.replace("/Date(",""))),!p.dateFilter){if(e.data.blockTillDate){var a=parseInt(e.data.blockTillDate.replace("/Date(",""));a>0&&(a=new Date(a),_.each(p.dateArray,function(e){e.date<a&&(e.isDay=!1,e.isDisabled=!0)}))}if(e.data.blockTime){var i=parseInt(e.data.blockTime);i>0&&(H.autoBookHC=i,H.autoBookCovid=i)}}_.isEmpty(e.data.providerDetails)||_.isEmpty(e.data.slotDetails)?w(e.data.providerSlots):(console.log("Emitting providers --> Done"),p.$emit("providersForPackage",{providers:e.data.providerDetails.providers,providerSlots:e.data.slotDetails.providerSlots}),e.data.unionOfSlots&&w([{slots:e.data.unionOfSlots}]))},function(e){p.isMedibuddyLoading=!1,y(),C(),l({message:"Unable to get provider slots at this moment, Please try after sometime",position:"center",duration:5e3})})}else r(function(){w(p.obj.providerSlots)});p.bookSlot=function(){r(function(){p.maxMinCheck=!0,p.calendarCheck=!1,_.isUndefined(p.minHours)&&(p.maxMinCheck=!1),("app.homehealthcare"===i.current.name||"app.genome"===i.current.name||p.sponsored)&&(p.calendarCheck=!0,p.isTime=!1),p.$apply()},0,!0)},p.bookSlot(),p.calendarCheck&&(p.isTime=!1),p.setBooking=function(){return e.$broadcast("mbProvider"),p.genomeCantBookCheck=!1,p.userObj=t.isUserSignedin(),p.driver&&p.driver.reset(),p.pipeline.homeSampleError=!1,p.pipeline.homeVisitDate&&p.prefDateTime&&Math.floor(p.prefDateTime)<=Math.floor(p.pipeline.homeVisitDate.prefDateTime)?void(p.pipeline.homeSampleError=!0):void(p.emitSlotHandler?(p.isMediClinic&&window._MB_Analytics.__push({isCleverTap:p.dropDownConsentFLow,dbLog:"mediclinic",name:"MC Confirm Slot Button Clicked",payload:window._Site_Props.__getEventParameters({custom:{srcPage:"MediClinic Slot Selection Page",patientId:p.obj.patientId,doctorId:p.obj.doctorUniqueId,prefDateTime:p.preferdStartTime,branch:p.dropDownConsentFLow?p.selectedDropDownBranch.branch:"N/A",zone:p.dropDownConsentFLow?p.selectedDropDownBranch.zone:"N/A"}})}),p.$emit(I,{date:p.currentDay,time:p.preferdStartTime,provider:p.obj,prefDateTime:p.prefDateTime})):p.userObj?_.isEmpty(p.userObj)||t.makeAjaxCalls(o.apiUrl+"/UpdateSession/"+p.userObj.token,"","GET").then(function(e){if(e.data)if(a.jllEntityIds.indexOf(p.userObj.userDetails.pmEntityID)>=0&&"app.genome"===i.current.name)l({message:"This service is not available for you.",position:"center",duration:5e3,classes:"has-error"});else if(F){var o=p.pickTimeIndex;C(o),o==ie&&p.setBookingAfterValidation()}else p.setBookingAfterValidation();else t.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"bookSlot",func:"setBooking",args:null,stayInState:!0})}):p.callCtrl?t.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:p.callCtrl,func:"bookSlotAfterValidation",args:null,stayInState:!0}):t.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"bookSlot",func:"setBooking",args:null,stayInState:!0}))},p.setBookingAfterValidation=function(){p.obj.prefDateTime=p.prefDateTime;var e={};if(p.appointmentDetails.packageData.orderId){if(e={appointmentDate:p.prefDateTime,appointmentDateValue:p.prefDateTime.toDateString(),"Order Id":p.obj.orderId,from:p.fromTimeline?"Timeline":"Track Order"},window._Site_Props.__setServiceDetails({serviceName:a.contractDetails[p.obj.orderType]}),p.obj.requests){var r=_.first(p.obj.requests);window._Site_Props.__setPackageDetails({packageName:r.packageName,providerName:r.providerName,providerLocation:r.providerLocation})}var d={orderId:p.appointmentDetails.packageData.orderId,remarks:"Rescheduled by customer",scheduledDate:p.prefDateTime};p.pipeline.homeVisitDate&&p.pipeline.homeVisitDate.prefDateTime&&(d.homeVisitDate=p.pipeline.homeVisitDate.prefDateTime,e.homeSampleDate=p.pipeline.homeVisitDate.prefDateTime.toLocaleString());var m=o.apiUrl+"/Reschedule.json";t.makeAjaxCalls(m,d,"POST",p.userObj.token).then(function(i){i.data.isSuccess&&i.data.order?(p.isLabs||window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"RescheduleOrderConfirm",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:e,google:window._Site_Props.__googleTransform(a.contractDetails[p.obj.orderType],"Reschedule",p.obj.packageName+" at "+t.getCity())})}),t.refreshOrders=!0,t.timeline.details=null,p.appointmentDetails.packageData&&p.appointmentDetails.packageData.emit?p.$emit("orderRescheduled",p.prefDateTime):c.url("/orderData?orderid="+i.data.order.orderId)):l({message:"There is some technical issue, Please try after sometime",position:"center",duration:5e3})})["catch"](function(e){l({message:"There is some technical issue, Please try after sometime",position:"center",duration:5e3})})}else{t.setBookingData=p.obj,t.detailsForBooking={docObj:p.obj,errorMessage:p.errormessage,isMediClinic:p.isMediClinic},s.searchc?(p.eventLabel=p.obj.packageName+" in "+s.searchc+" from "+t.getCity(),p.eventCategory=s.categoryItemTypeId):s.searchk&&(p.eventLabel=s.searchk+" from "+t.getCity(),p.eventCategory=s.categoryItemTypeId),s.categoryItemTypeId===a.investigationFilterName?(p.eventCategory="Labtest",p.eventLabel=p.obj.dcName.trim()):s.categoryItemTypeId===a.dentalFilterName&&(p.eventCategory="Dental",p.eventLabel=p.obj.packageName+" at "+t.getCity());n(p.obj.prefDateTime);if(s.categoryItemTypeId===a.genomFilterName&&(p.eventCategory="GENOME",p.eventLabel=p.obj.packageName+" at "+t.getCity()),p.obj.isDentalPackage&&(p.eventCategory="Dental",window._Site_Props.__setServiceDetails({serviceName:p.eventCategory,serviceType:s.searchk})),e={appointmentDate:p.obj.prefDateTime,appointmentDateValue:p.obj.prefDateTime.toDateString()},p.isRecommendation&&(e.isRecommendation=!0),p.pipeline.homeVisitDate&&p.pipeline.homeVisitDate.prefDateTime&&(e.homeSampleDate=p.pipeline.homeVisitDate.prefDateTime.toLocaleString()),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,fbq:!0,fbqReference:"AddToCart",name:p.medicine?"MedsProceedToAddressPage":"Slot Booked",dbLog:!p.medicine||"meds",hj:!0,googleSheet:!0,payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:e,google:window._Site_Props.__googleTransform(p.eventCategory,"slotBooked",p.eventLabel)})}),s.categoryItemTypeId===a.investigationFilterName||s.categoryItemTypeId===a.healthCheckFilterName){var g={sessionData:{},forceUpdate:!0},u=s.categoryItemTypeId===a.investigationFilterName?a.investigationId:a.healthCheckId,h=" diagnostic centers";s.packgName=s.packgName?s.packgName.replace(h,""):"",p.obj.testName=s.packgName,g.sessionData[u]=JSON.stringify(p.obj),t.makeAjaxCalls(o.apiUrl+"/SessionStorage.json",g,"POST",p.userObj.token).then(function(a){a.data.isSuccess&&i.go("app.payment",{categoryItemTypeId:u,searchc:s.searchc,searchk:s.searchk,packageId:p.obj.packageId,dcId:p.obj.dcId,appTime:p.obj.prefDateTime.getTime(),dcName:s.dcName,dcCity:p.obj.dcCity,packgName:s.packgName,coupon:s.coupon,isRecommendation:e.isRecommendation,doctorId:p.obj?p.obj.doctorUniqueId:""},{reload:"app.payment"})})}else s.categoryItemTypeId=t.checkSeriveType[s.categoryItemTypeId],i.go("app.payment",{categoryItemTypeId:p.obj.isDentalPackage?a.dentalPackageId:s.categoryItemTypeId,searchc:s.searchc,searchk:p.obj.isDentalPackage?a.dentalPackageName:s.searchk,packageId:p.obj.packageId,dcId:p.obj.dcId,dcName:s.dcName,dcCity:p.obj.dcCity,appTime:p.obj.prefDateTime.getTime(),pB:p.obj.poweredBy,coupon:s.coupon,isRecommendation:e.isRecommendation,doctorId:p.obj?p.obj.doctorUniqueId:""},{reload:"app.payment"})}},r(function(){var e=t.getAddress();window._MB_Analytics.__push({isCleverTap:!0,name:"Provider Visible Issue",payload:window._Site_Props.__getEventParameters({custom:{dateArray:p.dateArray,sponsored:p.sponsored,isTime:p.isTime,isCalender:p.calendarCheck,bookTillDate:p.bookTillDate,serverDate:t.serverDate,user:t.isUserSignedin(),pincode:t.getPincode(),latLong:e&&e.latLng?e.latLng:""}})})});var pe=!1,me=e.$on("bookSlot",function(e,a){pe=!0}),ge=e.$on("userDetails",function(e,a){pe&&p.setBooking()});p.pipeline.updateDateSlots=function(){_.isEmpty(p.pipeline.groupedSlots)?p.dateArray[0].overallSlotState="not-available":(_.each(p.dateArray,function(e,t){var i={max:0,available:0};_.each(p.pipeline.groupedSlots[e.date.setHours(0,0,0,0)],function(e,a){i.max+=e.totalSlots,e.availableSlots>0&&(i.available+=e.availableSlots)}),e.isOverbooked||e.isSlotNotAvail||e.isHoliday||!e.isDay||(0==i.available?(e.overallSlotState={className:"not-available",status:"Unavailiable"},e.isDisabled=!0):i.available<=i.max*(a.minSlotThreshold/100)?e.overallSlotState={className:"almost-full",status:"Filling fast",color:"#cc8800"}:e.overallSlotState={className:"slot-available",status:"Available",color:"#81a200"})}),p.oldCorporateFlow&&p.pipeline.groupedSlots&&(p.pipeline.oldCorporateProviderGroupedSlots=p.pipeline.groupedSlots))},p.prefDate||p.$on("onEditSlot",function(e,a){var t=_.find(p.dateArray,function(e){return e.date.setHours(0,0,0,0)==a.setHours(0,0,0,0)});t&&p.pickTimeWithoutSlot(t)}),p.$on("$destroy",function(){_.each(R,function(e,a){r.cancel(e),e&&(e.destroy(),R[a]=null)}),r.cancel(ae),r.cancel(j),r.cancel(te),me(),ge()})}}}]),e.register.directive("mediListingFilter",["$rootScope","authService","$timeout","$state","navConstantsSvc",function(e,a,t,i,o){return{restrict:"E",replace:!1,scope:{attributePackages:"=bind",weekFilter:"=week",isOfferFilter:"=isofferfilter",isHscFilter:"=ishscfilter",isGoldPartnerFilter:"=isgoldpartnerfilter",goldPartner:"=goldpartner",hsc:"=hsc",offer:"=offer",locSearch:"=locSearch",pipeline:"=?"},templateUrl:"/templates/listing-filter.html?"+timeStamp,link:function(e){e.filterPackageCollection={dummyProvider:[],provider:[],priceRange:[]},e.weeksArray=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],e.changeStatus=function(e){return _.forEach(e,function(a,t){e[t].isSelected=!1}),e},e.filterFor={provider:"provider",location:"Location",age:"Age",week:"Days",price:"Price",gender:"Gender"};var n;e.getFiltersApplied=function(t){n={OnlyDiscounted:!!e.offer&&e.offer.isSelected,OnlyPreferredPartners:!!e.goldPartner&&e.goldPartner.isSelected,OnlyHSC:!!e.hsc&&e.hsc.isSelected,MedicalCenter:e.selectedProviderCollection.length>0?_.pluck(e.selectedProviderCollection,"dcName").join(","):"",Location:e.selectedLocationCollection.length>0?_.pluck(e.selectedLocationCollection,"dcLocation").join(","):"",Gender:_.where(e.genderGroup,{isSelected:!0}).length>0?_.pluck(_.where(e.genderGroup,{isSelected:!0}),"gender").join(","):"",Age:e.selectedAgeCollection.length>0?_.pluck(e.selectedAgeCollection,"ageGroup").join(","):"",AppointmentDay:e.selectedWeeksCollection.length>0?_.pluck(e.selectedWeeksCollection,"day").join(","):"",PriceRange:!(!e.isClearPriceFilter||_.isNaN(e.priceRangeValue.minPrice))&&e.priceRangeValue.minPrice+"-"+e.priceRangeValue.maxPrice},window._Site_Props.__setFilterDetails(n),t||(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Filter Applied",payload:window._Site_Props.__getEventParameters({service:!0,filter:!0})}),e.eventLabel="",_.forEach(n,function(a,t){a&&(e.eventLabel+=t+", ")}),e.eventLabel=e.eventLabel.length>2?e.eventLabel.substring(0,e.eventLabel.length-2)+" filter applied in ":"Filters reset in ",e.eventLabel+=a.getCity(),window._MB_Analytics.__push({isCleverTap:!1,isGoogle:!0,name:"event",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform(e.eventCategory,"Filter Applied",e.eventLabel)})})),$("#provider-filter").trigger("sticky_kit:recalc")},e.eventCategory="app.hospitalizationlist"===i.current.name?"Hospitalization":i.params.categoryItemTypeId,i.params&&i.params.provider&&(e.filterProvider=i.params.provider),i.params&&i.params.l&&(e.filterLocation=i.params.l),e.selectedLocationCollection=[],e.reloadCollections=function(){e.selectedProviderCollection=[],e.selectedLocationCollection=[],e.selectedGenderrCollection=[],e.selectedAgeCollection=[],e.selectedWeeksCollection=[],e.demoAenitiesCollection=[],e.providerCollectionValue=[],e.amenitiesCollection=[],e.modifiedDataFordcServices=[],e.categoryItemCollectionWithLocation=[],e.locationFinalDataCollection=[],e.filterLocationDataCollection=[],e.categoryItemCollectionDemo=[],e.filterPackageCollection.provider=[],e.filterPackageCollection.priceRange=[],e.minPrice=0,e.maxPrice=0,e.providerCount=0,e.isClearPriceFilter=!1,e.ageGroup=e.changeStatus(o.ageGroup),e.genderGroup=e.changeStatus(o.genderGroup),e.weekGroup=e.weekFilter},e.reloadCollections(),e.getFiltersApplied(!0),e.updateFilter=function(a){e.$emit("updatedFilterCollection",a)},e.isClearPriceFilter=!1,e.clearAllFilter=function(){e.reloadCollections(),e.getFilterData(e.clearAllFilterCollection),e.updateFilter(e.finalCollection),e.priceRangeValue.maxPrice=e.priceRangeValue.MaximumPriceValue,e.priceRangeValue.minPrice=0,e.isClearPriceFilter=!1,e.$emit("priceRangeValue",e.priceRangeValue),e.ageRangeValue.maxAge=100,e.ageRangeValue.minAge=0,e.filterCollection("","Provider"),e.filterCollection("","Location"),e.$emit("filterAHCItems",{Provider:[],Location:[]}),e.genderFilter={type:"both",isTrue:!1},e.offer.isSelected=!1,e.hsc.isSelected=!1,e.goldPartner.isSelected=!1,e.selectedAgeCollection=[],e.selectedWeeksCollection=[],e.clearDaysFilter("Days"),e.collection=[],e.$emit("updateAgeFilter",e.ageRangeValue),e.$emit("updateGenderFilter",e.genderFilter),e.getFiltersApplied(),a.filterObj={}},e.slider={min:100,max:180,options:{floor:0,ceil:450,onEnd:e.priceSliderChanged}},e.ageRangeValue={maxAge:100,minAge:0,isTrue:!1},e.genderFilter={type:"both",isTrue:!1},e.$on("clearLocFilter",function(a,t){t&&e.clearLocationFilter(e.filterFor.location)}),e.mapPriceRange=function(o){var n=Math.round(a.finder(Math.min,o,"price"));e.priceRangeValue={minValue:0,maxValue:0,maxPrice:0,minPrice:0,isTrue:!1,MaximumPriceValue:0,MimPriceValue:0,options:{floor:n,ceil:0,step:1,translate:function(e,a,t){switch(t){case"model":return'<b class="mm mm-rupee"></b>'+e;case"high":return'<b class="mm mm-rupee" ></b> '+e;default:return e=""}}},range:{min:0,max:0}},t(function(){e.priceRangeValue.maxPrice=Math.round(a.finder(Math.max,o,"price")),e.priceRangeValue.MaximumPriceValue=Math.round(a.finder(Math.max,o,"price")),e.maxPrice=e.priceRangeValue.maxPrice>0?e.priceRangeValue.maxPrice:0;e.priceRangeValue.maxPrice.toString();e.priceRangeValue.minPrice=Math.round(a.finder(Math.min,o,"price")),e.priceRangeValue.MimPriceValue=Math.round(a.finder(Math.min,o,"price")),e.minPrice=e.priceRangeValue.minPrice>0?e.priceRangeValue.minPrice:0;e.priceRangeValue.minPrice.toString();e.priceRangeValue.range.max=e.priceRangeValue.maxPrice>0?e.priceRangeValue.maxPrice:0,e.priceRangeValue.range.min=e.priceRangeValue.minPrice>0?e.priceRangeValue.minPrice:0,e.priceRangeValue.options.ceil=e.priceRangeValue.range.max,e.priceRangeValue.options.minRange=0,e.priceRangeValue.MaximumPriceValue===e.priceRangeValue.MimPriceValue||"app.hospitalizationlist"===i.current.name?e.isPriceFilter=!1:e.isPriceFilter=!0},1)},e.priceRangeValue={range:{min:0,max:0},minPrice:0,maxPrice:0,MaximumPriceValue:0,MimPriceValue:0,trueValue:!1},e.showProviderBox=!1,e.showLocationBox=!1,e.showPriceBox=!1,e.showAgeBox=!1,e.showDayBox=!1,e.showGenderBox=!1,e.mobileClick=function(a){"Provider"===a?(e.showProviderBox=!0,e.showLocationBox=!1,e.showPriceBox=!1,e.showAgeBox=!1,e.showDayBox=!1,e.showGenderBox=!1):"Location"===a?(e.showProviderBox=!1,e.showLocationBox=!0,e.showPriceBox=!1,e.showAgeBox=!1,e.showDayBox=!1,e.showGenderBox=!1):"Price"===a?(e.showProviderBox=!1,e.showLocationBox=!1,e.showPriceBox=!0,e.showAgeBox=!1,e.showDayBox=!1,e.showGenderBox=!1,e.isClearPriceFilter||e.mapPriceRange(e.resolution)):"Age"===a?(e.showProviderBox=!1,e.showLocationBox=!1,e.showPriceBox=!1,e.showAgeBox=!0,e.showDayBox=!1,e.showGenderBox=!1):"Days"===a?(e.showProviderBox=!1,e.showLocationBox=!1,e.showPriceBox=!1,e.showAgeBox=!1,e.showDayBox=!0,e.showGenderBox=!1):"Gender"===a?(e.showProviderBox=!1,e.showLocationBox=!1,e.showPriceBox=!1,e.showAgeBox=!1,e.showDayBox=!1,e.showGenderBox=!0):"clear"===a&&(e.showProviderBox=!1,e.showLocationBox=!1,e.showPriceBox=!1,e.showAgeBox=!1,e.showDayBox=!1,e.showGenderBox=!1)},e.$on("slideEnded",function(){e.priceRangeValue.MaximumPriceValue!==e.priceRangeValue.maxPrice||e.priceRangeValue.minPrice!==e.priceRangeValue.MimPriceValue?(e.priceRangeValue.isTrue=!0,e.isClearPriceFilter=!0,e.$emit("priceRangeValue",e.priceRangeValue),e.getFiltersApplied()):e.priceRangeValue.isTrue&&(e.$emit("priceRangeValue",e.priceRangeValue),e.getFiltersApplied())}),e.isProviderText=!1,e.isLocationText=!1,e.model={providerNmae:"",locationName:""},e.filterCollection=function(a,t){if(a){e.value=[];var i,o=[];"Provider"===t?(e.isProviderText=!0,i=_.first(e.providerDataCollection),o=[],_.isEmpty(i.dcName)?_.isEmpty(i.hospName)||(angular.forEach(e.providerDataCollection,function(t){t.hospName.toLowerCase().indexOf(a.toLowerCase())===-1&&t.selected!==!0||e.value.push(t)}),e.filterPackageCollection.provider=e.value.length>0?e.value:[]):(angular.forEach(e.providerDataCollection,function(t){(t.dcName&&t.dcName.toLowerCase().indexOf(a.toLowerCase())!==-1||t.selected===!0)&&e.value.push(t)}),e.filterPackageCollection.provider=e.value.length>0?e.value:[])):"Gender"===t?(angular.forEach(e.amenitiesDataCollection,function(t){t.name.toLowerCase().indexOf(a.toLowerCase())!==-1&&e.value.push(t)}),e.modifiedDataFordcServices=e.value.length>0?e.value:[]):"Location"===t&&(e.isLocationText=!0,i=_.first(e.providerDataCollection),o=[],_.isEmpty(i.dcLocation)?_.isEmpty(i.hospBranch)||(angular.forEach(e.locationFinalDataCollection,function(t){t.hospBranch.toLowerCase().indexOf(a.toLowerCase())===-1&&t.selectedlocation!==!0||e.value.push(t)}),e.filterLocationDataCollection=e.value.length>0?e.value:[]):(angular.forEach(e.locationFinalDataCollection,function(t){(t.dcLocation&&t.dcLocation.toLowerCase().indexOf(a.toLowerCase())!==-1||t.selectedlocation===!0)&&e.value.push(t)}),e.filterLocationDataCollection=e.value.length>0?e.value:[]))}else"Gender"===t?e.modifiedDataFordcServices=e.amenitiesDataCollection:"Provider"===t?(e.isProviderText=!1,e.model.providerNmae="",e.filterPackageCollection.provider=e.providerDataCollection):"Location"===t&&(e.isLocationText=!1,e.model.locationName="",e.filterLocationDataCollection=e.locationFinalDataCollection)},e.clearFilterText=function(a){"Location"===a?e.filterCollection("",a):"Provider"===a&&e.filterCollection("",a)},e.gender={id:""},e.selectedAgeObj=[],e.selectedGenderObj=[],e.filterOffer=function(){e.isOfferFilter||(angular.noop(),e.offer.isSelected=!0),e.offer.isSelected=!e.offer.isSelected,e.getFiltersApplied()},e.filterHsc=function(){e.isHscFilter||(angular.noop(),e.hsc.isSelected=!0),e.hsc.isSelected=!e.hsc.isSelected,e.getFiltersApplied()},e.filterGoldPartner=function(){e.isGoldPartnerFilter||(angular.noop(),e.goldPartner.isSelected=!0),e.goldPartner.isSelected=!e.goldPartner.isSelected,e.getFiltersApplied()},e.filterAge=function(t){if(e.isAgeFilter)angular.noop();else{e.selectedAgeObj.push(t);var i=a.getUniqId(e.selectedAgeObj);_.forEach(i,function(e,a){e.id===t.id&&(i[a].isSelected=e.isSelected===!1)}),e.packagesIdefilter(i,"Age")}},e.filterGender=function(t){if(e.isGenderFilter)angular.noop();else{e.selectedGenderObj.push(t);var i=a.getUniqId(e.selectedGenderObj);_.forEach(i,function(e,a){e.id===t.id&&(i[a].isSelected=e.isSelected===!1)}),e.packagesIdefilter(i,"Gender")}},e.selectedWeeksrObj=[],e.filterWeeks=function(t){e.selectedWeeksrObj.push(t);var i=a.getUniqId(e.selectedWeeksrObj);_.forEach(i,function(e,a){e.id===t.id&&(i[a].isSelected=e.isSelected===!1)}),e.packagesIdefilter(i,"Week")},e.filterDays=function(e,a){var t=[];return _.forEach(e,function(i,o){_.forEach(i.availableSlots,function(i,o){i.day===a&&t.push(e[o])})}),t},e.filterSelectedCollection=function(a,t,o){var n,s,r=[];if(a.length>0){if(e.filterCollectionData=o,"Provider"===t){var l=[];r=_.first(a),s=[],_.isEmpty(r.dcName)?_.isEmpty(r.hospName)||_.forEach(a,function(a){_.forEach(e.filterCollectionData,function(t,i){a.hospName===t.hospName&&l.push(e.filterCollectionData[i])})}):_.forEach(a,function(a){_.forEach(e.filterCollectionData,function(t,i){a.dcName===t.dcName&&l.push(e.filterCollectionData[i])})}),e.categoryItemCollection=l,e.dummyFilteredCollectionOfProvider=l,n=e.categoryItemCollection}else if("Week"===t)e.searchResultDemoWeekCollection0=[],e.searchResultDemoWeekCollection1=[],e.searchResultDemoWeekCollection2=[],e.searchResultDemoWeekCollection3=[],e.searchResultDemoWeekCollection4=[],e.searchResultDemoWeekCollection5=[],e.searchResultDemoWeekCollection6=[],e.combinedData=[],_.forEach(a,function(a,t){_.forEach(e.filterCollectionData,function(t,i){t.daysSet0===a.day?e.searchResultDemoWeekCollection0.push(e.filterCollectionData[i]):t.daysSet1===a.day?e.searchResultDemoWeekCollection1.push(e.filterCollectionData[i]):t.daysSet2===a.day?e.searchResultDemoWeekCollection2.push(e.filterCollectionData[i]):t.daysSet3===a.day?e.searchResultDemoWeekCollection3.push(e.filterCollectionData[i]):t.daysSet4===a.day?e.searchResultDemoWeekCollection4.push(e.filterCollectionData[i]):t.daysSet5===a.day?e.searchResultDemoWeekCollection5.push(e.filterCollectionData[i]):t.daysSet6===a.day&&e.searchResultDemoWeekCollection6.push(e.filterCollectionData[i])}),e.daysData0=e.searchResultDemoWeekCollection0,e.daysData1=e.searchResultDemoWeekCollection1,e.daysData2=e.searchResultDemoWeekCollection2,e.daysData3=e.searchResultDemoWeekCollection3,e.daysData4=e.searchResultDemoWeekCollection4,e.daysData5=e.searchResultDemoWeekCollection5,e.daysData6=e.searchResultDemoWeekCollection6;var i=0;if(e.daysData0.length>0)for(i=0;i<e.daysData0.length;i++)e.combinedData.push(e.daysData0[i]);if(e.daysData1.length>0)for(i=0;i<e.daysData1.length;i++)e.combinedData.push(e.daysData1[i]);if(e.daysData2.length>0)for(i=0;i<e.daysData2.length;i++)e.combinedData.push(e.daysData2[i]);if(e.daysData3.length>0)for(i=0;i<e.daysData3.length;i++)e.combinedData.push(e.daysData3[i]);if(e.daysData4.length>0)for(i=0;i<e.daysData4.length;i++)e.combinedData.push(e.daysData4[i]);if(e.daysData5.length>0)for(i=0;i<e.daysData5.length;i++)e.combinedData.push(e.daysData5[i]);if(e.daysData6.length>0)for(i=0;i<e.daysData6.length;i++)e.combinedData.push(e.daysData6[i])}),"app.consultation"===i.current.name?s=_.uniq(e.combinedData,function(e){return e.doctorName}):"app.packagesnew"!==i.current.name&&"app.labtest"!==i.current.name||(s=_.uniq(e.combinedData,function(e){return e.trackId})),e.categoryItemCollection=s,e.dummyFilteredCollectionOfWeek=e.categoryItemCollection,n=e.categoryItemCollection;else if("Location"===t){var c=[];r=_.first(a),s=[],_.isEmpty(r.dcLocation)?_.isEmpty(r.hospBranch)||_.forEach(a,function(a){
_.forEach(e.filterCollectionData,function(t,i){(a.hospBranch===t.hospBranch||"home sample collection"===t.homeSampleCollection&&c.indexOf(t)===-1)&&c.push(e.filterCollectionData[i])})}):_.forEach(a,function(a){_.forEach(e.filterCollectionData,function(t,i){(a.dcLocation===t.dcLocation||"home sample collection"===t.homeSampleCollection&&c.indexOf(t)===-1)&&c.push(e.filterCollectionData[i])})}),e.categoryItemCollection=c,e.dummyFilteredCollectionOfLocation=c}n=e.categoryItemCollection,e.$emit("updatedFilterCollection",e.categoryItemCollection)}return n},e.isMin=function(e){for(var a=e[0].start,t=0;t<=e.length-1;t++)Number(e[t].start)<a&&(a=e[t].start);return a},e.isMax=function(e){for(var a=e[0].end,t=0;t<=e.length-1;t++)Number(e[t].end)>a&&(a=e[t].end);return a},e.packagesIdefilter=function(t,i){var o={},n={},s={};t&&("provider"===i.toLowerCase()?(t.selected=t.selected===!1,e.selectedProviderCollection.push(t),e.selectedProviderCollection=_.where(e.selectedProviderCollection,{selected:!0}),e.selectedProviderCollection=a.getUniqCollectionProvider(e.selectedProviderCollection),e.$emit("filterAHCItems",{Provider:e.selectedProviderCollection,Location:e.selectedLocationCollection}),0===e.selectedProviderCollection.length?0===e.selectedWeeksCollection.length&&0===e.selectedLocationCollection.length?(e.categoryItemCollection=e.finalCollection,e.updateFilter(e.categoryItemCollection)):0===e.selectedWeeksCollection.length&&0===e.selectedLocationCollection.length||(e.selectedLocationCollection.length>0&&e.selectedWeeksCollection.length>0?(o=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),n=e.filterSelectedCollection(e.selectedLocationCollection,"Location",o),e.updateFilter(n)):e.selectedWeeksCollection.length>0?(s=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),e.updateFilter(s)):e.selectedLocationCollection.length>0&&(s=e.filterSelectedCollection(e.selectedLocationCollection,"Location",e.finalCollection),e.updateFilter(s))):e.selectedProviderCollection.length>0&&(0===e.selectedWeeksCollection.length&&0===e.selectedLocationCollection.length?(s=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",e.finalCollection),e.updateFilter(s)):0===e.selectedWeeksCollection.length&&0===e.selectedLocationCollection.length||(e.selectedWeeksCollection.length>0&&e.selectedLocationCollection.length>0?(o=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),n=e.filterSelectedCollection(e.selectedLocationCollection,"Location",o),s=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",n),e.updateFilter(s)):e.selectedWeeksCollection.length>0?(o=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),s=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",o),e.updateFilter(s)):e.selectedLocationCollection.length>0&&(n=e.filterSelectedCollection(e.selectedLocationCollection,"Location",e.finalCollection),s=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",n),e.updateFilter(s))))):"week"===i.toLowerCase()?(e.selectedWeeksCollection=_.where(t,{isSelected:!0}),0===e.selectedWeeksCollection.length?0===e.selectedProviderCollection.length&&0===e.selectedLocationCollection.length?(e.categoryItemCollection=e.finalCollection,e.updateFilter(e.categoryItemCollection)):0===e.selectedProviderCollection.length&&0===e.selectedLocationCollection.length||(e.selectedProviderCollection.length>0&&e.selectedLocationCollection.length>0?(0===e.dummyFilteredCollectionOfLocation.length||0===e.dummyFilteredCollectionOfProvider.length?e.categoryItemCollection=[]:(o=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",e.finalCollection),n=e.filterSelectedCollection(e.selectedLocationCollection,"Location",o)),e.updateFilter(n)):e.selectedProviderCollection.length>0?(s=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",e.finalCollection),e.updateFilter(s)):e.selectedLocationCollection.length>0&&(s=e.filterSelectedCollection(e.selectedLocationCollection,"Location",e.finalCollection),e.updateFilter(s))):e.selectedWeeksCollection.length>0&&(0===e.selectedProviderCollection.length&&0===e.selectedLocationCollection.length?(s=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),e.updateFilter(s)):0===e.selectedProviderCollection.length&&0===e.selectedLocationCollection.length||(e.selectedProviderCollection.length>0&&e.selectedLocationCollection.length>0?(o=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",e.finalCollection),n=e.filterSelectedCollection(e.selectedLocationCollection,"Location",o),s=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",n),e.updateFilter(s)):e.selectedProviderCollection.length>0?(o=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",e.finalCollection),s=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",o),e.updateFilter(s)):e.selectedLocationCollection.length>0&&(n=e.filterSelectedCollection(e.selectedLocationCollection,"Location",e.finalCollection),s=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",n),e.updateFilter(s))))):"age"===i.toLowerCase()?(e.selectedAgeCollection=_.where(t,{isSelected:!0}),e.selectedAgeCollection.length>0?(e.ageRangeValue.maxAge=e.isMax(e.selectedAgeCollection),e.ageRangeValue.minAge=e.isMin(e.selectedAgeCollection),e.ageRangeValue.isTrue=!0,e.$emit("updateAgeFilter",e.ageRangeValue)):(e.ageRangeValue.maxAge=100,e.ageRangeValue.minAge=0,e.ageRangeValue.isTrue=!0,e.$emit("updateAgeFilter",e.ageRangeValue))):"gender"===i.toLowerCase()?(e.collection=_.where(t,{isSelected:!0}),1===e.collection.length?(e.genderFilter={type:e.collection[0].gender,isTrue:!0},e.$emit("updateGenderFilter",e.genderFilter)):(e.genderFilter={type:"both",isTrue:!0},e.$emit("updateGenderFilter",e.genderFilter))):"location"===i.toLowerCase()&&(t.hospBranch?(t.selectedlocation===!1?t.selectedlocation=!0:t.selectedlocation===!0&&(t.selectedlocation=!1),e.selectedLocationCollection.push(t)):t.dcLocation?(t.selectedlocation===!1?t.selectedlocation=!0:t.selectedlocation===!0&&(t.selectedlocation=!1),e.selectedLocationCollection.push(t)):e.selectedLocationCollection=[],e.selectedLocationCollection=_.where(e.selectedLocationCollection,{selectedlocation:!0}),e.selectedLocationCollection=a.getUniqCollectionLocation(e.selectedLocationCollection),0===e.selectedLocationCollection.length?0===e.selectedProviderCollection.length&&0===e.selectedWeeksCollection.length?(e.categoryItemCollection=e.finalCollection,e.updateFilter(e.categoryItemCollection)):0===e.selectedProviderCollection.length&&0===e.selectedWeeksCollection.length||(e.selectedProviderCollection.length>0&&e.selectedWeeksCollection.length>0?(o=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),n=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",o),e.updateFilter(n)):e.selectedProviderCollection.length>0?(s=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",e.finalCollection),e.updateFilter(s)):e.selectedWeeksCollection.length>0&&(s=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),e.updateFilter(s))):e.selectedLocationCollection.length>0&&(0===e.selectedProviderCollection.length&&0===e.selectedWeeksCollection.length?(s=e.filterSelectedCollection(e.selectedLocationCollection,"Location",e.finalCollection),e.updateFilter(s)):0===e.selectedProviderCollection.length&&0===e.selectedWeeksCollection.length||(e.selectedProviderCollection.length>0&&e.selectedWeeksCollection.length>0?(o=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),n=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",o),s=e.filterSelectedCollection(e.selectedLocationCollection,"Location",n),e.updateFilter(s)):e.selectedProviderCollection.length>0?(n=e.filterSelectedCollection(e.selectedProviderCollection,"Provider",e.finalCollection),s=e.filterSelectedCollection(e.selectedLocationCollection,"Location",n),e.updateFilter(s)):e.selectedWeeksCollection.length>0&&(o=e.filterSelectedCollection(e.selectedWeeksCollection,"Week",e.finalCollection),s=e.filterSelectedCollection(e.selectedLocationCollection,"Location",o),e.updateFilter(s)))),e.$emit("filterAHCItems",{Provider:e.selectedProviderCollection,Location:e.selectedLocationCollection}))),e.getFiltersApplied()},e.getFilterData=function(t){if(t.length>0&&(e.isAgeFilter="app.consultation"===i.current.name,e.isGenderFilter="app.consultation"===i.current.name,"app.hospitalizationlist"===i.current.name&&(e.isAgeFilter=!0,e.isGenderFilter=!0,e.isWeekFilter=!0,e.isPriceFilter=!1),e.categoryItemCollection=t,e.finalCollection=e.categoryItemCollection,angular.forEach(e.categoryItemCollection,function(a,t){a.selectedlocation=!1,(a.dcLocation||a.hospBranch)&&e.categoryItemCollectionWithLocation.push(e.categoryItemCollection[t])}),e.categoryItemCollection=e.categoryItemCollectionWithLocation,e.locationFinalDataCollection=a.getUniqCollectionLocation(e.categoryItemCollectionWithLocation),e.filterLocationDataCollection=a.getUniqCollectionLocation(e.categoryItemCollectionWithLocation),e.backupuLocation=e.locationFinalDataCollection,e.providerCollection=a.getUniqCollectionProvider(e.categoryItemCollection),e.filterPackageCollection.provider=e.providerCollection,angular.forEach(e.providerCollection,function(a,t){a.dcName&&a.dcName===e.filterProvider&&(e.filterInital=!0,e.filterOnDc=a),a.selected=!1,e.providerCollectionValue.push(e.providerCollection[t])}),e.filterPackageCollection.provider=e.providerCollectionValue,e.filterPackageCollection.dummyProvider=e.providerCollectionValue,e.providerCount=e.filterPackageCollection.provider.length,e.providerDataCollection=e.filterPackageCollection.provider,_.forEach(e.categoryItemCollection,function(a){a.dcServices&&a.dcServices.length>0&&_.forEach(a.dcServices,function(t,i){e.modifiedDataFordcServices.push({id:i+1,name:a.dcServices[i],selected:!1})})}),_.forEach(e.categoryItemCollection,function(e,a){e.dummyDcServices=[]}),e.modifiedDataFordcServices=a.getUniqCollectionName(e.modifiedDataFordcServices),e.amenitiesDataCollection=e.modifiedDataFordcServices,e.NewFieldForDcServices=a.getNewFieldForDcServices(e.modifiedDataFordcServices,e.categoryItemCollection),e.finalCollection=e.categoryItemCollection,e.locSearch)){var o=_.findWhere(e.filterLocationDataCollection,{dcLocation:e.locSearch});o&&e.packagesIdefilter(o,"Location")}e.categoryItemCollection.length>0&&(e.resolution=e.categoryItemCollection,e.mapPriceRange(e.categoryItemCollection)),e.filterInital&&e.filterOnDc&&e.packagesIdefilter(e.filterOnDc,"Provider")},e.clearProviderFilter=function(a){if(e.model.providerNmae="","provider"===a.toLowerCase()){var t=[];angular.forEach(e.filterPackageCollection.dummyProvider,function(a,i){a.selected=!1,t.push(e.filterPackageCollection.dummyProvider[i])}),e.filterPackageCollection.provider=t,e.packagesIdefilter([],"Provider")}},e.clearLocationFilter=function(a){if(e.model.locationName="","location"===a.toLowerCase()){var t=[];e.filterLocationDataCollection=e.backupuLocation,angular.forEach(e.backupuLocation,function(a,i){a.selectedlocation=!1,t.push(e.backupuLocation[i])}),e.filterLocationDataCollection=t,a={dcLocation:""},e.packagesIdefilter(a,"Location")}},e.clearPriceFilter=function(a){"price"===a.toLowerCase()&&(e.priceRangeValue.maxPrice=e.priceRangeValue.MaximumPriceValue,e.priceRangeValue.minPrice=e.priceRangeValue.MimPriceValue,e.priceRangeValue.isTrue=!0,e.isClearPriceFilter=!1,e.$emit("priceRangeValue",e.priceRangeValue))},e.clearAgeFilter=function(a){"age"===a.toLowerCase()&&(e.packagesIdefilter([],"Age"),e.ageRangeValue.maxAge=100,e.ageRangeValue.minAge=0,e.genderFilter={type:"both",isTrue:!1},e.ageGroup=e.changeStatus(o.ageGroup),e.$emit("updateAgeFilter",e.ageRangeValue))},e.clearDaysFilter=function(a){"days"===a.toLowerCase()&&(e.weekGroup=e.changeStatus(o.weekGroup),e.packagesIdefilter([],"Week"))},e.clearGenderFilter=function(a){"gender"===a.toLowerCase()&&(e.genderGroup=e.changeStatus(o.genderGroup),e.packagesIdefilter([],"Gender"))},e.$watch("attributePackages",function(a){a&&(e.attributeAssessment="",e.reloadCollections(),e.clearAllFilterCollection=a,e.getFilterData(a))}),e.$on("applyFilters",function(a,i){i.OnlyDiscounted&&(e.offer.isSelected=!0,e.getFiltersApplied()),i.OnlyPreferredPartners&&(e.goldPartner.isSelected=!0,e.getFiltersApplied()),i.OnlyHSC&&(e.hsc.isSelected=!0,e.getFiltersApplied()),i.Gender&&i.Gender.split(",").forEach(function(a){var t=_.findWhere(e.genderGroup,{gender:a});e.filterGender(t)}),i.Age&&i.Age.split(",").forEach(function(a){var t=_.findWhere(e.ageGroup,{ageGroup:a});e.filterAge(t)}),i.AppointmentDay&&i.AppointmentDay.split(",").forEach(function(a){var t=_.findWhere(e.weekGroup,{day:parseInt(a)});t.isSelected=!1,e.filterWeeks(t)}),i.MedicalCenter&&i.MedicalCenter.split(",").forEach(function(a){var t=_.findWhere(e.filterPackageCollection.provider,{dcName:a});e.packagesIdefilter(t,"Provider")}),i.Location&&i.Location.split(",").forEach(function(a){var t=_.findWhere(e.filterLocationDataCollection,{dcLocation:a});e.packagesIdefilter(t,"Location")}),t(function(){i&&i.PriceRange&&(e.priceRangeValue.minPrice=i.PriceRange.split("-")[0],e.priceRangeValue.maxPrice=i.PriceRange.split("-")[1],e.$emit("slideEnded",e.priceRangeValue))})}),e.$on("$destroy",function(){_.extend(a.filterObj,n)}),e.pipeline={updateFilters:function(a){e.reloadCollections(),e.clearAllFilterCollection=_.union(e.clearAllFilterCollection,a),e.getFilterData(e.clearAllFilterCollection)}}}}}]),e.register.directive("mediAppointmentForm",["$rootScope","navConstantsSvc","$sce","patternService","authService","$state",function(e,a,t,i,o,n){return{restrict:"E",replace:!0,scope:{openForm:"=open",maxHours:"=?",minHours:"=?",validate:"=validate"},templateUrl:"/templates/appointmentForm.html?"+timeStamp,link:function(e){function t(a){var t=a.date,i=e.daysCollection,o=a.mode;return 0===i.length?o="":1===i.length?"day"===o&&t.getDay()===i[0].day:2===i.length?"day"===o&&(t.getDay()===i[0].day||t.getDay()===i[1].day):3===i.length?"day"===o&&(t.getDay()===i[0].day||t.getDay()===i[1].day||t.getDay()===i[2].day):4===i.length?"day"===o&&(t.getDay()===i[0].day||t.getDay()===i[1].day||t.getDay()===i[2].day||t.getDay()===i[3].day):5===i.length?"day"===o&&(t.getDay()===i[0].day||t.getDay()===i[1].day||t.getDay()===i[2].day||t.getDay()===i[3].day||t.getDay()===i[4].day):6===i.length?"day"===o&&(t.getDay()===i[0].day||t.getDay()===i[1].day||t.getDay()===i[2].day||t.getDay()===i[3].day||t.getDay()===i[4].day||t.getDay()===i[5].day):void 0}function s(a){var t=a.date,i=a.mode;if("day"===i)for(var o=new Date(t).setHours(0,0,0,0),n=0;n<e.events.length;n++){var s=new Date(e.events[n].date).setHours(0,0,0,0);if(o===s)return e.events[n].status}return""}e.maxMinCheck=!0,e.calendarCheck=!1,_.isUndefined(e.minHours)&&_.isUndefined(e.minHours)&&(e.maxMinCheck=!1),"app.homehealthcare"!==n.current.name&&"app.genome"!==n.current.name||(e.calendarCheck=!0),e.daysCollection=[],e.takeServerDate=function(){var e=new Date;return o.serverDate&&(e=new Date(o.serverDate)),e},e.today=function(){e.dt=e.takeServerDate()},e.today(),e.inlineOptions={customClass:s,minDate:e.takeServerDate(),showWeeks:!0},e.isError=!1,e.isGenderSelection=!1,e.validateObj=function(a){"alert-danger"===a&&(e.isError=!0),"Gender"===a.type&&(e.isGenderSelection=!0,a.error?e.errorValueForGender=a.error:e.isGenderSelection=!1)},Date.prototype.addDays=function(e){return this.setDate(this.getDate()+parseInt(e)),this},e.daysCount="packageController"===n.current.controller?30:15;var r=e.takeServerDate();r=r.addDays(e.daysCount),e.dateOptions={dateDisabled:t,formatYear:"yy",maxDate:r,minDate:e.takeServerDate(),startingDay:1},e.dateOptionsForDob={formatYear:"yy",maxDate:e.takeServerDate(),minDate:new Date(1917,1,1),startingDay:1},e.popup={prefDate:!1,dateOfBirth:!1},e.openAppointmentDatePicker=function(){e.popup.prefDate=!0,e.popup.dateOfBirth=!1},e.openDobDatePicker=function(){e.popup.prefDate=!1,e.popup.dateOfBirth=!0},e.toggleMin=function(){var a=e.takeServerDate();e.minDate=a.setDate(a.getDate()+2),e.dateOptions.minDate=e.minDate},e.toggleMin(),e.toggleMaxDob=function(){e.dateOptionsForDob.maxDate=e.takeServerDate()},e.toggleMaxDob(),e.setDate=function(a,t,i){e.dt=new Date(a,t,i)},e.formats=["dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],e.format=e.formats[0],e.altInputFormats=["M!/d!/yyyy"],e.appointmentData={patientName:"",email:"",gender:"",phone:"",dateOfBirth:"",genderValue:a.genderTitle,prefDate:"",prefDateTime:"",relation:""},e.setMaxHours=e.maxHours,e.setMinHours=e.minHours,e.hstep=1,e.mstep=30,e.relation=a.relation,e.appointmentData.relation=e.relation[0],e.appointmentData.relationID=e.relation[0],e.genderData=a.gender,e.setDate=function(a,t,i){return e.dt=e.minDate,e.dt},e.emailPattern=i,e.newDate=e.takeServerDate();var l=e.newDate.getFullYear()-100;e.minDob=new Date(l,1,1),e.format=a.dateFormate,e.openPopup={opened:!1,openDobPopup:!1},e.user=o.isUserSignedin(),e.user&&(e.appointmentData.patientName=e.user.userDetails.displayName,e.appointmentData.email=e.user.userDetails.email,e.appointmentData.phone=e.user.userDetails.phone),e.cancelBooking=function(){e.$emit("cancelBooking",{})},e.appointmentDetails={packageData:{},userData:{}},e.daysCounts=[{day:1},{day:2},{day:3},{day:4},{day:5},{day:6},{day:0}],Date.prototype.addDays1=function(e){var a=new Date(this.valueOf());return a.setDate(a.getDate()+e),a},e.getDates=function(e,a){for(var t=[],i=e;i<=a;)t.push(i),i=i.addDays1(1);return t},e.openFormView=function(a){"app.consultation"===n.current.name?e.isPriceText=!0:e.isPriceText=!1,e.appointmentDetails.packageData=a,e.daysCountForPackage=[],angular.forEach(e.appointmentDetails.packageData.availableSlots,function(a,t){a.dayOfWeek&&e.daysCountForPackage.push({day:a.day})}),e.daysCollection=_.filter(e.daysCounts,function(a){return!_.findWhere(e.daysCountForPackage,a)});var t="app.consultation"===n.current.name?14:29,i=e.getDates(new Date(o.serverDate),new Date(o.serverDate).addDays(t));e.dateArray=[];for(var s=0;s<i.length;s++)e.dateArray.push({id:s+1,showPopover:!1,isOpen:!1,isSelected:!1,date:new Date(i[s]),isDay:!1,day:new Date(i[s]).getDay()});angular.forEach(e.dateArray,function(a,t){angular.forEach(e.appointmentDetails.packageData.availableSlots,function(i,o){i.day===a.day&&(e.dateArray[t].isDay=!0,1!==e.dateArray[t].id&&2!==e.dateArray[t].id||(e.dateArray[t].isDay=!1))})})},e.isopenlogin=!1,e.isPreviousValue={cursor:"not-allowed"},e.startWith=0,e.previousWith=0,e.next=function(){e.startWith++,e.increasedValue=e.startWith,30===e.dateArray.length?e.increasedValue<=4?(e.previousValue=e.increasedValue,e.nextCss=1===e.previousValue?420:2===e.previousValue?840:3===e.previousValue?1260:4===e.previousValue?1610:"",e.myStyle={"margin-left":-e.nextCss+"px"}):e.startWith=e.previousValue:15===e.dateArray.length&&(e.increasedValue<=8?(e.previousValue=e.increasedValue,e.nextCss=70*e.increasedValue,e.myStyle={"margin-left":-e.nextCss+"px"}):e.startWith=e.previousValue),e.isPreviousValue={}},e.startWith=0,e.previous=function(){var a;if(15===e.dateArray.length)if(e.startWith>1&&(e.startWith--,a=e.startWith),e.previousWith=a?a:0,0!==e.previousWith){var t=e.previousWith;e.previousCss=70*t,e.myStyle={"margin-left":-e.previousCss+"px"}}else 0===e.previousWith&&(e.myStyle={"margin-left":"0px"},e.isPreviousValue={cursor:"not-allowed"});else if(30===e.dateArray.length){e.nextCss=1===e.previousValue?0:2===e.previousValue?-420:3===e.previousValue?-840:4===e.previousValue?-1260:0,0===e.nextCss?e.isPreviousValue={cursor:"not-allowed"}:e.isPreviousValue={},e.myStyle={"margin-left":e.nextCss+"px"};var i=e.previousValue-1;e.previousValue=i,e.startWith=e.previousValue}},e.showPopover=!1,e.pad=function(a,t){return a=a.toString(),a.length<t?e.pad("0"+a,t):a},e.calculateTimeSlots=function(e){var a=[],t=0,i=0;t=e.slotStartTime,i=e.slotEndTime;for(var o=t;o<i;o++){var n;o===t?n=t:(n=t+30,t=n),i>=n&&a.push({slotStartTime:n})}return a},e.devideTimeSlots=function(a){return angular.forEach(a,function(t,i){if(t.slotStartTime){var o=t.slotStartTime%60,n="",s=Math.floor(t.slotStartTime/60);s>=12?(n="PM",12===s?s=s:s-=12):n="AM";var r=e.pad(s,"2")+":"+e.pad(o,"2");a[i].startTime=r,a[i].isSelected=!1,a[i].startTimeAmPm=n}}),a},e.slot1=[],e.slot2=[],e.slot3=[],e.slot4=[],e.slot5=[],e.slot6=[],e.slot7=[],e.slot8=[],e.slot9=[],e.slot10=[],e.pickTimeWithoutSlot=function(a){e.tempData&&(e.tempData.isSelected=!1),e.tempData=a,a.isSelected=!0,e.isSelectedPreferdTime=!0,e.appointmentData.prefDateTime=a.date,e.preferdStartTime=a.date,e.FinalTime=a.date},e.pickTime=function(a,t){if(e.preferdStartTime="",e.pickTimeIndex=t,a.isDay===!0){e.dayPrefered=a.date,a.showPopover=!a.showPopover,e.selectedDayTime=[];e.appointmentDetails.packageData.availableSlots;angular.forEach(e.appointmentDetails.packageData.availableSlots,function(t,i){t.day===a.day&&angular.forEach(t,function(a,t){e.selectedDayTime.push(a)})});var i,o,n,s,r,l,c,d,p,m;1===e.selectedDayTime[1].length&&0===e.slot1.length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),e.slot1=e.devideTimeSlots(i),e.slot2=[],e.slot3=[],e.slot4=[],e.slot5=[],e.slot6=[]):2===e.selectedDayTime[1].length&&0===e.slot2.length&&0===e.slot1.length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=[],e.slot4=[],e.slot5=[],e.slot6=[],e.slot7=[],e.slot8=[],e.slot9=[],e.slot10=[]):3===e.selectedDayTime[1].length&&0===e.slot2.length&&0===e.slot1.length&&0===e.slot3.length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),n=e.calculateTimeSlots(e.selectedDayTime[1][2]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=e.devideTimeSlots(n),e.slot4=[],e.slot5=[],e.slot6=[],e.slot7=[],e.slot8=[],e.slot9=[],e.slot10=[]):4===e.selectedDayTime[1].length&&0===e.slot2.length&&0===e.slot1.length&&0===e.slot3.length&&0===e.slot3.length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),n=e.calculateTimeSlots(e.selectedDayTime[1][2]),s=e.calculateTimeSlots(e.selectedDayTime[1][3]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=e.devideTimeSlots(n),e.slot4=e.devideTimeSlots(s),e.slot5=[],e.slot6=[],e.slot7=[],e.slot8=[],e.slot9=[],e.slot10=[]):5===e.selectedDayTime[1].length&&0===e.slot2.length&&0===e.slot1.length&&0===e.slot3.length&&0===e.slot4.length&&0===e.slot5.length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),n=e.calculateTimeSlots(e.selectedDayTime[1][2]),s=e.calculateTimeSlots(e.selectedDayTime[1][3]),r=e.calculateTimeSlots(e.selectedDayTime[1][4]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=e.devideTimeSlots(n),e.slot4=e.devideTimeSlots(s),e.slot5=e.devideTimeSlots(r),e.slot6=[],e.slot7=[],e.slot8=[],e.slot9=[],e.slot10=[]):6===e.selectedDayTime[1].length&&0===e.slot2.length&&0===e.slot1.length&&0===e.slot3.length&&0===e.slot4.length&&0===e.slot5.length&&0===e.slot6.length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),n=e.calculateTimeSlots(e.selectedDayTime[1][2]),s=e.calculateTimeSlots(e.selectedDayTime[1][3]),r=e.calculateTimeSlots(e.selectedDayTime[1][4]),l=e.calculateTimeSlots(e.selectedDayTime[1][5]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=e.devideTimeSlots(n),e.slot4=e.devideTimeSlots(s),e.slot5=e.devideTimeSlots(r),e.slot6=e.devideTimeSlots(l),e.slot7=e.devideTimeSlots(c),e.slot8=[],e.slot9=[],e.slot10=[]):7===e.selectedDayTime[1].length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),n=e.calculateTimeSlots(e.selectedDayTime[1][2]),s=e.calculateTimeSlots(e.selectedDayTime[1][3]),r=e.calculateTimeSlots(e.selectedDayTime[1][4]),l=e.calculateTimeSlots(e.selectedDayTime[1][5]),c=e.calculateTimeSlots(e.selectedDayTime[1][6]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=e.devideTimeSlots(n),e.slot4=e.devideTimeSlots(s),e.slot5=e.devideTimeSlots(r),e.slot6=e.devideTimeSlots(l),e.slot7=e.devideTimeSlots(c),e.slot8=[],e.slot9=[],e.slot10=[]):8===e.selectedDayTime[1].length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),n=e.calculateTimeSlots(e.selectedDayTime[1][2]),s=e.calculateTimeSlots(e.selectedDayTime[1][3]),r=e.calculateTimeSlots(e.selectedDayTime[1][4]),l=e.calculateTimeSlots(e.selectedDayTime[1][5]),c=e.calculateTimeSlots(e.selectedDayTime[1][6]),d=e.calculateTimeSlots(e.selectedDayTime[1][7]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=e.devideTimeSlots(n),e.slot4=e.devideTimeSlots(s),e.slot5=e.devideTimeSlots(r),e.slot6=e.devideTimeSlots(l),e.slot7=e.devideTimeSlots(c),e.slot8=e.devideTimeSlots(d),e.slot9=[],e.slot10=[]):9===e.selectedDayTime[1].length?(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),n=e.calculateTimeSlots(e.selectedDayTime[1][2]),s=e.calculateTimeSlots(e.selectedDayTime[1][3]),r=e.calculateTimeSlots(e.selectedDayTime[1][4]),l=e.calculateTimeSlots(e.selectedDayTime[1][5]),c=e.calculateTimeSlots(e.selectedDayTime[1][6]),d=e.calculateTimeSlots(e.selectedDayTime[1][7]),p=e.calculateTimeSlots(e.selectedDayTime[1][8]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=e.devideTimeSlots(n),e.slot4=e.devideTimeSlots(s),e.slot5=e.devideTimeSlots(r),e.slot6=e.devideTimeSlots(l),e.slot7=e.devideTimeSlots(c),e.slot8=e.devideTimeSlots(d),e.slot9=e.devideTimeSlots(p),e.slot10=[]):10===e.selectedDayTime[1].length&&(i=e.calculateTimeSlots(e.selectedDayTime[1][0]),o=e.calculateTimeSlots(e.selectedDayTime[1][1]),n=e.calculateTimeSlots(e.selectedDayTime[1][2]),s=e.calculateTimeSlots(e.selectedDayTime[1][3]),r=e.calculateTimeSlots(e.selectedDayTime[1][4]),l=e.calculateTimeSlots(e.selectedDayTime[1][5]),c=e.calculateTimeSlots(e.selectedDayTime[1][6]),d=e.calculateTimeSlots(e.selectedDayTime[1][7]),p=e.calculateTimeSlots(e.selectedDayTime[1][8]),m=e.calculateTimeSlots(e.selectedDayTime[1][9]),e.slot1=e.devideTimeSlots(i),e.slot2=e.devideTimeSlots(o),e.slot3=e.devideTimeSlots(n),e.slot4=e.devideTimeSlots(s),e.slot5=e.devideTimeSlots(r),e.slot6=e.devideTimeSlots(l),e.slot7=e.devideTimeSlots(c),e.slot8=e.devideTimeSlots(d),e.slot9=e.devideTimeSlots(p),e.slot10=e.devideTimeSlots(m)),e.isTime=!0}else e.isTime=!1},e.dynamicPopover={templateUrl:"myPopoverTemplate.html"},e.close=function(){e.dateArray[e.pickTimeIndex].isOpen=!1,e.FinalTime=e.preferdStartTime},e.selectedTime=function(a,t){"one"===t?(angular.forEach(e.slot1,function(t,i){t.slotStartTime===a.slotStartTime&&t.startTime===a.startTime&&t.isSelected===a.isSelected?e.slot1[i].isSelected=!0:e.slot1[i].isSelected=!1}),angular.forEach(e.slot2,function(a,t){e.slot2[t].isSelected=!1}),angular.forEach(e.slot3,function(a,t){e.slot3[t].isSelected=!1}),angular.forEach(e.slot4,function(a,t){e.slot4[t].isSelected=!1})):"two"===t?(angular.forEach(e.slot2,function(t,i){t.slotStartTime===a.slotStartTime&&t.startTime===a.startTime&&t.isSelected===a.isSelected?e.slot2[i].isSelected=!0:e.slot2[i].isSelected=!1}),angular.forEach(e.slot1,function(a,t){e.slot1[t].isSelected=!1}),angular.forEach(e.slot3,function(a,t){e.slot3[t].isSelected=!1}),angular.forEach(e.slot4,function(a,t){e.slot4[t].isSelected=!1})):"three"===t?(angular.forEach(e.slot3,function(t,i){t.slotStartTime===a.slotStartTime&&t.startTime===a.startTime&&t.isSelected===a.isSelected?e.slot3[i].isSelected=!0:e.slot3[i].isSelected=!1}),angular.forEach(e.slot2,function(a,t){e.slot2[t].isSelected=!1}),angular.forEach(e.slot1,function(a,t){e.slot1[t].isSelected=!1}),angular.forEach(e.slot4,function(a,t){e.slot4[t].isSelected=!1})):"four"===t&&(angular.forEach(e.slot4,function(t,i){t.slotStartTime===a.slotStartTime&&t.startTime===a.startTime&&t.isSelected===a.isSelected?e.slot4[i].isSelected=!0:e.slot4[i].isSelected=!1}),angular.forEach(e.slot2,function(a,t){e.slot2[t].isSelected=!1}),angular.forEach(e.slot3,function(a,t){e.slot3[t].isSelected=!1}),angular.forEach(e.slot1,function(a,t){e.slot1[t].isSelected=!1})),e.preferdStartTime=a.startTime+a.startTimeAmPm,e.isSelectedPreferdTime=!0,e.currentDay=e.dayPrefered,angular.forEach(e.dateArray,function(a,t){e.dateArray[t].isSelected=!1});var i=_.findWhere(e.dateArray,{date:e.currentDay});i.isSelected=!0,e.dateArray.push(i),e.dateArray=o.getUniqId(e.dateArray);var n=a.slotStartTime%60,s=0,r=0,l=Math.floor(a.slotStartTime/60),c=new Date(e.currentDay.getFullYear(),e.currentDay.getMonth(),e.currentDay.getDate(),l,n,s,r);e.appointmentData.prefDateTime=c,e.isError=!1},e.bookAppointmentForUser=function(){e.appointmentDetails.userData&&e.appointmentData.prefDateTime&&e.appointmentDetails.packageData?(e.appointmentData.relation=e.appointmentData.relation.name,e.appointmentDetails.userData=e.appointmentData,e.$emit("bookAppointmentForUser",e.appointmentDetails),e.appointmentData.relation=e.relation[0]):e.validateObj("alert-danger")},e.$watch("openForm",function(a){a&&(e.openForm="",e.isRegistration="app.consultation"===n.current.name,e.openFormView(a))}),e.$watch("validate",function(a){a&&e.validateObj(a)})}}}]),e.register.directive("multiSelectDate",["$filter",function(e){return{restrict:"E",require:"?ngModel",scope:{endYear:"=enddate",startYear:"=startYear",checkDate:"=checkDate",order:"=order",disabled:"=disabled"},templateUrl:"/templates/dateOfBirth.html?"+timeStamp,link:function(a,t,i,o){if(o){o.$render=function(){a.date={day:e("date")(o.$viewValue,"dd"),month:e("date")(o.$viewValue,"MM"),year:e("date")(o.$viewValue,"yyyy")}},i.endYear=a.endYear,i.startYear=a.startYear,a.yearOrder=!i.yearOrder||"asc"!==i.yearOrder;var n=i.endYear||(new Date).getFullYear(),s=i.startYear||s-100;a.selects={days:function(){for(var e=new Date(a.date.year,a.date.month,0).getDate()||31,t=[],i=1;i<=e;i++){var o=i.toString();t.push(o.length<2?"0"+o:o)}return t},months:function(){for(var e=[],a=1;a<=12;a++){var t=a.toString();e.push(t.length<2?"0"+t:t)}return e},years:function(){for(var e=[],a=n;a>=s;a--)e.push(a.toString());return e}},a.$watch("date",function(e){if(i.required){var t=!!e.year&&parseInt(e.year)<=n&&parseInt(e.year)>=s,r=!!e.month,l=!!e.day;a.checkDate&&"lesser"===a.order?e.year&&parseInt(e.year)===a.checkDate.getFullYear()?e.month&&parseInt(e.month)-1===a.checkDate.getMonth()?e.day&&parseInt(e.day)>=a.checkDate.getDate()&&(l=!1):e.month&&parseInt(e.month)-1>a.checkDate.getMonth()&&(r=!1,l=!1):e.year&&parseInt(e.year)>a.checkDate.getFullYear()&&(t=!1,r=!1,l=!1):a.checkDate&&"greater"===a.order&&(e.year&&parseInt(e.year)===a.checkDate.getFullYear()?e.month&&parseInt(e.month)-1===a.checkDate.getMonth()?e.day&&parseInt(e.day)<a.checkDate.getDate()&&(l=!1):e.month&&parseInt(e.month)-1<a.checkDate.getMonth()&&(r=!1,l=!1):e.year&&parseInt(e.year)<a.checkDate.getFullYear()&&(t=!1,r=!1,l=!1)),o.$setValidity("required",!!(t||r||l)),o.$setValidity("yearRequired",!!t),o.$setValidity("monthRequired",!!r),o.$setValidity("dayRequired",!!l),t&&r&&l&&o.$setViewValue(new Date(e.year,e.month-1,e.day))}else e.year&&e.month&&e.day?o.$setViewValue(new Date(e.year,e.month-1,e.day)):e.year&&e.month&&e.day&&o.$setViewValue(new Date(e.year,e.month-1,e.day))},!0)}}}}]),e.register.directive("mediBookAndPay",["$rootScope","navConstantsSvc","$sce","patternService","authService","$stateParams","$state","apiProvider","$window","$uibModal","$timeout","Idle","$interval","$http","notify","medsService","$location","localStorageService",function(e,t,i,o,n,s,r,l,c,d,p,m,g,u,h,f,y,v){return{restrict:"E",scope:{openForm:"=?",maxHours:"=?",minHours:"=?",validate:"=?"},templateUrl:"/templates/bookAndPaymentPopup.html?"+timeStamp,link:function(k){function b(){k.user=n.isUserSignedin();var e=a.getFlatProperty(k.user,"userDetails.userId"),t=a.getFlatProperty(k.user,"userDetails.pmEntityID"),i=a.getFlatProperty(k.user,"corpDetails.iwpEmployeeId"),o=a.getFlatProperty(k.user,"token");
if(e&&t&&i&&o){var s={medibuddyUserId:e,empId:i,pmEntityId:t},r={method:"POST",url:l.docsappBackend+"/mbweb/checkUserWhatsappConsent",headers:{shorttoken:o,medibuddyuserid:e,pmentityid:t,empid:i},ignoreLoadingBar:!0,data:s};u(r).then(function(e){e&&e.data&&e.data.success&&e.data.show&&(k.showWhatsappConsent=!0)})}}function D(){k.userObj=n.isUserSignedin(),k.showCoPayNote=!1,k.userObj||r.go("app.home",{},{reload:"app.home"}),k.userObj&&k.userObj.isRetailUser&&(k.retailUser=!0,k.disableGender=!1),11186744==k.user.userDetails.pmEntityID&&(k.disableDate=!0),k.strikeNavyaPkgAmount=a.getFlatProperty(n,"detailsForBooking.docObj.strikePackageAmount"),k.programType&&(k.disableGender=!0,k.disableName=!0,k.disableDate=!0,k.disableEmail=!0),k.userObj&&k.userObj.userDetails&&k.userObj.corpDetails&&k.userObj.corpDetails.employeeDetail&&k.userObj.corpDetails.employeeDetail.iwpBeneficiaries&&k.userObj.corpDetails.employeeDetail.iwpBeneficiaries.length>0&&(k.relation=k.userObj.corpDetails.employeeDetail.iwpBeneficiaries.map(function(e){return e}),k.strikeNavyaPkgAmount&&t.wiproIds.indexOf(k.userObj.userDetails.pmEntityID)>-1&&(k.relation=_.filter(k.relation,function(e){return _.contains(A,e.relationId)})),t.intelEntityIds.indexOf(k.userObj.userDetails.pmEntityID)>-1&&(k.intelEmp=!0),t.deloitteIds.indexOf(k.userObj.userDetails.pmEntityID)<0&&t.ibmEntityIds.indexOf(k.userObj.userDetails.pmEntityID)<0&&!k.intelEmp&&!k.isNavya&&k.relation.push({maid:0,relationName:"Others"}),k.retailUser=!1),k.userObj&&k.userObj.userDetails&&""!=(t.copayEntities[k.userObj.userDetails.pmEntityID]||"")&&(k.isCopay=!0,k.coPayPercentage=t.copayEntities[k.userObj.userDetails.pmEntityID])}function C(){u.get(l.medsService+"app/getDynamicEdd",{headers:{source:"web"}}).then(function(e){e.data.message&&e.data.message.STORE_PICKUP&&(k.storePickupIsAvailable=!0)})}function P(){k.isHomeSampleCollection&&!k.medicine||k.isCovid?k.userAddresses=_.filter(k.userAddresses,function(e){var a=e.city?t.cityTags[e.city.toLowerCase()]||e.city.toLowerCase():"";return a==n.getCity().toLowerCase()}):a.validatePIN(s.searchc)&&(k.userAddresses=_.filter(k.userAddresses,function(e){return e.pincode==s.searchc}))}function w(e,a){var t={orderId:e,browser_fingerprint_id:a};n.makeAjaxCalls("https://www.medibuddy.in/websiteapp/CreateOrderIdBrowserIdMapping",t,"POST").then(function(e){console.log("api called branch")})["catch"](function(e){console.log("error while createOrderIdBrowserFingerprintIdMapping"+e)})}function S(e){return e.getDate()<=k.currentDate.getDate()&&e.getMonth()==k.currentDate.getMonth()&&e.getFullYear()==k.currentDate.getFullYear()}window._MB_Analytics.__push({isCleverTap:!1,isGoogle:!0,name:"pageview",payload:window._Site_Props.__getEventParameters({google:window._Site_Props.__googleTransform("customer details Payment page.")})}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:!0,hj:!0,name:"OrderDetails",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0})}),c.scrollTo(0,0),v.setStorageType("sessionStorage"),s.reorder===!0&&(k.isReOrder=!0),n.reOrderId=null,n.reorder=null,k.uploadrx=!0,k.medicineFlow=t.uploadRxInstructions,k.medsPayment=v.get("medsPayment"),v.setStorageType("localStorage"),k.paymentBlockingCss=!1,k.currentDate=new Date,k.submitted=!1,k.emailPattern=o,k.navyaRedirect="",k.resData={};var T=null;k.showWhatsappConsent=!1,f.getCart().then(function(e){e&&e.items&&e.items.length>0&&(k.uploadrx=!1)}),b(),k.appointmentData={patientName:"",userConsent:!0,email:"",gender:"",phone:"",dateOfBirth:"",genderValue:t.genderTitle,prefDateTime:"",relation:"Self",isCashless:!1};var A=t.coreRelationIds;if(s.memberInfo){k.programType=s.searchk;var I=s.memberInfo;k.appointmentData.patientName=I.name,k.appointmentData.email=I.emailId,k.appointmentData.gender=I.gender||"F",k.appointmentData.genderValue=I.genderValue||"Female",k.appointmentData.phone=I.mobileNo,k.appointmentData.dateOfBirth=new Date(parseInt(I.dob.replace("/Date(","").replace(")/",""))),k.appointmentData.prefDateTime=I.lmpDate,k.appointmentData.relation="relation"in(I.details||{})}s.categoryItemTypeId===t.navyaId?(k.isNavya=!0,k.eventCategory="Navya"):k.programType&&(k.eventCategory=k.programType,window._Site_Props.__setServiceDetails({serviceName:"Program",serviceType:k.eventCategory})),k.resetPaymentCustomParams=function(){k.paymentCustomParams={MAWalletUsage:0,MBWalletUsage:0,CorpWalletUsage:0,couponDiscount:0,couponCodeApplied:"",referredBy:"",razorPaymentAmount:""}},k.billWalletUpdation=function(){k.checkoutPricing.walletAmount>=k.checkoutPricing.price?(k.checkoutPricing.walletDeduction=k.checkoutPricing.price,k.checkoutPricing.price=0):(k.checkoutPricing.walletDeduction=k.checkoutPricing.walletAmount,k.checkoutPricing.price=k.checkoutPricing.price-parseInt(k.checkoutPricing.walletAmount))},k.setPaymentCustomParams=function(e,a){k.paymentCustomParams[e]=a},k.resetPaymentCustomParams(),k.getMembershipDetailForUser=function(){k.membershipDetail=[],k.userObj&&n.makeAjaxCalls(l.apiUrl+"/GetRegisteredMembersForProgram",{EnrolType:"MEMBERSHIP"},"POST",k.userObj.token).then(function(e){_.isEmpty(e.data.membershipDetail)||(k.membershipDetail=e.data.membershipDetail)})},k.selectRelation=function(e){if(k.appointmentData.relation=e.relationName,k.appointmentData.gender=e.gender,k.appointmentData.gender&&"string"==typeof k.appointmentData.gender){var a=k.appointmentData.gender.toLowerCase();"male"===a?k.appointmentData.gender="M":"female"===a&&(k.appointmentData.gender="F")}k.appointmentData.patientName=e.name,k.disableName=!!k.appointmentData.patientName,k.disableGender=!!k.appointmentData.gender,e.dob?k.appointmentData.dateOfBirth=new Date(parseInt(e.dob.replace("/Date(","").replace(")/",""))):k.appointmentData.dateOfBirth="",k.appointmentData.maid=e.maid};var O=function(e){k.disableBenefSelection=!1;var a,t=!1;if(e&&(e.maid&&k.relation&&(e.maid=parseInt(e.maid),e.maid&&(a=k.relation.find(function(a){return a.maid===e.maid})),a?(k.selectRelation(a),k.disableBenefSelection=k.disableName&&k.disableGender,t=!0):(a=k.relation.find(function(e){return 0===e.maid}),a&&k.selectRelation(a))),t||(e.patientName&&(k.appointmentData.patientName=e.patientName),e.dob?k.appointmentData.dateOfBirth=new Date(parseInt(e.dob.replace("/Date(","").replace(")/",""))):k.appointmentData.dateOfBirth=""),e.gender&&"string"==typeof e.gender)){var i=e.gender.toLowerCase();"male"===i||"m"===i?k.appointmentData.gender="M":"female"!==i&&"f"!==i||(k.appointmentData.gender="F")}};if(k.checkCashlessLabel=function(){var e=_.findWhere(n.walletConfigs,{walletName:"MAWallet"});!_.isEmpty(e)&&e.eligibleContracts&&e.eligibleContracts.indexOf(t.consultationContract)&&(k.showNocashless=!0)},D(),k.getMembershipDetailForUser(),s.categoryItemTypeId===t.investigationId&&(k.fromLabTest=!0),k.packageWithoutMembership=!1,s.pB&&(k.bookNonMa=!0,k.poweredBy=s.pB,k.checkCashlessLabel(),s.categoryItemTypeId===t.consultationId&&(k.packageWithoutMembership=!0)),k.userObj&&k.userObj.userDetails&&t.ibmEntityIds.indexOf(k.userObj.userDetails.pmEntityID)>=0&&(k.showCoPayNote=!0,k.copayValue=50),k.userObj&&k.userObj.userDetails&&t.intelEntityIds.indexOf(k.userObj.userDetails.pmEntityID)>=0&&(k.showCoPayNote=!0,k.copayValue=20),k.storePickupIsAvailable=!1,C(),n.profileInfo&&n.profileInfo.userAddresses&&n.profileInfo.userAddresses.length>0&&(k.userAddresses=n.profileInfo.userAddresses,P()),k.validateObj=function(e){"alert-danger"===e&&(k.isError=!0),"Gender"===e.type&&(k.isGenderSelection=!0,e.error?k.errorValueForGender=e.error:k.isGenderSelection=!1),"Coupon"===e.type&&e.error&&(k.errorValueForCoupon=e.error),"Wallet"===e.type&&(k.wallet.isPayByMBWallet=!1,e.error?(k.isWalletFailure=!0,k.errorValueForWallet=e.error):k.isWalletFailure=!1)},k.couponListingOpen=function(){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:!k.medicine||"meds",hj:!0,name:k.medicine?"MedsApplyCouponClick":"Coupon Click",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Coupon Click")})});d.open({animation:!0,windowClass:"couponpage",templateUrl:"templates/couponListingPopup.html?"+timeStamp,controller:["$uibModalInstance","$scope","$rootScope","$timeout","$http","patternService","authService","$window","$state","$uibModal","notify","$sce","$stateParams",function(a,t,i,o,n,s,r,d,p,m,g,u,h){function y(){var e=l.apiUrl+"/CouponList.json";r.makeAjaxCalls(e,{},"POST",k.userObj.token).then(function(e){200===e.status&&e.data.isSuccess&&(t.couponList=e.data.coupons)})}function v(e,t){k.applyCoupon(e,t),a.dismiss("cancel")}t.couponList=[],t.txtCouponCode=k.validatedCouponCode,t.appliedCouponCode=k.validatedCouponCode,t.isMobileView=e.isMobileView,t.closeModal=function(){a.dismiss("cancel")},t.validateCoupon=function(e){if(e)if(k.medicine)f.addCoupon({couponCode:e,prePaymentCartId:k.checkoutData.prePaymentCartId,walletRequest:k.checkoutData,walletRequest:{bookingSource:"web"}},k).then(function(t){return 0==t.checkoutResponse.priceObj.isCoupanApplied?void g({message:"Invalid Coupon Code.",position:"center",duration:5e3}):(a.dismiss("cancel"),k.checkoutResponseData=t,k.gatewayTitle=u.trustAsHtml(k.checkoutResponseData.checkoutResponse.priceObj.gatewayTitle),k.disclaimerText=u.trustAsHtml(k.checkoutResponseData.checkoutResponse.priceObj.disclaimerText),k.isCouponCodeNotEmpty=!!e,k.validatedCouponCode=t.checkoutResponse.priceObj.isCoupanApplied?e:"",1==t.purelyRx&&(k.purelyRx=t.purelyRx,k.purelyRxText=t.purelyRxText),t.checkoutResponse.priceObj&&t.checkoutResponse.priceObj.coupanInfo&&t.checkoutResponse.priceObj.coupanInfo.discountAmount&&(k.mediMarketPayment={couponDiscount:t.checkoutResponse.priceObj.coupanInfo.discountAmount},k.couponCode=e),k.checkoutPricing={totalPrice:t.checkoutResponse.priceObj.totalPrice,partnerDiscountAmount:t.checkoutResponse.priceObj.discount.find(function(e){return"partnerDiscountAmount"===e.name}).value||0,firstOrderDiscount:t.checkoutResponse.priceObj.discount.find(function(e){return"firstOrderDiscount"===e.name}).value||0,walletDeduction:t.checkoutResponse.priceObj.cashlessAmount,finalPrice:t.checkoutResponse.priceObj.finalPrice,price:t.checkoutResponse.priceObj.finalPrice},t)});else{t.appliedCouponCode="",t.errorMessage="";var i={PackageId:r.detailsForBooking.docObj.packageId,ProviderID:r.detailsForBooking.docObj.dcId,DoctorUniqueId:r.detailsForBooking.docObj.doctorUniqueId?r.detailsForBooking.docObj.doctorUniqueId:"",CouponCode:e,Gender:k.appointmentData.gender,City:k.appointmentPackageData.citySelected,ApplicableDate:k.appointmentData.prefDateTime||new Date,Relation:k.appointmentData.relation};k.fromLabTest&&(i.isForCheckedOutOrder=!0);var o;c.location.href.includes("Medicine")?(o=l.siteUrl+"medibuddy/couponApply",i.service="Meds",i.quoteNumber=1,i.couponCode=e,i.amount=r.bookedAppointmentDetails.medicineCart.totalPrice):o=l.apiUrl+"/CheckCouponCodeApplicability.json",r.makeAjaxCalls(o,i,"POST",k.user.token).then(function(a){return t.appliedCouponCode=e,a.data.isSuccess&&a.data.response.isApplicable?a.data.response.discount||!a.data.response.finalPrice||k.medicine?(k.medsSale=a,v(e,a)):t.errorMessage="Could not apply coupon code.":void(t.errorMessage=a.data.response?a.data.response.message:a.data.response.message)})["catch"](function(e){t.errorMessage="Could not apply coupon code.",g({message:"Could not apply coupon code.",position:"center",duration:5e3})})}},y()}],size:"full-height-mobile"})},!k.retailUser&&k.relation&&!k.programType)for(var L=0;L<k.relation.length;L++)if("string"==typeof k.relation[L].relationName&&"self"===k.relation[L].relationName.toLowerCase()){k.selectRelation(k.relation[L]);break}k.initializeBilldeskPayment=function(e){bdPayment.initialize({msg:e.msg,options:{enableChildWindowPosting:e.options.enableChildWindowPosting,enablePaymentRetry:e.options.enablePaymentRetry,retry_attempt_count:e.options.retry_attempt_count,txtPayCategory:e.options.txtPayCategory},callbackUrl:e.callbackUrl})},k.takeServerDate=function(){var e="";return e=n.serverDate?new Date(n.serverDate):new Date},k.today=function(){k.dt=k.takeServerDate()},k.openDobDatePicker=function(){k.popup.prefDate=!1,k.popup.dateOfBirth=!0},k.toggleMaxDob=function(){k.dateOptionsForDob.maxDate=k.takeServerDate()},k.setDate=function(e,a,t){k.dt=new Date(e,a,t)},k.cancelBooking=function(){k.$emit("cancelBooking",{})},k.initializePayment=function(){if(k.bookedAppointmentDetails=n.bookedAppointmentDetails,k.bookedAppointmentDetails.couponCode="",k.errorValueForCoupon="",k.wallet={gatewayAmount:"",totalAmount:"",walletAmount:"",isPayByMBWallet:"",isPayByCorpWallet:"",isPayByMAWallet:""},k.isPayment=!0,k.mediMarketPayment={isCod:!1,amountAfterCouponDiscount:k.bookedAppointmentDetails.finalPrice},k.finalPayment=k.bookedAppointmentDetails.finalPrice,k.isEssential&&n.detailsForBooking&&n.detailsForBooking.docObj&&n.detailsForBooking.docObj.quantity>0&&(k.bookedAppointmentDetails.finalPrice*=n.detailsForBooking.docObj.quantity),k.paymentObject=[],k.paymentOptions.length>0){if(k.showWalletPaymentOption=!1,k.showCorpWalletPaymentOption=!1,k.showMaWalletPaymentOption=!1,k.showMBWalletPaymentOption=!1,k.onlyPgOption=!0,k.medicine){var e=!1,a=!1;_.each(k.paymentOptions,function(t){!a&&t.paymentMethod.toLowerCase().indexOf("wallet")>-1&&t.walletAmount>0&&(a=!0),!e&&t.paymentMethod.toLowerCase().indexOf("cashless")>-1&&(e=!0)}),!e&&a&&k.paymentOptions.push({paymentMethod:"CashlessDelivery"})}for(var t=0;t<k.paymentOptions.length;t++)"pgandcorpwallet"===k.paymentOptions[t].paymentMethod.toLowerCase()?(k.CorpBenefAmount=k.paymentOptions[t].walletAmount,k.CorpBalance=n.CorpBalance,k.CorpWalletName=n.corpAliasName,k.showCorpWalletPaymentOption=!!k.paymentOptions[t].walletAmount,k.showWalletPaymentOption=k.showWalletPaymentOption||k.showCorpWalletPaymentOption,k.onlyPgOption=!1):"pgandmawallet"===k.paymentOptions[t].paymentMethod.toLowerCase()?(k.MABenefAmount=k.paymentOptions[t].walletAmount,k.MAWalletName=n.maAliasName,k.showMaWalletPaymentOption=!!k.paymentOptions[t].walletAmount,k.MABalance=n.MABalance,k.showWalletPaymentOption=k.showWalletPaymentOption||k.showMaWalletPaymentOption,k.onlyPgOption=!1):"cashondelivery"===k.paymentOptions[t].paymentMethod.toLowerCase()?(k.mediMarketPayment.isCod=!0,k.showCashlessDifference=k.optedHomeDelivery,k.optedHomeDelivery?k.apolloHomeDelivery?(k.showCashlessDifference=!0,k.cashlessDelivery=k.courier?k.courierDelivery:"24-48",k.codDelivery=k.courier?k.courierDelivery:"24"):k.optedNormalDelivery&&(k.showCashlessDifference=!0,k.cashlessDelivery=k.courier?k.courierDelivery:"24-48",k.codDelivery=k.courier?k.courierDelivery:"24"):k.showCashlessDifference=!1):"pgandmbwallet"===k.paymentOptions[t].paymentMethod.toLowerCase()&&(!k.isCovid||k.isCovid&&k.user.isRetailUser)?(k.showWalletPaymentOption=k.showWalletPaymentOption||!k.medicine,k.showMBWalletPaymentOption=!!k.paymentOptions[t].walletAmount,k.MBBalance=n.MBBalance):"cashlessdelivery"===k.paymentOptions[t].paymentMethod.toLowerCase()&&(k.showWalletPaymentOption=!0,k.showCashlessOption=!0,k.appointmentData.isCashless=!0,k.optedHomeDelivery?k.apolloHomeDelivery?(k.showCashlessDifference=!0,k.cashlessDelivery=k.courier?k.courierDelivery:"24-48",k.codDelivery=k.courier?k.courierDelivery:"24"):k.optedNormalDelivery&&(k.showCashlessDifference=!0,k.cashlessDelivery=k.courier?k.courierDelivery:"24-48",k.codDelivery=k.courier?k.courierDelivery:"24"):k.showCashlessDifference=!1,k.onlyPgOption=!1);if(1===k.paymentOptions.length&&k.mediMarketPayment.isCod&&(k.courier?k.codDelivery=k.courierDelivery:k.optedHomeDelivery?k.optedNormalDelivery?k.codDelivery="48":k.codDelivery="24":k.codDelivery="Pickup within 5 hrs",k.appointmentData.isCashless=!1),!k.medicine&&k.onlyPgOption&&(n.CorpBalance>0||n.MABalance>0)){var i,o,s,r=_.findWhere(n.walletConfigs,{walletName:"MAWallet"}),l=_.findWhere(n.walletConfigs,{walletName:"CorpWallet"}),c=!1;if(_.isEmpty(r)||(r.eligibleContracts.indexOf(n.detailsForBooking.docObj.contractId)>-1?i=!0:o=!0),_.isEmpty(l)||(l.eligibleContracts.indexOf(n.detailsForBooking.docObj.contractId)>-1?s=!0:c=!0),s)k.walletErrorMessage=n.corpAliasName+" wallet is not applicable for the beneficiary selected";else if(i)k.walletErrorMessage=n.maAliasName+" wallet is not applicable for the beneficiary selected";else{var d=o&&c?n.corpAliasName+" and "+n.maAliasName:o?n.maAliasName:c?n.corpAliasName:"";k.walletErrorMessage=d+" wallet(s) is not applicable for the service"}k.showWalletCannotUsedMessage=!0}}angular.forEach(k.walletBalanceDetail,function(e,a){"mawallet"===e.walletName.toLowerCase()?(k.MABalance=e.balance,k.isMAWalletAvailable=!0):"mbwallet"===e.walletName.toLowerCase()?k.MBBalance=e.balance:"corpwallet"===e.walletName.toLowerCase()&&(k.CorpBalance=e.balance)}),k.isPaymentCalled=!1,k.flag=!1,k.isPaymentProcessing=!1,k.isChecmsg=!1,k.mediMarketPayment.isCod&&(k.cashOnDeli=!0),k.consultationCheck?(k.isConsultationPayment=!0,k.isPackagePayment=!1,k.isChecmsg=!0):(k.isConsultationPayment=!1,k.isPackagePayment=!0),k.showMaWalletPaymentOption?(k.wallet.isPayByMAWallet=!0,k.walletChoosed()):k.showCorpWalletPaymentOption?(k.wallet.isPayByCorpWallet=!0,k.walletChoosed()):k.medicine&&k.showCashlessOption&&k.showMBWalletPaymentOption&&(k.wallet.isPayByMBWallet=!0,k.walletChoosed())},k.takeToStoreSelection=function(){var e={sessionData:{},forceUpdate:!0};window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"MedsStoreSel"}),k.resData.appointmentData=JSON.stringify(k.appointmentData),e.sessionData[t.medicineId]=JSON.stringify(k.resData),n.makeAjaxCalls(l.apiUrl+"/SessionStorage.json",e,"POST",k.userObj.token).then(function(e){e.data.isSuccess?r.go("app.storeSelection",{pincode:k.appointmentData.patientPincode,categoryItemTypeId:s.categoryItemTypeId,searchc:s.searchc,searchk:s.searchk,packageId:s.packageId,dcId:s.dcId,appTime:s.appTime},{reload:"app.storeSelection"}):r.go("app.home",{},{reload:"app.home"})})},k.authorizeRazorPay=function(e){var a=l.paymentUrl+k.razorPayOptions.amount;a+="&paymentid="+e.razorpay_payment_id,c.location.href=a,p(function(){k.paymentBlockingCss=!0},0)},k.dismissalRazorPay=function(){k.bookingTabClick(),k.isPaymentProcessing=!1,k.isPaymentCalled=!1,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Payment Cancelled",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:k.customParams,google:window._Site_Props.__googleTransform(k.eventCategory,"PaymentCancelled",k.eventLabel)})}),v.remove("OrderCreatedEvent"),k.onDismissBilldeskPopup&&c.removeEventListener("message",k.onDismissBilldeskPopup),p(function(){k.flag=!1},0,!0),T=null},k.processPaymentOption=function(a){if(a)if(k.medicine)k.customParams.deliveryTime=k.appointmentData.isCashless?k.cashlessDelivery:k.codDelivery,f.payment({cartId:k.checkoutResponseData.prePaymentCartId,newCheckout:!0,estimatedAmount:k.checkoutPricing.totalPrice,couponCode:k.couponCode||"",totalAmount:k.checkoutPricing.finalPrice,email:k.checkoutData.email,paymentMethod:k.paymentData,addressCity:k.checkoutData.addressCity,pmEntityId:k.userObj.userDetails.pmEntityID},k.checkoutResponseData.checkoutResponse.accessToken).then(function(a){if(n.refreshOrders=!0,v.set("medicineBookAndPayURL",window.location.pathname),a.paymentMethodResponse&&a.paymentMethodResponse.isInsideSalesOrder&&a.paymentMethodResponse.message)k.paymentConfirmMessage=i.trustAsHtml(a.paymentMethodResponse.message),d.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",scope:k,templateUrl:"confirmPayment.html",size:"login"});else if(a.paymentMethodResponse.isSuccess&&0!==a.paymentMethodResponse.orderId){if(k.orderId=a.paymentMethodResponse.orderId,k.generatedOrderId=a.paymentMethodResponse.orderId,k.isWalletFailure=!1,w(a.paymentMethodResponse.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),!_.isEmpty(a.paymentMethodResponse.payUOptions)){var t=Number.parseFloat(a.paymentMethodResponse.payUOptions.amount)/100;k.setPaymentCustomParams("razorPaymentAmount",t)}if(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:k.medicine?"MedsPlaceOrder":"Payment Request",dbLog:!k.medicine||"meds",hj:!0,payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:_.extend(k.customParams,k.paymentCustomParams),google:window._Site_Props.__googleTransform(k.eventCategory,"PaymentRequest",k.eventLabel)})}),k.storeOrderCreatedEvent(a.paymentMethodResponse.orderId,k.customParams,s.isRecommendation,k.programType),(k.wallet.isPayByMBWallet||k.wallet.isPayByCorpWallet||k.wallet.isPayByMAWallet)&&(n.refreshWallet=!0),_.isEmpty(a.paymentMethodResponse.payUOptions))if(_.isEmpty(a.paymentMethodResponse.billdeskOptions))a.paymentMethodResponse.paymentGatewayURL?(e.$emit("cfpLoadingBar:loading"),c.location.href=a.paymentMethodResponse.paymentGatewayURL,k.paymentBlockingCss=!0):(n.orderId=a.paymentMethodResponse.orderId,w(a.paymentMethodResponse.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),e.$emit("closeBookPayPopup"),k.paymentBlockingCss=!0,v.set(k.userObj.userDetails.userId,k.appointmentData.dateOfBirth.getTime()),k.medicine&&window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:!k.medicine||"meds",hj:!0,name:k.medicine?"MedsThankYouPage":"MedsOrderPlaced",payload:window._Site_Props.__getEventParameters({custom:{payment_mode:k.appointmentData.isCashless?"Cashless":"COD",delivery_type:k.renderStorePickup&&k.storeData?"StorePickup":"Standard"}})}),r.go("app.orderDetails",{reload:"app.orderDetails"}));else{var o=a.paymentMethodResponse.billdeskOptions;o.options={},o.options.enableChildWindowPosting="true",o.options.enablePaymentRetry="true",o.options.retry_attempt_count="2",o.options.txtPayCategory="CREDITDEBITNETBANKINGBHARATQR",k.initializeBilldeskPayment(o),k.onDismissBilldeskPopup=function(e){"callCustomOnCloseFunction"!==e.data&&"dismissModal"!==e.data||k.dismissalRazorPay()},c.addEventListener("message",k.onDismissBilldeskPopup)}else k.razorPayOptions=a.paymentMethodResponse.payUOptions,k.razorPayOptions.name="MediBuddy",e.isWebView?(k.razorPayOptions.callback_url=l.paymentUrl+k.razorPayOptions.amount,k.razorPayOptions.redirect=!0):k.razorPayOptions.handler=k.authorizeRazorPay,k.razorPayOptions.prefill={name:k.appointmentData.patientName,email:k.appointmentData.email,contact:k.appointmentData.phone},k.razorPayOptions.modal={ondismiss:k.dismissalRazorPay},k.razorPayOptions.image="/assets/images/logo_medibuddy.png",k.razorPayOptions.description="Your order ID: "+a.paymentMethodResponse.orderId,k.razorPayOptions.theme.color="#2198ff",w(a.paymentMethodResponse.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),T=new Razorpay(k.razorPayOptions),k.paymentBlockingCss&&(k.paymentBlockingCss=!1),T.open()}else a.paymentMethodResponse.isSuccess||(k.isPaymentProcessing=!1,k.isPaymentCalled=!1,k.flag=!1,k.medicine?k.bookingTabClick():a.paymentMethodResponse.errorMessage?(k.errPayment=a.paymentMethodResponse.errorMessage,k.existingOrderId=a.paymentMethodResponse.existingOrderId,k.consultationCheck?(k.isConsultationPayment=!0,k.isPackagePayment=!1,k.isChecmsg=!0):(k.isConsultationPayment=!1,k.isPackagePayment=!0)):c.location.href="/technicalGlitch");return window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:!k.medicine||"meds",hj:!0,name:k.medicine?"MedsThankYouPage":"MedsOrderPlaced",payload:window._Site_Props.__getEventParameters({custom:{payment_mode:k.appointmentData.isCashless?"Cashless":"COD",delivery_type:k.renderStorePickup&&k.storeData?"StorePickup":"Standard"}})}),paymentResponse});else if(k.user=n.isUserSignedin(),k.user&&k.user.token){k.isPaymentProcessing=!0,k.isConsultationPayment=!1,k.isPackagePayment=!1;var t=l.apiUrl+"/PaymentMethod",o={paymentMethods:[]};angular.forEach(a,function(e,a){o.paymentMethods.push(e.paymentMethod)}),k.isCouponCodeNotEmpty&&(o.couponCode=k.validatedCouponCode),k.isMembershipCouponApplied&&(o.isMembershipUser=!0),0==parseInt(k.finalPayment)&&k.programType&&(k.paymentBlockingCss=!0),k.medicine&&k.user.isRetailUser&&(o.MedicineWalletAmount=k.MBBalance,!k.wallet.isPayByMBWallet&&k.MBBalance>0&&o.paymentMethods.push("CashlessDelivery")),k.errPayment="",k.existingOrderId="",k.paymentConfirmMessage=n.makeAjaxCalls(t,o,"POST",k.user.token).then(function(a){if(n.refreshOrders=!0,v.set("medicineBookAndPayURL",window.location.pathname),a.data.isInsideSalesOrder&&a.data.message)k.paymentConfirmMessage=i.trustAsHtml(a.data.message),d.open({animation:!0,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",scope:k,templateUrl:"confirmPayment.html",size:"login"});else if(a.data.isSuccess&&0!==a.data.orderId){if(k.orderId=a.data.orderId,k.generatedOrderId=a.data.orderId,k.isWalletFailure=!1,w(a.data.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),!_.isEmpty(a.data.razorPayOptions)){var t=Number.parseFloat(a.data.razorPayOptions.amount)/100;k.setPaymentCustomParams("razorPaymentAmount",t)}if(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:k.medicine?"MedsPlaceOrder":"Payment Request",dbLog:!k.medicine||"meds",hj:!0,payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:_.extend(k.customParams,k.paymentCustomParams),google:window._Site_Props.__googleTransform(k.eventCategory,"PaymentRequest",k.eventLabel)})}),k.storeOrderCreatedEvent(a.data.orderId,k.customParams,s.isRecommendation,k.programType),(k.wallet.isPayByMBWallet||k.wallet.isPayByCorpWallet||k.wallet.isPayByMAWallet)&&(n.refreshWallet=!0),_.isEmpty(a.data.razorPayOptions))if(_.isEmpty(a.data.billdeskOptions))a.data.paymentGatewayURL?(e.$emit("cfpLoadingBar:loading"),c.location.href=a.data.paymentGatewayURL,k.paymentBlockingCss=!0):(n.orderId=a.data.orderId,w(a.data.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),e.$emit("closeBookPayPopup"),k.paymentBlockingCss=!0,v.set(k.userObj.userDetails.userId,k.appointmentData.dateOfBirth.getTime()),k.medicine&&window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:!k.medicine||"meds",hj:!0,name:k.medicine?"MedsThankYouPage":"MedsOrderPlaced",payload:window._Site_Props.__getEventParameters({custom:{payment_mode:k.appointmentData.isCashless?"Cashless":"COD",delivery_type:k.renderStorePickup&&k.storeData?"StorePickup":"Standard"}})}),r.go("app.orderDetails",{reload:"app.orderDetails"}));else{var o=a.data.billdeskOptions;o.options={},o.options.enableChildWindowPosting="true",o.options.enablePaymentRetry="true",o.options.retry_attempt_count="2",o.options.txtPayCategory="CREDITDEBITNETBANKINGBHARATQR",k.initializeBilldeskPayment(o),k.onDismissBilldeskPopup=function(e){"callCustomOnCloseFunction"!==e.data&&"dismissModal"!==e.data||k.dismissalRazorPay()},c.addEventListener("message",k.onDismissBilldeskPopup)}else k.razorPayOptions=a.data.razorPayOptions,k.razorPayOptions.name="MediBuddy",e.isWebView?(k.razorPayOptions.callback_url=l.paymentUrl+k.razorPayOptions.amount,k.razorPayOptions.redirect=!0):k.razorPayOptions.handler=k.authorizeRazorPay,k.razorPayOptions.prefill={name:k.appointmentData.patientName,email:k.appointmentData.email,contact:k.appointmentData.phone},k.razorPayOptions.modal={ondismiss:k.dismissalRazorPay},k.razorPayOptions.image="/assets/images/logo_medibuddy.png",k.razorPayOptions.description="Your order ID: "+a.data.orderId,k.razorPayOptions.theme.color="#2198ff",w(a.data.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),T=new Razorpay(k.razorPayOptions),k.paymentBlockingCss&&(k.paymentBlockingCss=!1),T.open()}else a.data.isSuccess||(k.isPaymentProcessing=!1,k.isPaymentCalled=!1,k.flag=!1,k.medicine?k.bookingTabClick():a.data.errorMessage?(k.errPayment=a.data.errorMessage,k.existingOrderId=a.data.existingOrderId,k.consultationCheck?(k.isConsultationPayment=!0,k.isPackagePayment=!1,k.isChecmsg=!0):(k.isConsultationPayment=!1,k.isPackagePayment=!0)):c.location.href="/technicalGlitch")})}},k.storeOrderCreatedEvent=function(e,a,t,i){var o=window._Site_Props.__getPackageDetails(),n=window._Site_Props.__getServiceDetails();k.paymentCustomParams.referredBy?a.referredBy=k.paymentCustomParams.referredBy:delete a.referredBy,a.OrderID=e;var s={orderId:e,service:!!n,"package":!!o,custom:a,eventCategory:k.eventCategory,eventLabel:k.eventLabel,chargedEventPayload:{GMV:a.GMV,isRecommendation:t},packageDetails:o,serviceDetails:n};i&&_.extend(s.chargedEventPayload,{program:i}),v.set("OrderCreatedEvent",JSON.stringify(s))},k.applyCoupon=function(e,a){k.bookedAppointmentDetails.couponCode=e,k.resetPaymentCustomParams();var t={CodeApplied:e,CodeDiscount:a.data.response.discount,isRecommendation:s.isRecommendation};a.data.referrarDetails&&(t.referredBy=a.data.referrarDetails.userId,k.setPaymentCustomParams("referredBy",a.data.referrarDetails.userId)),k.setPaymentCustomParams("couponCodeApplied",e),k.setPaymentCustomParams("couponDiscount",a.data.response.discount),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:!k.medicine||"meds",hj:!0,name:k.medicine?"MedsCouponCodeApplied":"Coupon Code Applied",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:t,google:window._Site_Props.__googleTransform(k.eventCategory,"CouponApplied",e+" applied for "+k.eventLabel)})}),k.couponMessage=a.data.response.message,k.isCouponCodeNotEmpty=!0,k.validatedCouponCode=e,k.mediMarketPayment.couponDiscount=a.data.response.discount,k.isEssential&&(k.mediMarketPayment.couponDiscount*=n.detailsForBooking.docObj.quantity),k.medicine&&k.checkoutPricing&&k.checkoutPricing.finalPrice&&(k.checkoutPricing.price=k.checkoutPricing.finalPrice,k.checkoutPricing.price=k.checkoutPricing.price-k.mediMarketPayment.couponDiscount,k.billWalletUpdation()),k.mediMarketPayment.amountAfterCouponDiscount=k.bookedAppointmentDetails.finalPrice-k.mediMarketPayment.couponDiscount,k.isEssential&&(k.mediMarketPayment.amountAfterCouponDiscount+=k.deliveryCost),k.mediMarketPayment.amountAfterCouponDiscount=Number.parseFloat(k.mediMarketPayment.amountAfterCouponDiscount).toFixed(2),k.finalPayment=k.mediMarketPayment.amountAfterCouponDiscount,k.isNavya||k.walletChoosed()},k.removeCoupon=function(){if(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:!k.medicine||"meds",hj:!0,name:k.medicine?"MedsCouponCodeRemoved":"Coupon Code Removed",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,google:window._Site_Props.__googleTransform("Coupon Code Removed")})}),k.medicine)var e=f.removeCouponV2({couponCode:k.validatedCouponCode,prePaymentCartId:k.checkoutData.prePaymentCartId,walletRequest:k.checkoutData},k).then(function(e){return k.checkoutResponseData=e,k.gatewayTitle=i.trustAsHtml(k.checkoutResponseData.checkoutResponse.priceObj.gatewayTitle),k.disclaimerText=i.trustAsHtml(k.checkoutResponseData.checkoutResponse.priceObj.disclaimerText),k.isCouponCodeNotEmpty=!!k.validatedCouponCode,k.validatedCouponCode=e.checkoutResponse.priceObj.isCoupanApplied?couponCode:"",k.mediMarketPayment.couponDiscount=0,k.couponCode="",k.checkoutPricing={totalPrice:e.checkoutResponse.priceObj.totalPrice,partnerDiscountAmount:e.checkoutResponse.priceObj.discount.find(function(e){return"partnerDiscountAmount"===e.name}).value||0,firstOrderDiscount:e.checkoutResponse.priceObj.discount.find(function(e){return"firstOrderDiscount"===e.name}).value||0,walletDeduction:e.checkoutResponse.priceObj.cashlessAmount,finalPrice:e.checkoutResponse.priceObj.finalPrice,price:e.checkoutResponse.priceObj.finalPrice},e});return e.error?void($scope.errorMessage=e.error):(k.couponMessage="",k.isCouponCodeNotEmpty=!1,k.bookedAppointmentDetails.couponCode="",k.mediMarketPayment.couponDiscount=0,delete k.validatedCouponCode,k.mediMarketPayment.amountAfterCouponDiscount=k.bookedAppointmentDetails.finalPrice,k.mediMarketPayment.amountAfterCouponDiscount=Number.parseFloat(k.mediMarketPayment.amountAfterCouponDiscount).toFixed(2),k.finalPayment=k.mediMarketPayment.amountAfterCouponDiscount,k.isNavya||k.walletChoosed(),void 0)},k.validateCoupon=function(e){if(k.resetPaymentCustomParams(),k.saleCoupon||""!==k.bookedAppointmentDetails.couponCode){
var a={PackageId:n.detailsForBooking.docObj.packageId,ProviderID:n.detailsForBooking.docObj.dcId,DoctorUniqueId:n.detailsForBooking.docObj.doctorUniqueId?n.detailsForBooking.docObj.doctorUniqueId:"",CouponCode:k.saleCoupon?k.saleCoupon:k.bookedAppointmentDetails.couponCode,Gender:k.appointmentData.gender,City:k.appointmentPackageData.citySelected,ApplicableDate:k.appointmentData.prefDateTime||new Date,Relation:k.appointmentData.relation};k.fromLabTest&&(a.isForCheckedOutOrder=!0);var t=!1;e&&(a.enrollmentId=e.enrollmentId,a.enrollmentType=e.membershipType,t=!0);var i=l.apiUrl+"/CheckCouponCodeApplicability.json";n.makeAjaxCalls(i,a,"POST",k.user.token).then(function(e){if(e.data.isSuccess&&e.data.response.isApplicable){var a=k.saleCoupon?k.saleCoupon:k.bookedAppointmentDetails.couponCode;return k.applyCoupon(a,e),void(k.isMembershipCouponApplied=t)}k.removeCoupon(),t&&k.getCouponCode()})["catch"](function(){k.removeCoupon()})}else k.removeCoupon()},k.closeModal=function(){k.modalInstance&&k.modalInstance.close()},k.checkForMembershipBenefits=function(){if(k.isMembershipCouponApplied=!1,!_.isEmpty(k.membershipDetail)){var e=k.appointmentData.maid,a=k.membershipDetail.find(function(a){return a.maid==e});if(a&&a.membershipType)return k.bookedAppointmentDetails.couponCode=a.membershipType,k.validateCoupon(a),!0}return!1},k.getCouponCode=function(){s.coupon&&(k.bookedAppointmentDetails.couponCode=s.coupon,k.validateCoupon()),t.deloitteIds.indexOf(k.userObj.userDetails.pmEntityID)>-1&&k.olService&&(k.bookedAppointmentDetails.couponCode=t.deloitteTeleCouponCode,k.validateCoupon())},k.showAlert=function(){k.isNavya?window.open(k.navyaRedirect,"_self"):k.appointmentPackageData.isAHC&&k.appointmentPackageData.isSponser?k.AHCBooking():k.ProcessPaymentOption(k.mediMarketPayment)},k.ProcessPaymentOption=function(e){k.paymentObject=[];var a;if(k.modalInstance&&k.modalInstance.close(),k.flag=!0,!k.isPaymentCalled&&k.flag)if(k.isPayment=!1,k.isPaymentCalled=!0,e.isCod){if(k.appointmentData.isCashless&&(k.wallet.isPayByMAWallet||k.wallet.isPayByMBWallet||k.wallet.isPayByCorpWallet))for(a=0;a<k.paymentOptions.length;a++)("cashlessdelivery"===k.paymentOptions[a].paymentMethod.toLowerCase()||k.wallet.isPayByMBWallet&&"pgandmbwallet"===k.paymentOptions[a].paymentMethod.toLowerCase()||k.wallet.isPayByCorpWallet&&"pgandcorpwallet"===k.paymentOptions[a].paymentMethod.toLowerCase()||k.wallet.isPayByMAWallet&&"pgandmawallet"===k.paymentOptions[a].paymentMethod.toLowerCase())&&k.paymentObject.push(k.paymentOptions[a]);else for(a=0;a<k.paymentOptions.length;a++)"cashondelivery"===k.paymentOptions[a].paymentMethod.toLowerCase()&&k.paymentObject.push(k.paymentOptions[a]);k.processPaymentOption(k.paymentObject)}else{if(k.wallet.isPayByMAWallet&&angular.forEach(k.paymentOptions,function(e,a){"pgandmawallet"===e.paymentMethod.toLowerCase()&&k.paymentObject.push(e)}),k.wallet.isPayByMBWallet&&angular.forEach(k.paymentOptions,function(e,a){"pgandmbwallet"===e.paymentMethod.toLowerCase()&&(k.medicine&&!k.user.isRetailUser&&(e.paymentMethod="CashlessDelivery"),k.paymentObject.push(e))}),k.wallet.isPayByCorpWallet&&angular.forEach(k.paymentOptions,function(e,a){"pgandcorpwallet"===e.paymentMethod.toLowerCase()&&k.paymentObject.push(e)}),!k.wallet.isPayByCorpWallet&&!k.wallet.isPayByMBWallet&&!k.wallet.isPayByMAWallet)for(a=0;a<k.paymentOptions.length;a++)"pg"===k.paymentOptions[a].paymentMethod.toLowerCase()&&k.paymentObject.push(k.paymentOptions[a]);k.processPaymentOption(k.paymentObject)}},k.changeTab=function(){k.activeTabIndex=1,k.tab1Disable=!1,k.collapseTwo=!1,k.collapseOne=!0,k.submitted=!1,k.startTimer(),k.countDownDate=(new Date).getTime()+6e5,c.scrollTo(0,0)},k.startTimer=function(){var e;k.x=g(function(){var a=(new Date).getTime();e=k.countDownDate-a,k.days=Math.floor(e/864e5),k.hours=Math.floor(e%864e5/36e5),k.minutes=Math.floor(e%36e5/6e4),k.seconds=Math.floor(e%6e4/1e3),e<0&&k.bookingTabClick()},1e3)},k.bookingTabClick=function(){g.cancel(k.x),k.minute=10,k.seconds=0,k.activeTabIndex=0,k.showCashlessOption=!1,k.appointmentData.isCashless=!!k.medicine&&!k.resData.cashlessNA,k.collapseTwo=!0,k.tab1Disable=!0,k.collapseOne=!1,k.showCashlessDifference=!1,k.optedHomeDelivery=!1,k.showMBWalletPaymentOption&&k.wallet.isPayByMBWallet&&(k.wallet.isPayByMBWallet=!1),k.showCorpWalletPaymentOption&&k.wallet.isPayByCorpWallet&&(k.wallet.isPayByCorpWallet=!1),k.showMaWalletPaymentOption&&k.wallet.isPayByMAWallet&&(k.wallet.isPayByMAWallet=!1),k.bookedAppointmentDetails&&k.bookedAppointmentDetails.couponCode&&(k.bookedAppointmentDetails.couponCode="",k.validateCoupon()),k.isWalletFailure=!1},k.paymentDoubleClick=function(){return k.flag=!0,!1},k.updateWalletSelection=function(){k.wallet.isPayByMAWallet=k.appointmentData.isCashless,k.wallet.isPayByMBWallet=!(!k.medicine||k.showMaWalletPaymentOption)},k.walletOptionChanged=function(e,a){if(a?window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:!k.medicine||"meds",hj:!0,name:k.medicine?"MedsCorpWalletCheck":"Wallet Check",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{wallet:e},google:window._Site_Props.__googleTransform("Wallet Check")})}):window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:!k.medicine||"meds",hj:!0,name:k.medicine?"MedsCorpWalletUncheck":"Wallet Uncheck",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{wallet:e},google:window._Site_Props.__googleTransform("Wallet Uncheck")})}),!a&&k.medicine){var t=k.wallet.isPayByMBWallet||k.wallet.isPayByMAWallet||k.wallet.isPayByCorpWallet;if(0==t)switch(e){case"MAWallet":k.wallet.isPayByMAWallet=!0,k.walletType="PGAndMAWallet";break;case"CorpWallet":k.wallet.isPayByCorpWallet=!0,k.walletType="PGAndCorpWallet";break;case"MBWallet":k.wallet.isPayByMBWallet=!0,k.walletType="PGAndMBWallet"}}if(a)switch(e){case"MAWallet":k.walletType="PGAndMAWallet";case"CorpWallet":k.wallet.isPayByMBWallet=!1,k.walletType="PGAndCorpWallet";break;case"MBWallet":k.wallet.isPayByMAWallet=!1,k.wallet.isPayByCorpWallet=!1,k.walletType="PGAndMBWallet"}k.walletChoosed()},k.walletChoosed=function(){if(k.medicine){var e={prePaymentCartId:k.checkoutData.prePaymentCartId,walletName:k.walletType,walletRequest:k.checkoutData,retainCoupon:!0};return void f.changeWallet(e,k).then(function(e){const a=e.checkoutResponse.priceObj||{};return k.checkoutResponseData=e,k.gatewayTitle=i.trustAsHtml(k.checkoutResponseData.checkoutResponse.priceObj.gatewayTitle),k.disclaimerText=i.trustAsHtml(k.checkoutResponseData.checkoutResponse.priceObj.disclaimerText),k.checkoutPricing={totalPrice:a.totalPrice,partnerDiscountAmount:a.discount.find(function(e){return"partnerDiscountAmount"===e.name}).value||0,firstOrderDiscount:a.discount.find(function(e){return"firstOrderDiscount"===e.name}).value||0,walletDeduction:a.cashlessAmount,finalPrice:a.finalPrice,price:a.finalPrice},k.finalPayment=a.finalPrice,k.wallet={gatewayAmount:a.pgAmount,totalAmount:a.finalPrice,walletAmount:a.cashlessAmount,isPayByCorpWallet:"CorpWallet"==e.checkoutResponse.walletType,isPayByMAWallet:"MAWallet"==e.checkoutResponse.walletType,isPayByMBWallet:"MBWallet"==e.checkoutResponse.walletType},k.changeWalletResponse=e,e})}k.finalPayment=parseFloat(k.mediMarketPayment.amountAfterCouponDiscount),k.wallet.deductMBWallet=0,k.wallet.deductMAWallet=0,k.wallet.deductCorpWallet=0;var a=k.isHomeSampleCollection&&k.homeSampleCollectionCharges&&!isNaN(k.homeSampleCollectionCharges);a&&(k.finalPayment=k.finalPayment-k.homeSampleCollectionCharges),k.wallet.isPayByMBWallet&&(k.finalPayment<k.MBBalance?(k.wallet.deductMBWallet=k.finalPayment,k.finalPayment=0,0===k.wallet.deductMBWallet&&(k.wallet.isPayByMBWallet=!1)):(k.wallet.deductMBWallet=k.MBBalance,k.finalPayment=k.finalPayment-k.MBBalance)),k.wallet.isPayByMAWallet&&(k.finalPayment<k.MABenefAmount?(k.wallet.deductMAWallet=k.finalPayment,k.finalPayment=0,0===k.wallet.deductMAWallet&&(k.wallet.isPayByMAWallet=!1)):(k.wallet.deductMAWallet=k.MABenefAmount,k.finalPayment=k.finalPayment-k.MABenefAmount)),k.wallet.isPayByCorpWallet&&(k.finalPayment<k.CorpBenefAmount?(k.wallet.deductCorpWallet=k.finalPayment,k.finalPayment=0,0===k.wallet.deductCorpWallet&&(k.wallet.isPayByCorpWallet=!1)):(k.wallet.deductCorpWallet=k.CorpBenefAmount,k.finalPayment=k.finalPayment-k.CorpBenefAmount)),a&&(k.finalPayment=k.finalPayment+k.homeSampleCollectionCharges),k.setPaymentCustomParams("MAWalletUsage",Number.parseFloat(k.wallet.deductMAWallet)),k.setPaymentCustomParams("MBWalletUsage",Number.parseFloat(k.wallet.deductMBWallet)),k.setPaymentCustomParams("CorpWalletUsage",Number.parseFloat(k.wallet.deductCorpWallet))},k.prescriptionDownload=function(e){var a="";a=e.filePublicUrl?e.filePublicUrl.split("/")[0]:e.result.fileDetails[0].filePublicUrl.split("/")[0],n.fileDownload(a)},k.createAppointment=function(){if(k.errPayment="",k.existingOrderId="",k.user=n.isUserSignedin(),n.bookedAppointmentDetails=k.createAppointmentData,n.bookedAppointmentDetails.finalPrice=k.medicine?0:n.detailsForBooking.docObj.price,k.medicine){var e=f.checkoutData(k);k.checkoutData=e,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,fbq:!0,dbLog:!k.medicine||"meds",hj:!0,fbqReference:"InitiateCheckout",name:k.medicine?"MedsProceedToPaymentPage":"Appointment Creation Request",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:k.customParams,google:window._Site_Props.__googleTransform(k.eventCategory,"AppointmentCreationRequest",k.eventLabel)}),branchLog:{name:"Initiated Checkout",custom_data:{topic:k.eventCategory,netPaidAmount:k.customParams.amount,packageId:M?M.packageId:s.packageId,packageName:M?M.packageName:n.detailsForBooking.docObj?n.detailsForBooking.docObj.packageName:""},alias:M?M.packageName:n.detailsForBooking.docObj?n.detailsForBooking.docObj.packageName:""}}),f.checkout(k.checkoutData).then(function(e){k.isPurelyRX=k.checkoutData.isRxUpload&&("UPLOADRX"===k.checkoutData.meta.type||"REORDER"===k.checkoutData.meta.type),k.isSearchRx=k.checkoutData.isRxUpload&&"SEARCH"===k.checkoutData.meta.type,e.errMessage&&(h({message:e.errMessage,position:"center",duration:2e3}),k.submitted=!1),k.checkoutPricing={totalPrice:e.checkoutResponse.priceObj.totalPrice,partnerDiscountAmount:e.checkoutResponse.priceObj.discount.find(function(e){return"partnerDiscountAmount"===e.name}).value||0,firstOrderDiscount:e.checkoutResponse.priceObj.discount.find(function(e){return"firstOrderDiscount"===e.name}).value||0,walletDeduction:e.checkoutResponse.priceObj.cashlessAmount,finalPrice:e.checkoutResponse.priceObj.finalPrice,price:e.checkoutResponse.priceObj.finalPrice},k.finalPayment=e.checkoutResponse.priceObj.finalPrice,k.wallet={gatewayAmount:e.checkoutResponse.priceObj.pgAmount,totalAmount:e.checkoutResponse.priceObj.finalPrice,walletAmount:e.checkoutResponse.priceObj.cashlessAmount,isPayByCorpWallet:"CorpWallet"==e.checkoutResponse.walletType,isPayByMAWallet:"MAWallet"==e.checkoutResponse.walletType,isPayByMBWallet:"MBWallet"==e.checkoutResponse.walletType},k.paymentData=[],k.appointmentData.isCashless=!0,k.showMaWalletPaymentOption="MAWallet"==e.checkoutResponse.walletType,k.showCorpWalletPaymentOption="CorpWallet"==e.checkoutResponse.walletType,k.showMBWalletPaymentOption="MBWallet"==e.checkoutResponse.walletType;for(var a=0;a<e.checkoutResponse.paymentOptions.length;a++)k.paymentData.push(e.checkoutResponse.paymentOptions[a].paymentMethod),"MBWallet"===e.checkoutResponse.paymentOptions[a].walletName&&(k.wallet.isPayByMBWallet=e.checkoutResponse.walletUsed&&"MBWallet"===e.checkoutResponse.walletType,k.showWalletPaymentOption=!0,k.showMBWalletPaymentOption=!0,k.MBBalance=e.checkoutResponse.paymentOptions[a].walletAmount),"MAWallet"===e.checkoutResponse.paymentOptions[a].walletName&&(k.wallet.isPayByMAWallet=e.checkoutResponse.walletUsed&&"MAWallet"===e.checkoutResponse.walletType,k.showWalletPaymentOption=!0,k.MAWalletName=n.maAliasName,k.showMaWalletPaymentOption=!0,k.MABalance=e.checkoutResponse.paymentOptions[a].walletAmount,k.MABenefAmount=e.checkoutResponse.paymentOptions[a].walletAmount),"CorpWallet"===e.checkoutResponse.paymentOptions[a].walletName&&(k.wallet.isPayByCorpWallet=e.checkoutResponse.walletUsed&&"CorpWallet"===e.checkoutResponse.walletType,k.showWalletPaymentOption=!0,k.showCorpWalletPaymentOption=!0,k.CorpBalance=e.checkoutResponse.paymentOptions[a].walletAmount,k.CorpWalletName=n.corpAliasName);k.checkoutResponseData=e,k.gatewayTitle=i.trustAsHtml(k.checkoutResponseData.checkoutResponse.priceObj.gatewayTitle),k.disclaimerText=i.trustAsHtml(k.checkoutResponseData.checkoutResponse.priceObj.disclaimerText),k.mediMarketPayment={couponDiscount:0,isCod:e.checkoutResponse.priceObj.isCod||!1,amountAfterCouponDiscount:e.checkoutResponse.priceObj.finalPrice},k.paymentOptions=e.checkoutResponse.paymentOptions,k.changeTab()})}else if(k.user&&k.user.token){var a=l.apiUrl+"/Checkout";k.isCouponCodeNotEmpty=!1,k.resetPaymentCustomParams(),k.isMAWalletAvailable=!1,k.createAppointmentData.medicineCart={};var t=window.navigator.userAgent.toLowerCase(),o="web";if(t.indexOf("android")>-1?o="Android":/iphone|ipod|ipad/.test(t)&&(o="iOS"),console.log("key"+window.sessionStorage.getItem("branch_fingerprint")),k.createAppointmentData.cartItems[0].additionalParams.browser_fingerprint_id=window.sessionStorage.getItem("branch_fingerprint")||"",k.createAppointmentData.cartItems[0].additionalParams.Utm_Source=window.sessionStorage.getItem("utm_source")||"medibuddyInWeb",k.createAppointmentData.cartItems[0].additionalParams.Utm_Medium=window.sessionStorage.getItem("utm_medium")||"",k.createAppointmentData.cartItems[0].additionalParams.platform="web"===o?"DESKTOP_WEB":"Android"===o?"ANDROID_WEB":"IOS_WEB",k.createAppointmentData.medicineCart.medicineItems=k.resData.medicineItems,k.createAppointmentData.medicineCart.totalPrice=k.resData.totalPrice,console.log(k.resData),n.makeAjaxCalls(a,k.createAppointmentData,"POST",k.user.token).then(function(e){if(e.data.isSuccess){if(k.showWalletCannotUsedMessage=!1,e.data.walletBalaceDetail&&e.data.walletBalaceDetail.length>0&&!k.isCovid&&(k.walletBalanceDetail=e.data.walletBalaceDetail),e.data.checkoutPricing&&(k.checkoutPricing=e.data.checkoutPricing,k.checkoutPricing.walletAmount=e.data.paymentOptions[0].walletAmount,k.checkoutPricing.price=k.checkoutPricing.finalPrice,k.billWalletUpdation()),k.isEssential&&(k.deliveryCost=0,e&&e.data.additionalPrice&&(k.deliveryCost=e.data.additionalPrice.DeliveryCost)),k.isNavya||e.data.paymentOptions.length>0){if(k.paymentOptions=e.data.paymentOptions,k.appointmentData.prefDateTime&&(k.customParams.appointmentDate=k.appointmentData.prefDateTime,k.customParams.appointmentDateValue=k.appointmentData.prefDateTime.toDateString()),n.bookedAppointmentDetails.finalPrice>0&&(k.customParams.amount=n.bookedAppointmentDetails.finalPrice),n.detailsForBooking.docObj.priceRange&&(k.customParams.GMV=parseInt(n.detailsForBooking.docObj.priceRange)),k.isNavya&&window._Site_Props.__setServiceDetails({serviceName:"Second Opinion",serviceType:"Cancer Care Navya"}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,fbq:!0,dbLog:!k.medicine||"meds",hj:!0,fbqReference:"InitiateCheckout",name:k.medicine?"MedsProceedToPaymentPage":"Appointment Creation Request",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:k.customParams,google:window._Site_Props.__googleTransform(k.eventCategory,"AppointmentCreationRequest",k.eventLabel)}),branchLog:{name:"Initiated Checkout",custom_data:{topic:k.eventCategory,netPaidAmount:k.customParams.amount,packageId:M?M.packageId:s.packageId,packageName:M?M.packageName:n.detailsForBooking.docObj?n.detailsForBooking.docObj.packageName:""},alias:M?M.packageName:n.detailsForBooking.docObj?n.detailsForBooking.docObj.packageName:""}}),k.isMediClinic&&(k.saleCoupon="TCSSPONSOREDCONSULT",k.validateCoupon()),k.isNavya){if(e.data.acknowledgement&&e.data.acknowledgement.isSuccess)k.navyaRedirect=e.data.acknowledgement.redirectUrl,k.bookedAppointmentDetails=n.bookedAppointmentDetails,k.bookedAppointmentDetails.couponCode="",k.mediMarketPayment={amountAfterCouponDiscount:k.bookedAppointmentDetails.finalPrice},k.finalPayment=k.strikeNavyaPkgAmount?0:k.bookedAppointmentDetails.finalPrice;else if(!e.data.acknowledgement||!e.data.acknowledgement.isSuccess)return h({message:"Sorry. Please retry later",position:"center",duration:2e3}),void p(function(){r.go("app.navya")},1e3)}else k.paymentOptions=e.data.paymentOptions,k.initializePayment(),k.checkForMembershipBenefits()||(e.data.applyCoupon?(k.bookedAppointmentDetails.couponCode=e.data.applyCoupon,k.validateCoupon()):k.getCouponCode());k.changeTab()}if(k.isEssential&&(n.detailsForBooking.docObj.quantity>0&&(k.mediMarketPayment.amountAfterCouponDiscount*=n.detailsForBooking.docObj.quantity,k.finalPayment*=n.detailsForBooking.docObj.quantity),k.mediMarketPayment.amountAfterCouponDiscount+=k.deliveryCost,k.finalPayment+=k.deliveryCost),k.medicine&&!_.isEmpty(k.paymentOptions)){var a=k.paymentOptions.find(function(e){return"PG"==e.paymentMethod});a&&a.gatewayAmount&&(k.finalPayment=a.gatewayAmount)}}else k.submitted=!1,e.data.errorMessage.toLowerCase().indexOf("order booking failed")>-1?k.error={error:"Unfortunately, we are not able to process your request at this time.",type:"alert-danger"}:203===e.status&&"Please Login to proceed"===e.data.errorMessage?n.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"bookAndPay",func:"createAppointment",args:null,stayInState:!0}):e.data.errorMessage&&(h({message:e.data.errorMessage,position:"center",duration:5e3}),u.post(l.eventlogsUrl,{eventType:"MedsCheckoutFailure",user:k.user.userDetails.userId,screen:"Checkout",element:k.createAppointmentData.medicineCart.totalPrice,info:e.data.errorMessage,domain:"web",event:"MedsCheckoutFailure"}))}),k.showWhatsappConsent&&k.createAppointmentData.cartItems&&k.createAppointmentData.cartItems.length&&k.createAppointmentData.cartItems.length>0&&k.createAppointmentData.cartItems[0].userConsent){var c=k.user.userDetails.userId,d=k.user.userDetails.pmEntityID,m=k.user.corpDetails?k.user.corpDetails.iwpEmployeeId:null,g=k.user.token;if(c&&d&&m&&g){var y={phonenumber:k.createAppointmentData.cartItems[0].phone,medibuddyUserId:c,empId:m,pmEntityId:d,packageId:k.createAppointmentData.cartItems[0].packageId,source:"medibuddy_web_portal"},v={method:"POST",url:l.docsappBackend+"/mbweb/saveUserWhatsappConsent",headers:{shorttoken:g,medibuddyuserid:c,pmentityid:d,empid:m},data:y};u(v).then(function(e){e&&e.data&&e.data.success})}}}else n.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"bookAndPay",func:"createAppointment",args:null,stayInState:!0})},k.backToUpload=function(){c.history.back()};var M;k.bookWithStorePickup=function(){if(M=null,_.each(k.pharmacyProviderData,function(e){!M&&_.find(e.providers,function(e){return e.name==k.storeData.providerName})&&(M=e,M.packageName=M.packageName.replace(" Package",""))}),M){var e={pincode:k.storeData.pincode,addressLine1:k.storeData.address,addressLine2:null,packageId:M.packageId,packageName:M.packageName,visitType:"DiagnosticCenter",isPickupFromStore:!0,pickupStoreID:k.storeData.storeID};k.customParams={visitType:e.visitType,discount:"10%"};var a=_.findWhere(k.pharmacyProviderData,{packageId:t.apolloPackageId});console.log(a),n.detailsForBooking={docObj:{packageId:a.packageId,packageName:a.packageName,dcId:_.first(a.providers).dcid,dcName:_.first(a.providers).name}},window._Site_Props.__setPackageDetails({packageName:"Medicine",providerName:n.detailsForBooking.docObj.dcName,providerLocation:s.searchc}),k.eventLabel=n.detailsForBooking.docObj.dcName+" at "+s.searchc,k.bookAppointmentForUser(e)}},k.bookWithHomeDelivery=function(){var e={pincode:k.appointmentData.patientPincode,addressLine1:k.appointmentData.patientHouseNo,addressLine2:k.appointmentData.patientLocation,packageId:k.apolloHomeDelivery?t.apolloPackageId:s.packageId,packageName:k.apolloHomeDelivery?"Apollo Pharmacy":s.searchk,visitType:"HomeVisit"};k.customParams={visitType:e.visitType};var a;a=k.apolloHomeDelivery?"10%":k.mediBiz?"15%":k.courier?k.courierDiscount:"10%-15%",k.customParams.discount=a;var i=_.findWhere(k.pharmacyProviderData,{packageId:e.packageId});n.detailsForBooking={docObj:{packageId:i?i.packageId:"",packageName:i?i.packageName:"",dcId:i?_.first(i.providers).dcid:"",dcName:i?_.first(i.providers).name:""}},window._Site_Props.__setPackageDetails({packageName:"Medicine",providerName:n.detailsForBooking.docObj.dcName,providerLocation:s.searchc}),k.eventLabel=n.detailsForBooking.docObj.dcName+" at "+s.searchc,k.optedNormalDelivery=!k.apolloHomeDelivery,k.optedHomeDelivery=!0,k.bookAppointmentForUser(e)},k.bookNonMaPackage=function(){var e=l.apiUrl+"/bookConsultation.json",a={doctorUserName:n.detailsForBooking.docObj.doctorUniqueId,uclmCode:n.detailsForBooking.docObj.properties&&n.detailsForBooking.docObj.properties.UCLMCODE?n.detailsForBooking.docObj.properties.UCLMCODE:"",appointmentDateTime:n.detailsForBooking.docObj.prefDateTime,dob:k.appointmentData.dateOfBirth,gender:k.appointmentData.gender,poweredBy:k.poweredBy,phoneNumber:k.appointmentData.phone,userConsent:k.appointmentData.userConsent,emailId:k.appointmentData.email};n.makeAjaxCalls(e,a,"POST",k.userObj.token).then(function(e){e.data.isSuccess?y.url("/appointmentDetails?orderid="+e.data.appointmentCode):h({message:"Sorry. Please retry later",position:"center",duration:5e3})})},k.checkIfValid=function(e){k.userForm;e||(c.scrollTo(0,0),console.log(angular.element(document.querySelector("input.ng-invalid"))[0]),c.scrollTo(0,0),angular.element(document.querySelector("input.ng-invalid"))[0].focus(),angular.element(document.querySelector("select.ng-invalid"))[0][0].focus())},k.bookAppointment=function(){k.checked=!0,k.customParams={},s.isRecommendation&&(k.customParams.isRecommendation=!0),k.programType&&(k.customParams.program=k.programType),k.bookNonMa?k.bookNonMaPackage():k.medicine?k.renderStorePickup&&k.storeData?(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsBookOrder",payload:window._Site_Props.__getEventParameters({custom:{delivery_type:"StorePickup"}})}),k.bookWithStorePickup()):(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsBookOrder",payload:window._Site_Props.__getEventParameters({custom:{delivery_type:"Standard"}})}),k.bookWithHomeDelivery()):k.bookAppointmentForUser()},k.changeDeliveryDetails=function(e){k.medicine&&(0===e?(k.storeData="",k.renderStorePickup=!1,k.renderHomeDelivery=!0,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsHomeDeliveryTab"})):(k.renderHomeDelivery=!1,k.renderStorePickup=!0,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsStorePickupTab"})))},k.checkGender=function(){var e="";n.detailsForBooking.docObj&&n.detailsForBooking.docObj.genderType?(n.gender=n.detailsForBooking.docObj.genderType.trim(),"m"===n.gender.toLowerCase()||"male"===n.gender.toLowerCase()?(n.gender="M",e="Male"):"f"===n.gender.toLowerCase()||"female"===n.gender.toLowerCase()?(n.gender="F",e="Female"):n.gender="both"):n.detailsForBooking.docObj.genderType||(n.gender="both"),"both"!==n.gender&&n.gender!==k.appointmentData.gender?(k.submitted=!1,k.validate={error:"This is a "+e+" specific package.",type:"Gender"}):k.validate={error:"",type:"Gender"}},k.AHCBooking=function(){var a=l.apiUrl+"AHC/BookPackage.json",t=n.isUserSignedin();k.errorAHC="",t?(k.searchData={patientName:k.appointmentData.patientName,email:k.appointmentData.email,phone:k.appointmentData.phone,userConsent:k.appointmentData.userConsent,packageId:k.appointmentPackageData.packageId,dcid:k.appointmentPackageData.dcId,prefDateTime:k.appointmentData.prefDateTime,visitType:"DiagnosticCenter",addressLine1:k.appointmentData.patientHouseNo,addressLine2:k.appointmentData.patientLocation,couponCode:"",discountedAmount:0,maid:k.appointmentData.maid,ipAddress:"",remark:k.fileUploadTextArea,dateOfBirth:k.appointmentData.dateOfBirth,gender:k.appointmentData.gender,totalPrice:n.detailsForBooking.docObj.price,relation:k.appointmentData.relation,finalPrice:n.detailsForBooking.docObj.price},k.customParams={AHCPackage:!0,appointmentDate:k.appointmentData.prefDateTime,appointmentDateValue:k.appointmentData.prefDateTime.toDateString(),amount:n.detailsForBooking.docObj.price,isRecommendation:s.isRecommendation,visitType:k.searchData.visitType},n.detailsForBooking.docObj.priceRange&&(k.customParams.GMV=parseInt(n.detailsForBooking.docObj.priceRange)),k.isCouponCodeNotEmpty&&(k.searchData.couponCode=k.validatedCouponCode),k.urlData={cartItems:[k.searchData]},k.eventCategory="AHC",k.eventLabel=k.searchData.packageName+" in "+s.searchc,k.eventLabel=s.searchc,n.makeAjaxCalls(a,k.urlData,"POST",t.token).then(function(a){if(a.data.isSuccess&&0!==a.data.orderId)if(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:!k.medicine||"meds",hj:!0,name:k.medicine?"MedsProceedToPaymentPage":"Appointment Creation Request",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:k.customParams,google:window._Site_Props.__googleTransform(k.eventCategory,"AppointmentCreationRequest",k.eventLabel)}),branchLog:{name:"Initiated Checkout",custom_data:{topic:k.eventCategory,netPaidAmount:k.customParams.amount,packageId:s.packageId,packageName:n.detailsForBooking.docObj?n.detailsForBooking.docObj.packageName:""},alias:n.detailsForBooking.docObj?n.detailsForBooking.docObj.packageName:""}}),_.isEmpty(a.data.razorPayOptions))n.orderId=a.data.orderId,w(a.data.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),e.$emit("closeBookPayPopup"),k.paymentBlockingCss=!0,k.customParams.Sponsor=!0,k.storeOrderCreatedEvent(a.data.orderId,k.customParams,s.isRecommendation,k.programType),v.set(k.userObj.userDetails.userId,k.appointmentData.dateOfBirth.getTime()),r.go("app.orderDetails",{reload:"app.orderDetails"});else{var t=Number.parseFloat(a.data.razorPayOptions.amount)/100;k.setPaymentCustomParams("razorPaymentAmount",t),k.razorPayOptions=a.data.razorPayOptions,k.razorPayOptions.name="MediBuddy",e.isWebView?(k.razorPayOptions.callback_url=l.paymentUrl+k.razorPayOptions.amount,k.razorPayOptions.redirect=!0):k.razorPayOptions.handler=k.authorizeRazorPay,k.razorPayOptions.prefill={name:k.appointmentData.patientName,email:k.appointmentData.email,contact:k.appointmentData.phone},k.razorPayOptions.modal={ondismiss:k.dismissalRazorPay},k.razorPayOptions.image="/assets/images/logo_medibuddy.png",k.razorPayOptions.description="Your order ID: "+a.data.orderId,k.razorPayOptions.theme.color="#2198ff",w(a.data.orderId,window.sessionStorage.getItem("branch_fingerprint")||""),T=new Razorpay(k.razorPayOptions),T.open(),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:k.medicine?"MedsPlaceOrder":"Payment Request",dbLog:!k.medicine||"meds",hj:!0,payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:_.extend(k.customParams,k.paymentCustomParams),google:window._Site_Props.__googleTransform(k.eventCategory,"PaymentRequest",k.eventLabel)})}),k.storeOrderCreatedEvent(a.data.orderId,k.customParams,s.isRecommendation,k.programType)}else k.errorAHC=a.data.errorMessage,k.submitted=!1})):n.openLoginPopup("","templates/openLoginPopUp.html?"+timeStamp,{controller:"bookAndPay",func:"AHCBooking",args:null,stayInState:!0})},k.bookAppointmentForUser=function(e){k.submitted=!0;var a=n.isUserSignedin();if(k.createAppointmentData={cartItems:[]},k.medicine||k.programType||(k.appointmentData.prefDateTime=n.detailsForBooking.docObj.prefDateTime),k.appointmentPackageData.isSponser){if(k.checkGender(),!k.submitted)return;k.AHCBooking()}else if(k.medicine)if(a){k.searchData={patientName:k.appointmentData.patientName,gender:k.appointmentData.gender,relation:k.appointmentData.relation,phone:k.appointmentData.phone,userConsent:k.appointmentData.userConsent,pincode:e.pincode,addressLine1:_.isString(e.addressLine1)?e.addressLine1.replace(k.emailPattern.getRegexExpression("medicineAddrReplacePattern")," "):"",addressLine2:_.isString(e.addressLine2)?e.addressLine2.replace(k.emailPattern.getRegexExpression("medicineAddrReplacePattern")," "):"",uploadedFiles:k.fileArray,isCashless:k.appointmentData.isCashless&&!k.resData.cashlessNA,packageId:e.packageId,packageName:e.packageName,isSponsored:!1,visitType:e.visitType,totalPrice:0,discount:0,finalPrice:0,maid:k.appointmentData.maid,remark:k.fileUploadTextArea,isPickupFromStore:e.isPickupFromStore,pickupStoreID:e.pickupStoreID,dateOfBirth:k.appointmentData.dateOfBirth,email:k.appointmentData.email,ailment:k.appointmentData.ailment},k.customParams.visitType=e.visitType,k.searchData.additionalParams={meta:{source:"web",type:_.isEmpty(k.resData.medicineItems)?"UPLOADRX":"SEARCH"},bookingSource:window.getSrcType(),bookingUrl:window.location.hostname,pushToPartner:k.resData.pushToPartner&&"Apollo Pharmacy"!=e.packageName,withoutPrescription:!1,userType:k.userObj.isRetailUser?"retail":"corporate",opsRemarks:k.resData.opsRemark};var t=_.countBy(k.resData.medicineItems,"rxRequired");k.resData.medicineItems&&t["false"]===k.resData.medicineItems.length&&(k.searchData.additionalParams.meta.type="ONLYOTC"),k.createAppointmentData.cartItems.push(k.searchData),k.eventCategory="Medicine",k.createAppointment()}else n.openLoginPopup("","templates/openLoginPopUp.html?"+timeStamp,{controller:"bookAndPay",func:"bookAppointmentForUser",args:e,stayInState:!0});else if(k.appointmentData.prefDateTime){var i=k.appointmentData;if(k.checkGender(),!k.submitted)return;if(_.isEmpty(n.detailsForBooking.docObj.cart)){i.isSponsored=!1,i.totalPrice=n.detailsForBooking.docObj.price,i.discount=n.detailsForBooking.docObj.priceRange-n.detailsForBooking.docObj.price,i.couponCode=i.discount>0?n.detailsForBooking.docObj.discountCode:"",i.finalPrice=n.detailsForBooking.docObj.price,i.visitType="DiagnosticCenter",k.isHomeSampleCollection||k.isCovid||k.isEssential?(i.visitType=k.isHomeSampleCollection||k.isEssential?"HomeVisit":i.visitType,i.addressLine1=k.appointmentData.patientHouseNo,i.addressLine2=k.appointmentData.patientLocation,i.pincode=k.appointmentData.patientPincode):k.consultationCheck&&k.appointmentData.patientRegistrationNum&&(i.hospitalRegistrationNo=k.appointmentData.patientRegistrationNum);var o=n.createAppointmentObject(i,n.detailsForBooking.docObj);if(_.isEmpty(n.detailsForBooking.docObj.fileArray)||(o.uploadedFiles=n.detailsForBooking.docObj.fileArray),o.isGender="M"===o.gender,o.dcLocation=n.detailsForBooking.docObj.dcLocation,o.ProgramEnrollmentId=s.memberInfo?s.memberInfo.enrollmentId:0,o.remark=k.fileUploadTextArea,_.isEmpty(k.fileArray)||(o.uploadedFiles=k.fileArray),!k.retailUser&&k.appointmentData.maid&&(o.MAID=k.appointmentData.maid),o.additionalParams={bookingSource:window.getSrcType(),bookingUrl:window.location.hostname},k.customParams.visitType=o.visitType,k.createAppointmentData.cartItems.push(o),k.isEssential&&n.detailsForBooking.docObj.quantity>1)for(var r=1;r<n.detailsForBooking.docObj.quantity;r++)k.createAppointmentData.cartItems.push(o)}else _.forEach(n.detailsForBooking.docObj.cart,function(e,a){i.isSponsored=!1,i.totalPrice=e.price,e.priceRange&&e.priceRange>e.price?i.discount=e.priceRange-e.price:i.discount=0,i.couponCode=i.discount>0?e.discountCode:"",i.finalPrice=e.price,i.visitType="DiagnosticCenter",(k.isHomeSampleCollection&&e.homeSampleCollection||k.isCovid)&&(i.visitType=k.isHomeSampleCollection&&e.homeSampleCollection?"HomeVisit":i.visitType,i.addressLine1=k.appointmentData.patientHouseNo,i.addressLine2=k.appointmentData.patientLocation,i.pincode=k.appointmentData.patientPincode);var t=n.createAppointmentObject(i,e);_.isEmpty(n.detailsForBooking.docObj.fileArray)||(t.uploadedFiles=n.detailsForBooking.docObj.fileArray),t.isGender="M"===t.gender,t.dcLocation=n.detailsForBooking.docObj.dcLocation,!k.retailUser&&k.appointmentData.maid&&(t.MAID=k.appointmentData.maid);var o={bookingSource:window.getSrcType(),bookingUrl:window.location.hostname
};n.detailsForBooking.docObj.addressFiles&&"object"==typeof n.detailsForBooking.docObj.addressFiles&&(o.addressProof=JSON.stringify(n.detailsForBooking.docObj.addressFiles)),n.detailsForBooking&&n.detailsForBooking.docObj&&!_.isEmpty(o)&&(t.additionalParams=o),k.customParams.visitType=t.visitType,k.createAppointmentData.cartItems.push(t)});k.createAppointment()}else k.validateObj("alert-danger")},k.editCart=function(){r.go("app.labtestlist",{dcID:s.dcId,packgId:s.packageId,city:n.getCity(),dcName:s.dcName,packgName:s.packgName+" diagnostic centers"},{reload:"app.labtestlist"})},k.performFunction=function(){k.serviceType=s.searchk?s.searchk:s.searchc,k.appointmentPackageData=n.detailsForBooking.docObj,k.isMediClinic=n.detailsForBooking.isMediClinic,k.packageName=_.property("packageName")(n.detailsForBooking.docObj),k.endYear=(new Date).getFullYear(),k.appointmentPackageData.minAge&&k.appointmentPackageData.minAge>0&&(k.endYear-=k.appointmentPackageData.minAge),s.categoryItemTypeId===t.homehealthcareId?(k.isHomeSampleCollection=!0,k.homeHealthCare=!0,k.eventCategory="Home Health Care"):s.categoryItemTypeId===t.medicineId?(k.medicine=!0,k.isHomeSampleCollection=!0,k.eventCategory="Medicine"):s.categoryItemTypeId===t.consultationId?(k.consultationCheck=!0,k.eventCategory="Consultation",k.eventLabel=s.searchk?s.searchk:s.searchc,k.eventLabel=n.detailsForBooking.docObj.doctorName+" "+n.detailsForBooking.docObj.doctorSpecialization+" from "+n.getCity()):s.categoryItemTypeId===t.genomFilterName||s.categoryItemTypeId===t.genomeId?(k.genome=!0,k.eventCategory="Genome",k.eventLabel=s.searchk?s.searchk:s.searchc):s.categoryItemTypeId===t.gsoId?(k.getSecondOpinion=!0,k.eventCategory="Get Second Opinion"):s.categoryItemTypeId===t.healthCheckId?(k.packages=!0,k.eventCategory="Health Checks",k.eventLabel=s.searchk?s.searchk:s.searchc):s.categoryItemTypeId===t.olServiceId?(k.olService=!0,k.eventCategory="Tele Consultation",k.eventLabel=s.searchk?s.searchk:s.searchc):s.categoryItemTypeId===t.essentialId?(k.isEssential=!0,k.eventCategory="Essentials",k.eventLabel=s.searchk?s.searchk:s.searchc,k.disableBenefSelection=!0,k.cartFinalPrice=k.appointmentPackageData.price*n.detailsForBooking.docObj.quantity):s.categoryItemTypeId!==t.dentalId&&s.categoryItemTypeId!==t.dentalPackageId||(k.isDental=!0,k.eventCategory="Dental",k.eventLabel=s.searchk?s.searchk:s.searchc),k.consultationCheck||(k.eventLabel=k.appointmentPackageData.packageName+" by "+k.appointmentPackageData.dcName+" from "+n.getCity()),k.getSecondOpinion||k.medicine||(S(n.detailsForBooking.docObj.prefDateTime)&&s.categoryItemTypeId===t.healthCheckId&&r.go("app.packagesnew",{categoryItemTypeId:t.healthCheckFilterName,searchc:"Preventive",city:v.get("city")||"Bengaluru"},{reload:"app.packagesnew"}),k.appointmentPackageData.date=n.detailsForBooking.docObj.prefDateTime.toDateString().replace(" ",", "),k.homeHealthCare||k.genome||(k.appointmentPackageData.time=n.detailsForBooking.docObj.prefDateTime)),k.fromLabTest&&(k.eventCategory="Labtest",k.eventLabel=n.detailsForBooking.docObj.dcName.trim(),k.appointmentPackageData.dcCity=n.getCity(),k.eventLabel=k.eventLabel),!k.consultationCheck&&n.detailsForBooking.docObj&&n.detailsForBooking.docObj.homeSampleCollection&&(k.isHomeSampleCollection=!0),_.contains(t.covidPackageList,n.detailsForBooking.docObj.packageName)&&(k.isCovid=!0,_.contains(t.covidPackageName,n.detailsForBooking.docObj.packageName)&&(k.isCovidDetection=!0),(t.jllEntityIds.indexOf(k.userObj.userDetails.pmEntityID)>-1||t.rblIds.indexOf(k.userObj.userDetails.pmEntityID)>-1)&&k.isCovidDetection&&(k.maskFinalPrice=!0)),n.detailsForBooking&&n.detailsForBooking.errorMessage?k.validate=n.detailsForBooking.errorMessage:k.validate="",k.isError=!1,k.isGenderSelection=!1,k.today(),k.dateOptionsForDob={formatYear:"yy",maxDate:k.takeServerDate(),minDate:new Date(1917,1,1),startingDay:1},k.popup={prefDate:!1,dateOfBirth:!1},k.toggleMaxDob(),k.genderData=t.gender,k.user=n.isUserSignedin();var e=-621355968e5;k.user&&!k.programType&&(k.appointmentData.patientName||(k.appointmentData.patientName=k.user.userDetails.displayName),k.appointmentData.email=k.user.userDetails.email,k.appointmentData.phone=k.user.userDetails.phone,k.user.userDetails.dateOfBirth&&!k.appointmentData.dateOfBirth&&new Date(parseInt(k.user.userDetails.dateOfBirth.replace("/Date(","").replace(")/",""))).getTime()!==e&&(k.appointmentData.dateOfBirth=new Date(parseInt(k.user.userDetails.dateOfBirth.replace("/Date(","").replace(")/","")))),k.appointmentData.gender||(k.appointmentData.gender=k.user.userDetails.gender)),k.bookingTabClick(),k.localscope=k,n.profileInfo&&n.profileInfo.userAddresses&&n.profileInfo.userAddresses.length>0&&(k.userAddresses=n.profileInfo.userAddresses,P()),window._MB_Analytics.__push({branchLog:{name:"Payment Screen Visited",custom_data:{topic:k.eventCategory,netPaidAmount:k.appointmentPackageData.price,packageId:k.appointmentPackageData.packageId,packageName:k.appointmentPackageData.packageName},alias:k.appointmentPackageData.packageName}})},k.formatPackageFilters=function(){n.detailsForBooking.docObj.packageFilters&&n.detailsForBooking.docObj.packageFilters.length>0&&_.forEach(n.detailsForBooking.docObj.packageFilters,function(e,a){if("gender"===e.substring(0,6).toLowerCase()){var i=e.split(":")[1];n.detailsForBooking.docObj.genderType=i}else if("maxage"===e.substring(0,6).toLowerCase()){var o=e.split(":")[1];n.detailsForBooking.docObj.maxAge=parseInt(o)}else if("minage"===e.substring(0,6).toLowerCase()){var s=e.split(":")[1];n.detailsForBooking.docObj.minAge=parseInt(s)}else"homesamplecollection"===e.substring(0,20).toLowerCase()?n.detailsForBooking.docObj.homeSampleCollection=!0:"keywords"===e.substring(0,8).toLowerCase()&&e.split(":")[1].toLowerCase().indexOf(t.dentalPackageName.toLowerCase())>-1?n.detailsForBooking.docObj.isDentalPackage=!0:"priority"===e.substring(0,8).toLowerCase()?n.detailsForBooking.docObj.corpPriority=!0:(n.detailsForBooking.docObj.genderType="Both"===n.detailsForBooking.docObj.genderType?"both":"both"===n.detailsForBooking.docObj.genderType?n.detailsForBooking.docObj.genderType:"M"===n.detailsForBooking.docObj.genderType?n.detailsForBooking.docObj.genderType:"F"===n.detailsForBooking.docObj.genderType?n.detailsForBooking.docObj.genderType:"both",n.detailsForBooking.docObj.minAge=n.detailsForBooking.docObj.minAge>0?n.detailsForBooking.docObj.minAge:0,n.detailsForBooking.docObj.maxAge=n.detailsForBooking.docObj.maxAge>0?n.detailsForBooking.docObj.maxAge:59)}),n.detailsForBooking.docObj.priceRange&&(n.detailsForBooking.docObj.priceRange=parseInt(n.detailsForBooking.docObj.priceRange.split(".")[0])),n.detailsForBooking.docObj.price<n.detailsForBooking.docObj.priceRange&&(n.detailsForBooking.docObj.discountPercent=100-Math.round(n.detailsForBooking.docObj.price/n.detailsForBooking.docObj.priceRange*100))},k.getOlServiceFiles=function(){s.categoryItemTypeId===t.olServiceId&&n.makeAjaxCalls(l.apiUrl+"/SessionStorage/"+t.olServiceId+".json","","GET",k.userObj.token).then(function(e){e.data.isSuccess&&e.data.sessionData[t.olServiceId]?(k.totalFiles=[],k.resData=JSON.parse(e.data.sessionData[t.olServiceId]),k.fileArray=[],k.resData.fileArrays&&_.find(k.resData.fileArrays,function(e){k.fileArray.push(e[0].filePublicUrl)}),k.fileUploadTextArea=k.resData.remarks):r.go("app.home",{},{reload:"app.home"})})},k.$watch("validate",function(e){e&&k.validateObj(e)}),k.data={categoryItemTypeId:s.categoryItemTypeId,keyword:s.categoryItemTypeId===t.healthCheckId?s.searchc:s.searchk,condition:s.categoryItemTypeId===t.healthCheckId?"":s.searchc,packageId:s.packageId,dcId:s.dcId},s.city&&n.setCity(s.city);var B=l.apiUrl+"/categoryitemtypesearchForDC.json";if(k.userObj=n.isUserSignedin(),k.fileArray=[],s.categoryItemTypeId===t.investigationId||s.categoryItemTypeId===t.healthCheckId)n.makeAjaxCalls(l.apiUrl+"/SessionStorage/"+k.data.categoryItemTypeId+".json","","GET",k.userObj.token).then(function(e){e.data.isSuccess&&e.data.sessionData[s.categoryItemTypeId]?(n.detailsForBooking={docObj:JSON.parse(e.data.sessionData[s.categoryItemTypeId])},s.packgName&&s.dcName||(s.packgName=n.detailsForBooking.docObj.testName||n.detailsForBooking.docObj.packageName,s.dcName=n.detailsForBooking.docObj.dcName),n.detailsForBooking.docObj.prefDateTime=new Date(parseInt(s.appTime)),n.detailsForBooking.docObj.packageName=n.detailsForBooking.docObj.cart?_.first(n.detailsForBooking.docObj.cart).packageName:n.detailsForBooking.docObj.packageName,k.homeSampleCollectionCharges=n.detailsForBooking.docObj.homeSampleCollectionCharges,k.performFunction(),window._Site_Props.__setServiceDetails({serviceName:k.eventCategory,serviceType:s.packgName}),window._Site_Props.__setPackageDetails({packageName:n.detailsForBooking.docObj&&n.detailsForBooking.docObj.cart?_.first(n.detailsForBooking.docObj.cart).packageName:"",providerName:n.detailsForBooking.docObj.dcName,providerLocation:n.detailsForBooking.docObj&&n.detailsForBooking.docObj.cart?_.first(n.detailsForBooking.docObj.cart).dcLocation:""})):r.go("app.home",{},{reload:"app.home"})});else if(s.categoryItemTypeId===t.medicineFilterName)n.makeAjaxCalls(l.apiUrl+"/SessionStorage/"+k.data.dcId+".json","","GET",k.userObj.token).then(function(e){if(e.data.isSuccess&&e.data.sessionData[k.data.dcId]){if(k.totalFiles=[],k.resData=JSON.parse(e.data.sessionData[k.data.dcId]),k.fileArray=JSON.parse(k.resData.fileArrays),_.each(k.fileArray,function(e){var a=e.lastIndexOf("/");k.totalFiles.push({filePublicUrl:e,name:e.slice(a+1)})}),k.resData.orderData&&(k.orderData=JSON.parse(k.resData.orderData)),k.otcCart=[],k.resData&&k.resData.medicineItems&&(k.otcCart=k.resData.medicineItems.filter(function(e){return"OTC_STORE"==e.medicineType})),k.resData.providerInfo&&(k.active=0,k.pharmacyProviderData=JSON.parse(k.resData.providerInfo),k.showHomeDelivery=!0,k.renderHomeDelivery=!0,k.renderStorePickup=!1,k.hasApollo=_.findWhere(k.pharmacyProviderData,{packageId:t.apolloPackageId}),k.hasApolloStorePickUp=k.hasApollo&&!!_.findWhere(k.hasApollo.providers,{isStorePickup:!0})&&!(k.otcCart.length>0),1===k.pharmacyProviderData.length&&k.hasApollo&&(k.apolloHomeDelivery=!0),k.resData.courierInfo&&(k.courier=!0,k.courierDetails=k.resData.courierInfo),k.homeDeliveryOffer=i.trustAsHtml("Discount: <b>Upto 15%</b> Off on Home Delivery (24-48 hours)")),k.courier===!0){k.courierDiscount="15";var o=new Date;k.deliveryTime=o.setDate(o.getDate()+parseInt(k.courierDetails.deliveryTime)+1),k.courierDelivery=k.courierDetails.deliveryTime}if(k.resData.store&&(k.active=1,k.renderHomeDelivery=!1,k.renderStorePickup=!0,k.storeData=JSON.parse(k.resData.store)),k.resData.remark){if(a.isJsonObject(k.resData.remark)&&!_.isEmpty(JSON.parse(k.resData.remark))){var c=JSON.parse(k.resData.remark);k.resData.remark=c.map(function(e){return(e.name||e.itemName)+" -- "+(e.count||e.quantity)}).join("|")}k.fileUploadTextArea=k.resData.remark}if(t.forceCashlessEntityIds.indexOf(k.userObj.userDetails.pmEntityID)>-1&&(k.resData.cashlessNA=!1,k.resData.pushToPartner=!0),(!k.resData.cashlessNA||k.user.isRetailUser&&k.medicine)&&(k.appointmentData.isCashless=!0),!k.resData.rxRequired&&k.resData.remark&&_.isEmpty(k.fileArray)){var d={medicineCart:k.resData.remark.split("|").map(function(e){var a=e.split(" -- ");return{name:a[0],quantity:a[1]}})};u.post(l.medsService+"medibuddy/generateOtcPrescription",d).then(function(e){e.data.message&&!_.isEmpty(e.data.message.prescription)&&(k.fileArray=k.fileArray.concat(e.data.message.prescription),_.each(k.fileArray,function(e){var a=e.lastIndexOf("/");k.totalFiles.push({filePublicUrl:e,name:e.slice(a+1)})}))})}if(k.user=n.isUserSignedin(),k.user&&!k.programType&&(k.appointmentData.patientName||(k.appointmentData.patientName=k.user.userDetails.displayName),k.appointmentData.email=k.user.userDetails.email,k.appointmentData.phone=k.user.userDetails.phone),k.resData.appointmentData)k.appointmentData=JSON.parse(k.resData.appointmentData);else if(k.resData.patientData){var p=JSON.parse(k.resData.patientData);O(p)}if(k.orderData&&(k.appointmentData.patientHouseNo=k.orderData.addressLine1,k.appointmentData.patientLocation=k.orderData.addressLine2),k.whitelistedForPG=!1,k.userObj&&k.userObj.userDetails&&k.userObj.userDetails.pmEntityID&&u.get("https://sanjeevani.medibuddy.in/wallet/rules/checkDeductionWhitelisting/"+k.userObj.userDetails.pmEntityID).then(function(e){k.whitelistedForPG=e.data.isCorporateWhitelistedForDeduction}),k.userObj&&k.userObj.userDetails&&k.userObj.userDetails.pmEntityID){k.isTcsUser=1006639==k.userObj.userDetails.pmEntityID;var m=l.medsService+"app/getAilmentList/"+k.userObj.userDetails.pmEntityID;k.appointmentData.ailment="",u.get(m).then(function(e){k.ailmentRequired=e.data.message.isAilmentRequired,k.ailmentRequired&&(k.sysArr=e.data.message.ailmentList)})}k.isHomeSampleCollection=!0,k.medicine=!0,k.appointmentPackageData={dcCity:n.getCity()},k.eventCategory="Medicine",k.appointmentData.patientPincode=s.searchc,P(),k.endYear=(new Date).getFullYear(),window._Site_Props.__setServiceDetails({serviceName:k.eventCategory,serviceType:s.searchc}),k.bookingTabClick()}else r.go("app.home",{},{reload:"app.home"})});else if(_.isEmpty(n.detailsForBooking))if(k.bookNonMa){B=l.apiUrl+"/GetConsulationPackage.json";var F={packageIds:new Array(0)};F.packageIds.push(s.packageId),n.makeAjaxCalls(B,F,"POST",k.userObj.token).then(function(e){if(e.data.categoryItemTypeResponse&&e.data.categoryItemTypeResponse.length>0&&e.data.categoryItemTypeResponse[0].categoryItems&&e.data.categoryItemTypeResponse[0].categoryItems.length>0){if(e.data.categoryItemTypeResponse[0].categoryItems[0]){var a=_.find(e.data.categoryItemTypeResponse[0].categoryItems,function(e){return e.doctorUniqueId===s.doctorId});a?n.detailsForBooking={docObj:a}:n.detailsForBooking={docObj:e.data.categoryItemTypeResponse[0].categoryItems[0]}}else n.detailsForBooking={docObj:{}};n.detailsForBooking.docObj.prefDateTime=new Date(parseInt(s.appTime)),k.formatPackageFilters(),k.performFunction(),window._Site_Props.__setServiceDetails({serviceName:k.eventCategory,serviceType:k.serviceType}),window._Site_Props.__setPackageDetails({packageName:n.detailsForBooking.docObj.packageName,providerName:n.detailsForBooking.docObj.dcName,providerLocation:n.detailsForBooking.docObj.dcLocation})}else r.go("app.home",{},{reload:"app.home"})})}else s.categoryItemTypeId===t.navyaId?n.makeAjaxCalls(l.apiUrl+"/SessionStorage/"+k.data.categoryItemTypeId+".json","","GET",k.userObj.token).then(function(e){e.data.isSuccess&&e.data.sessionData[t.navyaId]?(n.detailsForBooking={docObj:JSON.parse(e.data.sessionData[t.navyaId])},s.packgName&&s.dcName||(s.packgName=n.detailsForBooking.docObj.testName,s.dcName=n.detailsForBooking.docObj.dcName),k.strikeNavyaPkgAmount=a.getFlatProperty(n,"detailsForBooking.docObj.strikePackageAmount"),k.strikeNavyaPkgAmount&&t.wiproIds.indexOf(k.userObj.userDetails.pmEntityID)>-1&&(k.relation=_.filter(k.relation,function(e){return _.contains(A,e.relationId)})),n.detailsForBooking.docObj.prefDateTime=new Date(parseInt(s.appTime)),k.performFunction(),window._Site_Props.__setServiceDetails({serviceName:k.eventCategory,serviceType:k.eventLabel}),window._Site_Props.__setPackageDetails({packageName:n.detailsForBooking.docObj.packageName,providerName:n.detailsForBooking.docObj.dcName,providerLocation:n.detailsForBooking.docObj.dcLocation})):r.go("app.home",{},{reload:"app.home"})}):n.makeAjaxCalls(B,k.data,"POST",k.userObj.token).then(function(e){if(e.data.categoryItemTypeResponse&&e.data.categoryItemTypeResponse.length>0&&e.data.categoryItemTypeResponse[0].categoryItems&&e.data.categoryItemTypeResponse[0].categoryItems.length>0){if(e.data.categoryItemTypeResponse[0].categoryItems[0]){var a=_.find(e.data.categoryItemTypeResponse[0].categoryItems,function(e){return e.doctorUniqueId===s.doctorId});a?n.detailsForBooking={docObj:a}:n.detailsForBooking={docObj:e.data.categoryItemTypeResponse[0].categoryItems[0]}}else n.detailsForBooking={docObj:{}};n.detailsForBooking.docObj.prefDateTime=new Date(parseInt(s.appTime)),k.formatPackageFilters(),k.getOlServiceFiles(),k.performFunction(),window._Site_Props.__setServiceDetails({serviceName:k.eventCategory,serviceType:k.serviceType}),window._Site_Props.__setPackageDetails({packageName:n.detailsForBooking.docObj.packageName,providerName:n.detailsForBooking.docObj.dcName,providerLocation:n.detailsForBooking.docObj.dcLocation})}else r.go("app.home",{},{reload:"app.home"})});else k.getOlServiceFiles(),k.performFunction(),window._Site_Props.__setPackageDetails({packageName:n.detailsForBooking.docObj.packageName,providerName:n.detailsForBooking.docObj.dcName,providerLocation:n.detailsForBooking.docObj.dcLocation});k.querySubmitCheck=!1,k.$on("IdleTimeout",function(){p(function(){k.querySubmitCheck=!0},0,!0)}),k.submitQuery=function(){d.open({templateUrl:"templates/help.html?"+timeStamp,size:"sm",controller:["$scope","$http","notify","$uibModalInstance",function(e,a,t,i){e.subject="User idle in payment page_"+k.eventCategory,e.feebackFunction=function(i){var o={userFeedBack:i.userFeedBack,subject:e.subject,userName:i.userName,phonenumber:i.phonenumber,email:i.email};a.post(l.apiUrl+"UserFeedBack",o,{headers:{"Content-Type":"application/json"}}).then(function(e){t({message:"Thank you! Your feedback is submitted successfully.",position:"center",duration:5e3})})},e.ok=function(){i.dismiss("cancel")}}]})},m.watch();var x=e.$on("bookAndPay",function(e,a){k[a.func](a.args)}),N=e.$on("userDetails",function(e,a){D(),k.getMembershipDetailForUser(),n.profileInfo&&n.profileInfo.userAddresses&&n.profileInfo.userAddresses.length>0&&(k.userAddresses=n.profileInfo.userAddresses,k.appointmentData.patientPincode=s.searchc,P())}),E=e.$on("showWalletInfo",function(e,a){k.bookNonMa&&k.checkCashlessLabel()}),j=e.$on("$stateChangeStart",function(e,a){T&&T.close()});s.categoryItemTypeId!=k.medsPayment.categoryItemTypeId&&k.medicine&&r.go("app.payment",k.medsPayment,{reload:"app.payment"}),k.updateMedicines=function(){k.cartQuantity=0;var e=f.getCart();k.cart=e&&e.items?e.items:k.medsCart,k.medsCart=k.cart,_.forEach(k.cart,function(e){var a=k.medicines.findIndex(function(a){return k.item={count:e.count||e.addedQuantity},a.drugCode==e.drugCode});a==-1||(k.medicines[a].count=e.count||e.addedQuantity),k.cartQuantity+=e.count||e.addedQuantity}),v.set("medsCart",k.medsCart)};var R=e.$on("userLogin",function(e,a){f.addBulkItemToCart(),n.updateMedsLocalCart(),r.go("app.medicine",{categoryItemTypeId:"Medicine"})}),V=e.$on("userLogout",function(e,a){k.isCorpSponsoredUser=!1,n.medsCartInfo={quantity:0},k.medsCart=f.removeMedsCart(),k.updateMedicines()});k.$on("$destroy",function(){R(),V(),j(),x(),N(),E(),k.manageAddressPopup&&k.manageAddressPopup.dismiss("cancel"),c.removeEventListener("message",k.onDismissBilldeskPopup)})}}}]),e.register.directive("mediCompareText",[function(){return{require:"ngModel",link:function(e,a,t,i){t.mediCompareText&&(e.$watch(t.mediCompareText,function(e){i.$viewValue&&i.$setValidity("mediCompareText",e===i.$viewValue)}),i.$parsers.push(function(a){var o=a===e.$eval(t.mediCompareText);return i.$setValidity("mediCompareText",o),o?a:void 0}))}}}]),e.register.directive("domManipulation",["$rootScope","$window","$state","$uibModalStack",function(e,a,t,i){return{restrict:"EA",link:function(i,o,n){a.scrollTo(0,0),e.$on("$stateChangeSuccess",function(e){"app.home"===t.current.name||"app.register"===t.current.name?(angular.element(document.body).addClass("home"),angular.element(document.body).removeClass("inner")):(angular.element(document.body).addClass("inner"),angular.element(document.body).removeClass("home"))}),e.$on("dailogserviceOpen",function(e){angular.element(document.body).toggleClass("bodyScrollFix")}),o.on("click",function(){angular.element(document.body).toggleClass("filter-active")})}}}]),e.register.directive("footerHeight",["$interval","$document","$timeout",function(e,a,t){return function(i,o,n){i.stop=function(){e.cancel(i.promise)},i.promise=e(function(){var e=function(e){var t="";return t=a[0].getElementById(e)},o=e("filterId");if(o){var n=o.firstElementChild.clientHeight+100;angular.element(document.getElementById("containeWrap")).css("min-height",n+"px"),t(function(){i.stop()},2e3)}},500)}}]),e.register.directive("mediNotificationContainer",["$timeout","$window",function(e,a){var t=6e3;return{restrict:"E",replace:!0,scope:{setErrorNotification:"=errorMessage"},templateUrl:"/templates/notificationContainer.html?"+timeStamp,link:function(a){function i(i,o){a.notification.message=o,a.alertClass=i,a.notification.visible=!0,e(function(){a.notification.visible=!1},t)}a.notification={},a.notification.visible=!1,a.closeNotification=function(){a.notification.visible=!1},a.$watch("setErrorNotification",function(e){e&&(a.setErrorNotification="",i(e.type,e.error))})}}}]),e.register.directive("fupload",["$rootScope","Upload","$timeout","authService","$state","apiProvider","$window","$stateParams","notify","navConstantsSvc","$http","$uibModal","localStorageService","medsService",function(e,a,t,i,o,n,s,r,l,c,d,p,m,g){return{restrict:"AE",scope:{provider:"=?",orderWithPresc:"=?",totalfilearray:"=?",filetextarea:"=?",prescriptionname:"=?",mandatory:"=?",apollohomedelivery:"=?",filePipeline:"=?",isPharmacy:"=?",medicineCart:"=?"},templateUrl:"/templates/mediUploadFileTemplate.html?"+timeStamp,link:function(s,d,g){function u(){s.isAnyFileStillUploading=_.reduce(s.totalFiles,function(e,a){return e||a.isLoading},!1)}function h(){s.filePipeline&&(s.filePipeline.isPrescriptionUploaded=s.totalFiles.length,s.totalFiles.length&&s.$emit("uploadedFiles",!0))}s.hasapollo=!1,s.adjudicationText={0:"CASHLESS",1:"COD",2:"OTHERS"},s.isMobileView=e.isMobileView,s.prescriptionname||(s.prescriptionname=g.prescriptionname?g.prescriptionname:"Prescription"),s.filePipeline||(s.filePipeline={}),s.isAnyFileStillUploading=!1,s.activateChat=function(){i.activateChat()},s.provider&&s.provider.length>0&&(_.each(s.provider,function(e,a){e.packageId===c.apolloPackageId?(s.storePickup=e,s.hasapollo=!0):(s.firstProvider=e,s.hasCourier=!!_.first(e.providers).courierInfo)}),1!==s.provider.length||s.firstProvider||(s.firstProvider=s.storePickup)),s.newOrder=function(){s.hideRefill=!0,s.totalFiles=[],s.fileArray=[],s.updatedFiles={},s.refill=null,s.errFiles=[],s.showPrevOrdersList=!1,s.uploadRemark=!1},s.getPreviousOrders=function(){var e=i.isUserSignedin();if(e&&s.orderWithPresc){var a=n.apiUrl+"/medicineorder.json";i.makeAjaxCalls(a,"","GET",e.token).then(function(e){if(s.hideRefill=!1,s.totalFiles=[],s.errFiles=[],e.data.isSuccess){if(i.reOrderId){var a=_.findWhere(e.data.orders,{orderId:i.reOrderId});_.isEmpty(a)?s.totalOrder=e.data.orders:(s.refillOrder(a),i.reOrderId=null,s.totalOrder=[],s.totalOrder.push(a))}else s.totalOrder=e.data.orders;_.forEach(s.totalOrder,function(e,a){e.isSelected=!1}),s.orderAvailable=!0}else s.orderAvailable=!1;window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Load Previous Orders",payload:window._Site_Props.__getEventParameters({service:!0})})})}},s.refillSignedIn=function(){var e=i.isUserSignedin();e?_.isEmpty(e)||i.makeAjaxCalls(n.apiUrl+"/UpdateSession/"+e.token,"","GET").then(function(e){e.data?s.getPreviousOrders():i.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"fileUpload",func:"refillSignedIn",args:null,stayInState:!0})}):i.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"fileUpload",func:"refillSignedIn",args:null,stayInState:!0})},s.refillOrder=function(e){s.updatedFiles={},s.totalFiles=[],s.refill=e,s.fileArray=e.uploadedFiles,s.showPrevOrdersList=!1,angular.forEach(s.totalOrder,function(e,a){e.isSelected=!1}),e.isSelected=!0,s.selectedOrder=e,s.selectedId=e.orderId,_.each(e.uploadedFiles,function(e){var a=e.lastIndexOf("/");s.totalFiles.push({filePublicUrl:e,name:e.slice(a+1)})}),s.uploadRemark=!0,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Refill Order",payload:window._Site_Props.__getEventParameters({service:!0})})},s.prescriptionDownload=function(e){var a="";a=e.filePublicUrl?e.filePublicUrl.split("/")[0]:e.result.fileDetails[0].filePublicUrl.split("/")[0],i.fileDownload(a)},s.downloadAllPrescriptions=function(e){_.forEach(e.uploadedFiles,function(e){i.fileDownload(_.first(e.split("/")))})},s.uploadFiles=function(e,o){if(e){String.prototype.includes||(String.prototype.includes=function(){return String.prototype.indexOf.apply(this,arguments)!==-1});for(var n=0;n<e.length;n++)if(e[n].name.indexOf("exe")>-1||e[n].name.indexOf("bat")>-1||e[n].size/1048576>15)o.push(e[n]),e.splice(n,1),n--;else{var r=_.where(s.totalFiles,{name:e[n].name});_.isEmpty(r)&&s.totalFiles.push(e[n])}}s.files=e,o.length>0&&(s.errFiles=o),0===o.length&&s.totalFiles.length>0&&(s.errFiles=[]),angular.forEach(e,function(e){if(_.contains(s.totalFiles,e)){var o=e.name.split(".").pop().length,n=e.name.substring(0,e.name.length-o-1)+(new Date).getTime()+"."+e.name.split(".").pop();e=a.rename(e,n),e.isLoading=!0,u(),i.uploadFile(e,c.medsContract,"Prescription").then(function(a){t(function(){a.data.isSuccess?(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",hj:!0,name:"MedsFileUploaded",payload:window._Site_Props.__getEventParameters({service:!0})}),_.isEmpty(s.medicineCart)||window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsRxUploaded",payload:window._Site_Props.__getEventParameters({custom:{status:!0}})}),s.UploadPrescription=!1,s.uploadRemark=!0,e.result=a.data,s.updatedFiles[a.data.fileDetails[0].fileName]=a.data.fileDetails,s.orderWithPresc||(s.totalfilearray=s.updatedFiles),_.each(s.totalFiles,function(e){e.fileType&&(e.fileType="prescription")})):(_.isEmpty(s.medicineCart)||window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsRxUploaded",payload:window._Site_Props.__getEventParameters({custom:{status:!1}})}),_.find(s.totalFiles,function(a){a.name===e.name&&(s.totalFiles=_.without(s.totalFiles,a))})),h(),e.isLoading=!1,u()})},function(a){_.find(s.totalFiles,function(a){a.name===e.name&&(s.totalFiles=_.without(s.totalFiles,a))}),h(),e.isLoading=!1,u()})}})},s.unselectItem=function(e){e.ngfName?(s.updatedFiles=_.omit(s.updatedFiles,e.ngfName),s.totalfilearray=s.updatedFiles,_.find(s.totalFiles,function(a){a.ngfName===e.ngfName&&(s.totalFiles=_.without(s.totalFiles,a),_.isEmpty(s.totalFiles)&&(s.uploadRemark=!1))})):(_.isEmpty(s.updatedFiles)?s.fileArray&&_.find(s.fileArray,function(a){a.indexOf(e.name)>-1&&(s.fileArray=_.without(s.fileArray,a))}):(s.updatedFiles=_.omit(s.updatedFiles,e.name),s.totalfilearray=s.updatedFiles),_.find(s.totalFiles,function(a){a.name===e.name&&(s.totalFiles=_.without(s.totalFiles,a),_.isEmpty(s.totalFiles)&&(s.uploadRemark=!1))})),h(),s.hideRefill||0!==s.totalFiles.length||angular.forEach(s.totalOrder,function(e,a){e.isSelected=!1}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"File Removed",payload:window._Site_Props.__getEventParameters({service:!0})}),setTimeout(function(){s.$emit("uploadedFiles",!1)}),s.errFiles=[]},s.proceed=function(){var e=i.isUserSignedin();if(e)if(0===s.totalFiles.length&&s.mandatory)l({message:"Please upload a prescription to proceed",position:"center",duration:5e3});else{var a=i.isUserSignedin();a?_.isEmpty(a)||i.makeAjaxCalls(n.apiUrl+"/UpdateSession/"+a.token,"","GET").then(function(e){e.data?s.proceedAfterValidation():i.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"fileUpload",func:"proceed",args:null,stayInState:!0})}):i.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"fileUpload",func:"proceed",args:null,stayInState:!0})}else i.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"fileUpload",func:"proceed",args:null,stayInState:!0});_.isEmpty(s.medicineCart)||window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsSearchRxButton",payload:window._Site_Props.__getEventParameters({service:!0})})},s.showPrevOrders=function(){s.showPrevOrdersList=!0},s.confirmchechout=function(){var e=[];i.reOrderId&&(s.fileArray=i.medsReoderFiles);var a={fileArrays:JSON.stringify(s.fileArray),remark:s.filetextarea};s.refill&&(a.orderData=JSON.stringify(s.refill)),a.providerInfo=JSON.stringify(s.provider),s.hasCourier&&(a.courierInfo=_.first(s.firstProvider.providers).courierInfo),s.medicineCart&&(_.each(s.medicineCart.items,function(a,t){1==a.rxRequired&&(s.mandatory=!0);var i=s.medicineCart.items.find(function(e){return"AVAILABLE"==a.availability&&e.drugCode==a.drugCode});_.isEmpty(i)||e.push(i)}),s.medicineCart.medicineItems=e),_.isEmpty(s.medicineCart)||_.extend(a,_.pick(s.medicineCart,"pushToPartner","remark","cashlessNA","isOtcOnly","opsRemark","medicineItems","totalPrice"));var t={sessionData:{},forceUpdate:!0};t.sessionData[c.medicineId]=JSON.stringify(a),(void 0===s.firstProvider||s.hasapollo&&s.apollohomedelivery)&&(s.firstProvider=s.storePickup),i.makeAjaxCalls(n.apiUrl+"/SessionStorage.json",t,"POST",s.userObj.token).then(function(e){e.data.isSuccess&&(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,fbq:!0,fbqReference:"AddToCart",name:"Slot Booked",dbLog:!0,hj:!0,googleSheet:!0,payload:window._Site_Props.__getEventParameters({service:!0,google:window._Site_Props.__googleTransform("Medicine","SlotBooked",r.pincode)})}),_.isEmpty(s.medicineCart)||window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsProceedWeb"}),m.setStorageType("sessionStorage"),m.set("medsPayment",JSON.stringify({categoryItemTypeId:r.categoryItemTypeId,searchc:r.pincode,searchk:s.firstProvider.packageName,dcId:c.medicineId,packageId:s.firstProvider.packageId})),m.setStorageType("localStorage"),o.go("app.payment",{categoryItemTypeId:r.categoryItemTypeId,searchc:r.pincode,searchk:s.firstProvider.packageName,dcId:c.medicineId,packageId:s.firstProvider.packageId},{reload:"app.payment"}))})},s.popup=function(){p.open({animation:!0,backdrop:"none",template:'                <div class="modal-bottom-header modal-header p-t-10 p-l-20 p-r-20 primary-color">                  <div class="btn-border-close m-b-20"><span class="cursor-pointer pull-right" ng-style="{\'color\':isHover ? \'#000\' : \'#aaa\'}" ng-class="{\'md-dark-color\':isMobileView}"ng-init="isHover=false;" ng-mouseover="isHover=true;" ng-mouseout="isHover=false;" ng-click="closeModal()">close</span></div>                  <div class="lgTxt bold" style="font-size: 20px;">Important message on cart items</div>                </div>                <div class="modal-body primary-color modal-border-body clearfix" ng-class="{\'p-t-0\':!isMobileView}">                  <div class="col-xs-12 col-md-12 p-l-0 p-r-0">                  <div style="border-color: #80808038;border-width: 1px;/* border: groove; */border-radius: 10px;padding: 10px;border-style: ridge;">                    <div class="lgTxt" style="font-size: 15px;">Following items are out of stock.</div>                    <ul>                    <div  ng-repeat="item in outOfStockItems">                      <li class="m-b-5"><b>{{item.name}}</b> </li>                    </div>                    </ul>                    </div>                    <br>                    <div class="lgTxt" style="font-size: 13px;">Please clear the out of stock items from cart and proceed</div>                    <button class="br-15 btn btn-danger btn-block p-t-10 p-b-10 m-t-20" ng-click="continue()">Clear cart & Proceed</button>                  </div>                </div>                ',scope:s,controller:["$scope","$uibModalInstance",function(e,a){e.outOfStockItems=s.outOfStockItems,e.closeModal=function(){a.dismiss("cancel")},e.closeModalafterconfirm=function(){o.go("app.medicineCart",{medicine:"Medicines",pincode:i.getPincode()},{reload:"app.medicineCart"}),a.dismiss("cancel")},e.apply=function(){e.closeModal()},e["continue"]=function(){var a=[],t=[];s.dummyCart.forEach(function(e){var i=s.medicineCart.items.findIndex(function(a){return a.drugCode==e.drugCode;
}),o=s.medsCart.findIndex(function(a){return a.drugCode==e.drugCode});a.push(s.medicineCart.items[i]),t.push(s.medsCart[o])}),s.medicineCart.items=a,m.set("medsCart",t),s.medicineCart.medicineItems=s.dummyCart,e.closeModalafterconfirm()}}],size:e.isMobileView?"bottom":"border modal-sm",windowClass:e.isMobileView&&"bottom-sheet"})},s.proceedAfterValidation=function(){if(_.find(s.updatedFiles,function(e){s.fileArray.push(e[0].filePublicUrl)}),s.fileArray.length>0||!s.mandatory){s.userObj=i.isUserSignedin();var e={fileArrays:JSON.stringify(s.fileArray),remark:s.filetextarea};s.refill&&(e.orderData=JSON.stringify(s.refill)),e.providerInfo=JSON.stringify(s.provider),s.hasCourier&&(e.courierInfo=_.first(s.firstProvider.providers).courierInfo);s.confirmchechout()}};var f=e.$on("fileUpload",function(e,a){s.hideRefill||s.getPreviousOrders(),a&&s[a.func](a.args)}),y=s.$on("clearFiles",function(e){_.each(s.totalFiles,function(e){s.unselectItem(e)})});s.$on("$destroy",function(){f(),y()}),s.updatedFiles={},s.totalFiles=[],s.fileArray=[],_.isEmpty(s.totalfilearray)?s.totalfilearray=s.updatedFiles:_.each(s.totalfilearray,function(e,a){if(_.isArray(e)){var t=_.first(e);s.totalFiles.push({filePublicUrl:t.filePublicUrl,name:t.fileName}),s.updatedFiles[a]=new Array({name:t.fileName,filePublicUrl:t.filePublicUrl})}else{var i=e.lastIndexOf("/");s.totalFiles.push({filePublicUrl:e,name:e.slice(i+1)}),s.updatedFiles[e.slice(i+1)]=new Array({name:e.slice(i+1),filePublicUrl:e})}s.uploadRemark=!0}),h(),s.orderWithPresc&&(s.newOrder(),i.reOrderId&&s.refillSignedIn())}}}]),e.register.directive("mediManageAddress",["$rootScope","navConstantsSvc","$sce","patternService","authService","$state","apiProvider","$window","$httpParamSerializer","$stateParams","$timeout","notify","$http","$location",function(e,a,t,i,o,n,s,r,l,c,d,p,m,g){return{restrict:"AE",scope:{userProfile:"=",allowDelete:"=?",openAddAddress:"=?",filterAddress:"=?"},templateUrl:"templates/mediManageAddress.html?"+timeStamp,link:function(a,t,i){function n(){var a=document.getElementById("address-slider");r=new Glider(a,{slidesToShow:"auto",slidesToScroll:1,draggable:e.isMobileView,skipTrack:!0,itemWidth:230,exactWidth:230,arrows:{prev:".glider-prev",next:".glider-next"}})}var r,l=null;a.editingAddress=null,a.user=o.getUserObj(),a.sendCleverTapEvent=function(e,a){var t=null;a?(a.action=e,t=a):t={action:e},window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Manage Address Book",payload:window._Site_Props.__getEventParameters({custom:t,service:!0})})},a.startEditingAddress=function(e,t){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"MedsAddAddr"}),a.disablePincode=!1,t!==-1?(a.sendCleverTapEvent("Edit",{addressTag:e.addressTag}),a.editingAddress=angular.copy(e),a.editingAddress.isActive=!0,a.editingAddress.additionalProperties?a.editingAddress.additionalProperties.name||(a.editingAddress.additionalProperties.name=a.userProfile.firstName):a.editingAddress.additionalProperties={name:a.userProfile.firstName},a.editingAddress.index=t):(a.sendCleverTapEvent("New"),a.filterAddress&&(a.disablePincode=!!a.filterAddress.pincode),a.editingAddress=angular.copy(a.filterAddress),a.editingAddress&&"object"==typeof a.editingAddress||(a.editingAddress={}),a.editingAddress.additionalProperties={name:""},a.editingAddress.isActive=!0,a.editingAddress.index=a.userProfile.userAddresses?a.userProfile.userAddresses.length:0),a.allowDelete&&o.scrollToSection("addressForm")},a.cancelEditAddress=function(){a.editingAddress.addressTag?a.sendCleverTapEvent("Cancel",{addressTag:a.editingAddress.addressTag}):a.sendCleverTapEvent("Cancel"),a.editingAddress=null,d(function(){r&&r.refresh()},100)},a.toggleAddressState=function(e,t){t?a.sendCleverTapEvent("Undo Delete",{addressTag:e.addressTag}):a.sendCleverTapEvent("Delete",{addressTag:e.addressTag}),e.isActive=t,l&&(d.cancel(l),l=null);var i=!t;i||a.userProfile.userAddresses.forEach(function(e){e.isActive||(i=!0)}),i&&(l=d(function(){c()},3e3))};var c=function(e){var t=[];e||_.each(a.userProfile.userAddresses,function(e){t.push(e.addressTag)});var i=s.apiUrl+"/UpdateProfile.json";o.makeAjaxCalls(i,a.userProfile,"POST",a.user.token,a.cityName).then(function(e){if(e.data.isSuccess){a.sendCleverTapEvent("Save Successful"),e.data.profile.dob&&(e.data.profile.dob=new Date(parseInt(e.data.profile.dob.replace("/Date(","")))),(!e.data.profile.userAddresses||e.data.profile.userAddresses&&0===e.data.profile.userAddresses.length)&&(e.data.profile.userAddresses=[]),o.userAddresses=e.data.profile.userAddresses.filter(function(e){return e.latitude&&e.longitude}),e.data.profile.gender&&("f"===e.data.profile.gender.toLowerCase()?e.data.profile.gender="Female":"m"===e.data.profile.gender.toLowerCase()?e.data.profile.gender="Male":e.data.profile.gender="Others"),a.userProfile=e.data.profile,o.profileInfo=e.data.profile;for(var i=0,n=a.userProfile.userAddresses.length;i<n;i++){var s=a.userProfile.userAddresses[i];if(!_.contains(t,s.addressTag)){a.$emit("selectAddress",s);break}}a.userProfile&&d(function(){r&&r.refresh()},100),p({message:"Updated Successfully!",position:"center",duration:5e3})}else p({message:"Sorry! Please try again after sometime.",position:"center",duration:5e3})})};a.submitNewAddress=function(e){if(e.$valid){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"MedsBookOrder"}),a.editingAddress.addressTag?a.sendCleverTapEvent("Save",{addressTag:a.editingAddress.addressTag}):a.sendCleverTapEvent("Save"),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsHomeDelivery"});var t=a.editingAddress.index;delete a.editingAddress.index,a.userProfile.userAddresses||(a.userProfile.userAddresses=[]),a.editingAddress.isPrimary&&a.userProfile.userAddresses.forEach(function(e){e.isPrimary=!1}),a.userProfile.userAddresses[t]=a.editingAddress,a.editingAddress=null,c(a.userProfile.userAddresses[t].addressTag)}},d(n,100);var m=e.$on("userLogin",function(e,t){a.user=o.getUserObj(),d(function(){r&&r.refresh()},100)});a.$on("$destroy",function(){if(r&&r.destroy(),m(),l){d.cancel(l);var e=s.apiUrl+"/UpdateProfile.json";o.makeAjaxCalls(e,a.userProfile,"POST",a.user.token,a.cityName).then(function(){})["catch"](function(){}),o.profileInfo.userAddresses=_.filter(o.profileInfo.userAddresses,function(e){return e.isActive}),l=null}}),a.$watch("userProfile",function(e){r&&r.refresh()}),a.sendCleverTapEvent("View Address Book"),a.openAddAddress&&!a.editingAddress&&a.startEditingAddress(null,-1)}}}]),e.register.directive("productSearch",["$rootScope","$window","authService","apiProvider","$http","$state","$uibModal","$timeout","patternService","navConstantsSvc","$location","$stateParams","corpLabsService",function(e,t,i,o,n,s,r,l,c,d,p,m,g){return{restrict:"E",scope:{isLoading:"=?",showSuggestion:"=?",searchText:"=?",isSeo:"=?",pipeline:"=?",categoryType:"=?",onlyLocation:"=?",srcPage:"=?",isCorpLabs:"=?",disabled:"=?"},templateUrl:"/templates/product-search.html?"+timeStamp,link:function(u,h,f){function y(){w="",S=!1,i.makeAjaxCalls(o.apiUrl+"/Labs/FetchPincodeByCity/"+u.pipeline.preferredCity,"","GET").then(function(e){e.data.isServicable&&e.data.pincode?w=e.data.pincode+"":S=!0,v()})}function v(){u.setCityPincode=!0;var e=i.getPincode();w?u.validatePinCode(w,!0):S&&(e?u.validatePinCode(e):u.selectLocation())}function k(e){u.pipeline.searchText&&(u.isLoading=!0,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",hj:!0,name:"MedsSearch",payload:window._Site_Props.__getEventParameters({custom:{keyword:e}})}),n.post(o.medsService+"app/medicine/search",{from:0,key:e,pmEntityId:C.userDetails?C.userDetails.pmEntityID:"1018900",source:"medibuddy",to:10},{headers:{pmEntityId:C.userDetails?C.userDetails.pmEntityID:"1018900"}}).then(function(e){_.isEmpty(e.data.message)?(u.isLoading=!1,u.searchResult=[]):(u.searchResult=e.data.message,u.counter=0,u.showDropdown=!0,u.isLoading=!1)},function(e){u.isLoading=!1,u.searchResult=[]}))}function b(e,a){u.pipeline.searchText&&(u.isLoading=!0,i.makeAjaxCalls(o.apiUrl+"/Labs/Search/"+u.city+"/"+u.pincode+"/"+e+"/10/"+(a?"true":"false"),"","GET",C.token,u.city,!0).then(function(a){a.data.isSuccess?(u.searchResult=a.data.searchedItems,u.counter=0,u.showDropdown=!0,u.isLoading=!1,u.pipeline.searchText=e):(u.isLoading=!1,u.searchResult=[]),a.data.suggestedKeyword&&e&&(u.pipeline.suggestedKeyword=e.toLowerCase()!==a.data.suggestedKeyword.toLowerCase()?a.data.suggestedKeyword:""),u.pipeline.searchText&&u.$emit("productSearchResult",u.searchResult,!0)},function(e){u.isLoading=!1,u.searchResult=[],u.$emit("productSearchResult",[],!0),notify({message:"There is some trouble loading in search results, please try again later",position:"center",duration:5e3})}))}var D="",C=i.isUserSignedin(),P=!!_.isEmpty(C)||C.isRetailUser;if(u.city=i.getCity(),u.isMergeFlow=!0,u.isMobileView=e.isMobileView,u.isMedicine=!1,u.isLabs=!1,u.isAhc=!1,u.setCityPincode=!1,_.isEmpty(u.pipeline)&&(u.pipeline={}),u.categoryType)switch(u.pincode=i.getPincode(),u.categoryType){case d.investigationId:u.isLabs=!0,u.redirectTo="app.labs",u.placeholderText="Search Lab Tests, Health Check Up Package";break;case d.medicineId:u.isMedicine=!0,u.redirectTo=u.isSeo?"app.aboutmedicine":"app.medicine",u.placeholderText="Search Medicines";break;case d.healthCheckId:u.isAhc=!0,u.redirectTo="app.ahc",u.placeholderText="Search Health Checks"}else u.isCorpLabs?(u.pincode=i.getPincode(),u.redirectTo="app.consumerLabs",u.placeholderText="Search Lab Tests, Health Check Up Package"):(u.categoryType=d.medicineId,u.isMedicine=!0);u.errorMessage="",u.pipeline||(u.pipeline={}),u.details={inputPincode:u.pincode&&u.city?u.pincode:"",showcity:u.pincode&&u.city?u.city:"",pincodeSelectionToogle:!(!u.pincode||!u.city),inputPincodeData:!u.pincode||!u.city},u.onFocus=function(){var e=document.querySelector("#product-search.search-background");e&&(!u.isCorpLabs&&t.scrollTo(0,0),e.classList.add("activate-search"),u.isCorpLabs&&(g.sendEvents("Search Page"),l(function(){a.hideFooter(!0)})),u.pipeline.focus=!0,u.isLabs&&(0==u.pipeline.proceedToCart&&window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",name:"Booking Flow Search Bar Clicked",payload:window._Site_Props.__getEventParameters({service:!0,custom:{srcPage:"Labs Landing Page"}})}),window._MB_Analytics.__push({isCleverTap:!0,name:"Search Page",dbLog:"labs",payload:window._Site_Props.__getEventParameters({service:!0,custom:{srcPage:"Labs Landing Page"}})})))},u.clearText=function(e){u.pipeline.searchText="",u.searchResult=[],u.$emit("productSearchResult",[]),e&&e.stopPropagation()},u.placeholderText||(u.placeholderText="Filter Lab Tests");var w="",S=!1;u.pipeline.preferredCity&&y(),u.getCityByPincode=function(e,a){u.isMedibuddyLoading=!0;var t=o.apiUrl+"/Labs/FetchCityByPincode/"+e;m.autoCartId&&(t+="/true"),i.makeAjaxCalls(t,"","GET",C.token,u.city).then(function(t){t.data.isServicable?(t.data.city&&(u.details={},u.details.inputPincode=e,u.details.showcity=t.data.city,u.details.pincodeSelectionToogle=!0,u.setCityPincode&&(i.setPincode(e),i.setCity(t.data.city),u.city=t.data.city,u.pincode=e,u.$emit("selectedCity",{city:u.city,pincode:u.pincode}),u.$emit("pincodeChange",e))),u.errorMessage="",u.isMedibuddyLoading=!1,u.isAvailable=!0,u.setCityPincode=!1):a?(u.isMedibuddyLoading=!1,u.isAvailable=!1,u.details.pincodeSelectionToogle=!1,u.pincode=i.getPincode(),u.pincode?u.validatePinCode(u.pincode):u.selectLocation()):(u.errorMessage="Sorry! We are not serviceable in "+e+" location. Please try another pincode",u.isMedibuddyLoading=!1,u.isAvailable=!1,u.details.pincodeSelectionToogle=!1)})["catch"](function(e){u.errorMessage="There is an error fetching the details. Please try again or after sometime.",u.isMedibuddyLoading=!1,u.isAvailable=!1,u.details.pincodeSelectionToogle=!1})},u.mergeFlowPincode=function(e,a){u.isMedibuddyLoading=!0;var t=o.apiUrl+"/Labs/v1/FetchCityByPincode/"+e;m.autoCartId&&(t+="/true"),i.makeAjaxCalls(t,"","GET",C.token,u.city).then(function(t){P&&t.data.isRetailPackagesAvailable||!P&&t.data.isSuccess?(t.data.city&&(u.details={},u.details.inputPincode=e,u.details.showcity=t.data.city,u.details.pincodeSelectionToogle=!0,u.setCityPincode&&(i.setPincode(e),i.setCity(t.data.city),u.city=t.data.city,u.pincode=e,u.$emit("pincodeChange",e)),g.sendEvents("Pincode Verification")),u.errorMessage="",u.isMedibuddyLoading=!1,u.isAvailable=!0,u.setCityPincode=!1):a?(u.isMedibuddyLoading=!1,u.isAvailable=!1,u.details.pincodeSelectionToogle=!1,u.pincode=i.getPincode(),u.pincode?u.validatePinCode(u.pincode):u.selectLocation()):(g.sendEvents("Pincode Not Servicable"),u.errorMessage="Sorry! We are not serviceable in "+e+" location. Please try another pincode",u.isMedibuddyLoading=!1,u.isAvailable=!1,u.details.pincodeSelectionToogle=!1)})["catch"](function(a){503==a.status?(g.sendEvents("Pincode Not Servicable"),u.errorMessage="Sorry! We are not serviceable in "+e+" location. Please try another pincode"):u.errorMessage="There is an error fetching the details. Please try again or after sometime.",u.isMedibuddyLoading=!1,u.isAvailable=!1,u.details.pincodeSelectionToogle=!1})},u.assignCityByPincode=function(e){u.ahcAvailablePackages={},u.errorMessage="true",u.details.pincodeSelectionToogle=!1,i.makeAjaxCalls(o.apiUrl+"/AHC/FetchCityByPincode",{PMEntityId:C.userDetails?C.userDetails.pmEntityID:"",Pincode:e},"POST").then(function(a){a.data.isSuccess&&a.data.city?(u.details={},u.details.inputPincode=e,u.details.showcity=a.data.city,u.details.pincodeSelectionToogle=!0,u.errorMessage="",u.isMedibuddyLoading=!1,u.isAvailable=!0,u.ahcAvailablePackages=a.data,u.setCityPincode&&(i.setPincode(e),i.setCity(a.data.city),u.city=a.data.city,u.pincode=e,u.$emit("ahcAvailablePackages",a.data),window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"ahc",name:"AHC Pincode Selected",payload:window._Site_Props.__getEventParameters({custom:{City:u.city,Success:!0,pincode:e,PMEntityId:C.userDetails?C.userDetails.pmEntityID:"",companyName:C.corpDetails&&C.corpDetails.employeeDetail?C.corpDetails.employeeDetail.companyName||"":""}})}))):a.data.isSuccess?(u.errorMessage="Sorry! We are not serviceable in "+e+" location. Please try another pincode",u.isMedibuddyLoading=!1,u.isAvailable=!1,u.details.pincodeSelectionToogle=!1,window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"ahc",name:"AHC Pincode Error",payload:window._Site_Props.__getEventParameters({custom:{City:u.city,Success:!1,pincode:e,PMEntityId:C.userDetails?C.userDetails.pmEntityID:"",companyName:C.corpDetails&&C.corpDetails.employeeDetail?C.corpDetails.employeeDetail.companyName||"":""}})})):(u.errorMessage="Please enter correct pincode",u.details.pincodeSelectionToogle=!1,u.isMedibuddyLoading=!1,u.isAvailable=!1,window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"ahc",name:"AHC Pincode Error",payload:window._Site_Props.__getEventParameters({custom:{City:"Non servicable city",Success:!1,pincode:e,PMEntityId:C.userDetails?C.userDetails.pmEntityID:"",companyName:C.corpDetails&&C.corpDetails.employeeDetail?C.corpDetails.employeeDetail.companyName||"":""}})}))})["catch"](function(a){u.errorMessage="Please enter correct pincode",u.details.pincodeSelectionToogle=!1,u.isMedibuddyLoading=!1,u.isAvailable=!1,window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"ahc",name:"AHC Pincode Error",payload:window._Site_Props.__getEventParameters({custom:{City:"Non servicable city",Success:!1,pincode:e,PMEntityId:C.userDetails?C.userDetails.pmEntityID:"",companyName:C.corpDetails&&C.corpDetails.employeeDetail?C.corpDetails.employeeDetail.companyName||"":""}})})})},u.fetchInfoForpincode=function(e){var a={categoryItemTypeId:u.categoryType,pincode:e,getPackageDetails:!0};u.pincodeKeyword=e,u.isMedibuddyLoading=!0,D=o.apiUrl+"pincodeAvailabilityCheck.json",i.makeAjaxCalls(D,a,"POST",C.token).then(function(a){if(a.data.isAvailable&&_.contains(i.allCities,a.data.pincodeCity)){a.data.pincodeCity&&(u.city=a.data.pincodeCity,i.setPincode(e),i.setCity(a.data.pincodeCity),u.city=a.data.pincodeCity,u.pincode=e,i.medicineCityParams=u.city.toLowerCase(),u.details={},u.details.inputPincode=e,u.details.showcity=a.data.pincodeCity,u.details.pincodeSelectionToogle=!0,u.$emit("selectedCity",{city:u.city,pincode:u.pincode}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsPINSubmitWeb",payload:window._Site_Props.__getEventParameters({custom:{pincode:u.pincode}})})),u.errorMessage="",u.isMedibuddyLoading=!1,u.isAvailable=!0;var t=p.path(),o=t.split("/");u.showSuggestion?"Medicine"==o[1]?s.go(u.redirectTo,{pincode:u.pincode},{reload:u.redirectTo}):"pharmacy"==o[1]&&s.go("app.pharmacy",{pincode:u.pincode},{reload:"app.pharmacy"}):"Medicine"==o[1]?s.go(u.redirectTo,{pincode:u.pincode},{reload:u.redirectTo}):"pharmacy"==o[1]&&s.go("app.pharmacy",{pincode:u.pincode},{reload:"app.pharmacy"})}else u.errorMessage=a.data.errorMessage,u.isMedibuddyLoading=!1,u.isAvailable=!1,u.details.pincodeSelectionToogle=!1})},u.validate=function(e,a){var t=new RegExp(c.getRegexExpression(a)),i=String.fromCharCode(e.charCode?e.charCode:e.which);if(!t.test(i)&&13!==e.charCode)return e.preventDefault(),!1},u.validatePinCode=function(e,a){e&&!u.disabled&&(u.isCorpLabs?u.mergeFlowPincode(e,a):u.isLabs?u.getCityByPincode(e,a):u.isAhc?u.assignCityByPincode(e):u.fetchInfoForpincode(e))},u.closeForm=function(){var e=u.details.inputPincode,a=u.details.showcity;u.isLabs||u.isCorpLabs?(i.setPincode(e),i.setCity(a),u.city=a,u.pincode=e,u.isCorpLabs?g.sendEvents("Pincode Success"):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",name:"Pincode Success"}),u.$emit("selectedCity",{city:u.city,pincode:u.pincode}),u.$emit("pincodeChange",e)):u.isAhc&&(i.setPincode(e),i.setCity(a),u.city=a,u.pincode=e,u.$emit("ahcAvailablePackages",u.ahcAvailablePackages)),T.close(),T=null};var T=null;u.selectLocation=function(a){if(u.isMedicine||u.isLabs||u.isAhc||u.isCorpLabs){if(u.isMedicine?window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsChangePINWeb"}):u.isLabs?window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",name:"Booking Flow Pincode Popup"}):u.isCorpLabs&&(a?g.sendEvents("Pincode Popup"):g.sendEvents("Change Location")),u.userProfile=i.profileInfo,u.userProfile&&!_.isEmpty(u.userProfile.userAddresses)&&!i.getPincode()){u.userAddresses=u.userProfile.userAddresses;var t=u.userAddresses.find(function(e){return e.isPrimary});t&&t.pincode&&u.validatePinCode(t.pincode)}T=r.open({animation:!0,scope:u,backdrop:"none",template:'<div ng-class="{\'modal-bottom-header modal-header\':isMobileView,\'modal-body\':!isMobileView}"><div class="clearfix text-right"><span class="cursor-pointer" ng-style="{\'color\':isHover ? \'#000\' : \'#aaa\'}" ng-class="{\'md-dark-color\':isMobileView}"ng-init="isHover=false;" ng-mouseover="isHover=true;" ng-mouseout="isHover=false;" ng-click="cancelDialog()">close</span></div><ng-include src="\'pincode_popup.html\'"></ng-include></div></div>',controller:["$scope","$uibModalInstance",function(e,a){var t=u.pincode&&u.city&&!u.errorMessage;u.details={inputPincode:t?u.pincode:"",showcity:t?u.city:"",pincodeSelectionToogle:!!t,inputPincodeData:!t},u.setCityPincode=!1,e.cancelDialog=function(){a.dismiss("cancel")},e.pincodeCheck=function(e){6!=e.target.value.length&&(u.errorMessage=""),e.target.value.length>0?(u.details.inputPincodeData=!1,u.details.pincodeSelectionToogle=!1):(u.details.inputPincodeData=!0,u.details.pincodeSelectionToogle=!1)}}],size:e.isMobileView?"bottom":"sm modal-border",windowClass:e.isMobileView&&"bottom-sheet"}),T.opened.then(function(){l(function(){var e=angular.element(document.querySelector('input[name="pincode"]'))[0];e&&e.focus()})}),T.result["catch"](function(){u.isCorpLabs?g.sendEvents("Pincode Cancel"):window._MB_Analytics.__push({isCleverTap:!0,dbLog:"labs",name:"Pincode Cancel"}),u.errorMessage="",i.getPincode()&&u.isAvailable||(u.setCityPincode=!0,i.getPincode()&&"app.medicine"===s.current.name?u.validatePinCode(i.getPincode().toString()):u.isAhc?u.assignCityByPincode(560029):u.validatePinCode("560029"))})}else i.cityPopup("lg")},u.pincode&&u.city||m.city&&m.city==u.city&&/^[a-z]+$/.test(m.city)?(u.isLabs||u.isAhc||u.isCorpLabs)&&u.pincode&&!m.city&&(u.setCityPincode=!0,u.validatePinCode(u.pincode)):u.selectLocation(!0),u.searchBarClick=function(){u.isLabs||u.isCorpLabs||(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",hj:!0,name:"MedsSearchField"}),u.isSeo&&(u.pincode?s.go("app.pharmacy",{pincode:u.pincode},{reload:"app.pharmacy"}):u.selectLocation()))},u.debounceSearch=_.debounce(function(e){u.isMedicine?k(e):b(e)},800,!1),u.searchItems=function(e){u.pipeline.searchText=e,e&&e.length>1?u.debounceSearch(e):(u.searchResult=[],u.$emit("productSearchResult",[]))},u.redirectToSearch=function(e,a){if(e&&e.length>2||a){var t;a&&(a.count=1,i.medsCartInfo.cartItems=[a],t=a.name,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsSearchItemSelected",payload:window._Site_Props.__getEventParameters({custom:{medicineName:a.name}})})),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Medicine Search",payload:window._Site_Props.__getEventParameters({custom:{searchText:e,selected:t}})}),u.showSuggestion||u.$emit("checkmedicines",e),u.showSuggestion&&s.go("app.pharmacy",{pincode:u.pincode,medicine:e},{reload:"app.pharmacy"})}},u.onKeyup=function(e,a){switch(e.keyCode){case 13:u.redirectToSearch(a,u.searchResult[u.counter]);break;case 27:u.showDropdown=!1;break;case 38:u.counter>0&&u.counter--;break;case 40:u.searchResult.length-1>u.counter&&u.counter++;break;default:u.$emit("checkmedicines",a)}},u.$on("allCities",function(e,a){u.city=a}),u.$on("clearProductSearchText",function(){u.clearText()}),u.$on("setSuggestedKey",function(e,a){u.clearText(),u.pipeline.suggestedKeyword="",b(a,!0)})}}}]),e.register.directive("providerSelection",["$rootScope","corpWellnessService","authService","$anchorScroll","navConstantsSvc","$filter","apiProvider","$timeout","$window","$uibModal",function(e,t,i,o,n,s,r,l,c,d){return{restrict:"AE",scope:{selectedPackage:"=?",pipeline:"=?",sponsored:"=?",checkout:"=?",dcList:"=?",providerSlots:"=?",allAhcPackageList:"=?",emitHandler:"=?",oldCorporateFlow:"=?"},templateUrl:"templates/providerTemplate.html?"+timeStamp,link:function(p,m,g,u){function h(e){y=l(function(){p.driver.highlight({element:"#"+e})},200)}function f(e){if(!p.isMobileView&&c.innerHeight&&e&&e.pageY){var a;a=void 0!==window.pageYOffset?window.pageYOffset:"CSS1Compat"===(document.compatMode||"")?document.documentElement.scrollTop:document.body.scrollTop;var t=c.innerHeight-e.clientY;if(t<200){var i=a+250-t;c.scrollTo(0,i)}}else l(function(){o.yOffset=150,o("selectedSlot")})}p.isMobileView=e.isMobileView,p.searchProvider={},p.recommendation={},p.homeSampleOption=1,p.totalPrice=p.selectedPackage.price,p.nextDay=new Date(i.serverDate).addDays(1).toDateString();var y;requirejs(["tour"],function(a){p.driver=new a({opacity:.5,allowClose:!1,padding:0,keyboardControl:!1,scrollIntoViewOptions:{}});e.$on("$stateChangeStart",function(){_.isEmpty(p.recommendation)||p.closeRecommendation(),p.driver.reset()})}),p.pipeline.highlightDateFilter=function(e){h(e),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"UCP Request Home Sample Slot Edit",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0})})},p.user=i.isUserSignedin(),p.user&&p.user.corpConfig&&p.user.corpConfig.bookTillDate&&(p.bookTillDate=new Date(p.user.corpConfig.bookTillDate)),p.showHideSponserPackageList=p.dcList,_.forEach(p.showHideSponserPackageList,function(e,a){e.parsedDcId=parseInt(e.dcId),e.providerRelativeUrl&&(e=t.filterProviderWithProfile(e))}),p.formatTime=function(e){return i.getTimeFormate(e)},p.showMessage=n.hpEntityIds.indexOf(a.getFlatProperty(p,"user.userDetails.pmEntityID"))>-1&&!1,p.notifyMessage="Please note that some of the key Hospitals may be available for appointment bookings after 8th Nov 2021. However, you can still choose from other available medical centres or opt for home sample pick up anytime.",p.closeRecommendation=function(){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"AHC Hide Recommendation",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{recommendedDate:s("date")(p.sponsored.prefDate.date,"yyyy-MM-dd"),companyName:p.user.corpDetails.employeeDetail.companyName}})}),p.showHideSponserPackageList=p.recommendation.prevProviders,_.isEmpty(p.allAhcPackageList)||(p.allAhcPackageList[p.recommendation.curIndex].sponserTempPackageDetails=p.showHideSponserPackageList),p.recommendation={},p.isMobileView||(p.driver.reset(),l.cancel(y))},p.viewRecommendation=function(e){var a=r.apiUrl+"ProviderRecommendation",t={ProviderId:e.dcId,SlotDateTime:s("date")(p.sponsored.prefDate.date,"yyyy-MM-dd"),PackageId:e.packageId,contractId:e.contractId};p.checkout&&(t.MPPackageId=p.selectedPackage.packageId),i.makeAjaxCalls(a,t,"POST",p.user.token,p.cityName).then(function(a){if(!_.isEmpty(a.data.recommendedProviders)){if(p.recommendation.prevProviders=angular.copy(p.showHideSponserPackageList),_.isEmpty(p.allAhcPackageList)){var t=_.pluck(a.data.recommendedProviders,"providerId");p.showHideSponserPackageList=_.filter(p.showHideSponserPackageList,function(e){return _.contains(t,e.dcId)})}else _.each(p.allAhcPackageList,function(t,i){t.provider.packageId==e.packageId&&(p.recommendation.curIndex=i,t.sponserTempPackageDetails=_.map(a.data.recommendedProviders,function(e){return t.sponserPackageDetails.find(function(a){return e.providerId==a.dcId})}),t.sponserTempPackageDetails=_.filter(t.sponserTempPackageDetails,function(e){return!!e}),p.showHideSponserPackageList=t.sponserTempPackageDetails)});if(_.isEmpty(p.showHideSponserPackageList))return void(p.showHideSponserPackageList=p.recommendation.prevProviders);if(p.recommendation.packageName=e.packageName,p.recommendation.date=p.sponsored.prefDate.date.toDateString(),window._Site_Props.__setPackageDetails({packageName:e.packageName,providerName:e.dcName,providerLocation:e.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"AHC Show Recommendations",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{recommendedDate:s("date")(p.sponsored.prefDate.date,"yyyy-MM-dd"),companyName:p.user.corpDetails.employeeDetail.companyName}})}),p.isMobileView){d.open({animation:!0,template:'<div class="modal-body result sponsored"><h3 style="margin-top:0px">'+e.packageName+"</h3><b>"+p.recommendation.date+'</b><button class="btn btn-default btn-close pull-left" type="button" ng-click="ok(false)"><i class="mm mm-close"></i></button><ng-include src="\'providerTempalte.html\'"></ng-include></div>',scope:p,size:"full-height-mobile",controller:["$scope","$uibModalInstance",function(e,a){e.ok=function(){p.closeRecommendation(!0),a.dismiss("cancel")}}]})}else h("highlight")}})};var v=_.debounce(function(){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"UCP Filter Provider",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{providerName:p.searchProvider.dcName,providerLocation:p.searchProvider.dcLocation,providerCount:p.showHideSponserPackageList.length,packageName:a.getFlatProperty(p,"selectedPackage.packageName"),showOnlyHomeSample:p.isRecommended}})})},1e3);p.isRecommended=!1,p.handleFilterChange=function(){if(p.showHideSponserPackageList=p.dcList,p.searchProvider.dcLocation){var e=p.searchProvider.dcLocation.toLowerCase();p.showHideSponserPackageList=_.filter(p.dcList,function(a){return a.dcLocation.toLowerCase().includes(e)})}if(p.searchProvider.dcName){var a=p.searchProvider.dcName.toLowerCase();p.showHideSponserPackageList=_.filter(p.showHideSponserPackageList,function(e){return e.dcName.toLowerCase().includes(a)})}p.isRecommended&&(p.showHideSponserPackageList=_.filter(p.showHideSponserPackageList,function(e){return e.isHomeSampleAvailable})),v()},p.toggleFilter=function(){p.isRecommended=!p.isRecommended,p.handleFilterChange()},p.nextDayFilter="",p.sponsored={prefDate:{date:null,position:0},isAutoSlotProviderAvailable:!_.isEmpty(p.providerSlots),fetchSlotInfo:function(e){p.autoBookSlots=[],p.$broadcast("closeSlot"),p.checkout&&!_.isEmpty(p.showHideSponserPackageList)&&_.each(p.showHideSponserPackageList,function(e){var a=p.selectedPackage.providerSlots.find(function(a){return a.providerId==parseInt(e.dcId)});if(a){var t=a.daySlots.find(function(e){return parseInt(e.date.replace("/Date(","").replace(")/",""))==p.sponsored.prefDate.date.getTime()});t&&t.workingDaySlots&&!_.isEmpty(t.workingDaySlots.slots)?(e.slotStartTime=i.getTimeFormate(_.first(t.workingDaySlots.slots).slotStartTime),e.slotEndTime=i.getTimeFormate(_.last(t.workingDaySlots.slots).slotEndTime)):(e.slotStartTime="",e.slotEndTime="")}}),p.driver&&p.driver.hasHighlightedElement()&&(p.driver.reset(),p.$broadcast("onEditSlot",p.sponsored.prefDate.date),p.bookSlotAfterValidation(p.pipeline.selectedProvider)),p.sponsored.prefDate.date.toDateString()==(new Date).addDays(1).toDateString()||6==p.sponsored.prefDate.date.getDay()||0==p.sponsored.prefDate.date.getDay()?p.nextDayFilter=function(e){return e&&e.isAutoSlotAvailable?e:null}:p.nextDayFilter="",_.each(p.dcList,function(e,a){p.checkout&&(e.availableSlots=p.selectedPackage.availableSlots,e.contractId=p.selectedPackage.contractId);var t=p.providerSlots.find(function(a){return a.providerId==parseInt(e.dcId)});if(t&&p.sponsored.prefDate){e.isHomeSampleAvailable=e.isHomeSampleAvailable&&_.has(t,"homeVisitAvailableSlots"),e.isHomeSampleAvailable&&(e.availableSlots=p.selectedPackage.availableSlots,e.homeVisitAvailableSlots=t.homeVisitAvailableSlots,e.radiologyAvailableSlots=t.radiologyAvailableSlots);var i=(t.daySlots||t.slots).find(function(e){return e.date.indexOf(Math.floor(p.sponsored.prefDate.date.setHours(0,0,0,0)))>-1});if(i){if(e.isAutoSlotAvailable=!0,!_.isEmpty(i.workingDaySlots)&&!_.isEmpty(e.availableSlots)){var o=e.availableSlots.findIndex(function(e){return e.day===i.workingDaySlots.day});o>-1&&!_.isEmpty(i.workingDaySlots.slots)&&(e.availableSlots[o]=i.workingDaySlots)}i.availableSlots<0&&(i.availableSlots=0),i.availableSlots<=i.totalSlots*(n.minSlotThreshold/100)?(e.slotStatus=!i.availableSlots&&i.totalSlots?"Not Available":"Filling Fast",e.slotStatusColor=!i.availableSlots&&i.totalSlots?"#f60":"#da7e19"):e.slotStatus=""}else e.isAutoSlotAvailable=!1;p.autoBookSlots.push(t)}}),p.isHomeSampleProviderAvailable=_.find(p.dcList,function(e){return e.isHomeSampleAvailable}),a.getFlatProperty(p,"sponsored.prefDate.date")&&window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"ucp",hj:!0,name:"AHC Appointment Date",googleSheet:n.ahcFilterName,payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{recommendedDate:s("date")(p.sponsored.prefDate.date,"yyyy-MM-dd"),companyName:p.user.corpDetails&&p.user.corpDetails.employeeDetail?p.user.corpDetails.employeeDetail.companyName||"":""}})}),e&&p.pipeline&&(p.pipeline.groupedSlots=_.groupBy(_.flatten(_.pluck(p.autoBookSlots,"daySlots")),function(e){return new Date(parseInt(e.date.replace("/Date(","").replace(")/",""))).setHours(0,0,0,0)}),p.pipeline.updateDateSlots()),p.inCardSlots={currentTimeStamp:Date.parse(p.sponsored.prefDate.date),providerGroupSlots:{}},_.forEach(p.pipeline.groupedSlots[p.inCardSlots.currentTimeStamp],function(e,a){p.inCardSlots.providerGroupSlots[e.providerId]=e.workingDaySlots.slots}),l(function(){1==p.showHideSponserPackageList.length&&"MediBuddyProvider"==p.showHideSponserPackageList[0].dcName&&p.bookSlotAfterValidation(p.showHideSponserPackageList[0])})}},p.valueChanged=function(e){p.homeSampleOption=parseInt(e),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"UCP Home Sample Toggle",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{"homeSample+centerVisit":1==p.homeSampleOption,onlyCenterVisit:2==p.homeSampleOption}})})};var k="";p.providerSelected=!1,p.selectProviderWithTimeSlot=function(e,t){var i,o;o=e.slotStartTime%60,
p.selectedSlotStartTiming=e.slotStartTime,i=Math.floor(e.slotStartTime/60),p.prefDateTime=new Date(p.sponsored.prefDate.date.getFullYear(),p.sponsored.prefDate.date.getMonth(),p.sponsored.prefDate.date.getDate(),i,o,0,0),p.$emit("selectedSlot",{date:p.sponsored.prefDate.date,time:p.formatTime(e.slotStartTime),provider:t,prefDateTime:p.prefDateTime}),window._Site_Props.__setPackageDetails({packageName:t.packageName||a.getFlatProperty(p,"selectedPackage.packageName"),providerName:t.dcName,providerLocation:t.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:"ucp",hj:!0,name:"Request Slot",googleSheet:n.ahcFilterName,payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{isRecommendation:!!p.recommendation.date,isHomeSampleAvailable:!!t.isHomeSampleAvailable,"homeSample+centerVisit":!!t.isHomeSampleAvailable&&1==p.homeSampleOption,onlyCenterVisit:!t.isHomeSampleAvailable||2==p.homeSampleOption},google:window._Site_Props.__googleTransform("AHC","RequestSlot",t.packageName+" by "+t.dcName)})})},p.pipeline.checkIfHomeSampleReq=function(e,t){p.pipeline.homeVisitDate="",p.providerSelected=!0,p.selectedDC=e,p.pipeline.homeSampleSelection=t||p.pipeline.homeSampleSelection,p.isMobileView?k=d.open({animation:!0,templateUrl:"home_sample_check.html",scope:p,size:"full-height-mobile",controller:["$scope","$uibModalInstance",function(e,a){e.close=function(){p.closehomeSampleOption(!0)}}]}):(c.scrollTo(0,100),l(function(){p.driver.highlight({element:"#homeSampleSlots"})},100)),window._Site_Props.__setPackageDetails({packageName:a.getFlatProperty(p,"selectedPackage.packageName"),providerName:e.dcName,providerLocation:e.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"UCP Home Sample Popup",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{"homeSample+centerVisit":1==p.homeSampleOption,onlyCenterVisit:2==p.homeSampleOption}})})},p.bookSlotAfterValidation=function(e,t){return p.emitHandler?void p.$emit(p.emitHandler,{packageDetailLocation:e,sponsored:p.sponsored}):void(!p.sponsored.prefDate.date||p.nextDay==p.sponsored.prefDate.date.toDateString()&&e.noAutoSlotAvailable||(e.packageId=e.packageId||p.selectedPackage.packageId,p.bookClicked=!0,p.clickDCId=e.dcId,p.clickPackageId=e.packageId,p.pipeline.blockProviderTimeSlots=[],i.makeAjaxCalls(r.apiUrl+"/ProviderTimeSlotForAHC",{providerid:p.clickDCId,BookingDate:p.sponsored.prefDate.date,PMEntityId:p.user.userDetails?p.user.userDetails.pmEntityID:""},"POST").then(function(e){e.data.isSuccess&&e.data.providerTimeSlots&&_.each(e.data.providerTimeSlots,function(e){e.isAvailable||p.pipeline.blockProviderTimeSlots.push(e.slotTime)})}),p.bookClicked?(window._Site_Props.__setPackageDetails({packageName:e.packageName||a.getFlatProperty(p,"selectedPackage.packageName"),providerName:e.dcName,providerLocation:e.dcLocation}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,dbLog:"ucp",hj:!0,name:"Request Slot",googleSheet:n.ahcFilterName,payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{isRecommendation:!!p.recommendation.date,isHomeSampleAvailable:!!e.isHomeSampleAvailable,"homeSample+centerVisit":!!e.isHomeSampleAvailable&&1==p.homeSampleOption,onlyCenterVisit:!e.isHomeSampleAvailable||2==p.homeSampleOption},google:window._Site_Props.__googleTransform("AHC","RequestSlot",e.packageName+" by "+e.dcName)})})):window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Slot Selection Cancelled",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:p.recommendation.date?{isRecommendation:!0}:null,google:window._Site_Props.__googleTransform("AHC","SlotSelectionCancelled",e.packageName+" by "+e.dcName)})}),f(t)))},p.getAmenities=function(){var e={ProviderIds:_.map(p.showHideSponserPackageList,function(e){return e.dcId})};"string"==typeof p.selectedPackage.packageId?e.mpPackageId=p.selectedPackage.packageId:e.PackageId=p.selectedPackage.packageId;var a=r.apiUrl+"GetHospitalAmeneties.json";i.makeAjaxCalls(a,e,"POST","","",!0).then(function(e){e.data.isSuccess&&(p.ameneties=e.data.ameneties)})},p.getAmenities(),p.closeDetails=function(e){p.clickPackageId="",e&&(p.pipeline.homeVisitDate="")},e.$on("mbProvider",function(){l(function(){1==p.showHideSponserPackageList.length&&"MediBuddyProvider"==p.showHideSponserPackageList[0].dcName&&p.bookSlotAfterValidation(p.showHideSponserPackageList[0])})}),p.$on("closeSlot",function(e,a){p.closeDetails()}),p.$on("clearAhcSearch",function(){p.searchProvider.dcName="",p.searchProvider.dcLocation="",p.handleFilterChange(),p.closeDetails()}),p.$on("selectedSlot",function(e,a){_.isEmpty(p.recommendation)||p.closeRecommendation(),p.homeVisitDate=p.pipeline.homeVisitDate}),p.$on("homeVisitDate",function(e,t){p.pipeline.homeVisitDate=t,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"UCP Home Sample Slot Selected",payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{homeSampleDate:a.getFlatProperty(t,"prefDateTime")&&t.prefDateTime instanceof Date&&t.prefDateTime.toLocaleString()}})})}),p.closehomeSampleOption=function(e){e||p.selectedPackage.isHomeSampleOnlyPackage||(p.pipeline.homeSampleSelection=p.homeSampleOption),p.providerSelected=!1,p.isMobileView?k.close():(p.driver.reset(),l.cancel(y))},p.$on("bookSlotForProvider",function(e,a){p.$broadcast("onEditSlot",p.pipeline.homeVisitDate?p.pipeline.homeVisitDate.date:p.pipeline.selectedSlot.date),p.bookSlotAfterValidation(a)})}}}]),e.register.directive("rcSubmit",["$parse",function(e){return{restrict:"A",require:["rcSubmit","?form"],controller:["$scope",function(e){this.attempted=!1;var a=null;this.setAttempted=function(){this.attempted=!0},this.setFormController=function(e){a=e},this.needsAttention=function(e){return!!a&&(e?e.$invalid&&(e.$dirty||this.attempted):a&&a.$invalid&&(a.$dirty||this.attempted))}}],compile:function(a,t,i){return{pre:function(e,a,t,i){var o=i[0],n=i.length>1?i[1]:null;o.setFormController(n),e.rc=e.rc||{},e.rc[t.name]=o},post:function(a,t,i,o){var n=o[0],s=o.length>1?o[1]:null,r=e(i.rcSubmit);t.bind("submit",function(e){return n.setAttempted(),a.$$phase||a.$apply(),!!s.$valid&&(a.$apply(function(){r(a,{$event:e})}),void e.preventDefault())})}}}}}]),e.register.directive("statusTimeline",["$timeout",function(e){return{restrict:"EA",scope:{orderStatus:"=timelineStatus",status:"=status"},templateUrl:"templates/status-timeline.html?"+timeStamp,link:function(a){e(function(){a.active=!0},1),a.getWidth=function(){return a.active&&a.orderStatus&&a.orderStatus.length>0&&a.status.state>=0?a.status.state>=a.orderStatus.length-1?"100%":100*a.status.state/(a.orderStatus.length-1)+"%":"0%"}}}}]),e.register.directive("userAddress",["$uibModal","authService","navConstantsSvc",function(e,t,i){return{restrict:"E",scope:{medicine:"=?",homeVisit:"=?",form:"=?",appointmentData:"=orderInfo",userAddresses:"=addressList",appointmentPackageData:"=packageData"},templateUrl:"/templates/user-address.html?"+timeStamp,link:function(o,n,s){var r=i.cityTags;if(o.setAddress=function(e){e&&(o.appointmentData.patientHouseNo=e.addressLine1,o.appointmentData.patientLocation=e.addressLine2,o.appointmentPackageData.dcCity=e.city,o.medicine||(o.appointmentData.patientPincode=e.pincode),o.selectedAddressTag=e.addressTag,o.orderInfo=o.appointmentData,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:o.medicine?"MedsAddressSelect":"SelectAddress",dbLog:!o.medicine||"meds",hj:!0,payload:window._Site_Props.__getEventParameters({service:!0,"package":!0,custom:{address:e.addressLine1+", "+e.addressLine2,city:e.city,pincode:e.pincode,itemSource:o.appointmentData?"EnterPatientsInfoPage":"BookingPage",visitType:"HomeVisit"}})}))},o.isAddressSelected=function(e){return o.selectedAddressTag===e.addressTag},o.manageAddressClose=function(e){if((o.medicine||o.homeVisit)&&a.validatePIN(o.appointmentData.patientPincode)?o.userAddresses=_.filter(t.profileInfo.userAddresses,function(e){return e.pincode==o.appointmentData.patientPincode&&e.isActive}):o.homeVisit&&o.appointmentPackageData.dcCity?o.userAddresses=_.filter(t.profileInfo.userAddresses,function(e){var a=e.city?r[e.city.toLowerCase()]||e.city.toLowerCase():"";return a==t.getCity().toLowerCase()}):o.userAddresses=_.filter(t.profileInfo.userAddresses,function(e){return e.isActive}),e){var i=o.userAddresses.find(function(a){return a.addressTag===e.addressTag});i&&o.setAddress(i)}else if(o.selectedAddressTag){var i=o.userAddresses.find(function(e){return e.addressTag===o.selectedAddressTag});i&&o.setAddress(i)}else o.selectedAddressTag=null;o.addressList=o.userAddresses,o.manageAddressPopup=null},o.manageAddressOpen=function(t){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsManageAddr"}),o.manageAddressPopup=e.open({templateUrl:"templates/manageAddressPopup.html?"+timeStamp,size:"full-height-mobile",controller:["$scope","$http","notify","$uibModalInstance","authService",function(e,i,n,s,r){e.subject="User idle in payment page_"+o.eventCategory,e.userData={userProfile:r.profileInfo},e.openAddAddress=t,e.closeModal=function(){s.dismiss("cancel"),o.manageAddressClose()},e.$on("selectAddress",function(e,a){s.dismiss("cancel"),o.manageAddressClose(a)}),(o.medicine||o.homeVisit)&&a.validatePIN(o.appointmentData.patientPincode)&&(e.filterAddress={pincode:o.appointmentData.patientPincode})}]})},!_.isEmpty(o.userAddresses))for(var l=0;l<o.userAddresses.length;l++)if(o.userAddresses[l]&&o.userAddresses[l].isPrimary){o.setAddress(o.userAddresses[l]);break}}}}]),e.register.directive("userFeedback",["$window","authService","apiProvider","$http","$rootScope","navConstantsSvc",function(e,a,t,i,o,n){return{restrict:"E",scope:{isPopup:"=?",orderId:"=?",requestData:"=?",feedbackRating:"=?"},templateUrl:"/templates/user-feedback.html?"+timeStamp,link:function(s,r,l){function c(e){switch(e){case n.medsContract:return s.iconLink="/assets/services/medicine.svg",s.serviceType=n.medicineFilterName,n.medicineFilterName;case n.ahcContract:return s.iconLink="/assets/services/health-check.svg",s.serviceType=n.ahcFilterName,n.ahcFilterName;case n.healthCheckContract:return s.iconLink="/assets/services/health-check.svg",s.serviceType=n.healthCheckFilterName,n.healthCheckFilterName;case n.labtestContract:return s.iconLink="/assets/services/labtest.svg",s.serviceType=n.investigationFilterName,n.investigationFilterName;default:return s.iconLink="",s.serviceType="",""}}function d(e){if(s.requestData&&!s.requestData.userFeedbackReceived){if(s.feedbackRating=e,s.isMedicine=n.medsContract==s.requestData.contractType,s.requestData.orderStatusDate=new Date(s.requestData.orderStatusDate),s.requestData.orderFulFillmentDate=new Date(s.requestData.orderFulFillmentDate),window._Site_Props.__setServiceDetails({serviceType:c(s.requestData.contractType)}),!_.isEmpty(s.feedbackRating.questions)){var a=_.filter(s.feedbackRating.questions,function(e){return e.categoryType==s.requestData.fulFillmentType});_.isEmpty(a)||(s.feedbackRating.questions=a),_.each(s.feedbackRating.questions,function(e){s.feedback.answers[e.questionId]={}})}s.showLoader=!1,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsFeedbackCard",payload:window._Site_Props.__getEventParameters({service:!0,custom:p})})}else s.feedback.isfeedbackGiven=!0,s.feedbackSubmitted=!0}var p={};s.isMobileView=o.isMobileView,s.user=a.isUserSignedin()||{},s.feedbackRating=s.feedbackRating||{},s.user.userType=s.user.corpDetails?"Corporate":"Retail",p.userType=s.user.userType||"",s.feedback={},s.feedback.answers={},s.captureResponse=!1,s.showLoader=!0,s.feedbackResponse={},s.onSelect=function(e,a){s.feedback.answers[e][a]||delete s.feedback.answers[e][a],s.feedbackResponse.enableSubmit=!_.isEmpty(s.feedback.answers[e])},s.orderId&&!s.requestData?(p.orderid=s.orderId,i.get(t.medsService+"medibuddy/getFeedback?orderId="+s.orderId).then(function(e){e.data.success?(s.requestData=e.data.requestData,d(e.data.feedbackRating)):s.showError=!0},function(e){s.showError=!0})):s.requestData&&d(s.feedbackRating),s.onSubmit=function(){s.feedback.isPositive=s.feedback.stars>3,s.captureResponse=!0,s.feedback.isReasonRequired=!s.feedback.isPositive&&!_.isEmpty(s.feedbackRating.questions)},s.submitFeedback=function(a){s.isPopup||e.scrollTo(0,0);var n={source:o.isWebView?e.navigator.userAgent.indexOf("iPhone")>-1?"IOS":"Android":"MediBuddy_Web",overallRating:s.feedback.stars,remarks:s.feedback.remarks||"",requestId:s.requestData.requestId,orderId:parseInt(s.requestData.orderId),categoryId:s.requestData.contractType,isfeedbackGiven:!!a,fulFillmentType:s.requestData.fulFillmentType,feedbackResponse:{}};!_.isEmpty(s.feedback.answers)&&a&&_.each(s.feedback.answers,function(e,a){var t=Object.keys(e).map(function(e){return parseInt(e)});t&&t.length&&(n.feedbackResponse.questionId=parseInt(a),n.feedbackResponse.answerId=t)}),i.post(t.medsService+"medibuddy/saveFeedback",n).then(function(e){s.feedbackSubmitted=!0,e.data.success&&(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsFeedbackSubmit",payload:window._Site_Props.__getEventParameters({service:!0,custom:_.extend({},p,{"email Id":s.user.userDetails?s.user.userDetails.email:"","rating value":s.feedback.stars,"rating text":s.feedback.remarks||""})})}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsFeedbackStatus",payload:window._Site_Props.__getEventParameters({service:!0,custom:_.extend({},p,{response:!!a})})})),s.isPopup&&s.$emit("onFeedbackSubmit")},function(e){s.feedbackSubmitted=!0})};var m=s.$on("starsSelected",function(e,a){s.feedback.stars=a});s.$on("$destroy",function(e){s.feedback.stars&&s.captureResponse&&!s.feedbackSubmitted&&s.submitFeedback(),m()})}}}]),e.register.directive("videoPopUp",["$rootScope",function(e){return{restrict:"EA",scope:{showVideo:"=?"},templateUrl:"templates/videoPopUp.html?"+timeStamp,link:function(e){e.showVideo=!1;var a=document.getElementById("player");e.isIOS=/iphone|ipod|ipad/.test(window.navigator.userAgent.toLowerCase()),e.isIOS&&(e.showVideo=!0),a&&(a.addEventListener("play",function(){a.style.removeProperty("object-fit"),a.currentTime<.1&&window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"labs",name:"Video Started",payload:window._Site_Props.__getEventParameters({service:!0,custom:{srcPage:"Labs Landing Page",videoURLId:"gV02QFqLH0E",videoTimeInSecs:0}})})}),a.addEventListener("canplaythrough",function(){e.showVideo=!0}),a.addEventListener("ended",function(){window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"labs",name:"Video Ended",payload:window._Site_Props.__getEventParameters({service:!0,custom:{srcPage:"Labs Landing Page",videoURLId:"gV02QFqLH0E",videoTimeInSecs:a?a.currentTime:0}})})}),a.addEventListener("webkitfullscreenchange",function(){document.fullscreenElement&&window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"labs",name:"Video Full Screen",payload:window._Site_Props.__getEventParameters({service:!0,custom:{srcPage:"Labs Landing Page",videoURLId:"gV02QFqLH0E",videoTimeInSecs:a?a.currentTime:0,videoUrl:"https://www.youtube.com/watch?v=gV02QFqLH0E"}})})})),e.closeVideo=function(){e.showVideo=!1,a&&a.pause(),window._MB_Analytics.__push({isCleverTap:!0,hj:!0,dbLog:"labs",name:"Video Force Closed",payload:window._Site_Props.__getEventParameters({service:!0,custom:{srcPage:"Labs Landing Page",videoURLId:"gV02QFqLH0E",videoTimeInSecs:a?a.currentTime:0}})})}}}}])})}();