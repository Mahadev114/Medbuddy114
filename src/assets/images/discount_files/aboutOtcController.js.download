!function(){"use strict";define(["_routes","utility"],function(e,t){e.register.controller("aboutOtcController",["$scope","$rootScope","$stateParams","apiProvider","$window","authService","$state","navConstantsSvc","seoService","$uibModal","$http","medsService","$location","localStorageService","patternService","$timeout",function(e,t,o,i,n,a,s,r,d,c,l,m,p,u,g,b){function y(){b(function(){h=document.querySelector("#otc-item"),S=new Glider(h,{slidesToShow:1,slidesToScroll:1,draggable:!0,scrollLock:!0,skipTrack:!0,arrows:!e.isMobileView&&{prev:".glider-prev",next:".glider-next"},dots:"#dots"})},10)}var C=this,v=a.isUserSignedin();e.isCorpUser=v&&!v.isRetailUser;var f={categoryItemTypeId:"Medicine",city:a.getCity(),pincode:a.getPincode()};e.$emit("selectedCity",f),e.categoryItemTypeId=r.medicineId,e.isCorpSponsoredUser=v&&v.corpDetails&&_.contains(r.sponsoredEntityIds,v.userDetails.pmEntityID),u.get("medsCart")||u.set("medsCart",[]),e.medsCart=u.get("medsCart"),n.scrollTo(0,0),e.noResult=!1,C.pinCode=a.getPincode()?a.getPincode():"",C.city=a.getCity(),o.city=C.city,C.medicine=o.medicine,d.getSeoContent({categoryItemTypeId:r.medicineId,city:C.city,pincode:C.pinCode}),e.pincodeKeyword="",e.item=o.item,e.drugcode=o.drugcode,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",hj:!0,name:"OtcItemPage",payload:window._Site_Props.__getEventParameters({service:!0,custom:{itemCode:o.drugcode}})}),e.cartQuantity=0,e.getMedsOtcStoreData=function(){C.searchData={drugCodes:[e.drugcode],pincode:parseInt(C.pinCode)},l.post(i.medsService+"medibuddy/getDrugCodeInfo",C.searchData).then(function(t){_.isEmpty(t.data.message)||(e.medicines=t.data.message.medicineDetails,e.updateMedicines(),e.medicines[0].productImageSlug&&e.medicines[0].productImageSlug[0]||(e.medicines[0].productImageSlug[0]="assets/images/medicines-default-image.png"),!a.isOtcEnabled()&&e.medicines[0].productFlags.isAddToCart&&p.url("/medicine"),u.set("medsCart",e.medsCart))})},e.getMedsOtcStoreData(),e.updateMedicines=function(){e.cartQuantity=0,m.getCart().then(function(t){e.cart=t&&t.items?t.items:e.medsCart,e.medsCart=e.cart,_.forEach(e.cart,function(t){var o=e.medicines.findIndex(function(o){return e.item={count:t.count||t.addedQuantity},o.drugCode==t.drugCode});o==-1||(e.medicines[o].count=t.count||t.addedQuantity),e.cartQuantity+=t.count||t.addedQuantity}),u.set("medsCart",e.medsCart)})},e.openDialog=function(o){c.open({animation:!0,backdrop:"none",template:'<div class="modal-bottom-header modal-header p-t-10 p-l-20 p-r-20 primary-color"><div class="btn-border-close m-b-20"><span class="cursor-pointer pull-right" ng-style="{\'color\':isHover ? \'#000\' : \'#aaa\'}" ng-class="{\'md-dark-color\':isMobileView}"ng-init="isHover=false;" ng-mouseover="isHover=true;" ng-mouseout="isHover=false;" ng-click="closeModal()">close</span></div><div class="lgTxt bold">Can not add more than added quantity for this item</div></div><div class="modal-body primary-color modal-border-body clearfix" ng-class="{\'p-t-0\':!isMobileView}"><div class="col-xs-12 col-md-12 p-l-0 p-r-0"><di class="m-b-5"><b>{{centerVisitTest}}</b> </di><button class="br-15 btn btn-danger btn-block p-t-10 p-b-10 m-t-20" ng-click="continue()">Okay</button></div></div>',scope:e,controller:["$scope","$uibModalInstance",function(e,t){e.centerVisitTest=o.name,e.closeModal=function(){t.dismiss("cancel")},e.apply=function(){e.closeModal()},e["continue"]=function(){e.closeModal()}}],size:t.isMobileView?"bottom":"border modal-sm",windowClass:t.isMobileView&&"bottom-sheet"})},e.addItemToCart=function(t){return t.count=t.count?t.count:0,t.count<(t.maxQuantity||5)?void m.updateItemOfCart(parseInt(t.drugCode),"add",t).then(function(t){e.medsCart=t,t&&t.cart&t.cart.items&&(e.medsCart=t.cart.items),e.cartQuantity+=1}):void e.openDialog(t)},e.removeItemFromCart=function(o,i){var n=e.medicines.findIndex(function(e){return o.drugCode==e.drugCode});o.count>1?m.updateItemOfCart(parseInt(o.drugCode),"remove",o).then(function(t){e.medsCart=t,t&&t.cart&t.cart.items&&(e.medsCart=t.cart.items),e.cartQuantity-=1}):1==o.count&&c.open({animation:!0,backdrop:"none",template:'<div class="modal-bottom-header modal-header p-t-10 p-l-20 p-r-20 primary-color"><div class="btn-border-close m-b-20"><span class="cursor-pointer pull-right" ng-style="{\'color\':isHover ? \'#000\' : \'#aaa\'}" ng-class="{\'md-dark-color\':isMobileView}"ng-init="isHover=false;" ng-mouseover="isHover=true;" ng-mouseout="isHover=false;" ng-click="closeModal()">close</span></div><div class="lgTxt bold">Are you sure you want to remove the following item?</div></div><div class="modal-body primary-color modal-border-body clearfix" ng-class="{\'p-t-0\':!isMobileView}"><div class="col-xs-12 col-md-12 p-l-0 p-r-0"><di class="m-b-5"><b>{{centerVisitTest}}</b> </di><button class="br-15 btn btn-primary btn-block p-t-10 p-b-10 m-t-20" ng-click="apply()">Yes, Remove</button> <button class="br-15 btn btn-danger btn-block p-t-10 p-b-10 m-t-20" ng-click="continue()">No</button></div></div>',scope:e,controller:["$scope","$uibModalInstance",function(t,i){t.centerVisitTest=o.name,t.closeModal=function(){i.dismiss("cancel")},t.apply=function(){m.updateItemOfCart(parseInt(o.drugCode),"remove",o).then(function(t){e.medsCart=t,t&&t.cart&t.cart.items&&(e.medsCart=t.cart.items),e.cartQuantity-=1,e.medicines[n].count=0,e.updateMedicines()}),t.closeModal(),e.cartItems&&0==e.cartItems.length&&e.$broadcast("clearFiles")},t["continue"]=function(){t.closeModal()}}],size:t.isMobileView?"bottom":"border modal-sm",windowClass:t.isMobileView&&"bottom-sheet"})},e.goToOtcStore=function(){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",hj:!0,name:"OtcContinueShopping",payload:window._Site_Props.__getEventParameters({service:!0,custom:{}})}),s.go("app.otcCategory",{})},e.prevPage=function(){n.history.go(-1)},y(),e.cartquantity=u.get("guestCartQuantity")+u.get("normalCartQuantity");var S=null,h=null;e.goToOtcMStore=function(){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",hj:!0,name:"OtcContinueShopping",payload:window._Site_Props.__getEventParameters({service:!0,custom:{}})}),s.go("app.otcMStore",{})},e.medsCartInfo=a.medsCartInfo,e.adjudicationText={0:"CASHLESS",1:"COD",2:"OTHERS"},e.proceedAfterValidation=function(){var t={},n={sessionData:{},forceUpdate:!0};n.sessionData[r.medicineId]=JSON.stringify(t),a.makeAjaxCalls(i.apiUrl+"/SessionStorage.json",n,"POST",e.userObj.token).then(function(e){e.data.isSuccess&&s.go("app.medicineCart",{pincode:a.getPincode(),medicine:o.medicine||C.medicine||"medicine"},{reload:"app.medicineCart"})})},e.proceed=function(){if(e.medsCart.length||e.medsCart.cart.items.length){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",name:"MedsViewCart"});var t=a.isUserSignedin();if(t){var o=a.isUserSignedin();e.userObj=o,o?_.isEmpty(o)||a.makeAjaxCalls(i.apiUrl+"/UpdateSession/"+o.token,"","GET").then(function(t){t.data?e.proceedAfterValidation():a.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"fileUpload",func:"proceed",args:null,stayInState:!0})}):a.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"fileUpload",func:"proceed",args:null,stayInState:!0})}else a.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"fileUpload",func:"proceed",args:null,stayInState:!0});_.isEmpty(e.medicineCart)||window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsSearchRxButton",payload:window._Site_Props.__getEventParameters({service:!0})})}};var I=t.$on("userLogin",function(){e.medsCart=a.updateMedsLocalCart(),v=a.isUserSignedin(),m.addBulkItemToCart(),v.isRetailUser||s.go("app.medicine",{categoryItemTypeId:"Medicine",city:a.getCity()||"Bengaluru",pincode:a.getPincode()||560029}),e.updateMedicines()}),M=t.$on("userLogout",function(){e.medsCart=m.removeMedsCart(),e.updateMedicines(),s.go("app.medicine",{categoryItemTypeId:"Medicine"})});e.$on("$destroy",function(){I(),M()})}])})}();