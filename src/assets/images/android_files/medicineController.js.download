!function(){"use strict";define(["_routes","utility"],function(e,t){e.register.controller("medicineController",["$scope","$rootScope","$stateParams","apiProvider","$window","authService","$state","navConstantsSvc","seoService","$uibModal","$timeout","patternService","medsService","notify","localStorageService","$http",function(e,i,o,r,a,n,s,d,c,l,p,m,u,g,v,y){function f(){l.open({animation:!0,template:'<div class="modal-header"><h3 class="modal-title text-center"><strong>{{heading}}</strong></h3></div><div class="modal-body terms-modal"><div ng-repeat="row in rows"><div ng-bind-html="row" ></div></div></div><div class="modal-footer"><button class="btn btn-primary btn-block" style="height:50px" ng-click="closeModal()">I Agree</button></div>',scope:e,size:"md",controller:["$uibModalInstance","$scope",function(t,i){i.rows=e.user.cwcDisclaimer.content,i.heading=e.user.cwcDisclaimer.heading,i.closeModal=function(){t.dismiss("cancel"),sessionStorage.setItem("hideConsentForm","true")}}]})}function b(){_.each(M,function(e,t){p.cancel(e),e&&(e.destroy(),M[t]=null,P[t]=null)})}var h="",C=this,I=n.isUserSignedin();a.scrollTo(0,0),v.get("city")&&(e.city=n.getCity().toLowerCase()),e.master={},e.emailPattern=m,e.pinCode=o.pincode||n.getPincode(),o.pincode&&n.setPincode(o.pincode),e.pincodeKeyword="",e.clearPincodeKeyword=function(){e.pincodeKeyword=""},v.get("medsCart")||v.set("medsCart",[]),e.medsCart=v.get("medsCart"),e.categoryItemTypeId=d.medicineId,e.user=n.isUserSignedin(),e.isCorpUser=e.user&&!e.user.isRetailUser,e.isRetailUser=!e.isCorpUser,e.isMchiUser=!1,e.isMorganStanleyUser=!1,e.isSlotAvailable=!0,window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",hj:!0,name:"MedsHomePage",payload:window._Site_Props.__getEventParameters({service:!0,custom:{}})}),e.user&&e.user.userDetails.pmEntityID&&e.user.cwcDisclaimer&&e.user.cwcDisclaimer.eligible_places.includes("medicine")&&"true"!=sessionStorage.getItem("hideConsentForm")&&f(),e.user&&e.user.userDetails.pmEntityID&&d.mchiEntityIds.indexOf(e.user.userDetails.pmEntityID)>-1&&(e.isMchiUser=!0),e.user&&e.user.userDetails.pmEntityID&&d.visionCareEntityIds.indexOf(e.user.userDetails.pmEntityID)>-1&&(e.visionCareEntityIds=!0),e.user&&e.user.userDetails&&e.user.userDetails.pmEntityID&&n.makeAjaxCalls(r.medsService+"app/getOrderLimit",{PMEntityId:e.user.userDetails.pmEntityID},"POST").then(function(t){e.isSlotAvailable=!0,e.slotMessage=t.data.displayText})["catch"](function(t){e.isSlotAvailable=!0}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsSearchPage",payload:window._Site_Props.__getEventParameters({service:!0,custom:{pincode:n.getPincode()}})}),e.userObj=n.getUserObj(),e.userObj&&e.userObj.userDetails.pmEntityID&&d.intelEntityIds.indexOf(e.userObj.userDetails.pmEntityID)>-1&&(e.intelEmp=!0),e.userObj&&e.userObj.userDetails.pmEntityID&&d.walmartEntityIds.indexOf(e.userObj.userDetails.pmEntityID)>-1&&(e.walmartEmp=!0),e.medsCartInfo=n.medsCartInfo,e.adjudicationText={0:"CASHLESS",1:"COD",2:"OTHERS"},e.userObj&&e.userObj.userDetails.pmEntityID&&(d.rakutenIds.indexOf(e.userObj.userDetails.pmEntityID)>-1&&(e.rakutenIds=!0),d.tcsIds.indexOf(e.userObj.userDetails.pmEntityID)>-1&&(e.tcsIds=!0),d.belIds.indexOf(e.userObj.userDetails.pmEntityID)>-1&&(e.belIds=!0),d.tceIds.indexOf(e.userObj.userDetails.pmEntityID)>-1&&(e.tceIds=!0),d.jabongIds.indexOf(e.userObj.userDetails.pmEntityID)>-1&&(e.jabongIds=!0),d.myntraIds.indexOf(e.userObj.userDetails.pmEntityID)>-1&&(e.myntraIds=!0),d.instacartIds.indexOf(e.userObj.userDetails.pmEntityID)>-1&&(e.instacartIds=!0),d.balIds.indexOf(e.userObj.userDetails.pmEntityID)>-1&&(e.balIds=!0));var w=e.isMobileView?200:300;e.isSticky=!1,e.handleScrollEvent=function(){var i=t.getScrollPosition();document.querySelector("#products");i>w&&!document.querySelector(".modal-open")?((document.querySelector("header").classList.contains("home")||e.isMobileView)&&document.querySelector(".search-background")&&document.querySelector(".search-background").classList.add("fixed-product-search"),document.querySelector(".search-background")&&!e.isMobileView&&document.querySelector(".search-background").classList.add("fixed-product-search"),e.isSticky=!0,e.$apply()):(document.querySelector(".search-background")&&document.querySelector(".search-background").classList.remove("fixed-product-search"),e.isSticky=!1,e.$apply())};var S=_.throttle(e.handleScrollEvent,d.scrollThrottleThreshold);a.addEventListener("scroll",S),c.getSeoContent({categoryItemTypeId:d.medicineId,city:e.city,pincode:e.pinCode}),window._Site_Props.__setServiceDetails({serviceName:d.medicineFilterName,serviceType:d.medicineFilterName}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Search",fbq:!0,fbqReference:"ViewContent",payload:window._Site_Props.__getEventParameters({service:!0,custom:{pincode:n.getPincode()}}),branchLog:{name:"Topic Visited",custom_data:{topic:d.medicineFilterName}}}),e.patternService=m,e.fetchInfoForpincode=function(t){var i={categoryItemTypeId:d.medicineId,pinCode:t,getPackageDetails:!0};e.pincodeKeyword=t,e.isMedibuddyLoading=!0,h=r.apiUrl+"pinCodeAvailabilityCheck.json",n.makeAjaxCalls(h,i,"POST",I.token,e.city).then(function(i){if(i.data.isAvailable&&_.contains(n.allCities,i.data.pincodeCity)){i.data.pincodeCity&&(e.city=i.data.pincodeCity,n.medicineCityParams&&o.city&&(o.city=n.medicineCityParams),o.city&&o.city!=i.data.pincodeCity.toLowerCase()?(e.pinCode=null,n.setPincode(null)):(n.setPincode(t),n.setCity(i.data.pincodeCity),o.city=i.data.pincodeCity.toLowerCase(),e.pinCode=t,s.transitionTo("app.medicine",{city:n.getCity().toLowerCase()},{inherit:!0,relative:s.$current,notify:!1,location:"replace"}),e.$emit("selectedCity",o))),e.isMedibuddyLoading=!1,e.isAvailable=!0,p(function(){document.querySelector("#product-search")&&document.querySelector("#product-search").focus()}),e.providerInfo=i.data.packageDetails;var r=_.findWhere(e.providerInfo,{packageId:d.apolloPackageId});if(e.hasApollo=!(!r||!_.findWhere(r.providers,{isStorePickup:!0})),e.courierInfo=_.first(_.first(e.providerInfo).providers).courierInfo,e.hasCourier=!(1!=e.providerInfo.length||e.hasApollo||!e.courierInfo),e.hasCourier){e.courierDiscount="15";var a=new Date;e.courierDelivery=a.setDate(a.getDate()+parseInt(e.courierInfo.deliveryTime)+1)}e.hasOthers=e.providerInfo.length>1||1===e.providerInfo.length&&!e.hasApollo&&!e.hasCourier}else e.isMedibuddyLoading=!1,e.isAvailable=!1,e.details.pincodeSelectionToogle=!1})},e.pinCode&&e.city&&e.fetchInfoForpincode(e.pinCode),e.goToOtcStore=function(){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",hj:!0,name:"OtcViewall",payload:window._Site_Props.__getEventParameters({service:!0,custom:{}})}),s.go("app.otcCategory",{})},e.goToOtcMStore=function(){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",hj:!0,name:"OtcViewall",payload:window._Site_Props.__getEventParameters({service:!0,custom:{}})}),s.go("app.otcMStore",{})};var M={},P={},O={};e.initializeMedsGlider=function(t,i){O[t]=p(function(){P[t]=document.querySelector("#"+t),M[t]=new Glider(P[t],{slidesToShow:i?e.isMobileView?1:i:e.isMobileView?1.5:4,slidesToScroll:i?e.isMobileView?1:i:e.isMobileView?1.5:2,draggable:!0,scrollLock:!0,skipTrack:!0,arrows:!e.isMobileView&&{prev:".prev-"+t,next:".next-"+t},dots:e.isMobileView&&"#dots"+t})},10)},e.stateTransition=function(e){"labs"==e?(s.go("app.labs"),{reload:"app.labtest"}):"medicine"==e&&s.go("app.medicine",{city:n.getCity().toLowerCase(),pincode:v.get("pincode")},{reload:"app.labtest"})},e.bigStageBanners=[{imgSrc:"/assets/banners/medicine-page.webp",title:"Medicine"}],e.bigStageBannersMob=[{imgSrc:"/assets/banners/medicine-page-mob.webp",title:"Medicine"}];var k=function(t){return new Promise(function(i,o){var a={categoryItemTypeId:d.medicineId,pinCode:t,getPackageDetails:!0},s=r.apiUrl+"pinCodeAvailabilityCheck.json";n.makeAjaxCalls(s,a,"POST","",e.city).then(function(r){r.data.isSuccessStatusCode?(e.selectedPincode=t,e.providerInfo=r.data.packageDetails,i(r.data)):o()},function(e){o()})})},D=function(){I=n.isUserSignedin(),e.isUserLogedIn=!!I,I&&n.makeAjaxCalls(r.apiUrl+"/SessionStorage/"+d.medicineId+".json","","GET",I.token).then(function(t){if(!_.isEmpty(t.data.sessionData)&&!_.isEmpty(t.data.sessionData[d.medicineId])){var i=JSON.parse(t.data.sessionData[d.medicineId]);!_.isEmpty(i.cart)&&_.isEmpty(e.cartItems)&&(e.medicineCart=i.cart,e.cartItems=i.cart.cartItems,n.medsCartInfo.cartItems=e.cartItems,n.medsCartInfo.quantity=e.medicineCart.totalItems,n.medsCartInfo.lastSelected=e.medicineCart.totalItems?_.last(e.medicineCart.medicineItems).medicineName.split(" ")[0]:"")}})};e.proceed=function(){if(e.medsCart.length||e.medsCart.cart.items.length){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",name:"MedsViewCart"});var t=n.isUserSignedin();if(t){var i=n.isUserSignedin();e.userObj=i,i?_.isEmpty(i)||e.proceedAfterValidation():n.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"fileUpload",func:"proceed",args:null,stayInState:!0})}else n.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"fileUpload",func:"proceed",args:null,stayInState:!0});_.isEmpty(e.medicineCart)||window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsSearchRxButton",payload:window._Site_Props.__getEventParameters({service:!0})})}};var T=function(){if(I=n.isUserSignedin(),e.isUserLogedIn=!!I,e.fileDownloadUrl=r.apiUrl+"GetFile/",e.totalOrder=[],I){e.filterPatient="All orders",e.filterData=[{value:"All orders",name:"All orders"}];var t=r.apiUrl+"/medicineorder.json";e.medicineDetails=[],e.loadingPreviousOrders=!0,n.makeAjaxCalls(t,"","GET",I.token,void 0,!0).then(function(t){if(e.showPrevOrdersList=!0,e.loadingPreviousOrders=!1,t.data.isSuccess){if(n.reOrderId){e.selectedOrderModel=n.reOrderId;var i=_.findWhere(t.data.orders,{orderId:n.reOrderId});_.isEmpty(i)?n.reorder?(e.totalOrder.push(n.reorder.requests[0]),e.orderAgain(n.reorder.requests[0])):e.totalOrder=t.data.orders:(e.totalOrder.push(i),e.orderAgain(i))}else e.totalOrder=t.data.orders;_.forEach(e.totalOrder,function(e,t){var i=[];_.forEach(e.uploadedFiles,function(e,t,o){if(e&&"string"==typeof e){var r=e.split("/");i.push(r[0])}}),e.uploadedFiles=i,i=[],e.isSelected=!1,e.medicineLimit=3}),e.orderAvailable=!0,t.data.orders&&(e.allPharmacyOrder=angular.copy(t.data.orders.reverse()));var o={};_.forEach(e.totalOrder,function(t){var i=t.maid;i&&!o[i]&&(e.filterData.push({value:t.maid,name:t.patientName}),o[i]=!0)})}else e.orderAvailable=!1;window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Load Previous Orders",payload:window._Site_Props.__getEventParameters({service:!0})})})["catch"](function(e){console.log(e)})}};e.filterByPatient=function(t){e.filterPatient=t.name,e.allPharmacyOrder&&"All orders"!==t.value?e.totalOrder=_.filter(e.allPharmacyOrder,function(e){return e.maid===t.value}):e.totalOrder=e.allPharmacyOrder},e.loginUser=function(){n.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"pharmacyController",func:"proceed",args:null,stayInState:!0})};var A=function(e){return new Promise(function(t,i){var o={pincode:[+e],distance:2},a=r.apiUrl+"pickUpStore.json";n.makeAjaxCalls(a,o,"POST").then(function(e){e.data.isSuccess&&e.data.stores&&e.data.stores.length>0?t(e.data.stores):i()},function(){i()})})},E=function(t){t&&(I?_.isEmpty(I)||n.makeAjaxCalls(r.apiUrl+"/UpdateSession/"+I.token,"","GET").then(function(i){i.data?e.proceedAfterValidation(t):n.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"pharmacyController",func:"proceed",args:null,stayInState:!0})}):n.openLoginPopup("lg","templates/openLoginPopUp.html?"+timeStamp,{controller:"pharmacyController",func:"proceed",args:null,stayInState:!0}))},x=function(t,i){e.city=t,n.setCity(t),o.city=t.toLowerCase(),e.$emit("selectedCity",o)};e.reorder=function(t){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"ReOrderHome",payload:window._Site_Props.__getEventParameters({service:!0,custom:{}})}),u.getCart().then(function(o){o&&o.items&&o.items.length>0?l.open({animation:!0,backdrop:"none",template:'<div class="modal-bottom-header modal-header p-t-10 p-l-20 p-r-20 primary-color"><div class="btn-border-close m-b-20"><span class="cursor-pointer pull-right" ng-style="{\'color\':isHover ? \'#000\' : \'#aaa\'}" ng-class="{\'md-dark-color\':isMobileView}"ng-init="isHover=false;" ng-mouseover="isHover=true;" ng-mouseout="isHover=false;" ng-click="closeModal()">close</span></div><div class="lgTxt bold">Your cart is not empty. You need to clear the cart to reorder. </div></div><div class="modal-body primary-color modal-border-body clearfix" ng-class="{\'p-t-0\':!isMobileView}"><div class="col-xs-12 col-md-12 p-l-0 p-r-0"><di class="m-b-5"><b>{{centerVisitTest}}</b> </di><button class="br-15 btn btn-primary btn-block p-t-10 p-b-10 m-t-20" ng-click="apply()">Clear cart & Proceed</button></div></div>',scope:e,controller:["$scope","$uibModalInstance",function(i,o){i.closeModal=function(){o.dismiss("cancel")},i.apply=function(){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"ReOrderClearCart",payload:window._Site_Props.__getEventParameters({service:!0,custom:{}})}),n.reOrderId=t.orderId,u.reorder(t.orderId,t.pincode,t.city,!0).then(function(){n.reorder=t,e.orderAgain(t)}),i.closeModal()},i["continue"]=function(){i.closeModal()}}],size:i.isMobileView?"bottom":"border modal-sm",windowClass:i.isMobileView&&"bottom-sheet"}):(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"ReOrderClearCart",payload:window._Site_Props.__getEventParameters({service:!0,custom:{}})}),n.reOrderId=t.orderId,u.reorder(t.orderId,t.pincode,t.city,!0).then(function(){n.reorder=t,e.orderAgain(t)}))})},e.orderAgain=function(t){e.selectedProvider=null,e.selectedStore=null,e.selectedPincode="",k(t.pincode).then(function(i){i.isAvailable?(x(i.pincodeCity,t.pincode),t.pickUpStoreId?A(t.pincode).then(function(o){if(o&&o.length>0)for(var r=0;r<o.length;r++)if(o[r].isActive&&o[r].storeID&&t.pickUpStoreId==o[r].storeID){var a=_.filter(i.packageDetails,function(e){return e.packageId===t.packageId});a&&a.length>0&&(e.selectedProvider=a[0],e.selectedStore=o[r]);break}E(t)})["catch"](function(){E(t)}):E(t)):k(t.pincode).then(function(e){e.isAvailable&&x(e.pincodeCity,t.pincode)})})["catch"](function(){k(t.pincode).then(function(e){e.isAvailable&&x(e.pincodeCity,t.pincode)})}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsReOrder"})},e.fileArray=[],e.proceedAfterValidation=function(t){if(t=t||"goToCart","goToCart"!=t){if(window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"Reorder",payload:window._Site_Props.__getEventParameters({service:!0})}),n.reOrderId&&(e.fileArray=n.medsReoderFiles),e.fileArray.length>0){var i={fileArrays:JSON.stringify(e.fileArray),remark:JSON.stringify(t.medicineDetails)};if(i.providerInfo=JSON.stringify(e.providerInfo),e.hasCourier&&(i.courierInfo=e.courierInfo),"true"==t.pushToPartner&&(i.pushToPartner=!0),e.selectedStore&&(i.store=JSON.stringify(e.selectedStore)),t){var a={maid:t.maid,patientName:t.patientName,dob:t.dob,gender:t.gender};t.phoneNo&&(a.phone=t.phoneNo),t.email&&(a.email=t.email),i.patientData=JSON.stringify(a)}}}else var i={};var c={sessionData:{},forceUpdate:!0};c.sessionData[d.medicineId]=JSON.stringify(i),n.makeAjaxCalls(r.apiUrl+"/SessionStorage.json",c,"POST",I.token).then(function(i){if(i.data.isSuccess)if("goToCart"!=t){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,name:"Slot Booked",fbq:!0,fbqReference:"AddToCart",payload:window._Site_Props.__getEventParameters({service:!0,google:window._Site_Props.__googleTransform("Medicine","SlotBooked",n.getPincode())})});var r;if(e.providerInfo&&e.providerInfo.length>0){for(var a=0;a<e.providerInfo.length;a++){var c=e.providerInfo[a];if(c.packageId!==d.apolloPackageId){r=c;break}e.storePickup=c}1!==e.providerInfo.length||r||(r=e.storePickup)}var l={packageId:t.packageId,packageName:t.packageName},p=e.selectedProvider||l;n.reOrderId&&n.reorder&&window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"NonDigitisedCart",payload:window._Site_Props.__getEventParameters({service:!0,custom:{}})}),n.reOrderId&&n.reorder&&s.go("app.payment",{categoryItemTypeId:o.categoryItemTypeId,searchc:e.selectedPincode||n.getPincode(),searchk:p.packageName,dcId:d.medicineId,packageId:p.packageId,reorder:!0},{reload:"app.payment"})}else n.reOrderId&&n.reorder?window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"DigitisedCart",payload:window._Site_Props.__getEventParameters({service:!0,custom:{}})}):s.go("app.medicineCart",{pincode:n.getPincode(),medicine:o.medicine||C.medicine||"medicines"},{reload:"app.medicineCart"})})},e.$on("changeCity",function(t,i){var o=n.getCity().toLowerCase();o!==e.city&&s.go("app.medicine",{city:o,pincode:""},{reload:"app.medicine"})}),e.appRedirect=function(e,t){n.appRedirect(e,t)},e.activateChat=function(){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsTTDoctor"}),n.activateChat()},e.onBannerClick=function(e){switch(e){case"vision":window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!0,hj:!0,dbLog:!0,name:"VisionCare_web_MedsLandingPage_bannerclick",payload:window._Site_Props.__getEventParameters({custom:{service:!0}})})}},e.coviSelfBannerClicked=function(){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"BannerClick",payload:window._Site_Props.__getEventParameters({service:!0,custom:{packageName:"CoviSelf"}})})},e.prescriptionUpload=function(){var t=u.getCart();t&&(e.medsCart=n.removeMedsLocalCart(),u.removeCartId(),g({message:"Items in the Cart are removed",position:"center",duration:5e3})),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",hj:!0,name:"MedsUploadRxHome",payload:window._Site_Props.__getEventParameters({service:!0,custom:{pincode:e.pinCode}})}),window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,name:"MedsRxUpload"}),s.go("app.pharmacy",{pincode:e.pinCode,medicine:""},{reload:"app.pharmacy"}),e.isSlotAvailable||blockOrders()},e.orderLimit=6,e.bannerExt=navigator.userAgent.indexOf("Chrome")>-1||navigator.userAgent.indexOf("Firefox")>-1?"webp":"png",e.onLoadMore=function(){e.totalOrder&&e.orderLimit<=e.totalOrder.length&&(e.orderLimit=e.orderLimit+6),n.scrollToSection("card-"+(e.orderLimit-3))},T(),D(),e.blockOrders=function(){l.open({animation:!0,template:'<div class="modal-header"><div class="smdTxt bold m-l-5">Block</div><button class="btn btn-default btn-close pull-left" type="button" ng-click="cancelDialog()"><i class="mm mm-close"></i></button></div><div class="modal-body clearfix"><div class=" col-xs-12 col-md-12">'+e.slotMessage+"</div>",controller:["$scope","$uibModalInstance",function(e,t){e.isMobileView=!0,e.medicineFlow=d.medicineInstructions,e.cancelDialog=function(){t.dismiss("cancel")}}],size:i.isMobileView?"full-height-mobile":"login"})},e.cartQuantity=0,e.updateMedicines=function(){e.cartQuantity=0,u.getCart().then(function(t){e.cart=t.items||e.medsCart,e.medsCart=e.cart,_.forEach(e.cart,function(t){var i=e.medicines.findIndex(function(i){return e.item={count:t.count||t.addedQuantity},i.drugCode==t.drugCode});i==-1||(e.medicines[i].count=t.count||t.addedQuantity),e.cartQuantity+=t.count||t.addedQuantity}),v.set("medsCart",e.medsCart)})},e.getMedsOtcStoreData=function(){e.top8=[];var t="1018900";e.user&&(t=e.user.userDetails.pmEntityID),y.get(r.medsService+"app/medicine/top/deals",{headers:{pmEntityId:t,source:"web"}}).then(function(t){e.isOTCUser=t.data.message.isOtcStoreEnabled,e.medicines=t.data.message.medicineDetails,e.medicines.forEach(function(e){e.image=e.productImageSlug[0],e.fromOtcStore=!0,e.count=0}),e.updateMedicines()})},e.getMedsOtcStoreData(),e.openDialog=function(t){l.open({animation:!0,backdrop:"none",template:'<div class="modal-bottom-header modal-header p-t-10 p-l-20 p-r-20 primary-color"><div class="btn-border-close m-b-20"><span class="cursor-pointer pull-right" ng-style="{\'color\':isHover ? \'#000\' : \'#aaa\'}" ng-class="{\'md-dark-color\':isMobileView}"ng-init="isHover=false;" ng-mouseover="isHover=true;" ng-mouseout="isHover=false;" ng-click="closeModal()">close</span></div><div class="lgTxt bold">Can not add more than five quantity for this item</div></div><div class="modal-body primary-color modal-border-body clearfix" ng-class="{\'p-t-0\':!isMobileView}"><div class="col-xs-12 col-md-12 p-l-0 p-r-0"><di class="m-b-5"><b>{{centerVisitTest}}</b> </di><button class="br-15 btn btn-danger btn-block p-t-10 p-b-10 m-t-20" ng-click="continue()">Okay</button></div></div>',scope:e,controller:["$scope","$uibModalInstance",function(e,i){e.centerVisitTest=t.name,e.closeModal=function(){i.dismiss("cancel")},e.apply=function(){e.closeModal()},e["continue"]=function(){e.closeModal()}}],size:i.isMobileView?"bottom":"border modal-sm",windowClass:i.isMobileView&&"bottom-sheet"})},e.addItemToCart=function(t){return t.count=t.count?t.count:0,t.count<t.maxQuantity?void u.updateItemOfCart(parseInt(t.drugCode),"add",t).then(function(t){e.medsCart=t,t&&t.cart&&t.cart.items&&(e.medsCart=t.cart.items),e.cartQuantity+=1}):void e.openDialog(t)},e.removeItemFromCart=function(t,o){var r=e.medicines.findIndex(function(e){return t.drugCode==e.drugCode});t.count>1?u.updateItemOfCart(parseInt(t.drugCode),"remove",t).then(function(t){e.medsCart=t.cart.items,e.cartItems=e.medsCart,e.cartQuantity-=1,i.$apply()}):1==t.count&&l.open({animation:!0,backdrop:"none",template:'<div class="modal-bottom-header modal-header p-t-10 p-l-20 p-r-20 primary-color"><div class="btn-border-close m-b-20"><span class="cursor-pointer pull-right" ng-style="{\'color\':isHover ? \'#000\' : \'#aaa\'}" ng-class="{\'md-dark-color\':isMobileView}"ng-init="isHover=false;" ng-mouseover="isHover=true;" ng-mouseout="isHover=false;" ng-click="closeModal()">close</span></div><div class="lgTxt bold">Are you sure you want to remove the following item?</div></div><div class="modal-body primary-color modal-border-body clearfix" ng-class="{\'p-t-0\':!isMobileView}"><div class="col-xs-12 col-md-12 p-l-0 p-r-0"><di class="m-b-5"><b>{{centerVisitTest}}</b> </di><button class="br-15 btn btn-primary btn-block p-t-10 p-b-10 m-t-20" ng-click="apply()">Yes, Remove</button> <button class="br-15 btn btn-danger btn-block p-t-10 p-b-10 m-t-20" ng-click="continue()">No</button></div></div>',scope:e,controller:["$scope","$uibModalInstance",function(o,a){o.centerVisitTest=t.name,o.closeModal=function(){a.dismiss("cancel")},o.apply=function(){u.updateItemOfCart(parseInt(t.drugCode),"remove",t).then(function(t){e.medsCart=t.cart.items,e.cartItems=e.medsCart,e.cartQuantity-=1,e.medicines[r].count=0,i.$apply()}),o.closeModal(),0==e.cartItems.length&&e.$broadcast("clearFiles")},o["continue"]=function(){o.closeModal()}}],size:i.isMobileView?"bottom":"border modal-sm",windowClass:i.isMobileView&&"bottom-sheet"})},e.howToOrder=function(){l.open({animation:!0,template:'<div class="modal-header"><div class="smdTxt bold m-l-5">How to Order through Prescription</div><button class="btn btn-default btn-close pull-left" type="button" ng-click="cancelDialog()"><i class="mm mm-close"></i></button></div><div class="modal-body clearfix"><div class=" col-xs-12 col-md-12"><ng-include src="\'how_to_order.html\'"><div></ng-include></div>',controller:["$scope","$uibModalInstance",function(e,t){e.isMobileView=!0,e.medicineFlow=d.medicineInstructions,e.cancelDialog=function(){t.dismiss("cancel")}}],size:i.isMobileView?"full-height-mobile":"login"})},e.$emit("selectedCity",o);var L=i.$on("userLogin",function(t,i){e.medsCart=n.updateMedsLocalCart(),e.user=n.isUserSignedin(),u.addBulkItemToCart(),e.updateMedicines(),e.isCorpUser=e.user&&0==e.user.isRetailUser,e.isRetailUser=!e.isCorpUser,T(),D()}),U=i.$on("userLogout",function(t,i){e.user=n.isUserSignedin(),e.isCorpUser=e.user&&0==e.user.isRetailUser,e.isRetailUser=!e.isCorpUser,n.medsCartInfo={quantity:0},e.medsCart=u.removeMedsCart(),e.updateMedicines(),e.getMedsOtcStoreData(),s.go("app.medicine",{categoryItemTypeId:"Medicine"}),sessionStorage.removeItem("hideConsentForm")});e.$on("$destroy",function(){L&&L(),_.each(O,function(e){p.cancel(e)}),U(),b()}),i.$on("$destroy",function(){a.removeEventListener("scroll",S),document.querySelector(".search-background")&&document.querySelector(".search-background").classList.remove("fixed-product-search"),e.isSticky=!1,e.$apply()}),e.goToAboutItem=function(e){window._MB_Analytics.__push({isCleverTap:!0,isGoogle:!1,dbLog:"meds",hj:!0,name:"OtcItem",payload:window._Site_Props.__getEventParameters({service:!0,custom:e})}),s.go("app.aboutOtc",{item:e,drugcode:e.drugCode})}}])})}();